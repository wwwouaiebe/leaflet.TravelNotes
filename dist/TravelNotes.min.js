/**
 * 
 * @source: https://github.com/wwwouaiebe/leaflet.TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * leaflet.travelnotes - version 1.11.0
 * Build 00124 - 2020-07-10T17:51:42+0200 
 * Copyright 2017 2020 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";let e=function(){let e={autoLoad:!1,map:{center:{lat:50.50923,lng:5.49542},zoom:12},travelNotesToolbarUI:{contactMail:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues"},layersToolbarUI:{haveLayersToolbarUI:!0,toolbarTimeOut:1500,contactMail:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues",theDevil:{addButton:!1,title:"Reminder! The devil will know everything about you",text:"&#x1f47f;"}},mouseUI:{haveMouseUI:!0},errorUI:{timeOut:1e4,helpTimeOut:3e4,showError:!0,showWarning:!0,showInfo:!0,showHelp:!0},geoLocation:{color:"red",radius:11,zoomToPosition:!0,zoomFactor:17,options:{enableHighAccuracy:!1,maximumAge:0,timeout:1/0}},APIKeys:{showDialogButton:!0,saveToSessionStorage:!0,showAPIKeysInDialog:!0,dialogHaveUnsecureButtons:!0},contextMenu:{timeout:1500},routing:{auto:!0},language:"fr",itineraryPointMarker:{color:"red",weight:2,radius:7,fill:!1},searchPointMarker:{color:"green",weight:4,radius:20,fill:!1},searchPointPolyline:{color:"green",weight:4,radius:20,fill:!1},previousSearchLimit:{color:"green",fill:!1,weight:1},nextSearchLimit:{color:"red",fill:!1,weight:1},wayPoint:{reverseGeocoding:!1},route:{color:"#ff0000",width:3,dashArray:0,dashChoices:[{text:"——————",iDashArray:null},{text:"— — — — —",iDashArray:[4,2]},{text:"—‧—‧—‧—‧—",iDashArray:[4,2,0,2]},{text:"················",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:.25,smoothPoints:3},showDragTooltip:3},note:{reverseGeocoding:!1,grip:{size:10,opacity:0},polyline:{color:"gray",weight:1},style:"",svgIconWidth:200,svgAnleMaxDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},svgZoom:17,svgAngleDistance:10,svgHamletDistance:200,svgVillageDistance:400,svgCityDistance:1200,svgTownDistance:1500,svgTimeOut:15e3,cityPrefix:'<span class="TravelNotes-NoteHtml-Address-City">',cityPostfix:"</span>",maxManeuversNotes:100},itineraryPointZoom:17,routeEditor:{displayEditionInHTMLPage:!0},travelEditor:{clearAfterSave:!0,startMinimized:!0,timeout:1e3,startupRouteEdition:!0},haveBeforeUnloadWarning:!0,overpassApiUrl:"https://lz4.overpass-api.de/api/interpreter",nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},printRouteMap:{isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,pageBreak:!1,printNotes:!0,borderWidth:30,zoomFactor:15,entryPointMarker:{color:"green",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"red",weight:4,radius:10,fill:!0,fillOpacity:1}},haveCrypto:!1};function t(t){!function e(t,o){if("object"==typeof t&&"object"==typeof o)try{for(let a in o)"object"==typeof o[a]?e(t[a],o[a]):o[a]=t[a]||o[a];for(let a in t)"object"==typeof t[a]?("[object Array]"===Object.prototype.toString.call(t[a])?o[a]=o[a]||[]:o[a]=o[a]||{},e(t[a],o[a])):o[a]=t[a]}catch(e){console.log(e||"Not possible to overload Config")}}(t,e),e=function e(t){for(let o in t)"object"==typeof t[o]&&(t[o]=e(t[o]));return Object.freeze(t)}(e)}return{get autoLoad(){return e.autoLoad},get map(){return e.map},get travelNotesToolbarUI(){return e.travelNotesToolbarUI},get layersToolbarUI(){return e.layersToolbarUI},get mouseUI(){return e.mouseUI},get errorUI(){return e.errorUI},get APIKeys(){return e.APIKeys},get contextMenu(){return e.contextMenu},get routing(){return e.routing},get language(){return e.language},get itineraryPointMarker(){return e.itineraryPointMarker},get searchPointMarker(){return e.searchPointMarker},get searchPointPolyline(){return e.searchPointPolyline},get previousSearchLimit(){return e.previousSearchLimit},get nextSearchLimit(){return e.nextSearchLimit},get wayPoint(){return e.wayPoint},get route(){return e.route},get note(){return e.note},get itineraryPointZoom(){return e.itineraryPointZoom},get routeEditor(){return e.routeEditor},get travelEditor(){return e.travelEditor},get haveBeforeUnloadWarning(){return e.haveBeforeUnloadWarning},get overpassApiUrl(){return e.overpassApiUrl},get nominatim(){return e.nominatim},get geoLocation(){return e.geoLocation},get printRouteMap(){return e.printRouteMap},get haveCrypto(){return e.haveCrypto},overload:e=>t(e)}}();function t(){return Object.seal({create:(e,t,o)=>function(e,t,o){let a=null;if(a="text"===e.toLowerCase()?document.createTextNode(""):document.createElement(e),o&&o.appendChild(a),t)for(let e in t)try{a[e]=t[e]}catch(t){console.log("Invalid property : "+e)}return a}(e,t,o)})}function o(){return{getJsonPromise:(e,t)=>function(e,t){return new Promise((function(o,a){let n=new XMLHttpRequest;n.timeout=2e4,n.ontimeout=function(){a("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){let e=null;try{e=JSON.parse(n.responseText)}catch(e){a(e.message+" File: "+n.responseURL)}o(e)}else a("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.overrideMimeType("application/json"),n.send(null)}))}(e,t),getBinaryPromise:(e,t)=>function(e,t){return new Promise((function(o,a){let n=new XMLHttpRequest;n.timeout=2e4,n.ontimeout=function(){a("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onload=function(){if(200===n.status){let e=n.response;e?o(e):a("Error XMLHttpRequest - File : "+n.responseURL)}else a("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.responseType="arraybuffer",n.send(null)}))}(e,t)}}const a=Object.freeze({fixed:2,invalid:-1,defaultValue:0}),n=Object.freeze({refusedByUser:-1,disabled:0,inactive:1,active:2}),r=Object.freeze({fixed:2,defaultValue:0}),i=Object.freeze({defaultValue:0,fixed:6}),l=Object.freeze({notEdited:0,editedNoChange:1,editedChanged:2}),s=Object.freeze({margin:100,height:500,width:1e3,yDeltaText:30,xDeltaText:10,vScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],hScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}),d=Object.freeze({width:40,height:40}),c=[.3,10,1];let u=0;function v(){return++u,u}function g(e){const t=e;return Object.seal({get name(){return t},get version(){return"1.11.0"},get object(){return{name:t,version:"1.11.0"}},validate:e=>function(e){if(!Object.getOwnPropertyNames(e).includes("name"))throw new Error("No name for "+t);if(t!==e.name)throw new Error("Invalid name for "+t);if(!Object.getOwnPropertyNames(e).includes("version"))throw new Error("No version for "+t)}(e)})}function p(e){const t=e().objType.name,o=e;let a=[];function n(e){if(!e.objType||!e.objType.name||e.objType.name!==t)throw new Error("invalid object name for add function");a.push(e)}function r(){let e=-1;return{get value(){return e<a.length?a[e]:null},get previous(){return 0>=e?null:a[e-1]},get next(){return e<a.length-1?a[e+1]:null},get done(){return++e>=a.length},get first(){return 0===e},get last(){return e>=a.length-1},get index(){return e}}}function i(e){return a.findIndex(t=>t.objId===e)}function l(e,t,o){let n=i(e);if(-1===n)throw new Error("invalid objId for next or previous function");let r=t;for(r||(r=()=>!0),n+=o;-1<n&&n<a.length&&!r(a[n]);)n+=o;return-1===n||a.length===n?null:a[n]}return Object.seal({add:e=>n(e),forEach:e=>function(e){let t=null,o=r();for(;!o.done;)t=e(o.value,t);return t}(e),getAt:e=>function(e){let t=i(e);return-1===t?null:a[t]}(e),moveTo:(e,t,o)=>function(e,t,o){let n=i(e),r=i(t);o||r++,a.splice(r,0,a[n]),r<n&&n++,a.splice(n,1)}(e,t,o),next:(e,t)=>l(e,t,1),previous:(e,t)=>l(e,t,-1),remove:e=>function(e){if(-1===i(e))throw new Error("invalid objId for remove function");a.splice(i(e),1)}(e),removeAll:e=>{e?a.splice(1,a.length-2):a.length=0},replace:(e,t)=>function(e,t){let o=i(e);if(-1===o)throw new Error("invalid objId for replace function");a[o]=t}(e,t),reverse:()=>{a.reverse()},sort:e=>function(e){a.sort(e)}(e),swap:(e,t)=>function(e,t){let o=i(e);if(-1===o||0===o&&t||a.length-1===o&&!t)throw new Error("invalid objId for swap function");let n=a[o];a[o]=a[o+(t?-1:1)],a[o+(t?-1:1)]=n}(e,t),get first(){return a[0]},get iterator(){return r()},get last(){return a[a.length-1]},get length(){return a.length},get object(){return function(){let e=[],t=r();for(;!t.done;)e.push(t.value.object);return e}()},set object(e){!function(e){a.length=0;let t=null;e.forEach(e=>{t=o(),t.object=e,n(t)})}(e)}})}const m=g("WayPoint");function h(){let e="",t=i.defaultValue,o=i.defaultValue,a=v();function n(n){let r=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+m.name);if(m.validate(e.objType),m.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":e.objType.version="1.11.0";break;default:throw new Error("invalid version for "+m.name)}let t=Object.getOwnPropertyNames(e);return["name","lat","lng","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+m.name)}),e}(n);e=r.name||"",t=r.lat||i.defaultValue,o=r.lng||i.defaultValue,a=v()}return Object.seal({get name(){return e},set name(t){e=t},get lat(){return t},set lat(e){t=e},get lng(){return o},set lng(e){o=e},get latLng(){return[t,o]},set latLng(e){t=e[0],o=e[1]},get objId(){return a},get objType(){return m},get object(){return{name:e,lat:parseFloat(t.toFixed(i.fixed)),lng:parseFloat(o.toFixed(i.fixed)),objId:a,objType:m.object}},set object(e){n(e)}})}const f=g("ItineraryPoint");function T(){let e=i.defaultValue,t=i.defaultValue,o=a.defaultValue,n=r.defaultValue,l=v();function s(s){let d=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+f.name);if(f.validate(e.objType),f.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.elev=r.defaultValue;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":e.objType.version="1.11.0";break;default:throw new Error("invalid version for "+f.name)}let t=Object.getOwnPropertyNames(e);return["lat","lng","distance","elev","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+f.name)}),e}(s);e=d.lat||i.defaultValue,t=d.lng||i.defaultValue,o=d.distance||a.defaultValue,n=d.elev||r.defaultValue,l=v()}return Object.seal({get lat(){return e},set lat(t){e=t},get lng(){return t},set lng(e){t=e},get latLng(){return[e,t]},set latLng(o){e=o[0],t=o[1]},get distance(){return o},set distance(e){o=e},get elev(){return n},set elev(e){n=e},get objId(){return l},get objType(){return f},get object(){return{lat:parseFloat(e.toFixed(i.fixed)),lng:parseFloat(t.toFixed(i.fixed)),distance:parseFloat(o.toFixed(a.fixed)),elev:parseFloat(n.toFixed(r.fixed)),objId:l,objType:f.object}},set object(e){s(e)}})}const b=g("Maneuver");function y(){let e=v(),t="",o="",n=-1,r=a.defaultValue,i=a.defaultValue;function l(l){let s=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+b.name);if(b.validate(e.objType),b.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":e.objType.version="1.11.0";break;default:throw new Error("invalid version for "+b.name)}let t=Object.getOwnPropertyNames(e);return["iconName","instruction","distance","duration","itineraryPointObjId","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+b.name)}),e}(l);t=s.iconName||"",o=s.instruction||"",r=s.distance||a.defaultValue,i=s.duration||a.defaultValue,n=s.itineraryPointObjId||-1,e=v()}return Object.seal({get iconName(){return t},set iconName(e){t=e},get instruction(){return o},set instruction(e){o=e},get itineraryPointObjId(){return n},set itineraryPointObjId(e){n=e},get distance(){return r},set distance(e){r=e},get duration(){return i},set duration(e){i=e},get objId(){return e},get objType(){return b},get object(){return{iconName:t,instruction:o,distance:parseFloat(r.toFixed(a.fixed)),duration:i,itineraryPointObjId:n,objId:e,objType:b.object}},set object(e){l(e)}})}const N=g("Itinerary");function I(){let e=!1,t=0,o=0,a="",n="",r=p(T),i=p(y),l=v();function s(s){let d=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+N.name);if(N.validate(e.objType),N.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.hasProfile=!1,e.ascent=0,e.descent=0;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":e.objType.version="1.11.0";break;default:throw new Error("invalid version for "+N.name)}let t=Object.getOwnPropertyNames(e);return["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+N.name)}),e}(s);e=d.hasProfile||!1,t=d.ascent||0,o=d.descent||0,r.object=d.itineraryPoints||[],i.object=d.maneuvers||[],a=d.provider||"",n=d.transitMode||"",l=v();let c=new Map,u=0,g=r.iterator;for(;!g.done;)c.set(d.itineraryPoints[u].objId,g.value.objId),u++;let p=i.iterator;for(;!p.done;)p.value.itineraryPointObjId=c.get(p.value.itineraryPointObjId)}return Object.seal({get hasProfile(){return e},set hasProfile(t){e=t},get ascent(){return t},set ascent(e){t=e},get descent(){return o},set descent(e){o=e},get itineraryPoints(){return r},get maneuvers(){return i},get provider(){return a},set provider(e){a=e},get transitMode(){return n},set transitMode(e){n=e},get objId(){return l},get objType(){return N},get object(){return{hasProfile:e,ascent:t,descent:o,itineraryPoints:r.object,maneuvers:i.object,provider:a,transitMode:n,objId:l,objType:N.object}},set object(e){s(e)}})}const w=g("Note");function x(){let e=v(),t=0,o=0,n="",r="",l="",s="",d="",c="",u=i.defaultValue,g=i.defaultValue,p=i.defaultValue,m=i.defaultValue,h=a.invalid,f=a.defaultValue;function T(T){let b=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+w.name);if(w.validate(e.objType),w.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":e.objType.version="1.11.0";break;default:throw new Error("invalid version for "+w.name)}let t=Object.getOwnPropertyNames(e);return["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+w.name)}),e}(T);t=b.iconHeight||0,o=b.iconWidth||0,n=b.iconContent||"",r=b.popupContent||"",l=b.tooltipContent||"",s=b.phone||"",d=b.url||"",c=b.address||"",u=b.iconLat||i.defaultValue,g=b.iconLng||i.defaultValue,p=b.lat||i.defaultValue,m=b.lng||i.defaultValue,h=b.distance||a.invalid,f=b.chainedDistance,e=v()}return Object.seal({get isRouteNote(){return h!==a.invalid},get iconHeight(){return t},set iconHeight(e){t=e},get iconWidth(){return o},set iconWidth(e){o=e},get iconContent(){return n},set iconContent(e){n=e},get popupContent(){return r},set popupContent(e){r=e},get tooltipContent(){return l},set tooltipContent(e){l=e},get phone(){return s},set phone(e){s=e},get url(){return d},set url(e){d=e},get address(){return c},set address(e){c=e},get iconLat(){return u},set iconLat(e){u=e},get iconLng(){return g},set iconLng(e){g=e},get iconLatLng(){return[u,g]},set iconLatLng(e){u=e[0],g=e[1]},get lat(){return p},set lat(e){p=e},get lng(){return m},set lng(e){m=e},get latLng(){return[p,m]},set latLng(e){p=e[0],m=e[1]},get distance(){return h},set distance(e){h=e},get chainedDistance(){return f},set chainedDistance(e){f=e},get objId(){return e},get objType(){return w},get object(){return{iconHeight:t,iconWidth:o,iconContent:n,popupContent:r,tooltipContent:l,phone:s,url:d,address:c,iconLat:parseFloat(u.toFixed(i.fixed)),iconLng:parseFloat(g.toFixed(i.fixed)),lat:parseFloat(p.toFixed(i.fixed)),lng:parseFloat(m.toFixed(i.fixed)),distance:parseFloat(h.toFixed(a.fixed)),chainedDistance:parseFloat(f.toFixed(a.fixed)),objId:e,objType:w.object}},set object(e){T(e)}})}const A=g("Route");function E(){let t="",o=p(h);o.add(h()),o.add(h());let n=p(x),r=I(),i=e.route.width,s=e.route.color,d=e.route.dashArray,c=!1,u=a.defaultValue,g=a.defaultValue,m=a.defaultValue,f=l.notEdited;let T=!1,b=v();function y(a){let p=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+A.name);if(A.validate(e.objType),A.version!==e.objType.version)switch(e.objType.version){case"1.0.0":e.dashArray=0,e.hidden=!1;case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.edited=l.notEdited;case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":e.objType.version="1.11.0";break;default:throw new Error("invalid version for "+A.name)}let t=Object.getOwnPropertyNames(e);return["name","wayPoints","notes","itinerary","width","color","dashArray","chain","distance","duration","edited","hidden","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+A.name)}),e}(a);t=p.name||"",o.object=p.wayPoints||[],n.object=p.notes||[],r.object=p.itinerary||I().object,i=p.width||e.route.width,s=p.color||"#000000",d=p.dashArray||0,c=p.chain||!1,g=p.distance,m=p.duration,f=p.edited||l.notEdited,T=p.hidden||!1,u=p.chainedDistance,b=v()}return Object.seal({get wayPoints(){return o},get itinerary(){return r},get notes(){return n},get name(){return t},set name(e){t=e},get width(){return i},set width(e){i=e},get color(){return s},set color(e){s=e},get dashArray(){return d},set dashArray(e){d=e},get chain(){return c},set chain(e){c=e},get chainedDistance(){return u},set chainedDistance(e){u=e},get distance(){return g},set distance(e){g=e},get duration(){return m},set duration(e){m=e},get edited(){return f},set edited(e){!function(e){if("number"!=typeof e||l.notEdited>e||l.editedChanged<e)throw new Error("Invalid value for Route.edited : "+e);f=e}(e)},get hidden(){return T},set hidden(e){T=e},get objId(){return b},get objType(){return A},get object(){return{name:t,wayPoints:o.object,notes:n.object,itinerary:r.object,width:i,color:s,dashArray:d,chain:c,distance:parseFloat(g.toFixed(a.fixed)),duration:m,edited:f,hidden:T,chainedDistance:parseFloat(u.toFixed(a.fixed)),objId:b,objType:A.object}},set object(e){y(e)}})}const C=g("Travel");function D(){let e=E(),t="OSM - Color",o="TravelNotes",a=p(E),n=p(x),r=v(),i=!1,l={};function s(s){let d=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+C.name);if(C.validate(e.objType),C.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.editedRoute=E();case"1.5.0":if(e.userData.layerId){let t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"Lantmäteriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find(t=>t.layerId===e.userData.layerId);e.layerName=t?t.layerName:"OSM - Color"}else e.layerName="OSM - Color";case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":e.objType.version="1.11.0";break;default:throw new Error("invalid version for "+C.name)}let t=Object.getOwnPropertyNames(e);return["name","editedRoute","routes","userData","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+C.name)}),e}(s);e.object=d.editedRoute,t=s.layerName||"OSM - Color",o=d.name||"",l=d.userData||{},i=d.readOnly||!1,a.object=d.routes||[],n.object=d.notes||[],r=v()}return Object.seal({get editedRoute(){return e},set editedRoute(t){e=t},get routes(){return a},get notes(){return n},get layerName(){return t},set layerName(e){t=e},get name(){return o},set name(e){o=e},get readOnly(){return i},set readOnly(e){i=e},get userData(){return l},set userData(e){l=e},get objId(){return r},get objType(){return C},get object(){return{editedRoute:e.object,layerName:t,name:o,routes:a.object,notes:n.object,userData:l,readOnly:i,objId:r,objType:C.object}},set object(e){s(e)}})}const P=function(){let e=new Map;return{setTranslations:t=>function(t){t.forEach(t=>e.set(t.msgid,t.msgstr))}(t),getText:(t,o)=>function(t,o){let a=e.get(t);return o&&a&&Object.getOwnPropertyNames(o).forEach(e=>a=a.replace("{"+e+"}",o[e])),a||t}(t,o)}}();function j(){function e(e){return e>0?e.toFixed(i.fixed)+" N":(-e).toFixed(i.fixed)+" S"}function t(e){return e>0?e.toFixed(i.fixed)+" E":(-e).toFixed(i.fixed)+" W"}return Object.seal({get UUID(){return function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}()},storageAvailable:e=>function(e){try{let t=window[e],o="__storage_test__";return t.setItem(o,o),t.removeItem(o),!0}catch(e){return!1}}(e),fileAPIAvailable:()=>function(){try{return new File(["testdata"],{type:"text/plain"}),!0}catch(e){return!!window.navigator.msSaveOrOpenBlob}}(),saveFile:(e,t,o)=>function(e,t,o){if(window.navigator.msSaveOrOpenBlob)try{window.navigator.msSaveOrOpenBlob(new Blob([t]),e)}catch(e){console.log(e||"An error occurs when saving file")}else try{let a=window.URL.createObjectURL(new File([t],{type:o||"text/plain"})),n=document.createElement("a");n.setAttribute("href",a),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a)}catch(e){console.log(e||"An error occurs when saving file")}}(e,t,o),formatTime:e=>function(e){let t=Math.floor(e);if(0===t)return"";let o=Math.floor(t/86400),a=Math.floor(t%86400/3600),n=Math.floor(t%3600/60),r=Math.floor(t%60);return 0<o?o+" "+P.getText("Utilities - Day")+" "+a+" "+P.getText("Utilities - Hour"):0<a?a+" "+P.getText("Utilities - Hour")+" "+n+" "+P.getText("Utilities - Minute"):0<n?n+" "+P.getText("Utilities - Minute"):r+" "+P.getText("Utilities - Second")}(e),formatDistance:e=>function(e){let t=Math.floor(e);return 0>=t?"0 km":Math.floor(t/1e3)+","+Math.floor(t%1e3/10).toFixed(0).padStart(2,"0").padEnd(3,"0")+" km"}(e),formatLat:t=>e(t),formatLng:e=>t(e),formatLatLng:o=>function(o){return 0===o[0]&&0===o[1]?"":e(o[0])+" - "+t(o[1])}(o)})}const M=function(){let e={map:null,providers:new Map,mapObjects:new Map,travel:D(),editedRouteObjId:-1,routing:Object.seal({provider:"",transitMode:""}),searchData:[],UUID:j().UUID};return Object.seal({get map(){return e.map},set map(t){e.map=t},get providers(){return e.providers},get mapObjects(){return e.mapObjects},get travel(){return e.travel},set travel(t){e.travel=t},get editedRouteObjId(){return e.editedRouteObjId},set editedRouteObjId(t){e.editedRouteObjId=t},get routeEdition(){return e.routeEdition},get routing(){return e.routing},get searchData(){return e.searchData},set searchData(t){e.searchData=t},get UUID(){return e.UUID}})}();const R=function(){let o=null,a=null,n=null,r=null,i=null,l=e.errorUI.showHelp,s=t();function d(){l=!n.checked}function c(){a&&(clearTimeout(a),a=null),o.classList.remove("TravelNotes-ErrorUI-Error"),o.classList.remove("TravelNotes-ErrorUI-Warning"),o.classList.remove("TravelNotes-ErrorUI-Info"),o.classList.remove("TravelNotes-ErrorUI-Help"),o.classList.add("TravelNotes-ErrorUI-Hidden"),n&&(n.removeEventListener("change",d,!1),n=null,r=null),o.innerHTML=""}function u(t,u){if("Error"===u&&!e.errorUI.showError||"Warning"===u&&!e.errorUI.showWarning||"Info"===u&&!e.errorUI.showInfo||"Help"===u&&!e.errorUI.showHelp||"Help"===u&&!l)return;a&&c();let v=s.create("div",{id:"TravelNotes-ErrorUI-Header"},o);i=s.create("span",{id:"TravelNotes-ErrorUI-CancelButton",innerHTML:"&#x274c"},v),i.addEventListener("click",c,!1),s.create("div",{id:"TravelNotes-ErrorUI-Message",innerHTML:t},o),o.classList.add("TravelNotes-ErrorUI-"+u);let g=e.errorUI.timeOut;"Help"===u&&(r=s.create("div",{id:"TravelNotes-ErrorUI-HelpInputDiv"},o),n=s.create("input",{id:"TravelNotes-ErrorUI-HelpInput",type:"checkbox"},r),n.addEventListener("change",d,!1),s.create("label",{id:"TravelNotes-ErrorUI-HelpInputLabel",for:"TravelNotes-ErrorUI-HelpInput",innerHTML:P.getText("ErrorUI - Dont show again")},r),g=e.errorUI.helpTimeOut),o.classList.remove("TravelNotes-ErrorUI-Hidden"),a=setTimeout(c,g)}return{createUI:()=>{document.getElementById("TravelNotes-ErrorUI")||(o=s.create("div",{id:"TravelNotes-ErrorUI",className:"TravelNotes-ErrorUI-Hidden"},document.querySelector("body")))},showError:e=>u(e,"Error"),showWarning:e=>u(e,"Warning"),showInfo:e=>u(e,"Info"),showHelp:e=>u(e,"Help")}}();function B(){return Object.seal({getRoute:e=>function(e){let t=null;return t=M.travel.routes.getAt(e),t||e===M.travel.editedRoute.objId&&(t=M.travel.editedRoute),t}(e),getNoteAndRoute:e=>function(e){let t=null;if(t=M.travel.notes.getAt(e),t)return{note:t,route:null};let o=M.travel.routes.iterator;for(;!o.done;)if(t=o.value.notes.getAt(e),t)return{note:t,route:o.value};return t=M.travel.editedRoute.notes.getAt(e),t?{note:t,route:M.travel.editedRoute}:{note:null,route:null}}(e),getWayPoint:e=>function(e){let t=null,o=M.travel.routes.iterator;for(;!o.done;)if(t=o.value.wayPoints.getAt(e),t)return t;return t=M.travel.editedRoute.wayPoints.getAt(e),t||null}(e)})}function S(){let e=0,o=0,a=0,n=0,r=0,i=0,l=null,s=null,d=null,c=null,u=null,v=null,g=null,p=null,m=null,h=null,f=t(),T=null,b=!0,y=null,N=null,L=null;function I(e){b&&("Escape"===e.key||"Esc"===e.key?h.click():"Enter"===e.key&&m.click())}function w(e,t){N=e,L=t,document.querySelector("body").appendChild(l),document.addEventListener("keydown",I,!0),r=l.clientWidth,i=l.clientHeight,function(){a=(r-s.clientWidth)/2,n=(i-s.clientHeight)/2,a=Math.min(Math.max(a,20),r-s.clientWidth-20),n=Math.max(n,20);let e=i-Math.max(n,0)-20;s.setAttribute("style","top:"+n+"px;left:"+a+"px;max-height:"+e+"px;")}(),y&&y()}return l=f.create("div",{className:"TravelNotes-BaseDialog-BackgroundDiv"}),l.addEventListener("dragover",()=>null,!1),l.addEventListener("drop",()=>null,!1),s=f.create("div",{className:"TravelNotes-BaseDialog-Container"},l),function(){let t=f.create("div",{className:"TravelNotes-BaseDialog-TopBar",draggable:!0},s);h=f.create("div",{innerHTML:"&#x274c",className:"TravelNotes-BaseDialog-CancelButton",title:P.getText("BaseDialog - Cancel")},t),h.addEventListener("click",()=>{document.removeEventListener("keydown",I,!0),document.querySelector("body").removeChild(l),L("Canceled by user")},!1),t.addEventListener("dragstart",t=>{try{t.dataTransfer.setData("Text","1")}catch(e){console.log(e)}e=t.screenX,o=t.screenY},!1),t.addEventListener("dragend",t=>{a+=t.screenX-e,n+=t.screenY-o,a=Math.min(Math.max(a,20),r-s.clientWidth-20),n=Math.max(n,20);let l=i-Math.max(n,0)-20;s.setAttribute("style","top:"+n+"px;left:"+a+"px;max-height:"+l+"px;")},!1)}(),d=f.create("div",{className:"TravelNotes-BaseDialog-HeaderDiv"},s),c=f.create("div",{className:"TravelNotes-BaseDialog-ContentDiv"},s),u=f.create("div",{className:"TravelNotes-BaseDialog-ErrorDiv TravelNotes-BaseDialog-ErrorDivHidden"},s),v=f.create("div",{className:"TravelNotes-BaseDialog-FooterDiv"},s),p=f.create("div",{className:"TravelNotes-BaseDialog-SearchWaitBullet TravelNotes-BaseDialog-SearchWait-Hidden"},g=f.create("div",{className:"TravelNotes-BaseDialog-SearchWait TravelNotes-BaseDialog-SearchWait-Hidden"},v)),m=f.create("div",{innerHTML:"&#x1f197;",className:"TravelNotes-BaseDialog-Button TravelNotes-BaseDialog-OkButton TravelNotes-BaseDialog-OkButton-Visible"},v),m.addEventListener("click",()=>{let e=null;T&&(e=T(),!e)||(document.removeEventListener("keydown",I,!0),document.querySelector("body").removeChild(l),N(e))},!1),Object.seal({set okButtonListener(e){T=e},set keyboardEventListenerEnabled(e){b=e},set onShow(e){y=e},showError:e=>function(e){u.innerHTML=e,u.classList.remove("TravelNotes-BaseDialog-ErrorDivHidden"),u.classList.add("TravelNotes-BaseDialog-ErrorDivVisible")}(e),hideError:()=>(u.innerHTML="",u.classList.add("TravelNotes-BaseDialog-ErrorDivHidden"),void u.classList.remove("TravelNotes-BaseDialog-ErrorDivVisible")),showWait:()=>(p.classList.remove("TravelNotes-BaseDialog-SearchWait-Hidden"),p.classList.add("TravelNotes-BaseDialog-SearchWait-Visible"),g.classList.remove("TravelNotes-BaseDialog-SearchWait-Hidden"),g.classList.add("TravelNotes-BaseDialog-SearchWait-Visible"),m.classList.remove("TravelNotes-BaseDialog-OkButton-Visible"),void m.classList.add("TravelNotes-BaseDialog-OkButton-Hidden")),hideWait:()=>(p.classList.remove("TravelNotes-BaseDialog-SearchWait-Visible"),p.classList.add("TravelNotes-BaseDialog-SearchWait-Hidden"),g.classList.remove("TravelNotes-BaseDialog-SearchWait-Visible"),g.classList.add("TravelNotes-BaseDialog-SearchWait-Hidden"),m.classList.remove("TravelNotes-BaseDialog-OkButton-Hidden"),void m.classList.add("TravelNotes-BaseDialog-OkButton-Visible")),get title(){return d.innerHTML},set title(e){d.innerHTML=e},get header(){return d},set header(e){d=e},get content(){return c},set content(e){c=e},get footer(){return v},set footer(e){v=e},get okButton(){return m},get cancelButton(){return h},show:()=>new Promise(w)})}function O(o){let a=t(),n=null,r=null,i=null,l=null,s=null;function d(){return o.color=document.getElementById("TravelNotes-ColorDialog-ColorSampleDiv").color,o.width=parseInt(i.value),o.chain=l.checked,o.dashArray=s.selectedIndex,o}return n=function(e){let o=null,a=null,n=e,r=null,i=null,l=null,s=null,d=t();function c(e){return{red:parseInt(e.substr(1,2),16),green:parseInt(e.substr(3,2),16),blue:parseInt(e.substr(5,2),16)}}function u(e,t,o){return"#"+parseInt(e).toString(16).padStart(2,"0")+parseInt(t).toString(16).padStart(2,"0")+parseInt(o).toString(16).padStart(2,"0")}function v(e){n=e.target.colorValue;let t=c(n);r.value=t.red,i.value=t.green,l.value=t.blue,s.setAttribute("style","background-color:"+e.target.colorValue+";"),s.color=n}function g(e){let t=e.target.redValue,o=255,a=255,n=0;for(;++n<=6;){let e=0;for(o=255;++e<=6;){let r=document.getElementById("TravelNotes-ColorDialog-CellColorDiv"+n+e);r.colorValue=u(t,o,a),r.setAttribute("style","background-color:"+u(t,o,a)),o-=51}a-=51}}function p(){n=u(r.value,i.value,l.value),s.setAttribute("style","background-color:"+n+";"),s.color=n}return o=S(),o.title=P.getText("ColorDialog - Colors"),a=d.create("div",{className:"TravelNotes-ColorDialog-ColorDiv",id:"TravelNotes-ColorDialog-ColorDiv"},o.content),function(){let e=d.create("div",{className:"TravelNotes-ColorDialog-ButtonsDiv",id:"TravelNotes-ColorDialog-ButtonsDiv"},a),t=255,o=255,n=255,r=0;for(;++r<=7;){let a=d.create("div",{className:"TravelNotes-ColorDialog-RowColorDiv",id:"TravelNotes-ColorDialog-RowColorDiv"+r},e),i=0;for(o=255;++i<=6;){let e=d.create("div",{className:"TravelNotes-ColorDialog-CellColorDiv",id:"TravelNotes-ColorDialog-CellColorDiv"+r+i},a);if(r<=6)e.setAttribute("style","background-color:"+u(t,o,n)),e.colorValue=u(t,o,n),e.addEventListener("click",v,!1),o-=51;else{t=51*(i-1);let o=u(255,t,t);e.setAttribute("style","background-color:"+o),e.redValue=255-t,e.addEventListener("click",g,!1)}}n-=51}}(),function(){let e=d.create("div",{className:"TravelNotes-ColorDialog-DataDiv",id:"TravelNotes-ColorDialog-DataDiv"},a);d.create("text",{data:P.getText("ColorDialog - Red")},e),r=d.create("input",{type:"number",className:"TravelNotes-ColorDialog-NumberInput",id:"TravelNotes-ColorDialog-RedInput"},e),r.value=c(n).red,r.min=0,r.max=255,r.addEventListener("input",p,!1),d.create("text",{data:P.getText("ColorDialog - Green")},e),i=d.create("input",{type:"number",className:"TravelNotes-ColorDialog-NumberInput",id:"TravelNotes-ColorDialog-GreenInput"},e),i.value=c(n).green,i.min=0,i.max=255,i.addEventListener("input",p,!1),d.create("text",{data:P.getText("ColorDialog - Blue")},e),l=d.create("input",{type:"number",className:"TravelNotes-ColorDialog-NumberInput",id:"TravelNotes-ColorDialog-BlueInput"},e),l.value=c(n).blue,l.min=0,l.max=255,l.addEventListener("input",p,!1)}(),s=d.create("div",{className:"TravelNotes-ColorDialog-ColorSampleDiv",id:"TravelNotes-ColorDialog-ColorSampleDiv"},a),s.setAttribute("style","background-color:"+n+";"),s.color=n,o}(o.color),n.title=P.getText("RoutePropertiesDialog - Route properties"),n.okButtonListener=d,r=a.create("div",{id:"TravelNotes-RoutePropertiesDialog-MainDataDiv"},n.content),function(){let e=a.create("div",{className:"TravelNotes-RoutePropertiesDialog-DataDiv",id:"TravelNotes-RoutePropertiesDialog-WithDiv"},r);e.innerHTML="<span>"+P.getText("RoutePropertiesDialog - Width")+"</span>",i=a.create("input",{type:"number",id:"TravelNotes-RoutePropertiesDialog-WidthInput"},e),i.value=o.width,i.min=1,i.max=40}(),function(){let t=a.create("div",{className:"TravelNotes-RoutePropertiesDialog-DataDiv",id:"TravelNotes-RoutePropertiesDialog-dashDiv"},r);t.innerHTML="<span>"+P.getText("RoutePropertiesDialog - Linetype")+"</span>",s=a.create("select",{className:"TravelNotes-RoutePropertiesDialog-Select",id:"TravelNotes-RoutePropertiesDialog-DashSelect"},t);let n=e.route.dashChoices;for(let e=0;e<n.length;e++)s.add(a.create("option",{text:n[e].text}));s.selectedIndex=o.dashArray<n.length?o.dashArray:0}(),function(){let e=a.create("div",{className:"TravelNotes-RoutePropertiesDialog-DataDiv",id:"TravelNotes-RoutePropertiesDialog-ChainDiv"},r);e.innerHTML="<span>"+P.getText("RoutePropertiesDialog - Chained route")+"</span>",l=a.create("input",{type:"checkbox",id:"TravelNotes-RoutePropertiesDialog-ChainInput"},e),l.checked=o.chain}(),n}function k(){function e(e,t){let o=function(e){return-1<["setitinerary","updateitinerary","settravelnotes","updatetravelnotes","setsearch","updatesearch","expandrouteui","reducerouteui","setwaypointslist","setrouteslist","setprovider","providersadded","settransitmode"].indexOf(e)?document.getElementById("TravelNotes-Control-MainDiv"):-1<["removeobject","removeallobjects","zoomto","additinerarypointmarker","addsearchpointmarker","addrectangle","addwaypoint","layerchange","geolocationstatuschanged","geolocationpositionchanged","routeupdated","routepropertiesupdated","noteupdated","roadbookupdate","travelnotesfileloaded","profileclosed"].indexOf(e)?document:null}(e);if(o){let a=new Event(e);t&&(a.data=t),o.dispatchEvent(a)}}return Object.seal({dispatch:(t,o)=>e(t,o)})}function H(){let t=null,o=1,a=1,n=Number.MAX_VALUE,r=0,i=0,l=null,d=0,c=e.route.elev.smoothCoefficient,u=e.route.elev.smoothPoints;function v(){let e=function(){let e=0,t=0,o=[],a=l.itinerary.itineraryPoints.iterator,n=0,r=a.done;for(o.push({distance:e,elev:a.value.elev}),n+=a.value.distance,r=a.done;!r;){for(e+=d;e>=n&&!r;)n+=a.value.distance,r=a.done;if(!r){let r=(a.value.elev-a.previous.elev)/a.previous.distance;t=a.value.elev-(n-e)*r,o.push({distance:e,elev:t})}}return o.push({distance:n,elev:l.itinerary.itineraryPoints.last.elev}),o}(),t=new Map,o=(e[u].elev-e[0].elev)/u,a=0;for(a=0;a<u;a++)t.set(a*d,{distance:a*d,elev:e[0].elev+o*a});for(a=u;a<e.length-u;a++){let o=0;for(let t=a-u;a+u>=t;t++)o+=e[t].elev;t.set(e[a].distance,{distance:e[a].distance,elev:o/(2*u+1)})}return a--,o=d*(e[e.length-1].elev-e[e.length-1-u].elev)/(e[e.length-1].distance-e[e.length-1-u].distance),t.set(e[a].distance+d,{distance:e[a].distance+d,elev:e[a].elev+o}),t.set(e[a].distance+2*d,{distance:e[a].distance+2*d,elev:e[a].elev+2*o}),t}function g(e){return l=e,n=Number.MAX_VALUE,r=0,l.itinerary.itineraryPoints.forEach(e=>{r=Math.max(r,e.elev),n=Math.min(n,e.elev)}),i=r-n,o=s.height/i,a=s.width/l.distance,t=document.createElementNS("http://www.w3.org/2000/svg","svg"),t.setAttributeNS(null,"viewBox","0 0 "+(s.width+2*s.margin)+" "+(s.height+2*s.margin)),t.setAttributeNS(null,"class","TravelNotes-SvgProfile"),function(){let e="",n=0,i=0,d=0;l.itinerary.itineraryPoints.forEach(t=>{i=(s.margin+a*n).toFixed(0),d=(s.margin+o*(r-t.elev)).toFixed(0),e+=i+","+d+" ",n+=t.distance});let c=document.createElementNS("http://www.w3.org/2000/svg","polyline");c.setAttributeNS(null,"points",e),c.setAttributeNS(null,"class","TravelNotes-SvgProfile-profilePolyline"),t.appendChild(c)}(),function(){const e=s.margin.toFixed(0),o=(s.margin+s.height).toFixed(0),a=(s.margin+s.width).toFixed(0),n=s.margin.toFixed(0);let r=e+","+n+" "+e+","+o+" "+a+","+o+" "+a+","+n,i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttributeNS(null,"points",r),i.setAttributeNS(null,"class","TravelNotes-SvgProfile-framePolyline"),t.appendChild(i)}(),function(){let e=Number.MAX_VALUE,a=0;s.vScales.forEach(t=>{let o=Math.abs(i/4-t);o<e&&(e=o,a=t)});let l=Math.ceil(n/a)*a;const d=(s.margin+s.width+s.xDeltaText).toFixed(0),c=(s.margin-s.xDeltaText).toFixed(0);for(;l<r;){let e=s.margin+(r-l)*o,n=document.createElementNS("http://www.w3.org/2000/svg","text");n.appendChild(document.createTextNode(l.toFixed(0))),n.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),n.setAttributeNS(null,"x",d),n.setAttributeNS(null,"y",e),n.setAttributeNS(null,"text-anchor","start"),t.appendChild(n);let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.appendChild(document.createTextNode(l.toFixed(0))),i.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),i.setAttributeNS(null,"x",c),i.setAttributeNS(null,"y",e),i.setAttributeNS(null,"text-anchor","end"),t.appendChild(i),l+=a}}(),function(){const e=s.margin+s.height+s.margin/2;let o=Number.MAX_VALUE,n=0;s.hScales.forEach(e=>{let t=Math.abs(l.distance/8-e);t<o&&(o=t,n=e)});let r=Math.ceil(l.chainedDistance/n)*n;for(;r<l.distance+l.chainedDistance;){let o=document.createElementNS("http://www.w3.org/2000/svg","text");o.appendChild(document.createTextNode(1e3<n||0<l.chainedDistance?r/1e3+" km":r+" m ")),o.setAttributeNS(null,"class","TravelNotes-SvgProfile-distLegend"),o.setAttributeNS(null,"x",s.margin+(r-l.chainedDistance)*a),o.setAttributeNS(null,"y",e),o.setAttributeNS(null,"text-anchor","start"),t.appendChild(o),r+=n}}(),t}return Object.seal({smooth:e=>function(e){l=e;let t=l.itinerary.itineraryPoints.iterator,o=0,a=0;for(;!t.done;)o+=t.value.distance,a+=t.next?Math.abs(t.value.elev-t.next.elev):0;if(d=10*Math.floor(c/(a/o)),o<=2*u*d)return;let n=v();t=l.itinerary.itineraryPoints.iterator,t.done;let r=t.value.distance;for(;!t.done;){let e=n.get(Math.floor(r/d)*d),o=n.get(Math.ceil(r/d)*d);if(e&&o){let a=r-e.distance,n=(o.elev-e.elev)/(o.distance-e.distance);t.value.elev=e.elev+a*n}r+=t.value.distance}}(e),createSvg:e=>g(e)})}function U(o){let n=t(),r=j(),i=H(),l=e.note.svgIconWidth,s=o||"TravelNotes-Control-";function d(e){let t="";0!==e.tooltipContent.length&&(t+='<div class="'+s+'NoteHtml-TooltipContent">'+e.tooltipContent+"</div>"),0!==e.popupContent.length&&(t+='<div class="'+s+'NoteHtml-PopupContent">'+e.popupContent+"</div>"),0!==e.address.length&&(t+='<div class="'+s+'NoteHtml-Address">'+P.getText("NoteEditor - Address")+e.address+"</div>"),0!==e.phone.length&&(t+='<div class="'+s+'NoteHtml-Phone">'+P.getText("NoteEditor - Phone")+e.phone+"</div>"),0!==e.url.length&&(t+='<div class="'+s+'NoteHtml-Url">'+P.getText("NoteEditor - Link")+'<a href="'+e.url+'" target="_blank">'+e.url.substr(0,40)+"...</a></div>");let o=j();return t+='<div class="'+s+'NoteHtml-LatLng">'+P.getText("NoteEditor - Latitude Longitude",{lat:o.formatLat(e.lat),lng:o.formatLng(e.lng)})+"</div>",a.invalid!==e.distance&&(t+='<div class="'+s+'NoteHtml-Distance">'+P.getText("NoteEditor - Distance",{distance:o.formatDistance(e.chainedDistance+e.distance)})+"</div>"),t}function c(e,t){let o=n.create("div",{className:s+"Travel-Notes-IconCell",innerHTML:e.iconContent},t);"svg"===o.firstChild.tagName&&"TravelNotes-Roadbook-"===s&&o.firstChild.setAttributeNS(null,"viewBox","0 0 "+l+" "+l),n.create("div",{className:s+"Travel-Notes-Cell",innerHTML:d(e)},t),t.noteObjId=e.objId}function u(e){let t='<div class="'+s+'Route-Header-Name">'+e.name+"</div>";return 0!==e.distance&&(t+='<div class="'+s+'Route-Header-Distance">'+P.getText("HTMLViewsFactory - Distance",{distance:r.formatDistance(e.distance)})+"</div>"),M.travel.readOnly||"bike"===e.itinerary.transitMode||(t+='<div class="'+s+'Route-Header-Duration">'+P.getText("HTMLViewsFactory - Duration",{duration:r.formatTime(e.duration)})+"</div>"),e.itinerary.hasProfile&&(t+='<div class="'+s+'Route-Header-Ascent">'+P.getText("HTMLViewsFactory - Ascent",{ascent:e.itinerary.ascent.toFixed(0)})+'</div><div class="'+s+'Route-Header-Descent">'+P.getText("HTMLViewsFactory - Descent",{descent:e.itinerary.descent.toFixed(0)})+"</div>"),t}function g(){let e=n.create("div",{className:s+"Travel-Header"});n.create("div",{className:s+"Travel-Header-Name",innerHTML:M.travel.name},e);let t=a.defaultValue,o=0,i=0,l=M.travel.routes.iterator;for(;!l.done;)n.create("div",{className:s+"Travel-Header-RouteName",innerHTML:'<a href="#route'+l.value.objId+'">'+l.value.name+"</a>&nbsp;:&nbsp;"+r.formatDistance(l.value.distance)+"."},e),l.value.chain&&(t+=l.value.distance,o+=l.value.itinerary.ascent,i+=l.value.itinerary.descent);return n.create("div",{className:s+"Travel-Header-TravelDistance",innerHTML:P.getText("HTMLViewsFactory - Travel distance&nbsp;:&nbsp;{distance}",{distance:r.formatDistance(t)})},e),0!==o&&n.create("div",{className:s+"Travel-Header-TravelAscent",innerHTML:P.getText("HTMLViewsFactory - Travel ascent&nbsp;:&nbsp;{ascent}",{ascent:o.toFixed(0)})},e),0!==i&&n.create("div",{className:s+"Travel-Header-TravelDescent",innerHTML:P.getText("HTMLViewsFactory - Travel descent&nbsp;:&nbsp;{descent}",{descent:i.toFixed(0)})},e),e}function p(){let e=n.create("div",{className:s+"Travel-Notes"}),t=M.travel.notes.iterator;for(;!t.done;){let o=n.create("div",{className:s+"Travel-Notes-Row"},e);c(t.value,o)}return e}function m(e){return n.create("div",{className:s+"Route-Header",id:"route"+e.objId,innerHTML:u(e)})}function h(e){let t=n.create("div",{className:s+"Route-ManeuversAndNotes"}),o=e.notes.iterator,i=o.done,l=i?Number.MAX_VALUE:o.value.distance,d=l,u=e.itinerary.maneuvers.iterator,g=u.done,p=a.defaultValue;for(;!g||!i;){let a=n.create("div",{className:s+"Route-ManeuversAndNotes-Row"},t);if(p<=l){if(!g){a.className=s+"Route-Maneuvers-Row",n.create("div",{className:s+"Route-ManeuversAndNotes-IconCell TravelNotes-ManeuverNote-"+u.value.iconName},a);let t="<div>"+u.value.instruction+"</div>";0<u.value.distance&&(t+="<div>"+P.getText("HTMLViewsFactory - To next instruction&nbsp;:&nbsp;{distance}&nbsp;-&nbsp;{duration}",{distance:r.formatDistance(u.value.distance),duration:r.formatTime(u.value.duration)})+"</div>"),n.create("div",{className:s+"Route-ManeuversAndNotes-Cell",innerHTML:t},a),a.objId=v(),a.latLng=e.itinerary.itineraryPoints.getAt(u.value.itineraryPointObjId).latLng,a.maneuverObjId=u.value.objId,p+=u.value.distance,g=u.done,g&&(p=Number.MAX_VALUE)}}else if(!i&&(a.className=s+"Route-Notes-Row",c(o.value,a),a.objId=v(),a.latLng=o.value.latLng,a.noteObjId=o.value.objId,d=o.value.distance,i=o.done,l=i?Number.MAX_VALUE:o.value.distance,!i)){let e=o.value.distance-d;9<e&&n.create("div",{className:s+"NoteHtml-NextDistance",innerHTML:P.getText("HTMLViewsFactory - Next distance&nbsp;:&nbsp;{distance}",{distance:r.formatDistance(e)})},a.lastChild)}}return t}function f(e){let t="";return""!==e.itinerary.provider&&""!==e.itinerary.transitMode&&(t=P.getText("HTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:e.itinerary.provider,transitMode:P.getText("HTMLViewsFactory - TransitMode "+e.itinerary.transitMode)})),n.create("div",{className:s+"RouteFooter",innerHTML:t})}function T(){return n.create("div",{className:s+"TravelFooter",innerHTML:P.getText("HTMLViewsFactory - Travel footer")})}function b(e){let t=n.create("div",{className:s+"RouteProfile",innerHTML:P.getText("HTMLViewsFactory - Profile")});return t.appendChild(i.createSvg(e)),t}return Object.seal({get travelHeaderHTML(){return g()},get travelNotesHTML(){return p()},get routeHeaderHTML(){return m(M.travel.editedRoute)},get routeManeuversAndNotesHTML(){return h(M.travel.editedRoute)},get routeFooterHTML(){return f(M.travel.editedRoute)},get travelFooterHTML(){return T()},get travelHTML(){return function(){let t=n.create("div",{className:s+"Travel"});t.appendChild(g()),t.appendChild(p());let o=M.travel.routes.iterator;for(;!o.done;){let a=e.routeEditor.displayEditionInHTMLPage&&o.value.objId===M.editedRouteObjId?M.travel.editedRoute:o.value;t.appendChild(m(a)),a.itinerary.hasProfile&&t.appendChild(b(a)),t.appendChild(h(a)),t.appendChild(f(a))}return t.appendChild(T()),t}()},getRouteHTML:e=>u(e),getNoteHTML:e=>d(e)})}const F=function(){let e=null;return Object.seal({getOpenPromise:()=>new Promise((function(t,o){if(e)return void t();let a=window.indexedDB.open("TravelNotesDb",1);a.onerror=function(){e=null,o(new Error("Not possible to open the db"))},a.onsuccess=function(o){e=o.target.result,t()},a.onupgradeneeded=function(t){e=t.target.result,e.createObjectStore("Travels",{keyPath:"UUID"})}})),getReadPromise:t=>function(t){return new Promise((function(o,a){if(!e)return void a(new Error("Database not opened"));let n=e.transaction(["Travels"],"readonly");n.onerror=function(){a(new Error("Transaction error"))},n.objectStore("Travels").get(t).onsuccess=function(e){o(e.target.result?e.target.result.data:null)}}))}(t),getWritePromise:(t,o)=>function(t,o){return new Promise((function(a,n){if(!e)return void n(new Error("Database not opened"));let r=null;try{r=e.transaction(["Travels"],"readwrite")}catch(e){return void n(e)}r.onerror=function(){n(new Error("Transaction error"))},r.objectStore("Travels").put({UUID:t,data:o}).onsuccess=function(){a()}}))}(t,o),closeDb:t=>function(t){if(!e)return;if(!t)return e.close(),void(e=null);let o=e.transaction(["Travels"],"readwrite");o.onerror=function(){};let a=o.objectStore("Travels").delete(t);a.onerror=function(){e.close(),e=null},a.onsuccess=function(){e.close(),e=null}}(t)})}();function W(){if(j().storageAvailable("localStorage")){let e=U("TravelNotes-Roadbook-");F.getOpenPromise().then(()=>{F.getWritePromise(M.UUID,e.travelHTML.outerHTML)}).then(()=>localStorage.setItem(M.UUID,Date.now())).catch(e=>console.log(e||"An error occurs when writing the content"))}}function V(){function e(e){return(e+540)%360-180}return Object.seal({getLatLngElevAtDist:(e,t)=>function(e,t){if(e.distance<=t||0>=t)return null;let o=0,a=e.itinerary.itineraryPoints.iterator;for(;o<t&&!a.done;)o+=a.value.distance;let n=a.value;a.done;let r=(n.distance-o+t)/n.distance;return[n.lat+(a.value.lat-n.lat)*r,n.lng+(a.value.lng-n.lng)*r,n.elev+(a.value.elev-n.elev)*r,100*(a.value.elev-n.elev)/n.distance]}(e,t),getClosestLatLngDistance:(e,t)=>function(e,t){if(0===e.itinerary.itineraryPoints.length)return null;let o=e.itinerary.itineraryPoints.iterator;o.done;let n=Number.MAX_VALUE,r=L.Projection.SphericalMercator.project(L.latLng(t[0],t[1])),i=L.Projection.SphericalMercator.project(L.latLng(o.value.lat,o.value.lng)),l=null,s=a.defaultValue,d=o.value.distance;for(;!o.done;){let e=L.Projection.SphericalMercator.project(L.latLng(o.value.lat,o.value.lng)),t=L.LineUtil.pointToSegmentDistance(r,i,e);t<n&&(n=t,l=L.Projection.SphericalMercator.unproject(L.LineUtil.closestPointOnSegment(r,i,e)),s=d-l.distanceTo(L.latLng(o.value.lat,o.value.lng))),d+=o.value.distance,i=e}return{latLng:[l.lat,l.lng],distance:s}}(e,t),getLatLngBounds:e=>function(e){let t=L.latLng([90,180]),o=L.latLng([-90,-180]);return e.forEach(e=>{t.lat=Math.min(t.lat,e[0]),t.lng=Math.min(t.lng,e[1]),o.lat=Math.max(o.lat,e[0]),o.lng=Math.max(o.lng,e[1])}),L.latLngBounds(t,o)}(e),pointsDistance:(t,o)=>function(t,o){if(t[0]===o[0]&&t[1]===o[1])return 0;const a=Math.PI/180;let n=t[0]*a,r=o[0]*a,i=(e(o[1])-e(t[1]))*a;return 6371e3*Math.acos(Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos(i))}(t,o),project:(e,t)=>function(e,t){let o=M.map.project(L.latLng(e),t);return[o.x,o.y]}(e,t),screenCoordToLatLng:(e,t)=>function(e,t){let o=M.map.containerPointToLatLng(L.point(e,t));return[o.lat,o.lng]}(e,t),addPoints:(e,t)=>function(e,t){return[e[0]+t[0],e[1]+t[1]]}(e,t),subtrackPoints:(e,t)=>function(e,t){return[e[0]-t[0],e[1]-t[1]]}(e,t)})}function K(){let e=k(),t=B(),o=[];function a(e){o.push(e.latLng),o.push(e.iconLatLng)}function n(e){e.itinerary.itineraryPoints.forEach(e=>o.push(e.latLng)),e.notes.forEach(e=>a(e))}return Object.seal({zoomToNote:o=>function(o){e.dispatch("zoomto",{latLng:t.getNoteAndRoute(o).note.latLng})}(o),zoomToRoute:a=>function(a){o=[],n(t.getRoute(a)),e.dispatch("zoomto",{geometry:[o]})}(a),zoomToTravel:()=>(o=[],M.travel.routes.forEach(e=>n(e)),-1!==M.travel.editedRouteObjId&&n(M.travel.editedRoute),M.travel.notes.forEach(e=>a(e)),void e.dispatch("zoomto",{geometry:[o]}))})}function z(){let e=null,o=null,a=null,n=0,r=0,i=0,l=0,s=0,d=0,c=null,u=t();function v(){c&&c(),document.querySelector("body").removeChild(e)}function g(){s=M.map.getContainer().clientWidth,d=M.map.getContainer().clientHeight,e=u.create("div",{className:"TravelNotes-FloatWindow-Container"},document.querySelector("body")),function(){let t=u.create("div",{className:"TravelNotes-FloatWindow-TopBar",draggable:!0},e);u.create("div",{innerHTML:"&#x274c",className:"TravelNotes-FloatWindow-CancelButton",title:P.getText("FloatWindow - Close")},t).addEventListener("click",v,!1),t.addEventListener("dragstart",e=>{try{e.dataTransfer.setData("Text","1")}catch(e){console.log(e)}n=e.screenX,r=e.screenY},!1),t.addEventListener("dragend",t=>{i+=t.screenX-n,l+=t.screenY-r,i=Math.min(Math.max(i,20),s-e.clientWidth-20),l=Math.max(l,20);let o=d-Math.max(l,0)-20;e.setAttribute("style","top:"+l+"px;left:"+i+"px;max-height:"+o+"px;")},!1)}(),o=u.create("div",{className:"TravelNotes-FloatWindow-HeaderDiv"},e),a=u.create("div",{className:"TravelNotes-FloatWindow-ContentDiv"},e)}return{createWindow:()=>g(),close:()=>v(),set onClose(e){c=e},get header(){return o},set header(e){o=e},get content(){return a},set content(e){a=e}}}let Z=!1;function J(){let t=V(),n={latLng:[i.defaultValue,i.defaultValue],distance:a.defaultValue},r=null,l=null,s={},d=new Map,c=new Map,u=[],v=null,g="",p=null,m=0,h=[0,0],f=0,T=null,b=e.note.svgZoom,y=e.note.svgAngleDistance,N=" ",L="",I="";function w(e){let t=!1;return l.wayPoints.forEach(o=>{Math.abs(e.lat-o.lat)<1e-5&&Math.abs(e.lng-o.lng)<1e-5&&(t=!0)}),!t&&(r.lat!==e.lat||r.lng!==e.lng)}function x(x,A){Z?A("A request is already running"):(Z=!0,s={},p=null,g="",N=" ",L="",I="",function(){let e=Number.MAX_VALUE,o=a.defaultValue;l.itinerary.itineraryPoints.forEach(a=>{let i=t.pointsDistance(n.latLng,a.latLng);e>i&&(e=i,r=a,n.distance=o),o+=a.distance}),n.latLng=r.latLng}(),o().getJsonPromise(function(){let t=n.latLng[0].toFixed(i.fixed)+","+n.latLng[1].toFixed(i.fixed);return e.overpassApiUrl+"?data=[out:json][timeout:"+e.note.svgTimeOut+"];way[highway](around:"+(1.5*e.note.svgIconWidth).toFixed(0)+","+t+")->.a;(.a >;.a;)->.a;.a out;is_in("+t+')->.e;area.e[admin_level="2"][name="United Kingdom"]->.f;area.e[admin_level="8"]->.g;area.e[admin_level="10"]->.h;if(f.count(deriveds)==0){.g->.i;}else{if(h.count(deriveds)==0){.g->.i;}else{.h->.i;}}.i out;(node(area.i)[place="village"];node(area.i)[place="hamlet"];node(area.i)[place="city"];node(area.i)[place="town"];)->.k;( node(around:'+e.note.svgHamletDistance+","+t+')[place="hamlet"];node(around:'+e.note.svgVillageDistance+","+t+')[place="village"];node(around:'+e.note.svgCityDistance+","+t+')[place="city"];node(around:'+e.note.svgTownDistance+","+t+')[place="town"];)->.l;node.k.l->.m;.m out;'}()).then((function(o){s=o,d.clear(),c.clear(),s.elements.forEach(e=>{switch(e.type){case"area":e.tags&&e.tags.boundary&&e.tags.name&&(g=e.tags.name);break;case"way":e.nodesIds=e.nodes,delete e.nodes,d.set(e.id,e);break;case"node":c.set(e.id,e),e.tags&&e.tags.place&&["town","city","village","hamlet"].includes(e.tags.place)&&u.push(e)}}),p=document.createElementNS("http://www.w3.org/2000/svg","svg"),p.setAttributeNS(null,"viewBox",String(e.note.svgIconWidth/4)+" "+e.note.svgIconWidth/4+" "+e.note.svgIconWidth/2+" "+e.note.svgIconWidth/2),p.setAttributeNS(null,"class","TravelNotes-SvgIcon"),function(){let e=Number.MAX_VALUE;u.forEach(o=>{let a=t.pointsDistance(r.latLng,[o.lat,o.lon]);e>a&&(e=a,v=o.tags.name)})}(),h=t.subtrackPoints([e.note.svgIconWidth/2,e.note.svgIconWidth/2],t.project(n.latLng,b)),function(){let e=a.defaultValue,o=l.itinerary.itineraryPoints.first,i=l.itinerary.itineraryPoints.last,s=!1;l.itinerary.itineraryPoints.forEach(t=>{n.distance-e>y&&(o=t),e-n.distance>y&&!s&&(i=t,s=!0),e+=t.distance});let d=t.addPoints(t.project(n.latLng,b),h);if(r.objId!==l.itinerary.itineraryPoints.first.objId){let e=t.addPoints(t.project(o.latLng,b),h);f=180*Math.atan((d[1]-e[1])/(e[0]-d[0]))/Math.PI,0>f&&(f+=360),f-=270,0>e[0]-d[0]&&(f+=180)}if(r.objId!==l.itinerary.itineraryPoints.last.objId){let e=t.addPoints(t.project(i.latLng,b),h);for(T=180*Math.atan((d[1]-e[1])/(e[0]-d[0]))/Math.PI,0>e[0]-d[0]&&(T+=180),T-=f;0>T;)T+=360;for(;360<T;)T-=360}r.objId===l.itinerary.itineraryPoints.first.objId&&(f=-T-90,T=null,m=-1),n.latLng[0]===l.itinerary.itineraryPoints.last.lat&&n.latLng[1]===l.itinerary.itineraryPoints.last.lng&&(T=null,m=1)}(),null!==T&&(T<e.note.svgAnleMaxDirection.right?(L=P.getText("SvgIconFromOsmFactory - Turn right"),N="&#x1f882;"):T<e.note.svgAnleMaxDirection.slightRight?(L=P.getText("SvgIconFromOsmFactory - Turn slight right"),N="&#x1f885;"):T<e.note.svgAnleMaxDirection.continue?(L=P.getText("SvgIconFromOsmFactory - Continue"),N="&#x1f881;"):T<e.note.svgAnleMaxDirection.slightLeft?(L=P.getText("SvgIconFromOsmFactory - Turn slight left"),N="&#x1f884;"):T<e.note.svgAnleMaxDirection.left?(L=P.getText("SvgIconFromOsmFactory - Turn left"),N="&#x1f880;"):T<e.note.svgAnleMaxDirection.sharpLeft?(L=P.getText("SvgIconFromOsmFactory - Turn sharp left"),N="&#x1f887;"):T<e.note.svgAnleMaxDirection.sharpRight?(L=P.getText("SvgIconFromOsmFactory - Turn sharp right"),N="&#x1f886;"):(L=P.getText("SvgIconFromOsmFactory - Turn right"),N="&#x1f882;")),-1===m?L=P.getText("SvgIconFromOsmFactory - Start"):1===m&&(L=P.getText("SvgIconFromOsmFactory - Stop")),function(){let e=l.itinerary.itineraryPoints.previous(r.objId,w),o=l.itinerary.itineraryPoints.next(r.objId,w),n=-1,i=-1,s=-1,u=Number.MAX_VALUE,v=Number.MAX_VALUE,g=Number.MAX_VALUE,p=a.defaultValue;c.forEach(a=>{r&&(p=t.pointsDistance([a.lat,a.lon],r.latLng),p<u&&(n=a.id,u=p)),e&&(p=t.pointsDistance([a.lat,a.lon],e.latLng),p<v&&(i=a.id,v=p)),o&&(p=t.pointsDistance([a.lat,a.lon],o.latLng),p<g&&(s=a.id,g=p))});let h=c.get(n),f=h&&h.tags&&h.tags.highway&&"mini_roundabout"===h.tags.highway?P.getText("SvgIconFromOsmFactory - at the small roundabout on the ground"):null,T="",b="",y=!1,x=!1;d.forEach(e=>{if(!e.nodesIds.includes(n))return;let t=function(e){return(e.tags.name?e.tags.name:"")+(e.tags.name&&e.tags.ref?" ":"")+(e.tags.ref?"["+e.tags.ref+"]":"")}(e),o=""!==t,a=e.nodesIds.includes(i),r=e.nodesIds.includes(s),l=2*e.nodesIds.filter(e=>e===n).length;if(e.nodesIds[0]===n&&l--,e.nodesIds[e.nodesIds.length-1]===n&&l--,a&&(T=o?t:"???",l--,e.tags.junction&&"roundabout"===e.tags.junction&&(x=!0)),0!==l&&(r&&(b=o?t:"???",l--,e.tags.junction&&"roundabout"===e.tags.junction&&(y=!0)),0!==l&&o))for(;0!==l;)I=""===I?t:I+" &#x2AA5; "+t,l--}),""===T&&(N="&#x1F7E2;"),I=-1===m?"&#x1F7E2; "+b:1===m?T+" &#x1F534;":T+(""===I?"":" &#x2AA5; "+I)+" "+N+" "+b,y&&!x?L+=P.getText("SvgIconFromOsmFactory - entry roundabout"):!y&&x?L+=P.getText("SvgIconFromOsmFactory - exit roundabout"):y&&x&&(L+=P.getText("SvgIconFromOsmFactory - continue roundabout")),f&&(L+=f)}(),function(){let o=-1,a=-1,n=-1,r=[];if(l.itinerary.itineraryPoints.forEach(i=>{o++;let l=t.addPoints(t.project(i.latLng,b),h);r.push(l),l[0]>=0&&l[1]>=0&&l[0]<=e.note.svgIconWidth&&l[1]<=e.note.svgIconWidth&&(-1===a&&(a=o),n=o)}),-1!==a&&-1!==n){0<a&&a--,l.itinerary.itineraryPoints.length-1>n&&n++;let t="";for(o=a;o<=n;o++)t+=r[o][0].toFixed(0)+","+r[o][1].toFixed(0)+" ";let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttributeNS(null,"points",t),i.setAttributeNS(null,"class","TravelNotes-OSM-Itinerary"),i.setAttributeNS(null,"transform","rotate("+f+","+e.note.svgIconWidth/2+","+e.note.svgIconWidth/2+")"),p.appendChild(i)}}(),d.forEach(o=>{let a=-1,n=-1,r=-1,i=[];if(o.nodesIds.forEach(o=>{r++;let l=c.get(o),s=t.addPoints(t.project([l.lat,l.lon],b),h);i.push(s),s[0]>=0&&s[1]>=0&&s[0]<=e.note.svgIconWidth&&s[1]<=e.note.svgIconWidth&&(-1===a&&(a=r),n=r)}),-1!==a&&-1!==n){0<a&&a--,o.nodesIds.length-1>n&&n++;let t="";for(r=a;r<=n;r++)t+=i[r][0].toFixed(0)+","+i[r][1].toFixed(0)+" ";let l=document.createElementNS("http://www.w3.org/2000/svg","polyline");l.setAttributeNS(null,"points",t),l.setAttributeNS(null,"class","TravelNotes-OSM-Highway TravelNotes-OSM-Highway-"+o.tags.highway),l.setAttributeNS(null,"transform","rotate("+f+","+e.note.svgIconWidth/2+","+e.note.svgIconWidth/2+")"),p.appendChild(l)}}),Z=!1,x({svg:p,tooltip:L,city:g,place:v,streets:I,latLng:r.latLng})})).catch(e=>{Z=!1,A(e)}))}return Object.seal({getPromiseIconAndAdress:(e,t)=>function(e,t){return n.latLng=e,l=B().getRoute(t),new Promise(x)}(e,t)})}function X(){return Object.seal({getPromiseAddress:t=>function(t){let a=e.nominatim.url+"reverse?format=json&lat="+t[0]+"&lon="+t[1]+"&zoom=18&addressdetails=1",n=e.nominatim.language;n&&"*"!==n&&(a+="&accept-language="+n);let r=null;return n&&"*"===n&&(r=[{headerName:"accept-language",headerValue:""}]),o().getJsonPromise(a,r)}(t)})}const G=function(){let e=[],o=[],a=null,n=null,r=null,i=null,l=t();function s(){o.forEach(e=>n.add(l.create("option",{text:e.name}))),n.selectedIndex=-1}function d(){e.forEach(e=>{l.create("button",{type:"button",innerHTML:e.title||"?",htmlBefore:e.htmlBefore||"",htmlAfter:e.htmlAfter||"",className:"TravelNotes-NoteDialog-EditorButton"},a).addEventListener("click",i,!1)})}function c(t){let r=new FileReader;r.onload=function(){try{let t=JSON.parse(r.result);e=e.concat(t.editionButtons),o=o.concat(t.preDefinedIconsList),o.sort((e,t)=>e.name.localeCompare(t.name));let l=null;for(;0<document.getElementsByClassName("TravelNotes-NoteDialog-EditorButton").length;)l=document.getElementsByClassName("TravelNotes-NoteDialog-EditorButton")[0],l.removeEventListener("click",i,!1),a.removeChild(l);d();for(let e=n.length-1;e>=0;e--)n.remove(e);s()}catch(e){console.log(e||"An error occurs when opening the file")}},r.readAsText(t.target.files[0])}function u(e,t){return r=e,i=t,a=l.create("div",{className:"TravelNotes-NoteDialog-ToolbarDiv",id:"TravelNotes-NoteDialog-ToolbarDiv"}),function(){n=l.create("select",{className:"TravelNotes-NoteDialog-Select",id:"TravelNotes-NoteDialog-IconSelect"},a),n.addEventListener("change",r,!1),s();let e=l.create("div",{id:"TravelNotes-NoteDialog-OpenEditorFileDiv"},a),t=l.create("input",{id:"TravelNotes-NoteDialog-OpenEditorFileInput",type:"file",accept:".json"},e);t.addEventListener("change",c,!1);let o=l.create("div",{id:"TravelNotes-NoteDialog-OpenStyleFakeDiv"},e);l.create("button",{id:"TravelNotes-NoteDialog-OpenEditorFileButton",title:P.getText("NoteDialog - Open a configuration file"),innerHTML:"&#x1F4C2;"},o).addEventListener("click",()=>t.click(),!1),d()}(),a}return Object.seal({set selectOptions(e){var t;t=e,o=o.concat(t),o.sort((e,t)=>e.name.localeCompare(t.name))},set buttons(t){e=e.concat(t)},getIconData:e=>o[e],createToolbar:(e,t)=>u(e,t)})}();function Y(){let e=null,o=null,a=null,n=t();return{createUI:()=>{document.getElementById("TravelNotes-WaitUI")||(e=n.create("div",{id:"TravelNotes-WaitUI-Background"},document.querySelector("body")),o=n.create("div",{id:"TravelNotes-WaitUI"},e),a=n.create("div",{id:"TravelNotes-WaitUI-MessageDiv"},o),n.create("div",{className:"TravelNotes-WaitUI-WaitBullet"},n.create("div",{className:"TravelNotes-WaitUI-Wait"},o)))},showInfo:e=>function(e){a.innerHTML=e}(e),close:()=>(document.querySelector("body").removeChild(e),void(e=null))}}const q=function(){let o=B(),n=k(),r=V(),l=null,s=0,c=0;function u(a){let i=o.getRoute(a),u=i.itinerary.maneuvers.iterator;for(c=0;!u.done;)"kDepartDefault"===u.value.iconName&&!u.first||"kArriveDefault"===u.value.iconName&&!u.last||c++;e.note.maxManeuversNotes<c?R.showError(P.getText("NoteEditor - max maneuvers notes reached {maneuversLength}{maxManeuversNotes}",{maneuversLength:c,maxManeuversNotes:e.note.maxManeuversNotes})):function(e){let o=t(),a=null;return function(){if(a=S(),a.title=e.title||"",e.okButtonContent&&(a.okButton.innerHTML=e.okButtonContent),a.okButton.classList.add("TravelNotes-TwoButtonsDialog-InlineButton"),e.secondButtonContent){o.create("div",{innerHTML:e.secondButtonContent,className:"TravelNotes-BaseDialog-Button TravelNotes-TwoButtonsDialog-InlineButton"},a.footer).addEventListener("click",()=>a.cancelButton.click(),!0)}e.textContent&&o.create("div",{id:"TravelNotes-TwoButtonsDialog-MessageDiv",innerHTML:e.textContent},a.content)}(),a}({title:P.getText("NoteEditor - Add a note for each maneuver"),textContent:P.getText("NoteEditor - Add a note for each maneuver. Are you sure?",{noteLength:c}),secondButtonContent:"&#x274C"}).show().then(()=>{u=i.itinerary.maneuvers.iterator,u.done||(l=Y(),l.createUI(),s=1,function t(o,a){function i(){o.done?(a.notes.sort((e,t)=>e.distance-t.distance),n.dispatch("updateitinerary"),n.dispatch("roadbookupdate"),l.close(),l=null):t(o,a)}if(l.showInfo(P.getText("NoteEditor - Creating note",{noteNumber:s,notesLength:c})),"kDepartDefault"===o.value.iconName&&!o.first||"kArriveDefault"===o.value.iconName&&!o.last)i();else{s++;let t=a.itinerary.itineraryPoints.getAt(o.value.itineraryPointObjId).latLng;J().getPromiseIconAndAdress(t,a.objId).then(t=>{let o=x();o.iconContent=t.svg.outerHTML,o.popupContent="",o.iconWidth=d.width,o.iconHeight=d.height,o.tooltipContent=t.tooltip,o.address=t.streets,""!==t.city&&(o.address+=" "+e.note.cityPrefix+t.city+e.note.cityPostfix),t.place&&t.place!==t.city&&(o.address+=" ("+t.place+")"),o.latLng=t.latLng,o.iconLatLng=t.latLng,o.distance=r.getClosestLatLngDistance(a,o.latLng).distance,o.chainedDistance=a.chainedDistance,a.notes.add(o),n.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:o.objId}),i()}).catch(e=>{console.log(e||"an error occurs when creating the SVG icon."),i()})}}(u,i))}).catch(e=>console.log(e||"An error occurs in the note dialog"))}function v(a,r,l){(function(o,a,n){let r=null,l=t(),s=o.latLng,c="",u="",v=null,g=null,p=null,m=null,h=null,f=null,T=null,b=null,y=null,N=null,L=null;function I(){if(0!==p.value.length)return o.iconWidth=m.value,o.iconHeight=h.value,o.iconContent=p.value,o.popupContent=f.value,o.tooltipContent=T.value,o.address=b.value,o.url=y.value,o.phone=N.value,o.latLng=s,o;v.showError(P.getText("Notedialog - The icon content cannot be empty"))}function w(t){c="",u="",t.address.house_number&&(c+=t.address.house_number+" "),t.address.road?c+=t.address.road+" ":t.address.pedestrian&&(c+=t.address.pedestrian+" "),t.address.village?u=t.address.village:t.address.town?u=t.address.town:t.address.city&&(u=t.address.city),""!==u&&(c+=e.note.cityPrefix+u+e.note.cityPostfix),0===c.length&&(c+=t.address.country),e.note.reverseGeocoding&&""===o.address&&n&&(b.value=c)}function x(e){v.showError(P.getText("Notedialog - an error occurs when searching the adress")),console.log(e||"an error occurs when searching the adress.")}function A(t){p.value=t.svg.outerHTML,T.value=t.tooltip;let o=t.streets,a=""===t.city?u:t.city;""!==a&&(o+=" "+e.note.cityPrefix+a+e.note.cityPostfix),t.place&&t.place!==a&&(o+=" ("+t.place+")"),b.value=o,s=t.latLng,v.hideWait()}function E(e){v.hideWait(),v.showError(P.getText("Notedialog - an error occurs when creating the SVG icon")),console.log(e||"an error occurs when creating the SVG icon.")}function C(e){let t=G.getIconData(e.target.selectedIndex);"SvgIcon"===t.icon?-1===a?v.showError(P.getText("Notedialog - not possible to create a SVG icon for a travel note")):(v.showWait(),J().getPromiseIconAndAdress(o.latLng,a).then(A).catch(E)):(v.hideError(),m.value=t.width,h.value=t.height,p.value=t.icon,T.value=t.tooltip)}function D(e){if(!r)return;let t=e.target;for(;!t.htmlBefore;)t=t.parentNode;let o=t.htmlAfter&&0<t.htmlAfter.length,a=r.selectionStart,n=r.selectionEnd,i=r.value;r.value=i.substring(0,a)+(o?t.htmlBefore+i.substring(a,n)+t.htmlAfter:t.htmlBefore)+i.substring(n),r.setSelectionRange(o||a===n?a+t.htmlBefore.length:a,(o?n:a)+t.htmlBefore.length),r.focus()}function j(e){r=e.target}return v=S(),v.title=P.getText("NoteDialog - Note"),v.okButtonListener=I,g=l.create("div",{id:"TravelNotes-NoteDialog-MainDataDiv"},v.content),g.appendChild(G.createToolbar(C,D)),function(){let e=l.create("div",{className:"TravelNotes-NoteDialog-DataDiv",id:"TravelNotes-NoteDialog-DimensionsDataDiv"},g);l.create("text",{data:P.getText("NoteDialog - Icon width")},e),m=l.create("input",{type:"number",className:"TravelNotes-NoteDialog-NumberInput",id:"TravelNotes-NoteDialog-WidthNumberInput"},e),m.value=0===o.iconWidth?d.width:o.iconWidth,l.create("text",{data:P.getText("NoteDialog - Icon height")},e),h=l.create("input",{type:"number",className:"TravelNotes-NoteDialog-NumberInput",id:"TravelNotes-NoteDialog-HeightNumberInput"},e),h.value=0===o.iconHeight?d.height:o.iconHeight}(),l.create("div",{className:"TravelNotes-NoteDialog-TitleDiv",id:"TravelNotes-NoteDialog-IconContentTitleDiv",innerHTML:P.getText("NoteDialog - Icon content")},g),p=l.create("textarea",{className:"TravelNotes-NoteDialog-TextArea",id:"TravelNotes-NoteDialog-TextArea-IconHtmlContent"},g),p.addEventListener("focus",j,!1),p.value=o.iconContent,l.create("div",{className:"TravelNotes-NoteDialog-TitleDiv",innerHTML:P.getText("NoteDialog - Text")},g),f=l.create("textarea",{className:"TravelNotes-NoteDialog-TextArea",id:"TravelNotes-NoteDialog-TextArea-PopupContent"},g),f.addEventListener("focus",j,!1),f.value=o.popupContent,l.create("div",{className:"TravelNotes-NoteDialog-TitleDiv",innerHTML:P.getText("NoteDialog - Tooltip content")},g),T=l.create("input",{type:"text",className:"TravelNotes-NoteDialog-InputText",id:"TravelNotes-NoteDialog-InputText-Tooltip"},g),T.addEventListener("focus",j,!1),T.value=o.tooltipContent,L=l.create("div",{className:"TravelNotes-NoteDialog-TitleDiv",innerHTML:'<span id="TravelNotes-NoteDialog-Reset-Address-Button">&#x1f504;</span>&nbsp;'+P.getText("NoteDialog - Address&nbsp;:")},g),L.addEventListener("click",(function(){b.value=c}),!1),b=l.create("input",{type:"text",className:"TravelNotes-NoteDialog-InputText",id:"TravelNotes-NoteDialog-InputText-Adress"},g),b.addEventListener("focus",j,!1),b.value=o.address,X().getPromiseAddress(o.latLng).then(w).catch(x),l.create("div",{className:"TravelNotes-NoteDialog-TitleDiv",innerHTML:(e.layersToolbarUI.theDevil.addButton?'<a href="https://www.google.com/maps/@'+o.lat.toFixed(i.fixed)+","+o.lng.toFixed(i.fixed)+","+e.layersToolbarUI.theDevil.noteZoom+'z" target="_blank" title="'+e.layersToolbarUI.theDevil.title+'" >'+e.layersToolbarUI.theDevil.text+"</a> ":"")+P.getText("NoteDialog - Link")},g),y=l.create("input",{type:"text",className:"TravelNotes-NoteDialog-InputText",id:"TravelNotes-NoteDialog-InputText-Link"},g),y.addEventListener("focus",(function(){r=null}),!1),y.value=o.url,l.create("div",{className:"TravelNotes-NoteDialog-TitleDiv",innerHTML:P.getText("NoteDialog - Phone")},g),N=l.create("input",{type:"text",className:"TravelNotes-NoteDialog-InputText",id:"TravelNotes-NoteDialog-InputText-Phone"},g),N.addEventListener("focus",j,!1),N.value=o.phone,v})(a,r,l).show().then(()=>{if(l)if(-1===r)M.travel.notes.add(a);else{let e=o.getRoute(r);e.notes.add(a),a.chainedDistance=e.chainedDistance,e.notes.sort((e,t)=>e.distance-t.distance)}-1===r?n.dispatch("settravelnotes"):n.dispatch("setitinerary"),n.dispatch("noteupdated",{removedNoteObjId:a.objId,addedNoteObjId:a.objId})}).catch(e=>console.log(e||"An error occurs in the note dialog"))}function g(e){let t=x();return t.latLng=e,t.iconLatLng=e,t}function p(){let e=M.travel.notes.iterator;for(;!e.done;)n.dispatch("removeobject",{objId:e.value.objId});let t=M.travel.routes.iterator;for(;!t.done;)for(e=t.value.notes.iterator;!e.done;)n.dispatch("removeobject",{objId:e.value.objId});if(-1!==M.editedRouteObjId)for(e=M.travel.editedRoute.notes.iterator;!e.done;)n.dispatch("removeobject",{objId:e.value.objId})}return Object.seal({addAllManeuverNotes:e=>u(e),newRouteNote:(e,t)=>function(e,t){let a=o.getRoute(e),n=r.getClosestLatLngDistance(a,[t.latlng.lat,t.latlng.lng]),i=g(n.latLng);i.distance=n.distance,v(i,a.objId,!0)}(e,t),newSearchNote:e=>function(e){let t=g([e.lat,e.lon]);t.address=(e.tags["addr:housenumber"]?e.tags["addr:housenumber"]+" ":"")+(e.tags["addr:street"]?e.tags["addr:street"]+" ":"")+(e.tags["addr:city"]?e.tags["addr:city"]+" ":""),t.url=e.tags.website||"",t.phone=e.tags.phone||"",t.tooltipContent=e.tags.name||"",t.popupContent=e.tags.name||"",v(t,-1,!0)}(e),newManeuverNote:(e,t)=>function(e,t){let o=r.getClosestLatLngDistance(M.travel.editedRoute,t),a=M.travel.editedRoute.itinerary.maneuvers.getAt(e),n=g(t);n.distance=o.distance,n.iconContent='<div class="TravelNotes-ManeuverNote TravelNotes-ManeuverNote-'+a.iconName+'"></div>',n.popupContent=a.instruction,v(n,M.travel.editedRoute.objId,!0)}(e,t),newTravelNote:e=>function(e){v(g(e),-1,!0)}(e),editNote:e=>function(e){let t=o.getNoteAndRoute(e),a=null===t.route?-1:t.route.objId;v(t.note,a,!1)}(e),removeNote:e=>function(e){let t=o.getNoteAndRoute(e);t.route?(t.route.notes.remove(e),n.dispatch("updateitinerary")):(M.travel.notes.remove(e),n.dispatch("updatetravelnotes")),n.dispatch("noteupdated",{removedNoteObjId:e,addedNoteObjId:-1})}(e),hideNotes:()=>p(),showNotes:()=>function(){p();let e=M.travel.notes.iterator;for(;!e.done;)n.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:e.value.objId});let t=M.travel.routes.iterator;for(;!t.done;)t.value.hidden||n.dispatch("routeupdated",{removedRouteObjId:t.value.objId,addedRouteObjId:t.value.objId})}(),attachNoteToRoute:e=>function(e){let t=o.getNoteAndRoute(e),a=Number.MAX_VALUE,i=null,l=null,s=null;M.travel.routes.forEach(e=>{let o=r.getClosestLatLngDistance(e,t.note.latLng);if(o){let n=r.pointsDistance(t.note.latLng,o.latLng);n<a&&(a=n,i=e,l=o.latLng,s=o.distance)}}),i&&(M.travel.notes.remove(e),t.note.distance=s,t.note.latLng=l,t.note.chainedDistance=i.chainedDistance,i.notes.add(t.note),i.notes.sort((e,t)=>e.distance-t.distance),n.dispatch("noteupdated",{removedNoteObjId:e,addedNoteObjId:e}),n.dispatch("updateitinerary"),n.dispatch("updatetravelnotes"))}(e),detachNoteFromRoute:e=>function(e){let t=o.getNoteAndRoute(e);t.route.notes.remove(e),t.note.distance=a.invalid,t.note.chainedDistance=a.defaultValue,M.travel.notes.add(t.note),n.dispatch("updateitinerary"),n.dispatch("updatetravelnotes"),n.dispatch("roadbookupdate")}(e),noteDropped:(e,t,o)=>function(e,t,o){M.travel.notes.moveTo(e,t,o),n.dispatch("updatetravelnotes"),n.dispatch("roadbookupdate")}(e,t,o)})}();const Q=function(){let o=new Map,a=H();function n(e){let a=o.get(e);a||(a=function(){let e=v(),o=null,a=null,n=null,r=null,i=null,l=null,d=null,c=null,u=V(),g=k(),p=j();function m(e){e.stopPropagation();let t=o.getBoundingClientRect(),a=(e.clientX-t.x-s.margin/(2*s.margin+s.width)*t.width)/(s.width/(2*s.margin+s.width)*t.width)*c.distance,n=u.getLatLngElevAtDist(c,a);n&&g.dispatch("zoomto",{latLng:[n[0],n[1]]})}function h(e){e.preventDefault(),e.stopPropagation();let t=o.getBoundingClientRect(),a=(e.clientX-t.x-s.margin/(2*s.margin+s.width)*t.width)/(s.width/(2*s.margin+s.width)*t.width)*c.distance,n=u.getLatLngElevAtDist(c,a);n&&q.newRouteNote(c.objId,{latlng:{lat:n[0],lng:n[1]}})}function f(t){t.stopPropagation();let l=o.getBoundingClientRect(),d=(t.clientX-l.x-s.margin/(2*s.margin+s.width)*l.width)/(s.width/(2*s.margin+s.width)*l.width)*c.distance,v=u.getLatLngElevAtDist(c,d);if(v){const u=3;g.dispatch("removeobject",{objId:e}),g.dispatch("additinerarypointmarker",{objId:e,latLng:[v[0],v[1]]}),a&&(o.removeChild(a),o.removeChild(i),o.removeChild(n),o.removeChild(r));let m=(2*s.margin+s.width)*(t.clientX-l.x)/l.width,h=s.margin+s.height;a=document.createElementNS("http://www.w3.org/2000/svg","polyline"),a.setAttributeNS(null,"points",String(m)+","+s.margin+" "+m+","+h),a.setAttributeNS(null,"class","TravelNotes-SvgProfile-markerPolyline"),o.appendChild(a);let f=d>c.distance/2?"end":"start",T=d>c.distance/2?-s.xDeltaText:s.xDeltaText;i=document.createElementNS("http://www.w3.org/2000/svg","text"),i.appendChild(document.createTextNode(p.formatDistance(d))),i.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevText"),i.setAttributeNS(null,"x",m+T),i.setAttributeNS(null,"y",s.margin+s.yDeltaText),i.setAttributeNS(null,"text-anchor",f),o.appendChild(i),n=document.createElementNS("http://www.w3.org/2000/svg","text"),n.appendChild(document.createTextNode("Alt. "+v[2].toFixed(0)+" m.")),n.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevText"),n.setAttributeNS(null,"x",m+T),n.setAttributeNS(null,"y",s.margin+2*s.yDeltaText),n.setAttributeNS(null,"text-anchor",f),o.appendChild(n),r=document.createElementNS("http://www.w3.org/2000/svg","text"),r.appendChild(document.createTextNode("Pente "+v[u].toFixed(0)+" % ")),r.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevText"),r.setAttributeNS(null,"x",m+T),r.setAttributeNS(null,"y",s.margin+s.yDeltaText*u),r.setAttributeNS(null,"text-anchor",f),o.appendChild(r)}}function T(){o&&(o.removeEventListener("click",m,!1),o.removeEventListener("contextmenu",h,!1),o.removeEventListener("mousemove",f,!1),g.dispatch("removeobject",{objId:e}),l.content.removeChild(d),l.content.removeChild(o)),o=null,a=null,r=null,i=null,n=null,d=null}return l=z(),l.createWindow(),l.onClose=function(){T(),g.dispatch("profileclosed",{objId:c.objId})},l.update=function(e){T(),c=e,o=H().createSvg(e),l.header.innerHTML=P.getText("ProfileWindow - Profile {name}",c),l.content.appendChild(o),o.addEventListener("click",m,!1),o.addEventListener("contextmenu",h,!1),o.addEventListener("mousemove",f,!1),d=t().create("div",{className:"TravelNotes-ProfileWindow-Ascent",innerHTML:P.getText("ProfileWindow - Ascent: {ascent} m. - Descent: {descent} m. - Distance: {distance}",{ascent:c.itinerary.ascent.toFixed(0),descent:c.itinerary.descent.toFixed(0),distance:p.formatDistance(c.distance)})}),l.content.appendChild(d)},Object.seal(l)}());let n=B().getRoute(e);a.update(n),o.set(e,a)}return Object.seal({createProfile:t=>function(t){let n=o.get(t.objId);if(t.itinerary.hasProfile){e.route.elev.smooth&&a.smooth(t),t.itinerary.ascent=0,t.itinerary.descent=0;let o=t.itinerary.itineraryPoints.first.elev;t.itinerary.itineraryPoints.forEach(e=>{let a=e.elev-o;0>a?t.itinerary.descent-=a:t.itinerary.ascent+=a,o=e.elev}),n&&n.update(t)}else n&&n.close()}(t),updateProfile:(e,t)=>function(e,t){let a=o.get(e);a&&(o.delete(e),t&&t.itinerary.hasProfile?(a.update(t),o.set(t.objId,a)):a.close())}(e,t),deleteProfile:e=>function(e){let t=o.get(e);t&&t.close()}(e),deleteAllProfiles:()=>{o.forEach(e=>e.close())},showProfile:e=>n(e),onProfileClosed:e=>function(e){o.delete(e)}(e)})}();function _(e){let o=t(),a=null,n=null,r=null;function i(){return a.hideError(),!e||!(r.value.length<12)&&r.value.match(RegExp("[0-9]+"))&&r.value.match(RegExp("[a-z]+"))&&r.value.match(RegExp("[A-Z]+"))&&r.value.match(RegExp("[^0-9a-zA-Z]"))?(new window.TextEncoder).encode(r.value):(a.showError(P.getText("PasswordDialog - Password rules")),void r.focus())}return a=S(),a.title=P.getText("PasswordDialog - password"),a.okButtonListener=i,n=o.create("div",{id:"TravelNotes-PasswordDialog-DataDiv"},a.content),r=o.create("input",{id:"TravelNotes-PasswordDialog-PasswordInput",type:"password"},n),a.onShow=function(){r.focus()},a}function $(){function e(e){return window.crypto.subtle.importKey("raw",e,{name:"PBKDF2"},!1,["deriveKey"])}function t(e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:(new window.TextEncoder).encode("Tire la chevillette la bobinette cherra. Le Petit Chaperon rouge tira la chevillette."),iterations:1e6,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}return Object.seal({encryptData:function(o,a,n,r){!function(o,a,n,r){let i=window.crypto.getRandomValues(new Uint8Array(16));r.then(e).then(t).then((function(e){return window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},e,o)})).then((function(e){a(new Blob([i,new Uint8Array(e)],{type:"application/octet-stream"}))})).catch(n)}(o,a,n,r)},decryptData:function(o,a,n,r){!function(o,a,n,r){r.then(e).then(t).then((function(e){return window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(o.slice(0,16))},e,new Uint8Array(o.slice(16)))})).then(a).catch(n)}(o,a,n,r)}})}function ee(a){let n=t(),r=null,i=null,l=null,s=null,d=null;function c(){let e=[],t=l.childNodes;for(let o=0;o<t.length;o++)e.push({providerName:t[o].childNodes[0].value,providerKey:t[o].childNodes[1].value});return e}function u(){let e=!0;r.hideError();let t=l.childNodes;for(let o=0;o<t.length;o++)e=e&&""!==t[o].childNodes[0].value,e=e&&""!==t[o].childNodes[1].value;return e||r.showError(P.getText("APIKeysDialog - empty API key name or value")),e}function v(){if(r.hideError(),u())return c()}function g(t){let o=n.create("div",{className:"TravelNotes-APIKeysDialog-ApiKeyRow"},l);n.create("input",{className:"TravelNotes-APIKeysDialog-ApiKeyName TravelNotes-APIKeysDialog-Input",value:t.providerName,placeholder:P.getText("APIKeysDialog - provider name")},o),n.create("input",{className:"TravelNotes-APIKeysDialog-ApiKeyValue TravelNotes-APIKeysDialog-Input",value:t.providerKey,placeholder:P.getText("APIKeysDialog - API key"),type:e.APIKeys.showAPIKeysInDialog?"text":"password"},o),n.create("div",{className:"TravelNotes-APIKeysDialog-Button TravelNotes-APIKeysDialog-DeleteButton",title:P.getText("APIKeysDialog - delete API key"),innerHTML:"&#x274c"},o).addEventListener("click",e=>{e.stopPropagation(),e.target.parentNode.parentNode.removeChild(e.target.parentNode)},!1)}function p(){r.showError(P.getText("APIKeysDialog - An error occurs when saving the keys")),r.hideWait(),r.keyboardEventListenerEnabled=!0}function m(e){r.hideError(),r.hideWait();let t=URL.createObjectURL(e),o=document.createElement("a");o.setAttribute("href",t),o.setAttribute("download","APIKeys"),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(t),r.keyboardEventListenerEnabled=!0}function h(e){r.hideWait(),r.keyboardEventListenerEnabled=!0,e&&"Canceled by user"!==e&&r.showError(P.getText("APIKeysDialog - An error occurs when reading the file"))}function f(e){let t=null;try{t=JSON.parse((new TextDecoder).decode(e))}catch(e){return void h(e)}for(;l.firstChild;)l.removeChild(l.firstChild);t.forEach(e=>g(e)),r.hideWait(),r.hideError(),r.keyboardEventListenerEnabled=!0}function T(t){t.stopPropagation(),e.haveCrypto&&(r.showWait(),r.keyboardEventListenerEnabled=!1,o().getBinaryPromise(window.location.href.substr(0,window.location.href.lastIndexOf("/")+1)+"APIKeys").then(e=>{$().decryptData(e,f,h,_(!1).show())}).catch(()=>{r.showError(P.getText("APIKeysDialog - An error occurs when loading the APIKeys file")),r.hideWait(),r.keyboardEventListenerEnabled=!0}))}return r=S(),r.title=P.getText("APIKeysDialog - API keys"),r.okButtonListener=v,i=n.create("div",{className:"TravelNotes-APIKeysDialog-ToolbarDiv",id:"TravelNotes-APIKeysDialog-ToolbarDiv"},r.content),l=n.create("div",{id:"TravelNotes-APIKeysDialog-DataDiv"},r.content),function(){if(e.haveCrypto){n.create("div",{id:"TravelNotes-APIKeysDialog-reloadFileButton",className:"TravelNotes-APIKeysDialog-Button",title:P.getText("APIKeysDialog - Reload from server"),innerHTML:"&#x1f504;"},i).addEventListener("click",T,!1),n.create("div",{id:"TravelNotes-APIKeysDialog-SaveToFileButton",className:"TravelNotes-APIKeysDialog-Button",title:P.getText("APIKeysDialog - Save to file"),innerHTML:"&#x1f4be;"},i).addEventListener("click",e=>{e.stopPropagation(),r.hideError(),u()&&(r.showWait(),r.keyboardEventListenerEnabled=!1,$().encryptData((new window.TextEncoder).encode(JSON.stringify(c())),m,p,_(!0).show()))},!1);let e=n.create("div",{id:"TravelNotes-APIKeysDialog-OpenFileDiv"},i);s=n.create("input",{id:"TravelNotes-APIKeysDialog-OpenFileInput",type:"file"},e),s.addEventListener("change",e=>{!function(e){r.hideError(),r.showWait(),r.keyboardEventListenerEnabled=!1,e.stopPropagation();let t=new FileReader;t.onload=function(){$().decryptData(t.result,f,h,_(!1).show())},t.readAsArrayBuffer(e.target.files[0])}(e)},!1);let t=n.create("div",{id:"TravelNotes-APIKeysDialog-OpenFileFakeDiv"},e);n.create("div",{id:"TravelNotes-APIKeysDialog-OpenFileButton",className:"TravelNotes-APIKeysDialog-Button",title:P.getText("APIKeysDialog - Open file"),innerHTML:"&#x1F4C2;"},t).addEventListener("click",()=>{s.click()},!1)}if(n.create("div",{id:"TravelNotes-APIKeysDialog-NewKeyButton",className:"TravelNotes-APIKeysDialog-Button",title:P.getText("APIKeysDialog - new API key"),innerHTML:"+"},i).addEventListener("click",e=>{e.stopPropagation(),g({providerName:"",providerKey:""})},!1),e.APIKeys.dialogHaveUnsecureButtons){n.create("div",{id:"TravelNotes-APIKeysDialog-SaveToJsonFileButton",className:"TravelNotes-APIKeysDialog-Button",title:P.getText("APIKeysDialog - Save to json file"),innerHTML:"&#x1f4be;"},i).addEventListener("click",e=>{e.stopPropagation(),r.hideError(),u()&&j().saveFile("APIKeys.json",JSON.stringify(c()))},!1);let e=n.create("div",{id:"TravelNotes-APIKeysDialog-OpenJsonFileDiv"},i);d=n.create("input",{id:"TravelNotes-APIKeysDialog-OpenJsonFileInput",type:"file"},e),d.addEventListener("change",e=>{!function(e){e.stopPropagation(),r.hideError();let t=new FileReader;t.onload=function(){try{let e=JSON.parse(t.result);for(;l.firstChild;)l.removeChild(l.firstChild);e.forEach(e=>g(e))}catch(e){r.showError(e.message),console.log(e||"An error occurs when reading the file")}},t.readAsText(e.target.files[0])}(e)},!1);let t=n.create("div",{id:"TravelNotes-APIKeysDialog-OpenJsonFileFakeDiv"},e);n.create("div",{id:"TravelNotes-APIKeysDialog-OpenJsonFileButton",className:"TravelNotes-APIKeysDialog-Button",title:P.getText("APIKeysDialog - Open json file"),innerHTML:"&#x1F4C2;"},t).addEventListener("click",()=>{d.click()},!1)}}(),a.forEach(e=>g(e)),R.showHelp(P.getText("Help - Complete the APIKeys")),r}let te=new Map;const oe=function(){function t(e){return te.get(e.toLowerCase())}function a(e,t){te.set(e.toLowerCase(),t)}function n(o){sessionStorage.clear(),te.clear();let n=j().storageAvailable("sessionStorage")&&e.APIKeys.saveToSessionStorage;o.forEach(e=>{n&&sessionStorage.setItem(e.providerName.toLowerCase()+"ProviderKey",btoa(e.providerKey)),a(e.providerName,e.providerKey)}),M.providers.forEach(e=>{e.providerKey=t(e.name)||""}),k().dispatch("providersadded")}function r(e){n(JSON.parse((new TextDecoder).decode(e)))}function i(e){console.log(e||"An error occurs when reading the APIKeys file"),e&&"Canceled by user"!==e&&R.showError(P.getText("APIKeysManager - An error occurs when reading the APIKeys file")),R.showHelp(P.getText("Help - Continue with interface"))}function l(e){$().decryptData(e,r,i,_(!1).show())}function s(){0===function(){let e=0;for(let t=0;t<sessionStorage.length;t++){let o=sessionStorage.key(t);"ProviderKey"===o.substr(o.length-"ProviderKey".length)&&(a(o.substr(0,o.length-"ProviderKey".length),atob(sessionStorage.getItem(o))),e++)}return M.providers.forEach(e=>{e.providerKey=t(e.name)||""}),e}()?e.haveCrypto&&o().getBinaryPromise(window.location.href.substr(0,window.location.href.lastIndexOf("/")+1)+"APIKeys").then(l).catch(e=>console.log(e||"APIKeys not found on server")):k().dispatch("providersadded")}return Object.seal({fromServerFile:()=>s(),fromUrl:t=>function(t){let o=t.split("=");if(2===o.length){let t=o[0].substr(0,o[0].length-"ProviderKey".length).toLowerCase(),n=o[1];j().storageAvailable("sessionStorage")&&e.APIKeys.saveToSessionStorage&&sessionStorage.setItem(t+"ProviderKey",btoa(n)),a(t,n);let r=M.providers.get(t);r&&(r.providerKey=n)}}(t),dialog:()=>function(){let e=[];te.forEach((t,o)=>e.push({providerName:o,providerKey:t})),e.sort((e,t)=>e.providerName.localeCompare(t.providerName)),ee(e).show().then(e=>n(e)).catch(e=>console.log(e||"canceled by user"))}(),getKey:e=>t(e),setKey:(e,t)=>a(e,t),addProvider:e=>function(e){let o=e.name.toLowerCase(),a=t(o);e.providerKeyNeeded&&!a&&j().storageAvailable("sessionStorage")&&(a=sessionStorage.getItem(o),a&&(a=atob(a))),e.providerKeyNeeded&&a&&(e.providerKey=a),M.providers.set(e.name.toLowerCase(),e)}(e)})}();const ae=function(){let e=null;function o(t){e.innerHTML='&copy; <a href="http://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> | &copy; <a href="http://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+t+'| &copy; <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a> '}return Object.seal({set attributions(e){o(e)},createUI:()=>(e=t().create("div",{id:"TravelNotes-AttributionsUI"},document.querySelector("body")),void o(""))})}();const ne=function(){let o=[{service:"wmts",url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"red",backgroundColor:"white"},providerName:"OSM",providerKeyNeeded:!1,attribution:""}],a=null,n=null,r=null,i=t(),l=k(),s=0,d=0,u=0,v=0;function g(e){e.target.setAttribute("style","color:"+e.target.layer.toolbar.backgroundColor+";background-color:"+e.target.layer.toolbar.color)}function p(e){e.target.setAttribute("style","color:"+e.target.layer.toolbar.color+";background-color:"+e.target.layer.toolbar.backgroundColor)}function m(e){e.target.classList.add("TravelNotes-LayersToolbarUI-LinkButton-Enter"),e.target.classList.remove("TravelNotes-LayersToolbarUI-LinkButton-Leave")}function h(e){e.target.classList.add("TravelNotes-LayersToolbarUI-LinkButton-Leave"),e.target.classList.remove("TravelNotes-LayersToolbarUI-LinkButton-Enter")}function f(e){l.dispatch("layerchange",{layer:e.target.layer}),ae.attributions=e.target.layer.attribution,M.travel.layerName=e.target.layer.name}function T(e){e.deltaY&&(s-=e.deltaY*c[e.deltaMode],s=s>v?v:s,s=s<v-u+3*d?v-u+3*d:s,r.style.marginTop=String(s)+"px"),e.stopPropagation()}function b(){let e=r.childNodes;for(let t=0;t<e.length;t++)"layer"===e[t].type?(e[t].removeEventListener("mouseenter",g,!1),e[t].removeEventListener("mouseleave",p,!1),e[t].removeEventListener("click",f,!1)):(e[t].removeEventListener("mouseenter",m,!1),e[t].removeEventListener("mouseleave",m,!1));r.removeEventListener("wheel",T,!1),n.removeChild(r),a=null}function y(){if(a)return clearTimeout(a),void(a=null);r=i.create("div",{id:"TravelNotes-LayersToolbarUI-Buttons"},n),v=n.clientHeight,u=0,o.forEach(e=>function(e){if(e.providerKeyNeeded&&!oe.getKey(e.providerName.toLowerCase()))return;let t=i.create("div",{type:"layer",className:"TravelNotes-LayersToolbarUI-Button",title:e.name,layer:e,innerHTML:e.toolbar.text,style:"color:"+e.toolbar.color+";background-color:"+e.toolbar.backgroundColor},r);t.addEventListener("mouseenter",g,!1),t.addEventListener("mouseleave",p,!1),t.addEventListener("click",f,!1),d=t.clientHeight,u+=d}(e)),e.layersToolbarUI.theDevil&&e.layersToolbarUI.theDevil.addButton&&function(e,t,o){let a=i.create("div",{type:"link",className:"TravelNotes-LayersToolbarUI-Button TravelNotes-LayersToolbarUI-LinkButton-Leave",innerHTML:'<a href="'+e+'" title="'+t+'" target="_blank">'+o+"</a>"},r);a.addEventListener("mouseenter",m,!1),a.addEventListener("mouseleave",h,!1),u+=a.clientHeight}("https://www.google.com/maps/@"+M.map.getCenter().lat+","+M.map.getCenter().lng+","+M.map.getZoom()+"z",e.layersToolbarUI.theDevil.title,e.layersToolbarUI.theDevil.text),v+=d,s=v,r.style.marginTop=String(s)+"px",r.addEventListener("wheel",T,!1)}function N(){n=i.create("div",{id:"TravelNotes-LayersToolbarUI"},document.querySelector("body")),i.create("div",{id:"TravelNotes-LayersToolbarUI-Header",innerHTML:P.getText("LayersToolbarUI - Layers")},n),n.addEventListener("mouseenter",y,!1),n.addEventListener("mouseleave",()=>{a=setTimeout(b,e.layersToolbarUI.toolbarTimeOut)},!1),l.dispatch("layerchange",{layer:o[0]}),ae.attributions=o[0].attribution}return Object.seal({createUI:()=>N(),getLayer:e=>function(e){let t=o.find(t=>t.name===e)||o[0];if(t.providerKeyNeeded){oe.getKey(t.providerName.toLowerCase())||(t=o[0])}return t}(e),setLayer:e=>function(e){let t=o.find(t=>t.name===e)||o[0];if(t.providerKeyNeeded){oe.getKey(t.providerName.toLowerCase())||(t=o[0])}l.dispatch("layerchange",{layer:t}),ae.attributions=t.attribution,M.travel.layerName=t.name}(e),setLayers:e=>function(e){o=o.concat(e)}(e)})}();function re(){let o=null,a=null,n=null,r=[],i=0,l=null,s=document.querySelector("body"),d=t(),c=V(),u=0;function v(){for(;0<document.getElementsByClassName("TravelNotes-routeViewDiv").length;)s.removeChild(document.getElementsByClassName("TravelNotes-routeViewDiv")[0]);document.getElementById("TravelNotes-PrintToolbar-PrintButton").removeEventListener("click",()=>window.print(),!1),document.getElementById("TravelNotes-PrintToolbar-CancelButton").removeEventListener("click",v,!1),s.removeChild(document.getElementById("TravelNotes-PrintToolbar"));let e=s.children;for(let t=0;t<e.length;t++)e.item(t).classList.remove("TravelNotes-PrintViews-Hidden");M.map.invalidateSize(!1),window.removeEventListener("afterprint",v,!0)}function g(e,t,o){let a=function(e,t,o){if(e.bottomLeft.lat===e.upperRight.lat&&e.bottomLeft.lng===e.upperRight.lng){let e=Math.min(Math.abs(n[0]/(o.lat-t.lat)),Math.abs(n[1]/(o.lng-t.lng)));return{lat:t.lat+e*(o.lat-t.lat),lng:t.lng+e*(o.lng-t.lng)}}return null}(e,t,o);if(a)return a;if(a=function(e,t){return t.lat-e.bottomLeft.lat<1e-6||e.upperRight.lat-t.lat<1e-6||t.lng-e.bottomLeft.lng<1e-6||e.upperRight.lng-t.lng<1e-6?{lat:t.lat,lng:t.lng}:null}(e,t),a)return a;if(a=function(e,t,o){return t.lng===o.lng?{lat:t.lat>o.lat?e.bottomLeft.lat:e.upperRight.lat,lng:t.lng}:t.lat===o.lat?{lat:t.lat,lng:t.lng<o.lng?e.upperRight.lng:e.bottomLeft.lng}:null}(e,t,o),a)return a;let r=(t.lat-o.lat)/(t.lng-o.lng),i=t.lat-r*t.lng;if(a={lat:r*e.upperRight.lng+i,lng:e.upperRight.lng},a.lat<=e.upperRight.lat&&a.lat>=e.bottomLeft.lat&&a.lng<o.lng)return a;if(a={lat:e.upperRight.lat,lng:(e.upperRight.lat-i)/r},a.lng>=e.bottomLeft.lng&&a.lng<=e.upperRight.lng&&a.lat<o.lat)return a;if(a={lat:r*e.bottomLeft.lng+i,lng:e.bottomLeft.lng},a.lat<=e.upperRight.lat&&a.lat>=e.bottomLeft.lat&&a.lng>o.lng)return a;if(a={lat:e.bottomLeft.lat,lng:(e.bottomLeft.lat-i)/r},a.lng>=e.bottomLeft.lng&&a.lng<=e.upperRight.lng&&a.lat>o.lat)return a;throw new Error("intermediate point not found")}function p(t){i++;let n="TravelNotes-RouteViewDiv"+i,r=d.create("div",{className:"TravelNotes-routeViewDiv",id:n},s);o.pageBreak&&r.classList.add("TravelNotes-PrintPageBreak"),r.setAttribute("style","width:"+o.paperWidth+"mm;height:"+o.paperHeight+"mm;");let c=o.printNotes?function(){let t=[];return a.notes.forEach(o=>{let a=L.divIcon({iconSize:[o.iconWidth,o.iconHeight],iconAnchor:[o.iconWidth/2,o.iconHeight/2],popupAnchor:[0,-o.iconHeight/2],html:o.iconContent,className:"TravelNotes-AllNotes "+e.note.style});let n=L.marker(o.iconLatLng,{zIndexOffset:100,icon:a,draggable:!0});t.push(n)}),t}():[];c.push(function(){let e=ne.getLayer(M.travel.layerName),t=e.url;if(e.providerKeyNeeded){let o=oe.getKey(e.providerName.toLowerCase());t=t.replace("{providerKey}",o)}let o=null;return o="wmts"===e.service.toLowerCase()?L.tileLayer(t):L.tileLayer.wms(t,e.wmsOptions),o.options.attribution=' &copy; <a href="http://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+e.attribution+'| &copy; <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a> ',o}()),c.push(L.circleMarker([t.entryPoint.lat,t.entryPoint.lng],e.printRouteMap.entryPointMarker)),c.push(L.circleMarker([t.exitPoint.lat,t.exitPoint.lng],e.printRouteMap.exitPointMarker)),c.push(l),L.map(n,{attributionControl:!0,zoomControl:!1,center:[(t.bottomLeft.lat+t.upperRight.lat)/2,(t.bottomLeft.lng+t.upperRight.lng)/2],zoom:o.zoomFactor,minZoom:o.zoomFactor,maxZoom:o.zoomFactor,layers:c})}function m(){let e=s.children;for(let t=0;t<e.length;t++)e.item(t).classList.add("TravelNotes-PrintViews-Hidden");!function(){let e=d.create("div",{id:"TravelNotes-PrintToolbar"},s);d.create("div",{id:"TravelNotes-PrintToolbar-PrintButton",className:"TravelNotes-Control-Button",title:P.getText("PrintFactory - Print"),innerHTML:"&#x1F5A8;&#xFE0F;"},e).addEventListener("click",()=>window.print(),!1),d.create("div",{id:"TravelNotes-PrintToolbar-CancelButton",className:"TravelNotes-Control-Button",title:P.getText("PrintFactory - Cancel print"),innerHTML:"&#x274c;"},e).addEventListener("click",v,!1)}(),window.addEventListener("afterprint",v,!0);let t=[],o=a.itinerary.itineraryPoints.iterator;for(;!o.done;)t.push(o.value.latLng);l=L.polyline(t,{color:a.color,weight:a.width}),i=0,r.forEach(p)}function h(t,i){a=B().getRoute(i),a&&(o=t,function(){let e=document.querySelector("body"),t=d.create("div",{},e);t.setAttribute("style","position:absolute;top:0,left:0;width:"+(o.paperWidth-2*o.borderWidth)+"mm;height:"+(o.paperHeight-2*o.borderWidth)+"mm;"),u=Math.ceil(t.clientWidth/256)*Math.ceil(t.clientHeight/256);let a=c.screenCoordToLatLng(0,0),r=c.screenCoordToLatLng(t.clientWidth,t.clientHeight);e.removeChild(t);let i=M.map.getZoomScale(M.map.getZoom(),o.zoomFactor);n=[Math.abs(a[0]-r[0])*i,Math.abs(a[1]-r[1])*i]}(),function(){r=[];let t=a.itinerary.itineraryPoints.iterator,o=t.done,i={bottomLeft:{lat:t.value.lat,lng:t.value.lng},upperRight:{lat:t.value.lat,lng:t.value.lng}},l={lat:t.value.lat,lng:t.value.lng},s=t.value;o=t.done;let d=t.value;for(;!o;){let a={bottomLeft:{lat:Math.min(i.bottomLeft.lat,d.lat),lng:Math.min(i.bottomLeft.lng,d.lng)},upperRight:{lat:Math.max(i.upperRight.lat,d.lat),lng:Math.max(i.upperRight.lng,d.lng)}},c=[a.upperRight.lat-a.bottomLeft.lat,a.upperRight.lng-a.bottomLeft.lng];n[0]>c[0]&&n[1]>c[1]?(i=a,s=t.value,o=t.done,d=t.value,o&&(i.entryPoint=l,i.exitPoint=s,r.push(i))):(s=g(i,s,d),i.bottomLeft={lat:Math.min(i.bottomLeft.lat,s.lat),lng:Math.min(i.bottomLeft.lng,s.lng)},i.upperRight={lat:Math.max(i.upperRight.lat,s.lat),lng:Math.max(i.upperRight.lng,s.lng)},i.entryPoint=l,i.exitPoint=s,r.push(i),i={bottomLeft:{lat:s.lat,lng:s.lng},upperRight:{lat:s.lat,lng:s.lng}},l={lat:s.lat,lng:s.lng}),e.printRouteMap.maxTiles<r.length*u&&(o=!0)}}(),e.printRouteMap.maxTiles<r.length*u?R.showError(P.getText("PrintFactory - The maximum of allowed pages is reached.")):m())}return Object.seal({print:(e,t)=>h(e,t)})}const ie=function(){let o=!1,n=!1,r=B(),s=j(),d=k(),c=V();function u(){let e=M.travel.routes.iterator,t=a.defaultValue;for(;!e.done;){e.value.chain?(e.value.chainedDistance=t,t+=e.value.distance):e.value.chainedDistance=a.defaultValue;let o=e.value.notes.iterator;for(;!o.done;)o.value.chainedDistance=e.value.chainedDistance}}function v(e){n=!1,R.showError(e),console.log(e||"An error occurs when asking the route to the provider")}function g(){if(n=!1,function(e){let t=e.itinerary.itineraryPoints.iterator,o=e.itinerary.maneuvers.iterator;for(t.done,o.done,o.value.distance=a.defaultValue,o.done,e.distance=a.defaultValue,e.duration=a.defaultValue;!t.done;)t.previous.distance=c.pointsDistance(t.previous.latLng,t.value.latLng),e.distance+=t.previous.distance,o.previous.distance+=t.previous.distance,o.value.itineraryPointObjId===t.value.objId&&(e.duration+=o.previous.duration,o.value.distance=a.defaultValue,o.done)}(M.travel.editedRoute),"circle"!==M.travel.editedRoute.itinerary.transitMode){let e=M.travel.editedRoute.wayPoints.iterator;for(;!e.done;)e.first?e.value.latLng=M.travel.editedRoute.itinerary.itineraryPoints.first.latLng:e.last?e.value.latLng=M.travel.editedRoute.itinerary.itineraryPoints.last.latLng:e.value.latLng=V().getClosestLatLngDistance(M.travel.editedRoute,e.value.latLng).latLng}let e=M.travel.editedRoute.notes.iterator;for(;!e.done;){let t=c.getClosestLatLngDistance(M.travel.editedRoute,e.value.latLng);e.value.latLng=t.latLng,e.value.distance=t.distance}u(),M.travel.editedRoute.notes.sort((e,t)=>e.distance-t.distance),o&&K().zoomToRoute(M.travel.editedRoute.objId),Q.createProfile(M.travel.editedRoute),d.dispatch("routeupdated",{removedRouteObjId:M.travel.editedRoute.objId,addedRouteObjId:M.travel.editedRoute.objId}),W(),d.dispatch("setitinerary"),d.dispatch("setwaypointslist")}function p(){if(!e.routing.auto)return;if(n)return!1;if(!function(){let e=!0;return M.travel.editedRoute.wayPoints.forEach(t=>{e=e&&i.defaultValue!==t.lat&&i.defaultValue!==t.lng}),e}())return!1;o=0===M.travel.editedRoute.itinerary.itineraryPoints.length,n=!0;let t=M.providers.get(M.routing.provider.toLowerCase());return M.travel.editedRoute.itinerary.provider=t.name,M.travel.editedRoute.itinerary.transitMode=M.routing.transitMode,t.getPromiseRoute(M.travel.editedRoute,null).then(g,v).catch(v),!0}function m(){let e=r.getRoute(M.editedRouteObjId);e.edited=l.notEdited,Q.updateProfile(M.travel.editedRoute.objId,e),d.dispatch("routeupdated",{removedRouteObjId:M.travel.editedRoute.objId,addedRouteObjId:M.editedRouteObjId}),M.editedRouteObjId=-1,M.travel.editedRoute=E(),u(),W(),d.dispatch("setrouteslist"),d.dispatch("setwaypointslist"),d.dispatch("reducerouteui"),d.dispatch("setitinerary")}function h(o){(function(){let o=t(),a=null,n=null,r=null,i=null,l=null,s=null,d=null,c=null;function u(){return{paperWidth:r.value,paperHeight:i.value,borderWidth:l.value,zoomFactor:c.value,pageBreak:s.checked,printNotes:d.checked}}return a=S(),a.title=P.getText("PrintRouteMapDialog - Print"),a.okButtonListener=u,n=o.create("div",{id:"TravelNotes-PrintRouteMapDialog-MainDataDiv"},a.content),function(){let t=o.create("div",{className:"TravelNotes-PrintRouteMapDialog-DataDiv",id:"TravelNotes-PrintRouteMapDialog-PaperWidthDataDiv"},n);o.create("text",{data:P.getText("PrintRouteMapDialog - Paper width")},t),r=o.create("input",{type:"number",className:"TravelNotes-PrintRouteMapDialog-NumberInput",id:"TravelNotes-PrintRouteMapDialog-PaperWidthNumberInput"},t),r.value=e.printRouteMap.paperWidth,o.create("text",{data:P.getText("PrintRouteMapDialog - Paper width units")},t);let a=o.create("div",{className:"TravelNotes-PrintRouteMapDialog-DataDiv",id:"TravelNotes-PrintRouteMapDialog-PaperHeightDataDiv"},n);o.create("text",{data:P.getText("PrintRouteMapDialog - Paper height")},a),i=o.create("input",{type:"number",className:"TravelNotes-PrintRouteMapDialog-NumberInput",id:"TravelNotes-PrintRouteMapDialog-PaperHeightNumberInput"},a),i.value=e.printRouteMap.paperHeight,o.create("text",{data:P.getText("PrintRouteMapDialog - Paper height units")},a);let s=o.create("div",{className:"TravelNotes-PrintRouteMapDialog-DataDiv",id:"TravelNotes-PrintRouteMapDialog-BorderWidthDataDiv"},n);o.create("text",{data:P.getText("PrintRouteMapDialog - Border width")},s),l=o.create("input",{type:"number",className:"TravelNotes-PrintRouteMapDialog-NumberInput",id:"TravelNotes-PrintRouteMapDialog-BorderWidthNumberInput"},s),l.value=e.printRouteMap.borderWidth,o.create("text",{data:P.getText("PrintRouteMapDialog - Border width units")},s)}(),function(){let t=o.create("div",{className:"TravelNotes-PrintRouteMapDialog-DataDiv",id:"TravelNotes-PrintRouteMapDialog-ZoomFactorDataDiv"},n);o.create("text",{data:P.getText("PrintRouteMapDialog - Zoom factor")},t),c=o.create("input",{type:"number",className:"TravelNotes-PrintRouteMapDialog-NumberInput",id:"TravelNotes-PrintRouteMapDialog-ZoomFactorNumberInput"},t),c.value=Math.min(e.printRouteMap.zoomFactor,15),c.min=M.map.getMinZoom(),c.max=Math.min(M.map.getMaxZoom(),15);let a=o.create("div",{className:"TravelNotes-PrintRouteMapDialog-DataDiv",id:"TravelNotes-PrintRouteMapDialog-PageBreakDataDiv"},n);s=o.create("input",{type:"checkbox",id:"TravelNotes-PrintRouteMapDialog-PageBreakInput"},a),s.checked=e.printRouteMap.pageBreak,o.create("text",{data:P.getText("PrintRouteMapDialog - Page break")},a);let r=o.create("div",{className:"TravelNotes-PrintRouteMapDialog-DataDiv",id:"TravelNotes-PrintRouteMapDialog-PrintNotesDataDiv"},n);d=o.create("input",{type:"checkbox",id:"TravelNotes-PrintRouteMapDialog-PrintNotesInput"},r),d.checked=e.printRouteMap.printNotes,o.create("text",{data:P.getText("PrintRouteMapDialog - Print notes")},r)}(),a})().show().then(e=>{re().print(e,o)}).catch(e=>console.log(e||"An error occurs in the route properties dialog"))}return Object.seal({saveGpx:()=>function(){let e='time="'+(new Date).toISOString()+'" ',t='<?xml version="1.0"?>\n';t+='<gpx xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd" version="1.1" creator="leaflet.TravelNotes">';let o=M.travel.editedRoute.wayPoints.iterator;for(;!o.done;)t+='\n\t<wpt lat="'+o.value.lat+'" lon="'+o.value.lng+'" '+e+"/>";t+="\n\t<rte>";let a=M.travel.editedRoute.itinerary.maneuvers.iterator;for(;!a.done;){let o=M.travel.editedRoute.itinerary.itineraryPoints.getAt(a.value.itineraryPointObjId),n=a.value.instruction.replace("&","&amp;").replace('"',"&apos;").replace('"',"&quote;").replace(">","&gt;").replace("<","&lt;");t+='\n\t\t<rtept lat="'+o.lat+'" lon="'+o.lng+'" '+e+'desc="'+n+'" />'}t+="\n\t</rte>",t+="\n\t<trk>",t+="\n\t\t<trkseg>";let n=M.travel.editedRoute.itinerary.itineraryPoints.iterator;for(;!n.done;)t+='\n\t\t\t<trkpt lat="'+n.value.lat+'" lon="'+n.value.lng+'" '+e+" />";t+="\n\t\t</trkseg>",t+="\n\t</trk>",t+="\n</gpx>";let r=M.travel.editedRoute.name;""===r&&(r="TravelNote"),r+=".gpx",s.saveFile(r,t)}(),chainRoutes:()=>u(),startRouting:()=>p(),saveEdition:()=>function(){let e=E();e.object=M.travel.editedRoute.object,M.travel.routes.replace(M.editedRouteObjId,e),M.editedRouteObjId=e.objId,m()}(),cancelEdition:()=>m(),routeProperties:e=>function(e){let t=r.getRoute(e);O(t).show().then(()=>{u(),d.dispatch("routepropertiesupdated",{routeObjId:t.objId}),d.dispatch("setrouteslist")}).catch(e=>console.log(e||"An error occurs in the route properties dialog"))}(e),printRouteMap:e=>h(e),hideRoute:e=>function(e){d.dispatch("routeupdated",{removedRouteObjId:e,addedRouteObjId:-1}),r.getRoute(e).hidden=!0}(e),showRoutes:()=>function(){let e=M.travel.routes.iterator;for(;!e.done;)e.value.hidden&&d.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:e.value.objId})}()})}();var le={};function se(e){return Math.floor(Math.abs(e)+.5)*(e>=0?1:-1)}function de(e,t,o){var a=(e=se(e*o))-(t=se(t*o));a<<=1,e-t<0&&(a=~a);for(var n="";a>=32;)n+=String.fromCharCode(63+(32|31&a)),a>>=5;return n+=String.fromCharCode(a+63)}function ce(e){for(var t=[],o=0;o<e.length;o++){var a=e[o].slice();t.push([a[1],a[0]])}return t}function ue(){function e(e){let t={};0!==e.itinerary.itineraryPoints.length&&(t=e.itinerary.itineraryPoints[0].objType);let o={latLngs:[],distances:[],elevs:[],objIds:[],objType:t};e.itinerary.itineraryPoints.forEach(e=>{o.latLngs.push([e.lat,e.lng]),o.distances.push(e.distance),o.elevs.push(e.elev),o.objIds.push(e.objId)}),o.latLngs=le.encode(o.latLngs,6),e.itinerary.itineraryPoints=o}function t(e){e.itinerary.itineraryPoints.latLngs=le.decode(e.itinerary.itineraryPoints.latLngs,6);let t=[],o=0;e.itinerary.itineraryPoints.latLngs.forEach(a=>{let n={};n.lat=a[0],n.lng=a[1],n.distance=e.itinerary.itineraryPoints.distances[o],e.itinerary.itineraryPoints.elevs?n.elev=e.itinerary.itineraryPoints.elevs[o]:n.elev=r.defaultValue,n.objId=e.itinerary.itineraryPoints.objIds[o],n.objType=e.itinerary.itineraryPoints.objType,t.push(n),o++}),e.itinerary.itineraryPoints=t}function o(e){let o=e;return o.routes.forEach(t),o.editedRoute&&t(o.editedRoute),o}return Object.seal({decompress:e=>function(e){M.travel.object=o(e),M.editedRouteObjId=-1,M.travel.routes.forEach(e=>{l.notEdited!==e.edited&&(M.editedRouteObjId=e.objId)})}(e),decompressMerge:e=>function(e){let t=D();t.object=o(e);let a=t.routes.iterator;for(;!a.done;)M.travel.routes.add(a.value);let n=t.notes.iterator;for(;!n.done;)M.travel.notes.add(n.value)}(e),compress:()=>function(){let t=M.travel.object;return t.routes.forEach(e),e(t.editedRoute),t}()})}le.decode=function(e,t){for(var o,a=0,n=0,r=0,i=[],l=0,s=0,d=null,c=Math.pow(10,Number.isInteger(t)?t:5);a<e.length;){d=null,l=0,s=0;do{s|=(31&(d=e.charCodeAt(a++)-63))<<l,l+=5}while(d>=32);o=1&s?~(s>>1):s>>1,l=s=0;do{s|=(31&(d=e.charCodeAt(a++)-63))<<l,l+=5}while(d>=32);n+=o,r+=1&s?~(s>>1):s>>1,i.push([n/c,r/c])}return i},le.encode=function(e,t){if(!e.length)return"";for(var o=Math.pow(10,Number.isInteger(t)?t:5),a=de(e[0][0],0,o)+de(e[0][1],0,o),n=1;n<e.length;n++){var r=e[n],i=e[n-1];a+=de(r[0],i[0],o),a+=de(r[1],i[1],o)}return a},le.fromGeoJSON=function(e,t){if(e&&"Feature"===e.type&&(e=e.geometry),!e||"LineString"!==e.type)throw new Error("Input must be a GeoJSON LineString");return le.encode(ce(e.coordinates),t)},le.toGeoJSON=function(e,t){return{type:"LineString",coordinates:ce(le.decode(e,t))}},"object"==typeof module&&module.exports&&(module.exports=le);const ve=function(){let t=j(),o=B(),a=k();function n(e){if(l.editedChanged===M.travel.editedRoute.edited)return void R.showError(P.getText("RouteEditor - Not possible to edit a route without a save or cancel"));-1!==M.editedRouteObjId&&ie.cancelEdition();let t=o.getRoute(e),n=t.itinerary.provider,r=M.providers.get(n.toLowerCase());if(n&&""!==n&&(!r||r.providerKeyNeeded&&!oe.getKey(n)))return void R.showError(P.getText("RouteEditor - Not possible to edit a route created with this provider",{provider:n}));n&&""!==n&&a.dispatch("setprovider",{provider:n});let i=t.itinerary.transitMode;i&&""!==i&&a.dispatch("settransitmode",{transitMode:i}),M.travel.editedRoute=E(),t.edited=l.editedNoChange,M.travel.editedRoute.object=t.object,M.editedRouteObjId=t.objId,M.travel.editedRoute.hidden=!1,t.hidden=!1,Q.updateProfile(M.editedRouteObjId,M.travel.editedRoute),ie.chainRoutes(),a.dispatch("routeupdated",{removedRouteObjId:t.objId,addedRouteObjId:M.travel.editedRoute.objId}),W(),a.dispatch("expandrouteui"),a.dispatch("setwaypointslist"),a.dispatch("setitinerary")}return Object.seal({addRoute:()=>function(){let e=E();M.travel.routes.add(e),a.dispatch("setrouteslist"),ie.chainRoutes(),a.dispatch("roadbookupdate"),l.editedChanged!==M.travel.editedRoute.edited&&n(e.objId)}(),removeRoute:e=>function(e){let t=e;t!==M.editedRouteObjId&&t!==M.travel.editedRoute.objId||l.editedChanged!==M.travel.editedRoute.edited?(t!==M.editedRouteObjId&&t!==M.travel.editedRoute.objId||(t=M.editedRouteObjId,ie.cancelEdition()),a.dispatch("routeupdated",{removedRouteObjId:t,addedRouteObjId:-1}),M.travel.routes.remove(t),Q.deleteProfile(t),ie.chainRoutes(),W(),a.dispatch("setrouteslist")):R.showError(P.getText("TravelEditor - Cannot remove an edited route"))}(e),editRoute:e=>n(e),renameRoute:(e,t)=>function(e,t){o.getRoute(e).name=t,e===M.editedRouteObjId&&(M.travel.editedRoute.name=t),a.dispatch("setrouteslist"),a.dispatch("roadbookupdate")}(e,t),swapRoute:(e,t)=>function(e,t){M.travel.routes.swap(e,t),ie.chainRoutes(),a.dispatch("setrouteslist"),a.dispatch("roadbookupdate")}(e,t),routeDropped:(e,t,o)=>function(e,t,o){M.travel.routes.moveTo(e,t,o),ie.chainRoutes(),a.dispatch("setrouteslist"),a.dispatch("roadbookupdate")}(e,t,o),saveTravel:()=>function(){let e=M.travel.routes.iterator;for(;!e.done;)e.value.hidden=!1;let o=ue().compress(M.travel);t.saveFile(o.name+".trv",JSON.stringify(o))}(),clear:()=>{window.confirm(P.getText("TravelEditor - This page ask to close; data are perhaps not saved."))&&(Q.deleteAllProfiles(),a.dispatch("removeallobjects"),M.travel.editedRoute=E(),M.editedRouteObjId=-1,M.travel=D(),M.travel.routes.add(E()),a.dispatch("setrouteslist"),a.dispatch("setwaypointslist"),a.dispatch("setitinerary"),a.dispatch("roadbookupdate"),a.dispatch("travelnotesfileloaded",{readOnly:!1,name:""}),e.travelEditor.startupRouteEdition&&n(M.travel.routes.first.objId))}})}();const ge=function(){let t=k(),o=V();function a(e,o){M.travel.editedRoute.edited=l.editedChanged,M.travel.editedRoute.wayPoints.getAt(o).name=e,t.dispatch("setwaypointslist")}function n(t,o){e.wayPoint.reverseGeocoding&&X().getPromiseAddress(t).then((function(e){if(e.error)return;let t="";e.address.house_number&&(t+=e.address.house_number+" "),e.address.road?t+=e.address.road+" ":e.address.pedestrian&&(t+=e.address.pedestrian+" "),e.address.village?t+=e.address.village:e.address.town?t+=e.address.town:e.address.city&&(t+=e.address.city),0===t.length&&(t+=e.address.country),a(t,o)})).catch(e=>console.log(e||"An error occurs in the geoCoder"))}return Object.seal({addWayPoint:e=>function(e){M.travel.editedRoute.edited=l.editedChanged;let o=h();o.latLng=e,n(e,o.objId),M.travel.editedRoute.wayPoints.add(o),t.dispatch("addwaypoint",{wayPoint:M.travel.editedRoute.wayPoints.last,letter:M.travel.editedRoute.wayPoints.length-2}),M.travel.editedRoute.wayPoints.swap(o.objId,!0),t.dispatch("setwaypointslist"),ie.startRouting()}(e),addWayPointOnRoute:(e,a)=>function(e,a){let r=o.getClosestLatLngDistance(M.travel.editedRoute,e).distance;M.travel.editedRoute.edited=l.editedChanged;let i=h();i.latLng=a,n(a,i.objId),M.travel.editedRoute.wayPoints.add(i),t.dispatch("addwaypoint",{wayPoint:M.travel.editedRoute.wayPoints.last,letter:M.travel.editedRoute.wayPoints.length-2});let s=M.travel.editedRoute.wayPoints.iterator;for(;!s.done;){if(r<o.getClosestLatLngDistance(M.travel.editedRoute,s.value.latLng).distance){M.travel.editedRoute.wayPoints.moveTo(i.objId,s.value.objId,!0);break}}t.dispatch("setwaypointslist"),ie.startRouting()}(e,a),reverseWayPoints:()=>function(){M.travel.editedRoute.edited=l.editedChanged;let e=M.travel.editedRoute.wayPoints.iterator;for(;!e.done;)t.dispatch("removeobject",{objId:e.value.objId});for(M.travel.editedRoute.wayPoints.reverse(),e=M.travel.editedRoute.wayPoints.iterator;!e.done;)t.dispatch("addwaypoint",{wayPoint:e.value,letter:e.first?"A":e.last?"B":e.index});t.dispatch("setwaypointslist"),ie.startRouting()}(),removeAllWayPoints:()=>function(){M.travel.editedRoute.edited=l.editedChanged;let e=M.travel.editedRoute.wayPoints.iterator;for(;!e.done;)t.dispatch("removeobject",{objId:e.value.objId});M.travel.editedRoute.wayPoints.removeAll(!0),t.dispatch("setwaypointslist"),ie.startRouting()}(),removeWayPoint:e=>function(e){M.travel.editedRoute.edited=l.editedChanged,t.dispatch("removeobject",{objId:e}),M.travel.editedRoute.wayPoints.remove(e),t.dispatch("setwaypointslist"),ie.startRouting()}(e),renameWayPoint:(e,t)=>a(e,t),swapWayPoints:(e,o)=>function(e,o){M.travel.editedRoute.edited=l.editedChanged,M.travel.editedRoute.wayPoints.swap(e,o),t.dispatch("setwaypointslist"),ie.startRouting()}(e,o),setStartPoint:o=>function(o){M.travel.editedRoute.edited=l.editedChanged,i.defaultValue!==M.travel.editedRoute.wayPoints.first.lat&&t.dispatch("removeobject",{objId:M.travel.editedRoute.wayPoints.first.objId}),M.travel.editedRoute.wayPoints.first.latLng=o,e.wayPoint.reverseGeocoding&&n(o,M.travel.editedRoute.wayPoints.first.objId),t.dispatch("addwaypoint",{wayPoint:M.travel.editedRoute.wayPoints.first,letter:"A"}),t.dispatch("setwaypointslist"),ie.startRouting()}(o),setEndPoint:o=>function(o){M.travel.editedRoute.edited=l.editedChanged,i.defaultValue!==M.travel.editedRoute.wayPoints.last.lat&&t.dispatch("removeobject",{objId:M.travel.editedRoute.wayPoints.last.objId}),M.travel.editedRoute.wayPoints.last.latLng=o,e.wayPoint.reverseGeocoding&&n(o,M.travel.editedRoute.wayPoints.last.objId),t.dispatch("addwaypoint",{wayPoint:M.travel.editedRoute.wayPoints.last,letter:"B"}),t.dispatch("setwaypointslist"),ie.startRouting()}(o),wayPointDragEnd:o=>function(o){M.travel.editedRoute.edited=l.editedChanged,e.wayPoint.reverseGeocoding&&n(M.travel.editedRoute.wayPoints.getAt(o).latLng,o),t.dispatch("setwaypointslist"),ie.startRouting()}(o),wayPointDropped:(e,o,a)=>function(e,o,a){if(M.travel.editedRoute.edited=l.editedChanged,o===M.travel.editedRoute.wayPoints.first.objId&&a)return;if(o===M.travel.editedRoute.wayPoints.last.objId&&!a)return;M.travel.editedRoute.wayPoints.moveTo(e,o,a),t.dispatch("setwaypointslist");let n=M.travel.editedRoute.wayPoints.iterator;for(;!n.done;)t.dispatch("removeobject",{objId:n.value.objId}),t.dispatch("addwaypoint",{wayPoint:n.value,letter:n.first?"A":n.last?"B":n.index});ie.startRouting()}(e,o,a)})}();let pe=null,me=null,he=0,fe=null,Te=null,be=i.defaultValue,ye=i.defaultValue;function Ne(o){let a=[],n=t(),r=document.querySelector("body");function l(e){e.preventDefault(),e.stopPropagation()}function s(e){e.preventDefault(),e.stopPropagation()}function d(e){pe&&("Escape"===e.key||"Esc"===e.key?(e.stopPropagation(),Te.click()):"ArrowDown"===e.key||"ArrowRight"===e.key||"Tab"===e.key?(e.stopPropagation(),he=he>=a.length?1:++he,pe.childNodes[he].firstChild.focus()):"ArrowUp"===e.key||"ArrowLeft"===e.key?(e.stopPropagation(),he=he<=1?a.length:--he,pe.childNodes[he].firstChild.focus()):"Home"===e.key?(e.stopPropagation(),he=1,pe.childNodes[he].firstChild.focus()):"End"===e.key?(e.stopPropagation(),he=a.length,pe.childNodes[he].firstChild.focus()):"Enter"===e.key&&he>0&&a[he-1].action&&(e.stopPropagation(),pe.childNodes[he].firstChild.click()))}function c(e){e.stopPropagation(),a[e.target.menuItem].param?a[e.target.menuItem].action.call(a[e.target.menuItem].context,a[e.target.menuItem].param,fe):a[e.target.menuItem].action.call(a[e.target.menuItem].context,fe),Te.click()}function u(){me&&(clearTimeout(me),me=null),document.removeEventListener("keydown",d,!0),document.removeEventListener("keypress",l,!0),document.removeEventListener("keyup",s,!0);let e=pe.childNodes;e[0].firstChild.removeEventListener("click",u,!1);for(let t=1;t<e.length;t++)e[t].firstChild.removeEventListener("click",c,!1);document.querySelector("body").removeChild(pe),pe=null,he=0,a=[],be=i.defaultValue,ye=i.defaultValue}function v(){fe=o,fe.latlng.lat===be&&fe.latlng.lng===ye||(be=fe.latlng.lat,ye=fe.latlng.lng,pe||(pe=n.create("div",{id:"TravelNotes-ContextMenu-Container",className:"TravelNotes-ContextMenu-Container"},r),pe.addEventListener("mouseenter",()=>{me&&(clearTimeout(me),me=null)},!1),pe.addEventListener("mouseleave",()=>{me=setTimeout(u,e.contextMenu.timeout)},!1),Te=n.create("div",{innerHTML:"&#x274c",className:"TravelNotes-ContextMenu-CloseButton",title:P.getText("ContextMenu - Close")},pe),Te.addEventListener("click",u,!1),function(){let e=0;a.forEach(t=>{let o=n.create("div",{className:"TravelNotes-ContextMenu-ItemContainer"},pe),a=n.create("button",{innerHTML:t.name,id:"TravelNotes-ContextMenu-Item"+e,className:t.action?"TravelNotes-ContextMenu-Item":"TravelNotes-ContextMenu-Item TravelNotes-ContextMenu-ItemDisabled"},o);t.action&&a.addEventListener("click",c,!1),a.menuItem=e,++e})}(),function(){let e=n.create("div",{className:"TravelNotes-ContextMenu-Panel"},r),t=e.clientWidth,o=e.clientHeight;r.removeChild(e);let a=Math.min(fe.originalEvent.clientY,o-pe.clientHeight-20),i=Math.min(fe.originalEvent.clientX,t-pe.clientWidth-20);pe.setAttribute("style","top:"+a+"px;left:"+i+"px;")}(),document.addEventListener("keydown",d,!0),document.addEventListener("keypress",l,!0),document.addEventListener("keyup",s,!0)))}return{init:e=>function(e){a=e}(e),show:()=>v()}}function Le(t){let o=t.target.objId,a=K();let n=Ne(t);return n.init(function(){let t=[{context:ie,name:P.getText("ContextMenuFactory - Edit this route"),action:o===M.travel.editedRoute.objId||l.editedChanged===M.travel.editedRoute.edited?null:ve.editRoute,param:o},{context:ve,name:P.getText("ContextMenuFactory - Delete this route"),action:o===M.travel.editedRoute.objId&&l.editedChanged===M.travel.editedRoute.edited?null:ve.removeRoute,param:o},{context:ie,name:P.getText("ContextMenuFactory - Hide this route"),action:M.travel.editedRoute.objId===o?null:ie.hideRoute,param:o},{context:q,name:P.getText("ContextMenuFactory - Add a note on the route"),action:q.newRouteNote,param:o},{context:q,name:P.getText("ContextMenuFactory - Create a note for each route maneuver"),action:q.addAllManeuverNotes,param:o},{context:ie,name:P.getText("ContextMenuFactory - Properties"),action:ie.routeProperties,param:o},{context:a,name:P.getText("ContextMenuFactory - Zoom to route"),action:a.zoomToRoute,param:o},{context:ie,name:P.getText("ContextMenuFactory - View the elevation"),action:B().getRoute(o).itinerary.hasProfile?Q.showProfile:null,param:o}];return e.printRouteMap.isEnabled&&t.push({context:ie,name:P.getText("ContextMenuFactory - Print route map"),action:ie.printRouteMap,param:o}),t=t.concat([{context:ie,name:P.getText("ContextMenuFactory - Save modifications on this route"),action:M.travel.editedRoute.objId===o?ie.saveEdition:null},{context:ie,name:P.getText("ContextMenuFactory - Cancel modifications on this route"),action:M.travel.editedRoute.objId===o?ie.cancelEdition:null}]),t}()),Object.seal(n)}function Ie(e){let t=B().getRoute(e.target.objId),o=V().getClosestLatLngDistance(t,[e.latlng.lat,e.latlng.lng]).distance;o+=t.chainedDistance,o=j().formatDistance(o);let a=M.mapObjects.get(e.target.objId);a.closeTooltip();let n=t.name;M.travel.readOnly||(n+=0===n.length?"":" - ",n+=o),a.setTooltipContent(n),a.openTooltip(e.latlng)}const we=function(){let t=B(),o=null,a=null;function r(e,t){t.objId=e,t.addTo(M.map),M.mapObjects.set(e,t)}function i(o){let a=t.getNoteAndRoute(o).note,n=M.travel.readOnly,i=L.marker(a.latLng,{icon:L.divIcon({iconSize:[e.note.grip.size,e.note.grip.size],iconAnchor:[e.note.grip.size/2,e.note.grip.size/2],html:"<div></div>"}),opacity:e.note.grip.opacity,draggable:!n});i.objId=a.objId;let l=L.divIcon({iconSize:[a.iconWidth,a.iconHeight],iconAnchor:[a.iconWidth/2,a.iconHeight/2],popupAnchor:[0,-a.iconHeight/2],html:a.iconContent,className:"TravelNotes-AllNotes "+e.note.style});let s=L.marker(a.iconLatLng,{zIndexOffset:100,icon:l,draggable:!n});s.objId=a.objId,s.bindPopup(e=>{let o=t.getNoteAndRoute(e.objId).note;return U("TravelNotes-").getNoteHTML(o)}),0!==a.tooltipContent.length&&(s.bindTooltip(e=>t.getNoteAndRoute(e.objId).note.tooltipContent),s.getTooltip().options.offset[0]=a.iconWidth/2);let d=L.polyline([a.latLng,a.iconLatLng],e.note.polyline);d.objId=a.objId;let c=L.layerGroup([s,d,i]);return c.markerId=L.Util.stamp(s),c.polylineId=L.Util.stamp(d),c.bulletId=L.Util.stamp(i),r(a.objId,c),{marker:s,polyline:d,bullet:i}}function s(t){t.dashArray>=e.route.dashChoices.length&&(t.dashArray=0);let o=e.route.dashChoices[t.dashArray].iDashArray;if(o){let e="",a=0;for(a=0;a<o.length-1;a++)e+=o[a]*t.width+",";return e+=o[a]*t.width,e}return null}return Object.seal({addRoute:e=>function(e){let o=t.getRoute(e),a=[],n=o.itinerary.itineraryPoints.iterator;for(;!n.done;)a.push(n.value.latLng);let d=L.polyline(a,{color:o.color,weight:o.width,dashArray:s(o)});r(o.objId,d),l.notEdited===o.edited&&(d.bindTooltip(o.name,{sticky:!0,direction:"right"}),d.on("mouseover",Ie),d.on("mousemove",Ie)),d.bindPopup(e=>{let o=t.getRoute(e.objId);return U("TravelNotes-").getRouteHTML(o)}),L.DomEvent.on(d,"click",e=>e.target.openPopup(e.latlng));let c=o.notes.iterator;for(;!c.done;)i(c.value.objId);return o}(e),addNote:e=>i(e),getDashArray:e=>s(e),zoomTo:(t,o)=>function(t,o){if(o){let e=[];o.forEach(t=>e=e.concat(t)),M.map.fitBounds(V().getLatLngBounds(e))}else M.map.setView(t,e.itineraryPointZoom)}(t,o),setLayer:e=>function(e){let t=null;t="wmts"===e.service.toLowerCase()?L.tileLayer(e.url):L.tileLayer.wms(e.url,e.wmsOptions),o&&M.map.removeLayer(o),M.map.addLayer(t),o=t,M.travel.readOnly||(M.map.getZoom()<(e.minZoom||0)&&M.map.setZoom(e.minZoom||0),M.map.setMinZoom(e.minZoom||0),M.map.getZoom()>(e.maxZoom||18)&&M.map.setZoom(e.maxZoom||18),M.map.setMaxZoom(e.maxZoom||18),e.bounds?(M.map.getBounds().intersects(e.bounds)&&!M.map.getBounds().contains(e.bounds)||(M.map.setMaxBounds(null),M.map.fitBounds(e.bounds),M.map.setZoom(e.minZoom||0)),M.map.setMaxBounds(e.bounds)):M.map.setMaxBounds(null)),M.map.fire("baselayerchange",t)}(e),onGeolocationStatusChanged:e=>function(e){n.active!==e&&a&&(M.map.removeLayer(a),a=null)}(e),onGeolocationPositionChanged:t=>function(t){let o=e.geoLocation.zoomToPosition;a&&(M.map.removeLayer(a),o=!1),a=L.circleMarker(L.latLng(t.coords.latitude,t.coords.longitude),{radius:e.geoLocation.radius,color:e.geoLocation.color}).bindTooltip(j().formatLatLng([t.coords.latitude,t.coords.longitude])).addTo(M.map),o&&M.map.setView(L.latLng(t.coords.latitude,t.coords.longitude),e.geoLocation.zoomFactor)}(t)})}();let xe=null,Ae=null,Ee=1;function Ce(e){ge.addWayPointOnRoute(Ae,[e.target.getLatLng().lat,e.target.getLatLng().lng]),xe&&(L.DomEvent.off(xe),M.map.removeLayer(xe),xe=null)}function De(){xe&&(L.DomEvent.off(xe),M.map.removeLayer(xe),xe=null)}function Pe(e){e.latlng.lat=Ae[0],e.latlng.lng=Ae[1],e.target.objId=M.travel.editedRoute.objId,Le(e).show()}function je(t){let o=B().getRoute(t.target.objId);if(l.notEdited!==o.edited)if(Ae=[t.latlng.lat,t.latlng.lng],xe)xe.setLatLng(t.latlng);else{let o='<div class="TravelNotes-WayPoint TravelNotes-WayPointTmp"></div><div class="TravelNotes-WayPointText">?</div>';xe=L.marker(t.latlng,{icon:L.divIcon({iconSize:[40,40],iconAnchor:[20,40],html:o,className:"TravelNotes-WayPointStyle"}),draggable:!0}),(-1===e.route.showDragTooltip||Ee<=e.route.showDragTooltip)&&(Ee++,xe.bindTooltip(P.getText("MapEditor - Drag and drop to add a waypoint")),xe.getTooltip().options.offset=[0,0]),xe.addTo(M.map),xe.on("mouseout",De),xe.on("dragstart",()=>xe.off("mouseout",De)),xe.on("dragend",Ce),xe.on("contextmenu",Pe)}}const Me=function(){let t=B(),o=k(),a=V();function n(e,t){t.objId=e,t.addTo(M.map),M.mapObjects.set(e,t)}function r(e){let t=M.mapObjects.get(e);t&&(L.DomEvent.off(t),M.map.removeLayer(t),M.mapObjects.delete(e))}function s(e,n){L.DomEvent.on(n.bullet,"dragend",e=>{let n=t.getNoteAndRoute(e.target.objId),r=n.note,i=n.route,l=M.mapObjects.get(e.target.objId);if(null===i)r.latLng=[e.target.getLatLng().lat,e.target.getLatLng().lng],o.dispatch("updatetravelnotes");else{let t=a.getClosestLatLngDistance(i,[e.target.getLatLng().lat,e.target.getLatLng().lng]);r.latLng=t.latLng,r.distance=t.distance,i.notes.sort((e,t)=>e.distance-t.distance),l.getLayer(l.bulletId).setLatLng(t.latLng),o.dispatch("updateitinerary")}l.getLayer(l.polylineId).setLatLngs([r.latLng,r.iconLatLng]),o.dispatch("roadbookupdate")}),L.DomEvent.on(n.bullet,"drag",e=>{let o=t.getNoteAndRoute(e.target.objId).note,a=M.mapObjects.get(e.target.objId);a.getLayer(a.polylineId).setLatLngs([[e.latlng.lat,e.latlng.lng],o.iconLatLng])}),L.DomEvent.on(n.marker,"contextmenu",e=>function(e){let t=e.target.objId,o=K(),a=Ne(e);return a.init(function(){let e=B().getNoteAndRoute(t).route;return[{context:q,name:P.getText("ContextMenuFactory - Edit this note"),action:q.editNote,param:t},{context:q,name:P.getText("ContextMenuFactory - Delete this note"),action:q.removeNote,param:t},{context:o,name:P.getText("ContextMenuFactory - Zoom to note"),action:o.zoomToNote,param:t},{context:q,name:e?P.getText("ContextMenuFactory - Detach note from route"):P.getText("ContextMenuFactory - Attach note to route"),action:0!==M.travel.routes.length&&-1===M.editedRouteObjId?e?q.detachNoteFromRoute:q.attachNoteToRoute:null,param:t}]}()),Object.seal(a)}(e).show()),L.DomEvent.on(n.marker,"dragend",e=>{let o=t.getNoteAndRoute(e.target.objId).note;o.iconLatLng=[e.target.getLatLng().lat,e.target.getLatLng().lng];let a=M.mapObjects.get(e.target.objId);a.getLayer(a.polylineId).setLatLngs([o.latLng,o.iconLatLng])}),L.DomEvent.on(n.marker,"drag",e=>{let o=t.getNoteAndRoute(e.target.objId).note,a=M.mapObjects.get(e.target.objId);a.getLayer(a.polylineId).setLatLngs([o.latLng,[e.latlng.lat,e.latlng.lng]])})}function d(e,o){if(i.defaultValue===e.lat&&i.defaultValue===e.lng)return;let a='<div class="TravelNotes-WayPoint TravelNotes-WayPoint'+("A"===o?"Start":"B"===o?"End":"Via")+'"></div><div class="TravelNotes-WayPointText">'+o+"</div>",r=L.marker(e.latLng,{icon:L.divIcon({iconSize:[40,40],iconAnchor:[20,40],html:a,className:"TravelNotes-WayPointStyle"}),draggable:!0});r.bindTooltip(e=>j().formatLatLng(t.getWayPoint(e.objId).latLng)),r.getTooltip().options.offset=[20,-20],L.DomEvent.on(r,"contextmenu",e=>function(e){let t=e.target.objId,o=Ne(e);return o.init(function(){let e=M.travel.editedRoute.wayPoints.first.objId!==t&&M.travel.editedRoute.wayPoints.last.objId!==t;return[{context:ge,name:P.getText("ContextMenuFactory - Delete this waypoint"),action:e?ge.removeWayPoint:null,param:t}]}()),Object.seal(o)}(e).show()),r.objId=e.objId,n(e.objId,r),L.DomEvent.on(r,"dragend",e=>{M.travel.editedRoute.wayPoints.getAt(e.target.objId).latLng=[e.target.getLatLng().lat,e.target.getLatLng().lng],ge.wayPointDragEnd(e.target.objId)})}function c(e,o){-1!==e&&function(e){let o=t.getRoute(e);r(o.objId);let a=o.notes.iterator;for(;!a.done;)r(a.value.objId);let n=o.wayPoints.iterator;for(;!n.done;)r(n.value.objId)}(e),-1!==o&&function(e){let t=we.addRoute(e),o=M.mapObjects.get(e);if(!M.travel.readOnly){L.DomEvent.on(o,"contextmenu",e=>Le(e).show()),o.on("mouseover",je);let e=t.notes.iterator;for(;!e.done;){let t=M.mapObjects.get(e.value.objId);s(e.value.objId,{marker:t.getLayer(t.markerId),polyline:t.getLayer(t.polylineId),bullet:t.getLayer(t.bulletId)})}}if(!M.travel.readOnly&&l.notEdited!==t.edited){let e=M.travel.editedRoute.wayPoints.iterator;for(;!e.done;)d(e.value,e.first?"A":e.last?"B":e.index)}}(o)}function u(e,t){let o=!1;if(-1!==e){let t=M.mapObjects.get(e);t&&(o=t.getLayer(t.markerId).isPopupOpen()),r(e)}-1!==t&&function(e,t){let o=we.addNote(e);t&&o.marker.openPopup(),M.travel.readOnly||s(0,o)}(t,o)}return Object.seal({updateRoute:(e,t)=>c(e,t),updateRouteProperties:e=>function(e){let o=t.getRoute(e);M.mapObjects.get(o.objId).setStyle({color:o.color,weight:o.width,dashArray:we.getDashArray(o)})}(e),updateNote:(e,t)=>u(e,t),removeObject:e=>r(e),removeAllObjects:()=>(M.mapObjects.forEach(e=>{L.DomEvent.off(e),M.map.removeLayer(e)}),void M.mapObjects.clear()),addItineraryPointMarker:(t,o)=>function(t,o){n(t,L.circleMarker(o,e.itineraryPointMarker))}(t,o),addSearchPointMarker:(t,o,r)=>function(t,o,r){let i=!1;if(r){let e=[];r.forEach(t=>{e=e.concat(t)});let t=a.getLatLngBounds(e),o=M.map.getBounds();i=(t.getEast()-t.getWest())/(o.getEast()-o.getWest())>.01&&(t.getNorth()-t.getSouth())/(o.getNorth()-o.getSouth())>.01}n(t,i?L.polyline(r,e.searchPointPolyline):L.circleMarker(o,e.searchPointMarker))}(t,o,r),addRectangle:(e,t,o)=>function(e,t,o){n(e,L.rectangle(t,o))}(e,t,o),addWayPoint:(e,t)=>d(e,t),setLayer:e=>function(e){let t=e.url;if(e.providerKeyNeeded){let o=oe.getKey(e.providerName.toLowerCase());if(!o)return;t=t.replace("{providerKey}",o)}e.url=t,we.setLayer(e)}(e)})}();function Re(e,o){let a=0,n=t(),r=[],i={minSize:2,listStyle:"AllSort",id:"TravelNotes-SortableList-Container"},l=n.create("div",{id:i.id,className:"TravelNotes-SortableList-Container"});function s(e){e.stopPropagation();try{e.dataTransfer.setData("Text",e.target.dataObjId),e.dataTransfer.dropEffect="move"}catch(e){console.log(e)}a=e.target.dataObjId-1}function d(e){let t=new Event("SortableListDelete");t.itemNode=e.target.parentNode,e.target.parentNode.parentNode.dispatchEvent(t),e.stopPropagation()}function u(e){let t=new Event("SortableListUpArrow");t.itemNode=e.target.parentNode,e.target.parentNode.parentNode.dispatchEvent(t),e.stopPropagation()}function v(e){let t=new Event("SortableListDownArrow");t.itemNode=e.target.parentNode,e.target.parentNode.parentNode.dispatchEvent(t),e.stopPropagation()}function g(e){let t=new Event("SortableListRightArrow");t.itemNode=e.target.parentNode,e.target.parentNode.parentNode.dispatchEvent(t),e.stopPropagation()}function p(e){let t=new Event("SortableListChange");t.dataObjId=e.target.parentNode.dataObjId,t.changeValue=e.target.value,e.target.parentNode.parentNode.dispatchEvent(t),e.stopPropagation()}function m(e){let t=n.create("div",{draggable:!1,className:"TravelNotes-SortableList-Item"});n.create("div",{className:"TravelNotes-SortableList-ItemTextIndex",innerHTML:e.label||""},t);let o=n.create("input",{type:"text",className:"TravelNotes-SortableList-ItemInput",placeholder:e.placeholder||"",value:e.value||""},t);o.addEventListener("change",p,!1),o.addEventListener("focus",e=>{e.target.parentElement.draggable=!1},!1),o.addEventListener("blur",e=>{e.target.parentElement.draggable=e.target.parentElement.canDrag},!1),n.create("div",{className:"TravelNotes-SortableList-ItemUpArrowButton",title:P.getText("SortableList - Move up"),innerHTML:"&#x21e7;"},t).addEventListener("click",u,!1),n.create("div",{className:"TravelNotes-SortableList-ItemDownArrowButton",title:P.getText("SortableList - Move down"),innerHTML:"&#x21e9;"},t).addEventListener("click",v,!1);let a=n.create("div",{className:"TravelNotes-SortableList-ItemRightArrowButton",title:P.getText("SortableList - Edit"),innerHTML:"&#x21f0;"},t);"AllSort"===i.listStyle&&a.addEventListener("click",g,!1),n.create("div",{className:"TravelNotes-SortableList-ItemDeleteButton",title:P.getText("SortableList - Delete"),innerHTML:"&#x267b;"},t).addEventListener("click",d,!1),t.dataObjId=e.objId||-1,t.canDrag=!1,("LimitedSort"!==i.listStyle||1<r.length)&&!e.isLast&&(t.draggable=!0,t.addEventListener("dragstart",s,!1),t.classList.add("TravelNotes-SortableList-MoveCursor"),t.canDrag=!0),r.push(t),l.appendChild(t)}for(let t in e)i[t]=e[t];"LimitedSort"===i.listStyle&&2>i.minSize&&(i.minSize=0),l.classList.add(i.listStyle),l.addEventListener("drop",(function(e){e.preventDefault();let t=e.target;for(;!t.dataObjId;)t=t.parentElement;let o=t.getBoundingClientRect(),n=new Event("SortableListDrop");n.draggedObjId=a+1,n.targetObjId=t.dataObjId,n.draggedBefore=e.clientY-o.top<o.bottom-e.clientY,t.parentNode.dispatchEvent(n)}),!1),l.addEventListener("dragover",(function(e){e.preventDefault()}),!1),l.addEventListener("wheel",(function(e){e.deltaY&&(e.target.scrollTop+=e.deltaY*c[e.deltaMode]),e.stopPropagation()}),!1),o&&o.appendChild(l);for(let e=0;e<i.minSize;e++)m();return Object.seal({removeAllItems:()=>function(){for(let e=0;e<r.length;e++)l.removeChild(r[e]);r.length=0}(),addItem:e=>m(e),get container(){return l}})}function Be(){let e=k();function t(){let t=M.travel.routes.iterator;for(;!t.done;)l.notEdited===t.value.edited&&e.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:t.value.objId});-1!==M.editedRouteObjId&&e.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:M.travel.editedRoute.objId});let o=M.travel.notes.iterator;for(;!o.done;)e.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:o.value.objId});K().zoomToTravel(),e.dispatch("travelnotesfileloaded",{name:M.travel.name})}return Object.seal({openDistantFile:e=>function(e){ue().decompress(e),M.travel.readOnly=!0,t()}(e),display:()=>t()})}function Se(){let e=k();function t(t,o){let a=t.target.files[0].name,n=new FileReader;n.onload=function(){let t={};try{t=JSON.parse(n.result)}catch(e){console.log(e||"An error occurs when reading the file")}o?ue().decompressMerge(t):(Q.deleteAllProfiles(),ue().decompress(t),M.travel.name=a.substr(0,a.lastIndexOf("."))),function(){if(e.dispatch("removeallobjects"),Be().display(),ne.setLayer(M.travel.layerName),ie.chainRoutes(),e.dispatch("setrouteslist"),-1===M.editedRouteObjId)e.dispatch("reducerouteui");else{let t=M.travel.editedRoute.itinerary.provider;if(t&&""!==t&&!M.providers.get(t.toLowerCase()))R.showError(P.getText("FileLoader - Not possible to select as provider",{provider:t}));else{let o=M.travel.editedRoute.itinerary.transitMode;e.dispatch("setprovider",{provider:t}),o&&""!==o&&e.dispatch("settransitmode",{transitMode:o})}ie.chainRoutes(),e.dispatch("expandrouteui")}e.dispatch("setwaypointslist"),e.dispatch("setitinerary"),e.dispatch("roadbookupdate"),e.dispatch("travelnotesfileloaded",{name:M.travel.name})}()},n.readAsText(t.target.files[0])}return Object.seal({openLocalFile:e=>t(e,!1),mergeLocalFile:e=>t(e,!0)})}const Oe=function(){let o=null,a=t(),n=null;function r(t){document.getElementById("TravelNotes-Control-TravelDataDiv")||(n=t,function(){let e=a.create("div",{id:"TravelNotes-Control-TravelHeaderDiv",className:"TravelNotes-Control-HeaderDiv"},n);a.create("span",{innerHTML:"&#x25bc;",id:"TravelNotes-ControlTravelExpandButton",className:"TravelNotes-Control-ExpandButton"},e).addEventListener("click",e=>{e.stopPropagation(),document.getElementById("TravelNotes-Control-TravelHeaderDiv").classList.toggle("TravelNotes-Control-SmallHeader"),document.getElementById("TravelNotes-Control-TravelDataDiv").classList.toggle("TravelNotes-Control-HiddenList"),document.getElementById("TravelNotes-ControlTravelButtonsDiv").classList.toggle("TravelNotes-Control-HiddenList");let t=document.getElementById("TravelNotes-Control-TravelDataDiv").classList.contains("TravelNotes-Control-HiddenList");document.getElementById("TravelNotes-ControlTravelExpandButton").innerHTML=t?"&#x25b6;":"&#x25bc;",document.getElementById("TravelNotes-ControlTravelExpandButton").title=t?P.getText("TravelUI - Show"):P.getText("TravelUI - Hide"),e.stopPropagation()},!1),a.create("span",{innerHTML:P.getText("TravelUI - Travel routes"),id:"TravelNotes-Control-TravelHeaderText",className:"TravelNotes-Control-HeaderText"},e)}(),function(){let e=a.create("div",{id:"TravelNotes-Control-TravelDataDiv",className:"TravelNotes-Control-DataDiv"},n);o=Re({minSize:0,id:"TravelNotes-Control-TravelRoutesList"},e),o.container.addEventListener("SortableListDelete",e=>{e.stopPropagation(),ve.removeRoute(e.itemNode.dataObjId)},!1),o.container.addEventListener("SortableListUpArrow",e=>{e.stopPropagation(),ve.swapRoute(e.itemNode.dataObjId,!0)},!1),o.container.addEventListener("SortableListDownArrow",e=>{e.stopPropagation(),ve.swapRoute(e.itemNode.dataObjId,!1)},!1),o.container.addEventListener("SortableListRightArrow",e=>{e.stopPropagation(),ve.editRoute(e.itemNode.dataObjId)},!1),o.container.addEventListener("SortableListChange",e=>{e.stopPropagation(),ve.renameRoute(e.dataObjId,e.changeValue)},!1),o.container.addEventListener("SortableListDrop",e=>{e.stopPropagation(),ve.routeDropped(e.draggedObjId,e.targetObjId,e.draggedBefore)},!1)}(),function(){let t=a.create("div",{id:"TravelNotes-ControlTravelButtonsDiv",className:"TravelNotes-Control-ButtonsDiv"},n);a.create("div",{id:"TravelNotes-Control-ExpandRoutesListButton",className:"TravelNotes-Control-Button",title:P.getText("TravelUI - Expand the list"),innerHTML:"&#x25bd;"},t).addEventListener("click",e=>{e.stopPropagation(),document.getElementById("TravelNotes-Control-TravelDataDiv").classList.toggle("TravelNotes-Control-ExpandedList");let t=document.getElementById("TravelNotes-Control-TravelDataDiv").classList.contains("TravelNotes-Control-ExpandedList");document.getElementById("TravelNotes-Control-ExpandRoutesListButton").innerHTML=t?"&#x25b3;":"&#x25bd;",document.getElementById("TravelNotes-Control-ExpandRoutesListButton").title=t?P.getText("TravelUI - Reduce the list"):P.getText("TravelUI - Expand the list")},!1),a.create("div",{id:"TravelNotes-Control-CancelTravelButton",className:"TravelNotes-Control-Button",title:P.getText("TravelUI - Cancel travel"),innerHTML:"&#x274c"},t).addEventListener("click",e=>{e.stopPropagation(),ve.clear()},!1),a.create("div",{id:"TravelNotes-Control-SaveTravelButton",className:"TravelNotes-Control-Button",title:P.getText("TravelUI - Save travel"),innerHTML:"&#x1f4be;"},t).addEventListener("click",e=>{e.stopPropagation(),ve.saveTravel()},!1);let o=a.create("div",{id:"TravelNotes-Control-OpenTravelDiv"},t);a.create("input",{id:"TravelNotes-Control-OpenTravelInput",type:"file",accept:".trv"},o).addEventListener("change",e=>{e.stopPropagation(),Se().openLocalFile(e)},!1);let r=a.create("div",{id:"TravelNotes-Control-OpenTravelFakeDiv"},o);a.create("div",{id:"TravelNotes-Control-OpenTravelButton",className:"TravelNotes-Control-Button",title:P.getText("TravelUI - Open travel"),innerHTML:"&#x1F4C2;"},r).addEventListener("click",()=>{window.confirm(P.getText("TravelEditor - This page ask to close; data are perhaps not saved."))&&document.getElementById("TravelNotes-Control-OpenTravelInput").click()},!1);let i=a.create("div",{id:"TravelNotes-Control-ImportTravelDiv"},t);a.create("input",{id:"TravelNotes-Control-ImportTravelInput",type:"file",accept:".trv,.map"},i).addEventListener("change",e=>{e.stopPropagation(),Se().mergeLocalFile(e)},!1);let l=a.create("div",{id:"TravelNotes-Control-ImportTravelFakeDiv"},i);a.create("div",{id:"TravelNotes-Control-ImportTravelButton",className:"TravelNotes-Control-Button",title:P.getText("TravelUI - Import travel"),innerHTML:"&#x1F30F;"},l).addEventListener("click",()=>{-1===M.editedRouteObjId?document.getElementById("TravelNotes-Control-ImportTravelInput").click():R.showError(P.getText("TravelUI - Not possible to merge a travel when a route is edited"))},!1),a.create("div",{id:"TravelNotes-Control-OpenTravelRoadbookButton",className:"TravelNotes-Control-Button",title:P.getText("TravelUI - Open travel roadbook"),innerHTML:'<a class="TravelNotes-Control-LinkButton" href="TravelNotesRoadbook.html?lng='+e.language+"&page="+M.UUID+'" target="_blank">&#x1F4CB;</a>'},t),a.create("div",{id:"TravelNotes-Control-AddRoutesButton",className:"TravelNotes-Control-Button",title:P.getText("TravelUI - New route"),innerHTML:"+"},t).addEventListener("click",e=>{e.stopPropagation(),ve.addRoute()},!1)}())}return Object.seal({createUI:e=>r(e),setRoutesList:()=>function(){o.removeAllItems();let e=M.travel.routes.iterator;for(;!e.done;)o.addItem({value:e.value.name,label:e.value.chain?"&#x26d3;":"",placeholder:P.getText("TravelUI - Route"),objId:e.value.objId,isLast:!1})}()})}();let ke=null;const He=function(){let e=null,o=t();function a(t){document.getElementById("TravelNotes-Control-RouteDataDiv")||(e=t,function(){let t=o.create("div",{id:"TravelNotes-Control-RouteHeaderDiv",className:"TravelNotes-Control-HeaderDiv"},e);o.create("span",{innerHTML:"&#x25bc;",id:"TravelNotes-Control-RouteExpandButton",className:"TravelNotes-Control-ExpandButton"},t).addEventListener("click",e=>{if(e.stopPropagation(),-1===M.editedRouteObjId)return;document.getElementById("TravelNotes-Control-RouteHeaderDiv").classList.toggle("TravelNotes-Control-SmallHeader"),document.getElementById("TravelNotes-Control-RouteDataDiv").classList.toggle("TravelNotes-Control-HiddenList"),document.getElementById("TravelNotes-Control-RouteButtonsDiv").classList.toggle("TravelNotes-Control-HiddenList");let t=document.getElementById("TravelNotes-Control-RouteDataDiv").classList.contains("TravelNotes-Control-HiddenList");document.getElementById("TravelNotes-Control-RouteExpandButton").innerHTML=t?"&#x25b6;":"&#x25bc;",document.getElementById("TravelNotes-Control-RouteExpandButton").title=t?P.getText("RouteUI - Show"):P.getText("RouteUI - Hide")},!1),o.create("span",{innerHTML:P.getText("RouteUI - Waypoints"),id:"TravelNotes-Control-RouteHeaderText",className:"TravelNotes-Control-HeaderText"},t)}(),function(){let t=o.create("div",{id:"TravelNotes-Control-RouteDataDiv",className:"TravelNotes-Control-DataDiv"},e);ke=Re({minSize:0,listStyle:"LimitedSort",id:"TravelNotes-Control-RouteWaypointsList"},t),ke.container.addEventListener("SortableListDelete",e=>{e.stopPropagation(),ge.removeWayPoint(e.itemNode.dataObjId)},!1),ke.container.addEventListener("SortableListUpArrow",e=>{e.stopPropagation(),ge.swapWayPoints(e.itemNode.dataObjId,!0)},!1),ke.container.addEventListener("SortableListDownArrow",e=>{e.stopPropagation(),ge.swapWayPoints(e.itemNode.dataObjId,!1)},!1),ke.container.addEventListener("SortableListChange",e=>{e.stopPropagation(),ge.renameWayPoint(e.dataObjId,e.changeValue)},!1),ke.container.addEventListener("SortableListDrop",e=>{e.stopPropagation(),ge.wayPointDropped(e.draggedObjId,e.targetObjId,e.draggedBefore)},!1)}(),function(){let t=o.create("div",{id:"TravelNotes-Control-RouteButtonsDiv",className:"TravelNotes-Control-ButtonsDiv"},e);o.create("div",{id:"TravelNotes-Control-ExpandWayPointsListButton",className:"TravelNotes-Control-Button",title:P.getText("RouteUI - Expand the list"),innerHTML:"&#x25bd;"},t).addEventListener("click",e=>{e.stopPropagation(),document.getElementById("TravelNotes-Control-RouteDataDiv").classList.toggle("TravelNotes-Control-ExpandedList");let t=document.getElementById("TravelNotes-Control-RouteDataDiv").classList.contains("TravelNotes-Control-ExpandedList");document.getElementById("TravelNotes-Control-ExpandWayPointsListButton").innerHTML=t?"&#x25b3;":"&#x25bd;",document.getElementById("TravelNotes-Control-ExpandWayPointsListButton").title=t?P.getText("RouteUI - Reduce the list"):P.getText("RouteUI - Expand the list")},!1),o.create("div",{id:"TravelNotes-Control-CancelRouteButton",className:"TravelNotes-Control-Button",title:P.getText("RouteUI - Cancel"),innerHTML:"&#x274c"},t).addEventListener("click",e=>{e.stopPropagation(),ie.cancelEdition()},!1),o.create("div",{id:"TravelNotes-Control-SaveRouteButton",className:"TravelNotes-Control-Button",title:P.getText("RouteUI - Save"),innerHTML:"&#x1f4be;"},t).addEventListener("click",e=>{e.stopPropagation(),ie.saveEdition()},!1),o.create("div",{id:"TravelNotes-Control-gpxButton",className:"TravelNotes-Control-Button",title:P.getText("RouteUI - Save the route in a gpx file"),innerHTML:"gpx"},t).addEventListener("click",e=>{e.stopPropagation(),ie.saveGpx()},!1),o.create("div",{id:"TravelNotes-Control-ReverseWayPointsButton",className:"TravelNotes-Control-Button",title:P.getText("RouteUI - Invert waypoints"),innerHTML:"&#x21C5;"},t).addEventListener("click",e=>{e.stopPropagation(),ge.reverseWayPoints()},!1),o.create("div",{id:"TravelNotes-Control-RemoveAllWayPointsButton",className:"TravelNotes-Control-Button",title:P.getText("RouteUI - Delete all waypoints"),innerHTML:"&#x267b;"},t).addEventListener("click",e=>{e.stopPropagation(),ge.removeAllWayPoints()},!1)}())}return Object.seal({createUI:e=>a(e),expandUI:()=>(document.getElementById("TravelNotes-Control-RouteExpandButton").innerHTML="&#x25bc;",document.getElementById("TravelNotes-Control-RouteExpandButton").title="Masquer",document.getElementById("TravelNotes-Control-RouteDataDiv").classList.remove("TravelNotes-Control-HiddenList"),void document.getElementById("TravelNotes-Control-RouteButtonsDiv").classList.remove("TravelNotes-Control-HiddenList")),reduceUI:()=>(document.getElementById("TravelNotes-Control-RouteExpandButton").innerHTML="&#x25b6;",document.getElementById("TravelNotes-Control-RouteExpandButton").title="Afficher",document.getElementById("TravelNotes-Control-RouteDataDiv").classList.add("TravelNotes-Control-HiddenList"),void document.getElementById("TravelNotes-Control-RouteButtonsDiv").classList.add("TravelNotes-Control-HiddenList")),setWayPointsList:()=>function(){if(ke.removeAllItems(),-1===M.editedRouteObjId)return;let e=M.travel.editedRoute.wayPoints.iterator;for(;!e.done;){let t=e.first?"A":e.last?" B":e.index,o=e.first?P.getText("RouteUI - Start"):e.last?P.getText("RouteUI - End"):P.getText("RouteUI - Via");ke.addItem({value:""===e.value.name?j().formatLatLng(e.value.latLng):e.value.name,label:t,placeholder:o,objId:e.value.objId,isLast:e.last})}}()})}();function Ue(){let e=0,t=k();function o(t){t.stopPropagation();try{t.dataTransfer.setData("Text",t.target.dataObjId),t.dataTransfer.dropEffect="move"}catch(e){console.log(e)}e=t.target.noteObjId-1}function a(e){e.preventDefault()}function n(t){t.preventDefault();let o=t.target;for(;!o.noteObjId;)o=o.parentElement;let a=o.getBoundingClientRect();q.noteDropped(e+1,o.noteObjId,t.clientY-a.top<a.bottom-t.clientY)}function r(e){e.stopPropagation(),e.preventDefault();let o=e.target;for(;!o.noteObjId;)o=o.parentNode;t.dispatch("zoomto",{latLng:B().getNoteAndRoute(o.noteObjId).note.iconLatLng})}function i(e){e.stopPropagation(),e.preventDefault();let t=e.target;for(;!t.noteObjId;)t=t.parentNode;q.editNote(t.noteObjId)}return Object.seal({remove:()=>function(){let e=document.getElementById("TravelNotes-Control-DataPanesDiv");if(!e)return;let t=e.firstChild;t&&(t.childNodes.forEach(e=>{e.removeEventListener("click",r,!1),e.removeEventListener("contextmenu",i,!1),e.removeEventListener("dragstart",o,!1)}),e.removeChild(t))}(),add:()=>function(){document.getElementById("TravelNotes-Control-ItineraryPaneButton").classList.remove("TravelNotes-Control-ActivePaneButton"),document.getElementById("TravelNotes-Control-TravelNotesPaneButton").classList.add("TravelNotes-Control-ActivePaneButton"),window.osmSearch&&document.getElementById("TravelNotes-Control-SearchPaneButton").classList.remove("TravelNotes-Control-ActivePaneButton");let e=U("TravelNotes-Control-"),t=document.getElementById("TravelNotes-Control-DataPanesDiv");if(!t)return;let l=e.travelNotesHTML;l.addEventListener("drop",n,!1),l.addEventListener("dragover",a,!1),t.appendChild(l),l.childNodes.forEach(e=>{e.addEventListener("click",r,!1),e.addEventListener("contextmenu",i,!1),e.draggable=!0,e.addEventListener("dragstart",o,!1),e.classList.add("TravelNotes-SortableList-MoveCursor")})}()})}let Fe=!1,We={searchPhrase:"",bbox:null},Ve=-1,Ke=-1,ze=window.osmSearch?window.osmSearch.searchLimits:null;function Ze(){We.bbox&&(-1===Ve?Ve=v():k().dispatch("removeobject",{objId:Ve}),k().dispatch("addrectangle",{objId:Ve,bounds:[[We.bbox.southWest.lat,We.bbox.southWest.lng],[We.bbox.northEast.lat,We.bbox.northEast.lng]],properties:e.previousSearchLimit}))}function Je(e){M.searchData=e,Fe=!1,Ze(),k().dispatch("updatesearch")}function Xe(e){console.log(e||"An error occurs in the search"),Fe=!1}function Ge(){let t=M.map.getCenter();-1===Ke?Ke=v():k().dispatch("removeobject",{objId:Ke}),k().dispatch("addrectangle",{objId:Ke,bounds:[[t.lat-ze.lat,t.lng-ze.lng],[t.lat+ze.lat,t.lng+ze.lng]],properties:e.nextSearchLimit})}function Ye(){let e=k();return Object.seal({search:()=>function(){if(Fe)return;Fe=!0;let e=M.map.getBounds();We={bbox:{southWest:{lat:e.getSouthWest().lat,lng:e.getSouthWest().lng},northEast:{lat:e.getNorthEast().lat,lng:e.getNorthEast().lng}},searchPhrase:document.getElementById("TravelNotes-Control-SearchInput").value},M.searchData=[],window.osmSearch.getSearchPromise(We).then(Je,Xe)}(),show:()=>(M.map.on("zoom",Ge),M.map.on("move",Ge),Ge(),void Ze()),hide:()=>(M.map.off("zoom",Ge),M.map.off("move",Ge),-1!==Ke&&(e.dispatch("removeobject",{objId:Ke}),Ke=-1),void(-1!==Ve&&(e.dispatch("removeobject",{objId:Ve}),Ve=-1)))})}function qe(){let e=Ye(),o="",a=t(),n=k();function r(e){e.stopPropagation();let t=e.target;for(;!t.latLng;)t=t.parentNode;n.dispatch("zoomto",{latLng:t.latLng,geometry:t.geometry})}function i(e){e.stopPropagation(),e.preventDefault();let t=e.target;for(;!t.latLng;)t=t.parentNode;q.newSearchNote(t.searchResult)}function l(e){e.stopPropagation(),n.dispatch("addsearchpointmarker",{objId:e.target.objId,latLng:e.target.latLng,geometry:e.target.geometry})}function s(e){e.stopPropagation(),n.dispatch("removeobject",{objId:e.target.objId})}function d(){o=document.getElementById("TravelNotes-Control-SearchInput").value;let a=document.getElementById("TravelNotes-Control-SearchDiv"),n=document.getElementsByClassName("TravelNotes-Control-SearchResult");for(;0!==n.length;)n[0].removeEventListener("click",r,!1),n[0].removeEventListener("contextmenu",i,!1),n[0].removeEventListener("mouseenter",l,!1),n[0].removeEventListener("mouseleave",s,!1),a.removeChild(n[0]);if(!document.getElementById("TravelNotes-Control-SearchWaitBullet")){let e=t();e.create("div",{id:"TravelNotes-Control-SearchWaitBullet"},e.create("div",{id:"TravelNotes-Control-SearchWait"},a))}e.search()}return Object.seal({remove:()=>function(){let t=document.getElementById("TravelNotes-Control-DataPanesDiv");if(!t)return;e.hide();let o=document.getElementById("TravelNotes-Control-SearchButton");o&&o.removeEventListener("click",d,!1);let a=document.getElementById("TravelNotes-Control-SearchInput");a&&a.removeEventListener("change",d,!1);let n=document.getElementById("TravelNotes-Control-SearchDiv"),c=document.getElementsByClassName("TravelNotes-Control-SearchResult");Array.prototype.forEach.call(c,e=>{e.removeEventListener("click",r,!1),e.removeEventListener("contextmenu",i,!1),e.removeEventListener("mouseenter",l,!1),e.removeEventListener("mouseleave",s,!1)}),n&&t.removeChild(n)}(),add:()=>function(){document.getElementById("TravelNotes-Control-ItineraryPaneButton").classList.remove("TravelNotes-Control-ActivePaneButton"),document.getElementById("TravelNotes-Control-TravelNotesPaneButton").classList.remove("TravelNotes-Control-ActivePaneButton"),document.getElementById("TravelNotes-Control-SearchPaneButton").classList.add("TravelNotes-Control-ActivePaneButton");let t=document.getElementById("TravelNotes-Control-DataPanesDiv");if(!t)return;e.show();let n=a.create("div",{id:"TravelNotes-Control-SearchDiv"},t);a.create("div",{id:"TravelNotes-Control-SearchButton",className:"TravelNotes-Control-Button",title:P.getText("SearchPaneUI - Search OpenStreetMap"),innerHTML:"&#x1f50e"},n).addEventListener("click",d,!1);let c=a.create("input",{type:"text",id:"TravelNotes-Control-SearchInput",placeholder:P.getText("SearchPaneUI - Search phrase"),value:o},n);c.addEventListener("change",d,!1),c.addEventListener("keydown",e=>{"Enter"===e.key&&d()},!1),c.focus();let u=0;M.searchData.forEach(e=>{let t=a.create("div",{id:"TravelNotes-Control-SearchResult"+u++,className:"TravelNotes-Control-SearchResult",innerHTML:(""===e.description?"":'<p class="TravelNotes-Control-SearchResultDescription">'+e.description+"</p>")+(e.tags.name?"<p>"+e.tags.name+"</p>":"")+(e.tags["addr:street"]?"<p>"+e.tags["addr:street"]+" "+(e.tags["addr:housenumber"]?e.tags["addr:housenumber"]:"")+"</p>":"")+(e.tags["addr:city"]?"<p>"+(e.tags["addr:postcode"]?e.tags["addr:postcode"]+" ":"")+e.tags["addr:city"]+"</p>":"")+(e.tags.phone?"<p>"+e.tags.phone+"</p>":"")+(e.tags.email?'<p><a href="mailto:'+e.tags.email+'">'+e.tags.email+"</a></p>":"")+(e.tags.website?'<p><a href="'+e.tags.website+'" target="_blank">'+e.tags.website+"</a></p>":"")+(e.ranking?"<p>&#x26ab;"+e.ranking+"</p>":"")},n);t.searchResult=e,t.objId=v(),t.osmId=e.id,t.latLng=[e.lat,e.lon],t.geometry=e.geometry,t.addEventListener("click",r,!1),t.addEventListener("contextmenu",i,!1),t.addEventListener("mouseenter",l,!1),t.addEventListener("mouseleave",s,!1)})}()})}function Qe(){let e=k();function t(t){t.stopPropagation();let o=t.target;for(;!o.latLng;)o=o.parentNode;e.dispatch("zoomto",{latLng:o.latLng})}function o(e){e.stopPropagation(),e.preventDefault();let t=e.target;for(;!t.latLng;)t=t.parentNode;t.maneuverObjId?q.newManeuverNote(t.maneuverObjId,t.latLng):t.noteObjId&&q.editNote(t.noteObjId)}function a(t){t.stopPropagation(),e.dispatch("additinerarypointmarker",{objId:t.target.objId,latLng:t.target.latLng})}function n(t){t.stopPropagation(),e.dispatch("removeobject",{objId:t.target.objId})}return Object.seal({remove:()=>function(){let e=document.getElementById("TravelNotes-Control-DataPanesDiv");if(!e)return;let r=document.querySelector(".TravelNotes-Control-Route-Header");r&&e.removeChild(r);let i=document.querySelector(".TravelNotes-Control-Route-ManeuversAndNotes");if(i){let r=i.childNodes;for(let e=0;e<r.length;e++){let i=r[e];i.removeEventListener("click",t,!1),i.removeEventListener("contextmenu",o,!1),i.removeEventListener("mouseenter",a,!1),i.removeEventListener("mouseleave",n,!1)}e.removeChild(i)}}(),add:()=>function(){document.getElementById("TravelNotes-Control-ItineraryPaneButton").classList.add("TravelNotes-Control-ActivePaneButton"),document.getElementById("TravelNotes-Control-TravelNotesPaneButton").classList.remove("TravelNotes-Control-ActivePaneButton"),window.osmSearch&&document.getElementById("TravelNotes-Control-SearchPaneButton").classList.remove("TravelNotes-Control-ActivePaneButton");let e=U("TravelNotes-Control-"),r=document.getElementById("TravelNotes-Control-DataPanesDiv");if(!r)return;r.appendChild(e.routeHeaderHTML),r.appendChild(e.routeManeuversAndNotesHTML);let i=document.querySelector(".TravelNotes-Control-Route-ManeuversAndNotes");if(i){let e=i.childNodes;for(let r=0;r<e.length;r++){let i=e[r];i.addEventListener("click",t,!1),i.addEventListener("contextmenu",o,!1),i.addEventListener("mouseenter",a,!1),i.addEventListener("mouseleave",n,!1)}}}()})}const _e=function(){let e=-1,o=Ue(),a=qe(),n=Qe();function r(){switch(e){case 0:n.remove();break;case 1:o.remove();break;case 2:window.osmSearch&&a.remove()}}function i(){r(),n.add(),e=0}function l(){r(),o.add(),e=1}function s(){r(),a.add(),e=2}return Object.seal({createUI:e=>function(e){if(document.getElementById("TravelNotes-Control-DataPanesDiv"))return;let o=t(),a=o.create("div",{id:"TravelNotes-Control-ItineraryHeaderDiv",className:"TravelNotes-Control-HeaderDiv"},e);o.create("div",{innerHTML:P.getText("DataPanesUI - Itinerary"),id:"TravelNotes-Control-ItineraryPaneButton",className:"TravelNotes-Control-PaneButton"},a).addEventListener("click",()=>i(),!1),o.create("div",{innerHTML:P.getText("DataPanesUI - Travel notes"),id:"TravelNotes-Control-TravelNotesPaneButton",className:"TravelNotes-Control-PaneButton"},a).addEventListener("click",()=>l(),!1),window.osmSearch&&o.create("div",{innerHTML:P.getText("DataPanesUI - Search"),id:"TravelNotes-Control-SearchPaneButton",className:"TravelNotes-Control-PaneButton"},a).addEventListener("click",()=>s(),!1),o.create("div",{id:"TravelNotes-Control-DataPanesDiv",className:"TravelNotes-Control-DataDiv"},e).addEventListener("wheel",e=>{e.deltaY&&(e.target.scrollTop+=e.deltaY*c[e.deltaMode]),e.stopPropagation()},!1)}(e),setItinerary:()=>i(),updateItinerary:()=>{0===e&&(n.remove(),n.add())},setTravelNotes:()=>l(),updateTravelNotes:()=>{1===e&&(o.remove(),o.add())},setSearch:()=>s(),updateSearch:()=>{2===e&&(a.remove(),a.add())}})}();const $e=function(){let e=null,o=t(),a=!1,n=null,r=null,i=null,l=null,s=null,d=null,c=null;function u(e){M.routing.transitMode=e;let t=document.querySelector(".TravelNotes-Control-ActiveTransitModeImgButton");t&&t.classList.remove("TravelNotes-Control-ActiveTransitModeImgButton"),document.getElementById("TravelNotes-Control-"+e+"ImgButton").classList.add("TravelNotes-Control-ActiveTransitModeImgButton")}function v(e){e.stopPropagation(),u(e.target.transitMode),ie.startRouting()}function g(e){M.routing.provider=e;let t=document.querySelector(".TravelNotes-Control-ActiveProviderImgButton");t&&t.classList.remove("TravelNotes-Control-ActiveProviderImgButton"),document.getElementById("TravelNotes-Control-"+e+"ImgButton").classList.add("TravelNotes-Control-ActiveProviderImgButton");let o=M.providers.get(e.toLowerCase());o.transitModes.car?document.getElementById("TravelNotes-Control-carImgButton").classList.remove("TravelNotes-Control-InactiveTransitModeImgButton"):document.getElementById("TravelNotes-Control-carImgButton").classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),o.transitModes.bike?document.getElementById("TravelNotes-Control-bikeImgButton").classList.remove("TravelNotes-Control-InactiveTransitModeImgButton"):document.getElementById("TravelNotes-Control-bikeImgButton").classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),o.transitModes.pedestrian?document.getElementById("TravelNotes-Control-pedestrianImgButton").classList.remove("TravelNotes-Control-InactiveTransitModeImgButton"):document.getElementById("TravelNotes-Control-pedestrianImgButton").classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),o.transitModes.train?document.getElementById("TravelNotes-Control-trainImgButton").classList.remove("TravelNotes-Control-InactiveTransitModeImgButton"):document.getElementById("TravelNotes-Control-trainImgButton").classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),o.transitModes.line?document.getElementById("TravelNotes-Control-lineImgButton").classList.remove("TravelNotes-Control-InactiveTransitModeImgButton"):document.getElementById("TravelNotes-Control-lineImgButton").classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),o.transitModes.circle?document.getElementById("TravelNotes-Control-circleImgButton").classList.remove("TravelNotes-Control-InactiveTransitModeImgButton"):document.getElementById("TravelNotes-Control-circleImgButton").classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),M.providers.get(e.toLowerCase()).transitModes[M.routing.transitMode]||(o.transitModes.bike?u("bike"):o.transitModes.pedestrian?u("pedestrian"):o.transitModes.car?u("car"):o.transitModes.train?u("train"):o.transitModes.line?u("line"):o.transitModes.circle&&u("circle"))}function p(t){if(0===t.providerKey)return;let c=o.create("img",{src:t.icon,id:"TravelNotes-Control-"+t.name+"ImgButton",className:"TravelNotes-Control-ImgButton",title:t.name},e);c.provider=t.name,c.addEventListener("click",e=>{e.stopPropagation(),g(e.target.provider),ie.startRouting()},!1),a||(c.classList.add("TravelNotes-Control-ActiveProviderImgButton"),M.routing.provider=c.provider,a=!0,t.transitModes.bike?(n.classList.add("TravelNotes-Control-ActiveTransitModeImgButton"),M.routing.transitMode="bike"):t.transitModes.pedestrian?(r.classList.add("TravelNotes-Control-ActiveTransitModeImgButton"),M.routing.transitMode="pedestrian"):t.transitModes.car?(i.classList.add("TravelNotes-Control-ActiveTransitModeImgButton"),M.routing.transitMode="car"):t.transitModes.train?(l.classList.add("TravelNotes-Control-ActiveTransitModeImgButton"),M.routing.transitMode="train"):t.transitModes.line?(s.classList.add("TravelNotes-Control-ActiveTransitModeImgButton"),M.routing.transitMode="line"):t.transitModes.circle&&(d.classList.add("TravelNotes-Control-ActiveTransitModeImgButton"),M.routing.transitMode="circle"),t.transitModes.car||i.classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),t.transitModes.pedestrian||r.classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),t.transitModes.bike||n.classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),t.transitModes.train||l.classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),t.transitModes.line||s.classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),t.transitModes.circle||d.classList.add("TravelNotes-Control-InactiveTransitModeImgButton"))}function m(t){c=t,e=o.create("div",{id:"TravelNotes-Control-ItineraryButtonsDiv",className:"TravelNotes-Control-ButtonsDiv"},t),n=o.create("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\t\t\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEIChYTLGSDtAAAA65JREFUSMftVl1sk1UYfs53vnZft4/R/W+hHaUrbshcQch06VCGWd\t\t\t\t\tBohmNRCRiXKXphZCOacCEYBeOFXHhDlHDjQDEBdKIx9sL4Q8bqtEPqLAOE/YDrGPspa2m7bt/Xr8eLr3WddFuJ88b4Xp285z1P3v\t\t\t\t\tOe533eQ9xud3FxMcdxmMMURWGMUUoJIUjNFEUZHBwkPp8vovBnHVfB7gghACNIsgEQQgjAwBjiAfFIQqqrLBpNhKeU/to9Vr/fic\t\t\t\t\tWzbw6iqrKEQ/Ks/pkxAODwr9n/0HcHLWq5uoqlXMqMTjR+nj2bKWPlcrH9t4komyHRmgLt3pcq0gQNGOr2dSJZMyycteNaSJKjlk\t\t\t\t\tIh0dk9KjnO3QhORtrsV+YmXjzreW576qfxlrrlJUXCrUkWlBgDlmgJI+Tn7pvHfvTOeYzEodncTfP8xoIu93h7XzDR+Vx1vj8kVx\t\t\t\t\toEp2fqrlvGWihsseoFnggCv2JZRql+1pNMK+xL10T5yiyeI6/UFuzbalydq12YIbWW9CMt1u2bDeVm8VCzdZUl+1j7yEPr8wmBlh\t\t\t\t\tJTJg+AEgBI1+L4Gw9OSez8ldsv1JvfbbonKUNi1U6jZNuW0p3vuVRG1K8P6wUc2G4++OlAU03Rh98PV63OKvNNXR8K2oxCqTn747\t\t\t\t\taLgVCkfSBkv+Bvqs5985kV+08OzGTNEoi192lTm71XdTSs1RMl2trhzczUBWXm6vG2PGHcue2+xzeZHNfDWx81vX308tcX/BbTEp\t\t\t\t\tX0rR3jOdnpswqSKPAZomC/FABQadA1PlX+uWsCAM8xAK4Rqb7WvMlmebZhzQ5bXl6u+MC9WS9uzM/R6z7ac796fHJa+XtB/sKOSJ\t\t\t\t\tEqg9DpmXJ6wnWvd8RGRjS273TdqFxnvnh5+BPH2Nqy7N/7/F/5ZABArAiiQNUFpRwATlEUhmnVdeiz/saGWa/xWJkoyxF1vefo1Y\t\t\t\t\twNrR8c7wbQ+kX/q42rEiN3bS76Y+i2uo5GGQCeUhplkuryhJROp+fIbmuXa9h9LfTkw0WimNZ8uGeGrwxDo2EAPV75bOfg4eaK8b\t\t\t\t\tFAKCQtM+i9t8JvneiPQ0cBkEAgcO6XkZrXvksYe3j5kYK8HN2ZrtEz/ZPza1CNRczP0p4+PyEpM3Swv7Nug62UBwBCZ7USw/vfjq\t\t\t\t\tQobz/0BpNoHs8voHzzik9SsUtZVFNH+Y8NMMqRxQWllAdA/H6/RqPr7bvJGBYcgSz28wIhJK49SR7WUlIoy2HidruNRiOldBGzVr\t\t\t\t\t+TfwLXzWMKJ+iQhAAAAABJRU5ErkJggg==",id:"TravelNotes-Control-bikeImgButton",className:"TravelNotes-Control-ImgButton",title:P.getText("ProvidersToolbarUI - bike")},e),n.transitMode="bike",n.addEventListener("click",v,!1),r=o.create("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\t\t\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEICholT2tZIQAAAyxJREFUSMetll1IFFEUx/93PtZ13cykJNvWNDXEMkgoyYKICCJISK\t\t\t\t\tkIIYjqpU98kB77loogjCzKCvoQkqigh8ioKKS01NS2grDwY7ddLa3dNVt37r1ze5haLXVzV8/TmTN3fufMYeacP3E4HCkpKZIkYX\t\t\t\t\twmhCCEhD/DOXc6ncTr9TKu1D5vgxj7LCEQYvglAYQQnOuSTAiMTAQGgpDlSzNUlSmyLLe0fl1/6BUmzx6exNIl6RLwV7kygUomzB\t\t\t\t\tYA8G+LuQD9kyoxRrqxf9HFvQtIVMmUMPeqDuevWZUNgDJ917n3kaLDfRhZmUmGE2dRo6g6HLr6bmtQY+5u78kr7ycZ3fCmlzGdUj\t\t\t\t\t01yTyZ6MOb0q6dLYyzmObYE29VFp3Ykjk56HXZU0p2rrDE/m6xJda0c1v+yjTLeIgyCYveujHb0+MfCLBQxOsPHi1dNh40F2HRVm\t\t\t\t\tvMz4AW1IbQZyrrF8637S+wT7QhVovKGedMD0U8Xwau3mzYsyM/XpUmhDaZVKHrus5DEVUmu8+/8/T4LpbmGpFjxelvb6zLSjRFhl\t\t\t\t\tZUhTGu86GqzSYJwL6Dz3Lm21ZnWgEkxMfYbdP8QT0ydMWluoorjRrlnAtKdQCKTAC8cAXKymsvn1p752Desry0/h+D+ZnWyNCVtX\t\t\t\t\t3XG7yDQdbU3F52+nEIDaDq1bfj5c/efei1z060JSdUnS86snluxH+jRjkIqMYAmIZNkXNPejpc/dOmxgLo6PpeVLDQqkiRoRnjBM\t\t\t\t\tTbTwEoyl+Dtbgw25i0U+PNJQce5SSbx0SPOpB1ziVJcvdp/xyYZVEW56YaftJ0K+Woc/4cEz3qXqSUg8DVpwEAGXq/HJv53v0Wd7\t\t\t\t\tfvZVNXp/PbjAQ14l4HBhkAt4/+2bS/rabtR/GJlt6+gYZmV3tnb3XT92jQhBBPvyYEMGKJCcBsVijTo1lg92rarHGqLkRQ46NpD/\t\t\t\t\tHZ4/d0+6NBX3jaYzhOt3f4FDSs8XXXg+fuetdgNOiQzdtwe2Rwe7nj/+NJlqJXHqM+KcsKAOLz+VQ19uOnbiEwht4gMGSZGJJp4S\t\t\t\t\t0jfSalAeJwOOx2uyzLYfTjCAU4Ljn5C1w5SWBHSm1MAAAAAElFTkSuQmCC",id:"TravelNotes-Control-pedestrianImgButton",className:"TravelNotes-Control-ImgButton",title:P.getText("ProvidersToolbarUI - pedestrian")},e),r.transitMode="pedestrian",r.addEventListener("click",v,!1),i=o.create("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\t\t\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEICh4hLGpYPAAAAlZJREFUSMfdlk1oE0EUx/+zszEx3UhD0zZYkn5ksfWjlVgrVk1RQV\t\t\t\t\tR6EMFaK9qjggdBRO1NvSiIB8/iyQ/akxepSKteRPxoETXamkQtJAbbBN0ky0boZne8FIu23exqKuhjDgMz78ef/3u8GRIOh/1+P8\t\t\t\t\tdxKF1ompZIJEgmkylo/KPHMTBL6QQzCXM2hGxpF222Ak8pffkqvff88xKqHrqE9g0BDrAo10wwAOCwaPFvovmFDo6Gak4f3+x0gj\t\t\t\t\tHoOjQNTIfOoOvQ9dn93aF3p268tobu3R9sqC+XJACgdGbxPCgFIbPXHPYWa+gKWtbS7M3nIe669VVTfjm1aRUC53AtwYObHXW1rr\t\t\t\t\tZK90haMuv1mZ4VgsBFYlNzuQBU+kUiybiajMYmeR69e0QLZdwW8gMYGU0ZF+rp6GcArcHlZg3Z5K1avaqKMUwkpGNbawzQ2VxB09\t\t\t\t\tDU6Gl0lUVkpQj6xA7xwtntdjsjBBfPdZhpMnc5fXL7wO5DA8+mFCND1gddDgcA8nFCVtUi0OlpRKKyrsPtphuby015PTYuB7r67w\t\t\t\t\t3HjdH3H8abDva/eStZKGOt33n9ZNu6tZXG6NagZ6AvVF+3zEJfCwI93BMs6nJ1tbN730rTM+R3JyxjxVQfuRztu5IaG+4UBORyWL\t\t\t\t\tNz0AD34k6nx4NCAYHQ4Cc1XQStMEVRlR8SEmrSjOT4fNf++lBNpfR8npNlzThZlmG3Y6H2nx8tdl8zo6uh6+p/94AtMppypLRQSn\t\t\t\t\tkAJJvN2mxL33+YZOynR+9PQgx4VfUbCYfDPp+PUlry7+R3HyvZuSYHFFYAAAAASUVORK5CYII=",id:"TravelNotes-Control-carImgButton",className:"TravelNotes-Control-ImgButton",title:P.getText("ProvidersToolbarUI - car")},e),i.transitMode="car",i.addEventListener("click",v,!1),l=o.create("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\t\t\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEICiI23EqkBAAABQpJREFUSMetVm1QVFUYfs+55+4u+zEsshK0iuy6iuAHbaSwJhkZNp\t\t\t\t\tWjaWn2oQ2Zk1lmpjMllmNqDYZjM+Y0TdkIg8WYHwU6KjqUIzl8KGhihcgCu8Auu3uBXXfZT+89/cBAYFex8f1173nOfea973ne5z\t\t\t\t\t2oqrouNUWHMYb7CUqBAkWAEAqD8jxvMplRd08vpWzlhRtA74scwe0PRjwgNMegIyRERCypq3cs/qwWHlyc+RIyZ2oxAASCXniwQQ\t\t\t\t\tEAMAB4ff6wG6Yr4YMcVaoi+D/IEUIEAFhCwsL5G6elTEnc8A6RSgnP05vuQOP1juXbrnjpqM4cA4BIxIbFnv/0mnbpyQlLyo6VXU\t\t\t\t\tEIHfn1kiYpLjlmtIkTACAMGwleZZAumK8bo5SFQoGxseyhXxqezkyYYnFVXPPYb5F7UyMU/gfzX43f+P5z5L9yvZWrHoACgUDlhb\t\t\t\t\t9e23LRHkJ3o4Zw6LIZUevW5HCcc++354/+Zp6YIDPoVZN1YxPiY5TRoujo6NSUpIL3uNw9RgExkalHhAwLX3ySTQizeUd5YU0fgL\t\t\t\t\tTJSE8ZHQCOYTvTov1/3pRFpKZ0eCMeLzBoNeofiioKa/p2r4yfnjpeLGb9gWCfx2/nvOZOd7vFIxETsZg0Gb2Tgu4bfkWErKlwxz\t\t\t\t\tt/umD2E3OmHSg+t3Zfc+m2tIULDHc/LquVe2TJ0ZFFx/367n/JfAguFz2TMVOXv+dETb2t6cjCe/ICQEKC6utNqeF1jQADwJsGeW\t\t\t\t\tnh0lDo1surD6VNjdtX8GJS0sOjlPCz8/UaqRAx68na2IMl52+6AysWa2ama1mWHX1bKxTyzbmTwioEAYBCRlSxyrlZ08tOVAGAz+\t\t\t\t\tezO1wWa4+5vcfY2t3U6q66xjl9vEpGdGq5LmmMNIpixDMYE4IZBndYXBHF12J2tpgFrudsZY3l8311tZxoRHJSALB74O/rPFwfrk\t\t\t\t\tI5+BlgeRjUOBlQXnl1t8kVctNeAAAQ3a/VeUCiZjydvHyQemAEbV2rX7QgzcE5u2xOk7nncoOl+LTN5B/SafvXaV56YZYgCEU/VW\t\t\t\t\t840N6/uH6efOVyvcXqXLOjFvjhBaEA8H1Jg9frmZ2p06fp0vV4ySLY+lGoo8PeZHRUXzR9d9xiCTJFx0xPZiXHKOUK2aDt3DD7lU\t\t\t\t\tolBUSGDkrkdrsv1TuyPzw7sDRvAlm1LPFR/WTdRDXDMAN+1GnhzO2cg+tze0L9Zi+RiAiDCRNSKhVJibElR+q2HOoCgDO7MgwZE8\t\t\t\t\tN4SIXplre4dT3GbSabIPCPpSePVcWIxWKtRq3VqCPVus1k3f6z5baaB3U9wvqquujyXc2m9t6sOTNaWjr3Hyj/p7E1GIw4ybju3m\t\t\t\t\t27KgJDp8/d7Pztb9r+qLXtyMuZmqotOXzhqdxTr2SrtBOUcSoFYXiEkVgkkkhoe4fr3b3GPgGPylQHoviS7+Sy0oPb01e9Me/xTN\t\t\t\t\t3HO899dcbZD2XEwabVU+dm6bPnRs3OnFJxrjG/sPlORTF5eXkWq7eo3BiJ3SegHyusgt0cJcGJCezvF7kgMADQ2QeHKx2nTzTIWb\t\t\t\t\tfb7ZPLRbNSotoabbYAWZEzbvy4MQQAGIzu2RE7Szko5QAAYIi31HP09d1NdyxIAIBhCAAgl8vFslHNxi5KASGgdPhkGHmto/T2Fk\t\t\t\t\toppVSgFCggBBhjQMBgPEkXHwr50NWrDYmJ4zFmYMilDwECBEBppBsM9KcSNniebzOZ/gWOPRAUHy2iQwAAAABJRU5ErkJggg==",id:"TravelNotes-Control-trainImgButton",className:"TravelNotes-Control-ImgButton",title:P.getText("ProvidersToolbarUI - train")},e),l.transitMode="train",l.addEventListener("click",v,!1),s=o.create("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\t\t\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEICiINbUFNIAAAAfZJREFUSMdjvHz5spycHBMTEwP1wN+/fx8/fsz44cOHP39ZDh+9zf\t\t\t\t\tCfJO2MDFANGAxGRhtLFVbWPyzMzMwXLr4ObDxFRVfv6mKwNFNmYmAg0bnEgP8MDAwMZAZxoqXgomJd/GrIMdpCkq270SMi1Iz6Rs\t\t\t\t\t9sdxIW4l2x+hSVjV5UrKunI3fpyqO43svUNDrfVSwi1Oztu8/plfsIKmYiKYhrS50ZGBiau/eeeP6LmkbDg3ji7lfEqGeiehCTZj\t\t\t\t\tRJQYzTaMb/bBQGMU6j/zOia57f60ZSEBMbIBsbTTXUpI6dvE18EMMBCx65mgBpT3e9Fy8/FLccxZUcE4OUv//4XTD3DglGW0iyle\t\t\t\t\tY7MTAwVLXsRgtiiIl21srKSuKsLMyPn7wlzej5vW58vJyz5h+ef/w9VhN///l7997LQ0fvzl93l4QAgQdx+tTrAVrcUQFqxoZysr\t\t\t\t\tIiaCbiTzAsuIL40+fvb958ubvaX0lRnIGB4fv3X9dvPD1x+iFBE3EaDQliVhZmVl5OP2/D799/nTl3/+jJ+1hDkzSjixK1+Xg5v3\t\t\t\t\t//dfX6U/JMxGl03/yrl669atnwlPIKEt3oE89/naCGueRXu4PAaGYmRuoayszMwsDAwPjx40dWVs47d1/8/8/ASCUrVJQlfv/+zn\t\t\t\t\tj58mVZWVlmZmaqNycB+D3rTYmxQpEAAAAASUVORK5CYII=",id:"TravelNotes-Control-lineImgButton",className:"TravelNotes-Control-ImgButton",title:P.getText("ProvidersToolbarUI - line")},e),s.transitMode="line",s.addEventListener("click",v,!1),d=o.create("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\t\t\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEICiEaxb+bJAAAAqNJREFUSMdjvHz5spycHBMTEwP1wN+/fx8/fsz44cOHP39ZDh+9zf\t\t\t\t\tCfJO2MDFANGAxGRhtLFVbWPyzMzMwXLr4ObDxFRVfv6mKwNFNmYmAg0bnEgP8MDAwMTAw0Ayz4pS0k2RKDlO2slUVFeIWFeBkYGN\t\t\t\t\t6++/z6zedDR+/OX3f3xPNfZBo9M1szIsTk48dvBw7fOnvp5cTdrxgYGPJdxYz1xD1dtWIjzBevOJk+9TrJRu/vszUyVJg6+1DVso\t\t\t\t\tfI4hN3v2LY/Yqh93JNgHRpvpOOloR19n6sJjDhMldZSSw+ex2aucigZcNT96iVstJCR6c6Emv0zGxNI0OFvKodG659xR8TJ57/Cs\t\t\t\t\tvcrKMlMzNbk7DRFpJssRHm3RP3ETQXbnr3xH2xEeYWkmwEjE4MUn7z9nPLhqfEJ7KWDU/fvP2cFaVOwGg7a+UDh2+RmoS3775mai\t\t\t\t\txPwGhREd6zl16SavSJcy+kJAUJGC0sxAtJvySB+cff8/FyEpX4qALQjf70+Xu+qxippiRaCn76/J2A0c+evzfWEyfVaAsjiWfP3x\t\t\t\t\tMw+vTZhw62aqQabWetfPrsQwJGT1t2U0SYty1KnnhzawKk5WVFpi27ScDoE89/LV5xMjvVDjN34Sp1S/OdFq84iVnAYkkh6VOvX7\t\t\t\t\tn2ZNV0X4KmW0iyrZrue+XaE6xFK/bEZ529//HTdzuXhdcESOMJh53Lwh8/fYerUMVZXltn75+ZrVlV7JoY/X7PgVsnzr2Yf/w9JJ\t\t\t\t\t1ZGEm4OKhJSgiSWRVAQmb+urtZUep21soRISbzeDkhCf/Z8/dHT9ybtuwm+RUYJFZP9F5mYLhMhdxI5YzOzMRIXUOZmVkYGBgYP3\t\t\t\t\t78yMrKeefui///GRipZIWKssTv398ZL1++LCsry8zMTPXmJADJwQv2CCSQygAAAABJRU5ErkJggg==",id:"TravelNotes-Control-circleImgButton",className:"TravelNotes-Control-ImgButton",title:P.getText("ProvidersToolbarUI - circle")},e),d.transitMode="circle",d.addEventListener("click",v,!1),M.providers&&(a=!1,M.providers.forEach(p))}return Object.seal({createUI:e=>m(e),get provider(){return M.routing.provider},set provider(e){g(e)},get transitMode(){return M.routing.transitMode},set transitMode(e){u(e)},providersAdded:()=>(c.removeChild(e),void m(c))})}();const et=function(){let t=n.disabled,o=null,a=k();function r(e){a.dispatch("geolocationpositionchanged",{position:e})}function i(){n.active===t&&(t=n.inactive),a.dispatch("geolocationstatuschanged",{status:t}),navigator.geolocation.clearWatch(o),o=null}function l(e){1===e.code&&(t=n.refusedByUser),i()}function s(){switch(t){case n.inactive:t=n.active,a.dispatch("geolocationstatuschanged",{status:t}),navigator.geolocation.getCurrentPosition(r,l,e.geoLocation.options),o=navigator.geolocation.watchPosition(r,l,e.geoLocation.options);break;case n.active:i()}return t}return t="geolocation"in navigator?n.inactive:n.disabled,Object.seal({get status(){return t},switch:()=>s()})}();const tt=function(){let o=null,a=t(),r=null,i=null;function l(){i&&(clearTimeout(i),i=null),document.getElementById("TravelNotes-Control-MainDiv").classList.remove("TravelNotes-Control-MainDiv-Minimize"),document.getElementById("TravelNotes-Control-MainDiv").classList.add("TravelNotes-Control-MainDiv-Maximize")}function s(){i=setTimeout(()=>{document.getElementById("TravelNotes-Control-MainDiv").classList.remove("TravelNotes-Control-MainDiv-Maximize"),document.getElementById("TravelNotes-Control-MainDiv").classList.add("TravelNotes-Control-MainDiv-Minimize")},e.travelEditor.timeout)}return Object.seal({createUI:t=>function(t){if(document.getElementById("TravelNotes-Control-TravelNotesToolbarDiv"))return;let i=a.create("div",{id:"TravelNotes-Control-TravelNotesToolbarDiv",className:"TravelNotes-Control-ButtonsDiv"},t);a.create("div",{id:"TravelNotes-Control-HomeButton",className:"TravelNotes-Control-Button",title:"Home",innerHTML:'<a class="TravelNotes-Control-LinkButton" href="'+window.location.origin+'" target="_blank">&#x1f3e0;</a>'},i),a.create("div",{id:"TravelNotes-Control-HelpButton",className:"TravelNotes-Control-Button",title:"Help",innerHTML:'<a class="TravelNotes-Control-LinkButton" href="https://github.com/wwwouaiebe/leaflet.TravelNotes/tree/gh-pages/TravelNotesGuides" target="_blank">?</a>'},i),a.create("div",{id:"TravelNotes-Control-ContactButton",className:"TravelNotes-Control-Button",title:"Contact",innerHTML:'<a class="TravelNotes-Control-LinkButton" href="'+(e.travelNotesToolbarUI.contactMail||window.location.origin)+'" target="_blank">@</a>'},i),e.APIKeys.showDialogButton&&a.create("div",{id:"TravelNotes-Control-ApiKeysButton",className:"TravelNotes-Control-Button",title:P.getText("TravelNotesToolbarUI - API keys"),innerHTML:"&#x1f511;"},i).addEventListener("click",e=>{e.stopPropagation(),oe.dialog()},!1),n.disabled<et.status&&(o=a.create("div",{id:"TravelNotes-Control-GeoLocatorButton",className:"TravelNotes-Control-Button",title:P.getText("TravelNotesToolbarUI - Geo location"),innerHTML:"&#x1f310;"},i),o.addEventListener("click",e=>{e.stopPropagation(),et.switch()},!1)),r=a.create("span",{innerHTML:"&#x274c;",id:"TravelNotes-Control-PinButton"},i),r.addEventListener("click",e=>{let t=document.getElementById("TravelNotes-Control-MainDiv"),o=document.createElement("div");o.innerHTML="&#x274c;",o.innerHTML===e.target.innerHTML?(e.target.innerHTML="&#x1f4cc;",t.addEventListener("mouseenter",l,!1),t.addEventListener("mouseleave",s,!1)):(e.target.innerHTML="&#x274c;",t.removeEventListener("mouseenter",l,!1),t.removeEventListener("mouseleave",s,!1))},!1),e.travelEditor.startMinimized?(r.innerHTML="&#x1f4cc;",t.addEventListener("mouseenter",l,!1),t.addEventListener("mouseleave",s,!1),t.classList.add("TravelNotes-Control-MainDiv-Minimize")):t.classList.add("TravelNotes-Control-MainDiv-Maximize")}(t),geoLocationStatusChanged:e=>function(e){switch(e){case n.inactive:o.classList.remove("TravelNotes-Control-GeoLocationButton-Striked");break;case n.active:o.classList.add("TravelNotes-Control-GeoLocationButton-Striked");break;default:o&&(o.parentNode.removeChild(o),o=null)}}(e)})}();const ot=function(){let e=null;function o(o){if(document.getElementById("TravelNotes-Control-MainDiv"))return;let a=t();e=a.create("div",{id:"TravelNotes-Control-MainDiv"},o),a.create("div",{id:"TravelNotes-Control-MainDiv-Title",innerHTML:"Travel&nbsp;&amp;&nbsp;Notes"},e),tt.createUI(e),Oe.createUI(e),He.createUI(e),_e.createUI(e),$e.createUI(e),e.addEventListener("setrouteslist",()=>Oe.setRoutesList(),!1),e.addEventListener("expandrouteui",()=>He.expandUI(),!1),e.addEventListener("reducerouteui",()=>He.reduceUI(),!1),e.addEventListener("setwaypointslist",()=>He.setWayPointsList(),!1),e.addEventListener("setitinerary",()=>_e.setItinerary(),!1),e.addEventListener("updateitinerary",()=>_e.updateItinerary(),!1),e.addEventListener("settravelnotes",()=>_e.setTravelNotes(),!1),e.addEventListener("updatetravelnotes",()=>_e.updateTravelNotes(),!1),e.addEventListener("setsearch",()=>_e.setSearch(),!1),e.addEventListener("updatesearch",()=>_e.updateSearch(),!1),e.addEventListener("providersadded",()=>$e.providersAdded(),!1),e.addEventListener("setprovider",e=>{e.data&&e.data.provider&&($e.provider=e.data.provider)},!1),e.addEventListener("settransitmode",e=>{e.data&&e.data.provider&&($e.transitMode=e.data.transitMode)},!1),e.addEventListener("click",e=>{e.target.classList.contains("TravelNotes-SortableList-ItemInput")||e.target.classList.contains("TravelNotes-Control-LinkButton")||e.target.id&&-1!==["TravelNotes-Control-OpenTravelInput","TravelNotes-Control-OpenTravelButton","TravelNotes-Control-ImportTravelInput","TravelNotes-Control-ImportTravelButton"].indexOf(e.target.id)||(e.stopPropagation(),e.preventDefault())},!1),e.addEventListener("dblclick",e=>{e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("wheel",e=>{e.stopPropagation(),e.preventDefault()},!1),document.addEventListener("geolocationstatuschanged",e=>{tt.geoLocationStatusChanged(e.data.status)},!1)}return e||o(),{createUI:e=>o(e)}}();function at(){let e=S();e.title=P.getText("AboutDialog - About Travel & Notes"),t().create("div",{id:"TravelNotes-AboutDialog-AboutDiv"},e.content).innerHTML='<p>This  program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or any later version.</p><p>Copyright - 2017 2020 - wwwouaiebe</p><p>Contact : <a href="http://www.ouaie.be/blog/pages/contact" target="_blank">http://www.ouaie.be/</a></p><p>GitHub : <a href="https://github.com/wwwouaiebe/leaflet.TravelNotes" target="_blank">https://github.com/wwwouaiebe/leaflet.TravelNotes</a></p><p>Version : 1.11.0.<p>This program uses: <a href="https://leafletjs.com/" target="_blank">leaflet</a>, <a href="https://github.com/mapbox/polyline" target="_blank">mapbox/polyline</a>, <a href="https://github.com/Project-OSRM/osrm-text-instructions" target="_blank">Project-OSRM/osrm-text-instructions</a> and  <a href="https://github.com/drolbr/Overpass-API" target="_blank">the Overpass API</a></p>',e.show().then().catch(e=>console.log(e||"An error occurs in the dialog"))}function nt(e){let t=[e.latlng.lat,e.latlng.lng],o=K();let a=Ne(e);return a.init([{context:ge,name:P.getText("ContextMenuFactory - Select this point as start point"),action:-1!==M.editedRouteObjId&&i.defaultValue===M.travel.editedRoute.wayPoints.first.lat?ge.setStartPoint:null,param:t},{context:ge,name:P.getText("ContextMenuFactory - Select this point as way point"),action:-1===M.editedRouteObjId?null:ge.addWayPoint,param:t},{context:ge,name:P.getText("ContextMenuFactory - Select this point as end point"),action:-1!==M.editedRouteObjId&&i.defaultValue===M.travel.editedRoute.wayPoints.last.lat?ge.setEndPoint:null,param:t},{context:q,name:P.getText("ContextMenuFactory - New travel note"),action:q.newTravelNote,param:t},{context:q,name:P.getText("ContextMenuFactory - Hide notes"),action:q.hideNotes},{context:q,name:P.getText("ContextMenuFactory - Show notes"),action:q.showNotes},{context:ie,name:P.getText("ContextMenuFactory - Show all routes"),action:ie.showRoutes},{context:o,name:P.getText("ContextMenuFactory - Zoom to travel"),action:o.zoomToTravel},{context:null,name:P.getText("ContextMenuFactory - About Travel & Notes"),action:at}]),Object.seal(a)}const rt=function(){let e=null,o=null,a=null,n="",r=j();function i(){e.innerHTML="<span>"+o+"&nbsp;-&nbsp;Zoom&nbsp;:&nbsp;"+a+(""===n?"":"&nbsp;-&nbsp;"+n)+"</span>"}return Object.seal({createUI:()=>function(){a=M.map.getZoom();let l=M.map.getCenter();o=r.formatLat(l.lat)+"&nbsp;-&nbsp;"+r.formatLng(l.lng),e=t().create("div",{id:"TravelNotes-MouseControl"},document.querySelector("body")),M.map.on("mousemove",e=>{o=r.formatLat(e.latlng.lat)+"&nbsp;-&nbsp;"+r.formatLng(e.latlng.lng),i()}),M.map.on("zoomend",()=>{a=M.map.getZoom(),i()}),document.addEventListener("travelnotesfileloaded",e=>{n=e.data.name||"",i()},!1)}(),set mousePos(e){var t;t=e,o=r.formatLat(t.lat)+"&nbsp;-&nbsp;"+r.formatLng(t.lng),i()},set zoom(e){a=e,i()},set fileName(e){n=e,i()}})}();const it=function(){let t=[],a=[],n=!1,r=!1,l=k();function s(){document.addEventListener("routeupdated",e=>{e.data&&Me.updateRoute(e.data.removedRouteObjId,e.data.addedRouteObjId)},!1),document.addEventListener("routepropertiesupdated",e=>{e.data&&(Me.updateRouteProperties(e.data.routeObjId),W())},!1),document.addEventListener("noteupdated",e=>{e.data&&(Me.updateNote(e.data.removedNoteObjId,e.data.addedNoteObjId),W())},!1),document.addEventListener("removeobject",e=>{e.data&&Me.removeObject(e.data.objId)},!1),document.addEventListener("removeallobjects",()=>Me.removeAllObjects(),!1),document.addEventListener("zoomto",e=>{e.data&&we.zoomTo(e.data.latLng,e.data.geometry)},!1),document.addEventListener("additinerarypointmarker",e=>{e.data&&Me.addItineraryPointMarker(e.data.objId,e.data.latLng)},!1),document.addEventListener("addsearchpointmarker",e=>{e.data&&Me.addSearchPointMarker(e.data.objId,e.data.latLng,e.data.geometry)},!1),document.addEventListener("addrectangle",e=>{e.data&&Me.addRectangle(e.data.objId,e.data.bounds,e.data.properties)},!1),document.addEventListener("addwaypoint",e=>{e.data&&Me.addWayPoint(e.data.wayPoint,e.data.letter)},!1),document.addEventListener("layerchange",e=>{e.data&&Me.setLayer(e.data.layer)}),document.addEventListener("geolocationpositionchanged",e=>{e.data&&we.onGeolocationPositionChanged(e.data.position)},!1),document.addEventListener("geolocationstatuschanged",e=>{e.data&&we.onGeolocationStatusChanged(e.data.status)},!1),document.addEventListener("roadbookupdate",()=>W(),!1),document.addEventListener("profileclosed",e=>{e.data&&Q.onProfileClosed(e.data.objId)},!1)}function d(){M.travel.readOnly||nt(event).show()}function c(e){M.travel.readOnly||nt(e).show()}return Object.seal({addReadOnlyMap:(e,t)=>function(e,t){s(),e&&(M.map=e),ae.createUI(),ne.setLayer("OSM - Color"),o().getJsonPromise(t).then(Be().openDistantFile).catch(e=>{console.log(e||"Not possible to load the .trv file"),M.map.setView([i.defaultValue,i.defaultValue],2)})}(e,t),addControl:(t,o)=>function(t,o){s(),window.addEventListener("unload",()=>{localStorage.removeItem(M.UUID)}),window.addEventListener("beforeunload",e=>(F.closeDb(M.UUID),e.returnValue="x","x")),t&&(M.map=t),M.travel=D(),M.travel.routes.add(E()),ot.createUI(document.getElementById(o)),ae.createUI(),R.createUI(),oe.fromServerFile(),e.layersToolbarUI.haveLayersToolbarUI&&ne.createUI(),e.mouseUI.haveMouseUI&&rt.createUI(),l.dispatch("setrouteslist"),l.dispatch("roadbookupdate"),e.travelEditor.startupRouteEdition?ve.editRoute(M.travel.routes.first.objId):l.dispatch("reducerouteui"),M.map.setView([e.map.center.lat,e.map.center.lng],e.map.zoom),R.showHelp(P.getText("Help - Continue with interface"))}(t,o),addProvider:e=>function(e){oe.addProvider(e)}(e),showInfo:e=>function(e){R.showInfo(e)}(e),addMapContextMenu:(e,t)=>{e&&(M.map.on("click",d),n=!0),t&&(M.map.on("contextmenu",d),r=!0)},get baseDialog(){return S()},get userData(){return M.travel.userData},set userData(e){M.travel.userData=e},get rightContextMenu(){return r},set rightContextMenu(e){e&&!r?(M.map.on("contextmenu",c),r=!0):!e&&r&&(M.map.off("contextmenu",c),r=!1)},get leftContextMenu(){return n},set leftContextMenu(e){e&&!n?(M.map.on("click",d),n=!0):!e&&n&&(M.map.off("click",d),n=!1)},get leftUserContextMenu(){return t},set leftUserContextMenu(e){t=e},get rightUserContextMenu(){return a},set rightUserContextMenu(e){a=e},get map(){return M.map},get maneuver(){return y()},get itineraryPoint(){return T()},get version(){return"1.11.0"}})}();!function(){let a=null,n=null;!function(){let e="?";decodeURI(window.location.search).substr(1).split("&").forEach(t=>{-1===t.indexOf("ProviderKey")?("fil="===t.substr(0,4).toLowerCase()?n=decodeURIComponent(escape(atob(t.substr(4)))):"lng="===t.substr(0,4).toLowerCase()&&(a=t.substr(4).toLowerCase()),e+="?"===e?"":"&",e+=t):oe.fromUrl(t)}),history.replaceState({index:"bar"},"page",e)}(),window.L.travelNotes=it,window.osmSearch?window.osmSearch.getDictionaryPromise(e.language,"travelNotes").then(()=>console.log("osmSearch dictionary loaded"),e=>console.log(e||"An error occurs when loading the osmSearch dictionary")):console.log("osmSearch not found");let r=o(),l=[r.getJsonPromise(window.location.href.substr(0,window.location.href.lastIndexOf("/")+1)+"TravelNotesConfig.json"),r.getJsonPromise(window.location.href.substr(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes"+(a||e.language).toUpperCase()+".json"),r.getJsonPromise(window.location.href.substr(0,window.location.href.lastIndexOf("/")+1)+"TravelNotesLayers.json"),r.getJsonPromise(window.location.href.substr(0,window.location.href.lastIndexOf("/")+1)+"TravelNotesNoteDialog"+(a||e.language).toUpperCase()+".json"),function(){if(!window.crypto||!window.crypto.subtle||!window.crypto.subtle.importKey)return Promise.resolve(!1);if(!window.isSecureContext)return Promise.resolve(!1);try{return window.crypto.subtle.importKey("raw",(new window.TextEncoder).encode("hoho"),{name:"PBKDF2"},!1,["deriveKey"])}catch(e){return Promise.resolve(!1)}}()];Promise.all(l).then(o=>{if(a&&(o[0].language=a),o[4]&&(o[0].haveCrypto=!0),"wwwouaiebe.github.io"===window.location.hostname){o[0].layersToolbarUI.theDevil.addButton=!1,o[0].errorUI.showHelp=!0;const e=120;o[0].printRouteMap.maxTiles=e}if(e.overload(o[0]),M.providers.forEach(t=>{t.userLanguage=e.language}),P.setTranslations(o[1]),ne.setLayers(o[2]),G.selectOptions=o[3].preDefinedIconsList,G.buttons=o[3].editionButtons,e.autoLoad){t().create("div",{id:"Map"},document.querySelector("body")),t().create("div",{id:"TravelNotes"},document.querySelector("body"));let e=window.L.map("Map",{attributionControl:!1,zoomControl:!1}).setView([i.defaultValue,i.defaultValue],0);n?it.addReadOnlyMap(e,n):(it.addControl(e,"TravelNotes"),it.rightContextMenu=!0)}}).catch(e=>console.log(e||"An error occurs when downloading the json configuration files"))}()}();