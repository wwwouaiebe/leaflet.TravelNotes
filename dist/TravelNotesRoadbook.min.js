/**
 * 
 * @source: https://github.com/wwwouaiebe/leaflet.TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * leaflet.travelnotes - version 3.0.0
 * Build 02746 - 2021-09-07T16:09:50+0200 
 * Copyright 2017 2021 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Constants.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/Object.freeze({minColorValue:0,maxColorValue:255,rowsNumber:6,cellsNumber:6,deltaColor:51,sliderMaxValue:100,sliderStep:20,initialRed:0}),Object.freeze({notSaved:"ðŸ”´",modified:"ðŸŸ¡",saved:"ðŸŸ¢"}),Object.freeze({fixed:2,invalid:-1,defaultValue:0,metersInKm:1e3}),Object.freeze({refusedByUser:-1,disabled:0,inactive:1,active:2}),Object.freeze({invalidPane:"43a6a53e-008a-4910-80a6-7a87d301ea15",itineraryPane:"8fbf0da7-4e6f-4bc7-8e20-1388461ccde7",travelNotesPane:"dffe782b-07df-4b81-a318-f287c0cf5ec6",searchPane:"228f00d7-43a8-4c13-897d-70400cb6dd58"}),Object.freeze({fixed:2,defaultValue:0}),Object.freeze({defaultValue:0,fixed:6,maxLat:90,minLat:-90,maxLng:180,minLng:-180}),Object.freeze({notEdited:0,editedNoChange:1,editedChanged:2}),Object.freeze({margin:100,height:500,width:1e3,yDeltaText:30,xDeltaText:10,vScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],hScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}),Object.freeze({width:40,height:40,svgViewboxDim:200}),Object.freeze({d0:0,d90:90,d180:180,d270:270,d360:360,d540:540,toRadians:Math.PI/180,fromRadians:180/Math.PI}),Object.freeze({atStart:-1,onRoute:0,atEnd:1});const e=Object.freeze(new class{#validityMap=new Map;#parser=new DOMParser;#addHtmlEntities(e){return e.replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;").replaceAll(/"/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}#stringify(e){let t="",r="",o=e.childNodes;for(let s=0;s<o.length;s++){let o=e.childNodes[s],a=o.nodeName.toLowerCase(),i=this.#validityMap.get(a);if(i){i=i.concat(["id","class","dir","title","tanwidth","tanheight"]);let e="svg"===a||"text"===a||"polyline"===a;t+="<"+a,o.hasAttribute("target")&&(t+=' rel="noopener noreferrer"'),i.forEach((s=>{if(e)o.hasAttributeNS(null,s)&&(t+=" "+s+'="'+this.#addHtmlEntities(o.getAttribute(s))+'"',o.removeAttribute(s));else if(o.hasAttribute(s))if("href"===s||"src"===s){let e=this.sanitizeToUrl(o.getAttribute(s),s).url;""===e?r+="\nAn invalid url ("+o.getAttribute(s)+") was removed from a "+s+" attribute":t+=" "+s+'="'+e+'"',o.removeAttribute(s)}else t+=" "+s+'="'+this.#addHtmlEntities(o.getAttribute(s))+'"',o.removeAttribute(s)})),t+=">";let s="",l="";[s,l]=this.#stringify(o),t+=s,r+=l,t+="</"+a+">"}else"#text"===a?t+=this.#addHtmlEntities(o.nodeValue):r+="\nAn invalid tag "+a+" was removed";if(o.hasAttributes)for(let e=0;e<o.attributes.length;e++)"rel"!==o.attributes[e].name&&(r+="\nAn unsecure attribute "+o.attributes[e].name+'="'+o.attributes[e].value+'" was removed.')}return[t,r]}#cloneNode(e,t){let r=e.childNodes;for(let o=0;o<r.length;o++){let r=e.childNodes[o],s=r.nodeName.toLowerCase(),a=this.#validityMap.get(s);if(a){a=a.concat(["id","class","dir","title","tanwidth","tanheight"]);let e="svg"===s||"text"===s||"polyline"===s,o=e?document.createElementNS("http://www.w3.org/2000/svg",s):document.createElement(s);if(a.forEach((t=>{if(e)r.hasAttributeNS(null,t)&&(o.setAttributeNS(null,t,r.getAttribute(t)),r.removeAttributeNS(null,t));else if(r.hasAttribute(t))if("href"===t||"src"===t){let e=this.sanitizeToUrl(r.getAttribute(t),t).url;""!==e&&o.setAttribute(t,e)}else o.setAttribute(t,r.getAttribute(t))})),r.hasAttribute("style")){r.getAttribute("style").split(";").forEach((e=>{let t=e.split(":");2!==t.length||"width"!==t[0].trim()&&"height"!==t[0].trim()||(o.style[t[0].trim()]=t[1].trim())}))}r.hasAttribute("target")&&o.setAttribute("rel","noopener noreferrer"),t.appendChild(o),this.#cloneNode(r,o)}else"#text"===s&&t.appendChild(document.createTextNode(r.nodeValue))}}constructor(){this.#validityMap.set("a",["href","target"]),this.#validityMap.set("div",[]),this.#validityMap.set("del",[]),this.#validityMap.set("em",[]),this.#validityMap.set("figcaption",[]),this.#validityMap.set("figure",[]),this.#validityMap.set("h1",[]),this.#validityMap.set("h2",[]),this.#validityMap.set("h3",[]),this.#validityMap.set("h4",[]),this.#validityMap.set("h5",[]),this.#validityMap.set("h6",[]),this.#validityMap.set("hr",[]),this.#validityMap.set("img",["src","alt","width","height"]),this.#validityMap.set("ins",[]),this.#validityMap.set("li",[]),this.#validityMap.set("mark",[]),this.#validityMap.set("ol",[]),this.#validityMap.set("p",[]),this.#validityMap.set("s",[]),this.#validityMap.set("small",[]),this.#validityMap.set("strong",[]),this.#validityMap.set("span",[]),this.#validityMap.set("sub",[]),this.#validityMap.set("sup",[]),this.#validityMap.set("ul",[]),this.#validityMap.set("svg",["xmlns","viewBox","class"]),this.#validityMap.set("text",["x","y","text-anchor"]),this.#validityMap.set("polyline",["points","class","transform"]),Object.freeze(this)}sanitizeToColor(e){let t=e.match(/^\u0023[0-9,A-F,a-f]{6}$/);return t?t[0]:null}sanitizeToUrl(e,t="href"){let r=this.#parser.parseFromString("<div>"+e+"</div>","text/html");if(!r||"#document"!==r.nodeName)return{url:"",errorsString:"Parsing error"};let o=r.body.firstChild,s="";for(let e=0;e<o.childNodes.length;e++){if("#text"!==o.childNodes[e].nodeName)return{url:"",errorsString:"Invalid characters found in the url"};s+=o.childNodes[e].nodeValue}if(s=s.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),s!==e)return{url:"",errorsString:"Invalid characters found in the url"};let a=["https:"];if("http:"!==window.location.protocol&&"href"!==t||a.push("http:"),"href"===t){a.push("mailto:"),a.push("sms:"),a.push("tel:");let e=s.match(/^\u0023\w*/);if(e&&s===e[0])return{url:s,errorsString:""}}"src"===t&&a.push("data:");let i=null;try{i=new URL(s)}catch(e){return{url:"",errorsString:"Invalid url string"}}if(-1===a.indexOf(i.protocol))return{url:"",errorsString:"Invalid protocol "+i.protocol};if(-1!==["sms:","tel:"].indexOf(i.protocol)&&i.pathname.match(/^\+[0-9,*,\u0023]*$/))return{url:s,errorsString:""};try{encodeURIComponent(i.href)}catch(e){return{url:"",errorsString:"Invalid character in url"}}return{url:s,errorsString:""}}sanitizeToJsString(e){let t=this.#parser.parseFromString("<div>"+e+"</div>","text/html");if(!t||"#document"!==t.nodeName)return"";let r=t.body.firstChild,o="";for(let e=0;e<r.childNodes.length;e++){if("#text"!==r.childNodes[e].nodeName)return"";o+=r.childNodes[e].nodeValue}return o=o.replaceAll(/</g,"â‰º").replaceAll(/>/g,"â‰»").replaceAll(/"/g,"â€³").replaceAll(/\u0027/g,"â€²"),o}sanitizeToHtmlElement(e,t){let r=this.#parser.parseFromString("<div>"+e+"</div>","text/html");r&&"#document"===r.nodeName?this.#cloneNode(r.body.firstChild,t):t.textContent=""}clone(e){let t=document.createElement(e.tagName);return this.#cloneNode(e,t),t}sanitizeToHtmlString(e){let t="",r="",o=this.#parser.parseFromString("<div>"+e.replace("&nbsp;","à¨€")+"</div>","text/html");return o&&"#document"===o.nodeName?([t,r]=this.#stringify(o.body.firstChild,r),{htmlString:t,errorsString:r}):{htmlString:"",errorsString:"Parsing error"}}});const t=new class{#translations=new Map;constructor(){Object.freeze(this)}setTranslations(t){t.forEach((t=>this.#translations.set(t.msgid,e.sanitizeToJsString(t.msgstr))))}getText(e,t){let r=this.#translations.get(e);return t&&r&&Object.getOwnPropertyNames(t).forEach((e=>r=r.replace("{"+e+"}",t[e]))),r||e}};
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file IndexedDb.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/const r=new class{#indexedDb=null;#UUID=null;#data=null;#open(e,t){if(this.#indexedDb)return void e();let r=window.indexedDB.open("TravelNotesDb",1);r.onerror=()=>{this.#indexedDb=null,t(new Error("Not possible to open the db"))},r.onsuccess=t=>{this.#indexedDb=t.target.result,e()},r.onupgradeneeded=e=>{this.#indexedDb=e.target.result,this.#indexedDb.createObjectStore("Travels",{keyPath:"UUID"})}}#read(e,t){if(!this.#indexedDb)return void t(new Error("Database not opened"));let r=this.#indexedDb.transaction(["Travels"],"readonly");r.onerror=()=>t(new Error("Transaction error")),r.objectStore("Travels").get(this.#UUID).onsuccess=t=>e(t.target.result?t.target.result.data:null)}#write(e,t){if(!this.#indexedDb)return void t(new Error("Database not opened"));let r=null;try{r=this.#indexedDb.transaction(["Travels"],"readwrite")}catch(e){return void t(e)}r.onerror=()=>t(new Error("Transaction error")),r.objectStore("Travels").put({UUID:this.#UUID,data:this.#data}).onsuccess=()=>e()}#close(){this.#indexedDb.close(),this.#indexedDb=null}constructor(){Object.freeze(this)}getOpenPromise(){return new Promise(((e,t)=>this.#open(e,t)))}getReadPromise(e){return this.#UUID=e,new Promise(((e,t)=>this.#read(e,t)))}getWritePromise(e,t){return this.#UUID=e,this.#data=t,new Promise(((e,t)=>this.#write(e,t)))}closeDb(e){if(!this.#indexedDb)return;if(!e)return void this.#close();let t=this.#indexedDb.transaction(["Travels"],"readwrite");t.onerror=()=>{};let r=t.objectStore("Travels").delete(e);r.onerror=()=>this.#close(),r.onsuccess=()=>this.#close()}};const o=new class{#travelNotesHtmlElement=document.getElementById("TravelNotes");constructor(){this.showTravelNotes=!0,this.showRouteNotes=!0,this.showManeuversNotes=!1,Object.seal(this)}toggleTravelNotes(){document.querySelectorAll(".TravelNotes-Roadbook-Travel-Notes-Row").forEach((e=>{this.showTravelNotes?e.classList.remove("TravelNotes-Hidden"):e.classList.add("TravelNotes-Hidden")}))}toggleRouteNotes(){document.querySelectorAll(".TravelNotes-Roadbook-Route-Notes-Row").forEach((e=>{this.showRouteNotes?e.classList.remove("TravelNotes-Hidden"):e.classList.add("TravelNotes-Hidden")}))}toggleManeuversNotes(){document.querySelectorAll(".TravelNotes-Roadbook-Route-Maneuvers-Row").forEach((e=>{this.showManeuversNotes?e.classList.remove("TravelNotes-Hidden"):e.classList.add("TravelNotes-Hidden")}))}toggleNotes(){this.toggleTravelNotes(),this.toggleRouteNotes(),this.toggleManeuversNotes()}updateIcons(){document.querySelectorAll(".TravelNotes-Roadbook-Route-ManeuversAndNotes-IconCell, .TravelNotes-Roadbook-Travel-Notes-IconCell").forEach((e=>{let t=e.getAttribute("tanwidth");t&&(e.style.width=t);let r=e.getAttribute("tanheight");r&&(e.style.height=r)}))}updateRoadbook(t){this.#travelNotesHtmlElement.textContent="",e.sanitizeToHtmlElement(t,this.#travelNotesHtmlElement);let r=document.querySelector(".TravelNotes-Roadbook-Travel-Header-Name");r&&(document.title=""===r.textContent?"roadbook":r.textContent+" - roadbook"),this.updateIcons(),this.toggleNotes()}};class s{constructor(){Object.freeze(this)}handleEvent(e){e.stopPropagation(),o.showTravelNotes=e.target.checked,o.toggleTravelNotes()}}class a{constructor(){Object.freeze(this)}handleEvent(e){e.stopPropagation(),o.showRouteNotes=e.target.checked,o.toggleRouteNotes()}}class i{constructor(){Object.freeze(this)}handleEvent(e){e.stopPropagation(),o.showManeuversNotes=e.target.checked,o.toggleManeuversNotes()}}class l{#UUID=null;constructor(e){this.#UUID=e}handleEvent(){r.getReadPromise(this.#UUID).then((e=>{e?o.updateRoadbook(e):o.updateRoadbook("")})).catch((e=>{e instanceof Error&&console.error(e)}))}}class n{constructor(){Object.freeze(this)}handleEvent(){try{let e=document.querySelector(".TravelNotes-Roadbook-Travel-Header-Name").textContent+"-Roadbook.html",t=document.getElementById("TravelNotes-Roadbook-Menu"),r=t.removeChild(document.getElementById("TravelNotes-SaveDiv")),o=window.URL.createObjectURL(new File(["<!DOCTYPE html>",document.documentElement.outerHTML],e,{type:"text/plain"})),s=document.createElement("a");s.setAttribute("href",o),s.setAttribute("download",e),s.style.display="none",s.click(),window.URL.revokeObjectURL(o),t.appendChild(r)}catch(e){e instanceof Error&&console.error(e)}}}(new class{#UUID=null;#language="fr";#saveButton=null;#initCheckboxes(){document.getElementById("TravelNotes-Travel-ShowNotes").checked=o.showTravelNotes,document.getElementById("TravelNotes-Routes-ShowNotes").checked=o.showRouteNotes,document.getElementById("TravelNotes-Routes-ShowManeuvers").checked=o.showManeuversNotes}#addEventListeners(){document.getElementById("TravelNotes-Travel-ShowNotes").addEventListener("change",new s),document.getElementById("TravelNotes-Routes-ShowNotes").addEventListener("change",new a),document.getElementById("TravelNotes-Routes-ShowManeuvers").addEventListener("change",new i)}#addSaveButton(){this.#saveButton=document.createElement("button"),this.#saveButton.id="TravelNotes-SaveButton",this.#saveButton.addEventListener("click",new n);let e=document.createElement("div");e.id="TravelNotes-SaveDiv",e.appendChild(this.#saveButton),document.getElementById("TravelNotes-Roadbook-Menu").appendChild(e)}#openIndexedDb(){r.getOpenPromise().then((()=>r.getReadPromise(this.#UUID))).then((e=>o.updateRoadbook(e))).catch((e=>{e instanceof Error&&console.error(e)})),window.addEventListener("storage",new l(this.#UUID)),window.addEventListener("unload",(()=>r.closeDb()))}#loadTranslations(){fetch(window.location.href.substr(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes"+this.#language.toUpperCase()+".json").then((e=>{200===e.status&&e.ok&&e.json().then((e=>t.setTranslations(e))).then((()=>this.#translatePage())).catch((e=>{e instanceof Error&&console.error(e)}))}))}#translatePage(){document.getElementById("TravelNotes-Travel-ShowNotesLabel").textContent=t.getText("Roadbook - show travel notes"),document.getElementById("TravelNotes-Routes-ShowManeuversLabel").textContent=t.getText("Roadbook - show maneuver"),document.getElementById("TravelNotes-Routes-ShowNotesLabel").textContent=t.getText("Roadbook - show routes notes"),this.#saveButton&&(this.#saveButton.textContent=t.getText("Roadbook - Save"))}constructor(){let e=new URLSearchParams(document.location.search.substring(1));this.#UUID=e.get("page"),this.#language=e.get("lng")||"fr"}loadRoadbook(){this.#initCheckboxes(),this.#addEventListeners(),this.#UUID?(this.#addSaveButton(),this.#openIndexedDb(),this.#loadTranslations()):o.updateIcons(),o.toggleNotes()}}).loadRoadbook()}();