/**
 * 
 * @source: https://github.com/wwwouaiebe/leaflet.TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * leaflet.travelnotes - version 2.1.0
 * Build 00427 - 2021-01-22T11:39:53+0100 
 * Copyright 2017 2021 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Constants.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/const e=Object.freeze({fixed:2,invalid:-1,defaultValue:0}),t=Object.freeze({refusedByUser:-1,disabled:0,inactive:1,active:2}),o=(Object.freeze({invalidPane:"43a6a53e-008a-4910-80a6-7a87d301ea15",itineraryPane:"8fbf0da7-4e6f-4bc7-8e20-1388461ccde7",travelNotesPane:"dffe782b-07df-4b81-a318-f287c0cf5ec6",searchPane:"228f00d7-43a8-4c13-897d-70400cb6dd58"}),Object.freeze({fixed:2,defaultValue:0})),a=Object.freeze({defaultValue:0,fixed:6}),n=Object.freeze({notEdited:0,editedNoChange:1,editedChanged:2}),i=Object.freeze({margin:100,height:500,width:1e3,yDeltaText:30,xDeltaText:10,vScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],hScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}),r=Object.freeze({width:40,height:40,svgViewboxDim:200}),s="http://www.w3.org/2000/svg";let l=new Map;l.set("a",["href","target"]),l.set("div",[]),l.set("del",[]),l.set("em",[]),l.set("figcaption",[]),l.set("figure",[]),l.set("h1",[]),l.set("h2",[]),l.set("h3",[]),l.set("h4",[]),l.set("h5",[]),l.set("h6",[]),l.set("hr",[]),l.set("img",["src","alt","width","height"]),l.set("ins",[]),l.set("li",[]),l.set("mark",[]),l.set("ol",[]),l.set("p",[]),l.set("s",[]),l.set("small",[]),l.set("strong",[]),l.set("span",[]),l.set("sub",[]),l.set("sup",[]),l.set("ul",[]),l.set("svg",["xmlns","viewBox","class"]),l.set("text",["x","y","text-anchor"]),l.set("polyline",["points","class","transform"]);const c=window.location.protocol,d=new DOMParser;function u(e){return e.replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;").replaceAll(/"/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}function h(e,t="href"){let o=d.parseFromString("<div>"+e+"</div>","text/html");if(!o||"#document"!==o.nodeName)return{url:"",errorsString:"Parsing error"};let a=o.querySelector("body").firstChild,n="";for(let e=0;e<a.childNodes.length;e++){if("#text"!==a.childNodes[e].nodeName)return{url:"",errorsString:"Invalid characters found in the url"};n+=a.childNodes[e].nodeValue}if(n=n.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),n!==e)return{url:"",errorsString:"Invalid characters found in the url"};let i=["https:"];if("http:"!==c&&"href"!==t||i.push("http:"),"href"===t){i.push("mailto:"),i.push("sms:"),i.push("tel:");let e=n.match(/^#\w*/);if(e&&n===e[0])return{url:n,errorsString:""}}"src"===t&&i.push("data:");let r=null;try{r=new URL(n)}catch(e){return{url:"",errorsString:"Invalid url string"}}if(-1===i.indexOf(r.protocol))return{url:"",errorsString:"Invalid protocol "+r.protocol};if(-1!==["sms:","tel:"].indexOf(r.protocol)&&r.pathname.match(/^\+[0-9,*,#]*$/))return{url:n,errorsString:""};try{encodeURIComponent(r.href)}catch(e){return{url:"",errorsString:"Invalid character in url"}}return{url:n,errorsString:""}}const g=Object.freeze(new class{sanitizeToColor(e){let t=e.match(/^#[0-9,A-F,a-f]{6}$/);return t?t[0]:null}sanitizeToUrl(e,t){return h(e,t)}sanitizeToJsString(e){return function(e){let t=d.parseFromString("<div>"+e+"</div>","text/html");if(!t||"#document"!==t.nodeName)return"";let o=t.querySelector("body").firstChild,a="";for(let e=0;e<o.childNodes.length;e++){if("#text"!==o.childNodes[e].nodeName)return"";a+=o.childNodes[e].nodeValue}return a=a.replaceAll(/</g,"≺").replaceAll(/>/g,"≻").replaceAll(/"/g,"″").replaceAll(/\u0027/g,"′"),a}(e)}sanitizeToHtmlElement(e,t){!function(e,t){let o=d.parseFromString("<div>"+e+"</div>","text/html");o&&"#document"===o.nodeName?function e(t,o){let a=t.childNodes;for(let n=0;n<a.length;n++){let a=t.childNodes[n],i=a.nodeName.toLowerCase(),r=l.get(i);if(r){r=r.concat(["id","class","dir","title"]);let t="svg"===i||"text"===i||"polyline"===i,n=t?document.createElementNS(s,i):document.createElement(i);if(r.forEach(e=>{if(t)a.hasAttributeNS(null,e)&&(n.setAttributeNS(null,e,a.getAttribute(e)),a.removeAttributeNS(null,e));else if(a.hasAttribute(e))if("href"===e||"src"===e){let t=h(a.getAttribute(e),e).url;""!==t&&n.setAttribute(e,t)}else n.setAttribute(e,a.getAttribute(e))}),a.hasAttribute("style")){a.getAttribute("style").split(";").forEach(e=>{let t=e.split(":");2!==t.length||"width"!==t[0].trim()&&"height"!==t[0].trim()||(n.style[t[0].trim()]=t[1].trim())})}o.appendChild(n),e(a,n)}else"#text"===i&&o.appendChild(document.createTextNode(a.nodeValue))}}(o.querySelector("body").firstChild,t):t.textContent=""}(e,t)}sanitizeToHtmlString(e){return function(e){let t="",o="",a=d.parseFromString("<div>"+e.replace("&nbsp;","਀")+"</div>","text/html");return a&&"#document"===a.nodeName?(function e(a){let n=a.childNodes;for(let i=0;i<n.length;i++){let n=a.childNodes[i],r=n.nodeName.toLowerCase(),s=l.get(r);if(s){s=s.concat(["id","class","dir","title"]);let a="svg"===r||"text"===r||"polyline"===r;t+="<"+r,s.forEach(e=>{if(a)n.hasAttributeNS(null,e)&&(t+=" "+e+'="'+u(n.getAttribute(e))+'"',n.removeAttribute(e));else if(n.hasAttribute(e))if("href"===e||"src"===e){let a=h(n.getAttribute(e),e).url;""===a?o+="\nAn invalid url ("+n.getAttribute(e)+") was removed from a "+e+" attribute":t+=" "+e+'="'+a+'"',n.removeAttribute(e)}else t+=" "+e+'="'+u(n.getAttribute(e))+'"',n.removeAttribute(e)}),t+=">",e(n),t+="</"+r+">"}else"#text"===r?t+=u(n.nodeValue):o+="\nAn invalid tag "+r+" was removed";if(n.hasAttributes)for(let e=0;e<n.attributes.length;e++)o+="\nAn unsecure attribute "+n.attributes[e].name+'="'+n.attributes[e].value+'" was removed.'}}(a.querySelector("body").firstChild),{htmlString:t,errorsString:o}):{htmlString:"",errorsString:"Parsing error"}}(e)}});let p={autoLoad:!1,map:{center:{lat:50.50923,lng:5.49542},zoom:12},travelNotesToolbarUI:{contactMail:{url:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues"}},layersToolbarUI:{haveLayersToolbarUI:!0,toolbarTimeOut:1500,theDevil:{addButton:!1}},mouseUI:{haveMouseUI:!0},errorUI:{timeOut:1e4,helpTimeOut:3e4,showError:!0,showWarning:!0,showInfo:!0,showHelp:!0},geoLocation:{color:"#ff0000",radius:11,zoomToPosition:!0,zoomFactor:17,options:{enableHighAccuracy:!1,maximumAge:0,timeout:1/0}},APIKeys:{showDialogButton:!0,saveToSessionStorage:!0,showAPIKeysInDialog:!0,dialogHaveUnsecureButtons:!0},contextMenu:{timeout:1500},routing:{auto:!0},language:"fr",itineraryPointMarker:{color:"#ff0000",weight:2,radius:7,fill:!1},searchPointMarker:{color:"#006400",weight:4,radius:20,fill:!1},searchPointPolyline:{color:"#006400",weight:4,radius:20,fill:!1},previousSearchLimit:{color:"#006400",fill:!1,weight:1},nextSearchLimit:{color:"#ff0000",fill:!1,weight:1},wayPoint:{reverseGeocoding:!1},route:{color:"#ff0000",width:3,dashArray:0,dashChoices:[{text:"——————",iDashArray:null},{text:"— — — — —",iDashArray:[4,2]},{text:"—‧—‧—‧—‧—",iDashArray:[4,2,0,2]},{text:"················",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:.25,smoothPoints:3},showDragTooltip:3},note:{osmSearchNoteDialog:!1,reverseGeocoding:!1,grip:{size:10,opacity:0,moveOpacity:1},polyline:{color:"#808080",weight:1},haveBackground:!1,svgRoadbookDimCoef:2,svgAnleMaxDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},svgZoom:17,svgRcnRefDistance:20,svgAngleDistance:10,svgHamletDistance:200,svgVillageDistance:400,svgCityDistance:1200,svgTownDistance:1500,svgTimeOut:40,maxManeuversNotes:100},noteDialog:{toggleIconDimension:!0,toggleIconTextArea:!1,toggleTooltip:!1,togglePopupContent:!1,toggleAddress:!1,toggleLink:!1,togglePhone:!0,iconAreaHeight:2,popupAreaHeigth:8},itineraryPointZoom:17,routeEditor:{displayEditionInHTMLPage:!0},travelEditor:{clearAfterSave:!0,startMinimized:!0,timeout:1e3,startupRouteEdition:!0},haveBeforeUnloadWarning:!0,overpassApi:{url:"https://lz4.overpass-api.de/api/interpreter"},nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},printRouteMap:{isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,pageBreak:!1,printNotes:!0,borderWidth:30,zoomFactor:15,entryPointMarker:{color:"#00ff00",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"#ff0000",weight:4,radius:10,fill:!0,fillOpacity:1}},haveCrypto:!1,itineraryPane:{showNotes:!0,showManeuvers:!1},colorDialog:{haveSlider:!0,initialRed:0}};let m=new class{get autoLoad(){return p.autoLoad}get map(){return p.map}get travelNotesToolbarUI(){return p.travelNotesToolbarUI}get layersToolbarUI(){return p.layersToolbarUI}get mouseUI(){return p.mouseUI}get errorUI(){return p.errorUI}get APIKeys(){return p.APIKeys}get contextMenu(){return p.contextMenu}get routing(){return p.routing}get language(){return p.language}get itineraryPointMarker(){return p.itineraryPointMarker}get searchPointMarker(){return p.searchPointMarker}get searchPointPolyline(){return p.searchPointPolyline}get previousSearchLimit(){return p.previousSearchLimit}get nextSearchLimit(){return p.nextSearchLimit}get wayPoint(){return p.wayPoint}get route(){return p.route}get note(){return p.note}get noteDialog(){return p.noteDialog}get itineraryPointZoom(){return p.itineraryPointZoom}get routeEditor(){return p.routeEditor}get travelEditor(){return p.travelEditor}get haveBeforeUnloadWarning(){return p.haveBeforeUnloadWarning}get overpassApi(){return p.overpassApi}get nominatim(){return p.nominatim}get geoLocation(){return p.geoLocation}get printRouteMap(){return p.printRouteMap}get haveCrypto(){return p.haveCrypto}get itineraryPane(){return p.itineraryPane}get colorDialog(){return p.colorDialog}overload(e){!function e(t,o){if("object"==typeof t&&"object"==typeof o)try{for(let a in o)"object"==typeof o[a]?e(t[a],o[a]):typeof t[a]==typeof o[a]&&("string"==typeof o[a]?o[a]="color"===a?g.sanitizeToColor(t[a])||o[a]:"url"===a?g.sanitizeToUrl(t[a]).url:g.sanitizeToJsString(t[a]):o[a]=t[a]||o[a]);for(let a in t)"object"==typeof t[a]?("[object Array]"===Object.prototype.toString.call(t[a])?o[a]=o[a]||[]:o[a]=o[a]||{},e(t[a],o[a])):"string"==typeof o.property?o[a]=g.sanitizeToHtmlString(t[a],[]).htmlString:o[a]=t[a]}catch(e){console.log(e||"Not possible to overload Config")}}(e,p),p=function e(t){for(let o in t)"object"==typeof t[o]&&(t[o]=e(t[o]));return Object.freeze(t)}(p)}};
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file HTMLElementsFactory.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/const f=Object.freeze(new class{create(e,t,o){let a=null;return"text"===e.toLowerCase()?a=document.createTextNode(t.value||""):(a=document.createElement(e),t&&function(e,t){for(let o in t)try{e[o]=t[o]}catch(e){console.log("Invalid property : "+o)}}(a,t)),o&&o.appendChild(a),a}});const v=Object.freeze(new
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file HttpRequestBuilder.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/
class{getTextPromise(e,t){return new Promise((function(o,a){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){a("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onreadystatechange=function(){4===n.readyState&&(200===n.status?o(n.responseText):a("Error XMLHttpRequest - File : "+n.responseURL))},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.overrideMimeType("text/plain"),n.send(null)}))}getJsonPromise(e,t){return new Promise((function(o,a){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){a("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){let e=null;try{e=JSON.parse(n.responseText)}catch(e){a(e.message+" File: "+n.responseURL)}o(e)}else a("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.overrideMimeType("application/json"),n.send(null)}))}getBinaryPromise(e,t){return new Promise((function(o,a){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){a("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onload=function(){if(200===n.status){let e=n.response;e?o(e):a("Error XMLHttpRequest - File : "+n.responseURL)}else a("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.responseType="arraybuffer",n.send(null)}))}});let y=0;function b(){return++y,y}
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Version.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/function w(e){const t=e;return Object.seal(new class{get name(){return t}get version(){return"2.1.0"}get jsonObject(){return{name:t,version:"2.1.0"}}validate(e){if(!Object.getOwnPropertyNames(e).includes("name"))throw new Error("No name for "+t);if(t!==e.name)throw new Error("Invalid name for "+t);if(!Object.getOwnPropertyNames(e).includes("version"))throw new Error("No version for "+t)}})}function j(e){const t=e;let o=[];const a=function(){let e=t();if(!e.objType||!e.objType.name)throw new Error("invalid object name for collection");return e.objType.name}();function n(e){if(!e.objType||!e.objType.name||e.objType.name!==a)throw new Error("invalid object name for add function");o.push(e)}function i(){let e=-1;return Object.seal({get value(){return e<o.length?o[e]:null},get previous(){return 0>=e?null:o[e-1]},get next(){return e<o.length-1?o[e+1]:null},get done(){return++e>=o.length},get first(){return 0===e},get last(){return e>=o.length-1},get index(){return e}})}function r(e){return o.findIndex(t=>t.objId===e)}function s(e,t,a){let n=r(e);if(-1===n)throw new Error("invalid objId for next or previous function");if(1!==a&&-1!==a)throw new Error("invalid direction");let i=t;for(i||(i=()=>!0),n+=a;-1<n&&n<o.length&&!i(o[n]);)n+=a;return-1===n||o.length===n?null:o[n]}return Object.seal(new class{add(e){n(e)}forEach(e){let t=null,o=i();for(;!o.done;)t=e(o.value,t);return t}getAt(e){let t=r(e);return-1===t?null:o[t]}moveTo(e,t,a){let n=r(e),i=r(t);if(-1===n||-1===i)throw new Error("invalid objId for function  myMoveTo");a||i++,o.splice(i,0,o[n]),i<n&&n++,o.splice(n,1)}next(e,t){return s(e,t,1)}previous(e,t){return s(e,t,-1)}remove(e){if(-1===r(e))throw new Error("invalid objId for remove function");o.splice(r(e),1)}removeAll(e){e?o.splice(1,o.length-2):o.length=0}replace(e,t){let n=r(e);if(-1===n)throw new Error("invalid objId for replace function");if(!t.objType||!t.objType.name||t.objType.name!==a)throw new Error("invalid object name for replace function");o[n]=t}reverse(){o.reverse()}sort(e){o.sort(e)}swap(e,t){let a=r(e);if(-1===a||0===a&&t||o.length-1===a&&!t)throw new Error("invalid objId for swap function");let n=o[a];o[a]=o[a+(t?-1:1)],o[a+(t?-1:1)]=n}get first(){return o[0]}get iterator(){return i()}get last(){return o[o.length-1]}get length(){return o.length}get jsonObject(){let e=[],t=i();for(;!t.done;)e.push(t.value.jsonObject);return e}set jsonObject(e){o.length=0;let a=null;e.forEach(e=>{a=t(),a.jsonObject=e,n(a)})}})}let T=new Map;const N=Object.freeze(new class{setTranslations(e){e.forEach(e=>T.set(e.msgid,g.sanitizeToJsString(e.msgstr)))}getText(e,t){let o=T.get(e);return t&&o&&Object.getOwnPropertyNames(t).forEach(e=>o=o.replace("{"+e+"}",t[e])),o||e}});const L=Object.freeze(new class{get UUID(){let e=new Uint16Array(8);const t=["","-","-","-","-","","",""];window.crypto.getRandomValues(e);let o="";for(let a=0;a<8;a++)o+=e[a].toString(16).padStart(4,"0")+t[a];return o}storageAvailable(e){try{let t=window[e],o="__storage_test__";return t.setItem(o,o),t.removeItem(o),!0}catch(e){return!1}}saveFile(e,t,o){try{let a=window.URL.createObjectURL(new File([t],e,{type:o||"text/plain"})),n=document.createElement("a");n.setAttribute("href",a),n.setAttribute("download",e),n.click(),window.URL.revokeObjectURL(a)}catch(e){console.log(e||"An error occurs when saving file")}}formatTime(e){let t=Math.floor(e);if(0===t)return"";let o=Math.floor(t/86400),a=Math.floor(t%86400/3600),n=Math.floor(t%3600/60),i=Math.floor(t%60);return 0<o?o+" "+N.getText("Utilities - Day")+" "+a+" "+N.getText("Utilities - Hour"):0<a?a+" "+N.getText("Utilities - Hour")+" "+n+" "+N.getText("Utilities - Minute"):0<n?n+" "+N.getText("Utilities - Minute"):i+" "+N.getText("Utilities - Second")}formatDistance(e){let t=Math.floor(e);return 0>=t?"0 km":Math.floor(t/1e3)+","+Math.floor(t%1e3/10).toFixed(0).padStart(2,"0").padEnd(3,"0")+" km"}formatLat(e){return e>0?e.toFixed(a.fixed)+" N":(-e).toFixed(a.fixed)+" S"}formatLng(e){return e>0?e.toFixed(a.fixed)+" E":(-e).toFixed(a.fixed)+" W"}formatLatLng(e){return 0===e[0]&&0===e[1]?"":this.formatLat(e[0])+" - "+this.formatLng(e[1])}}),O=w("WayPoint"),x=new WeakMap;class P{constructor(){this.name="",this.address="",this.lat=a.defaultValue,this.lng=a.defaultValue,x.set(this,b())}get fullName(){let e=""===this.name?this.address:this.name+", "+this.address;return""===e&&(e=L.formatLatLng([this.lat,this.lng])),e}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objId(){return x.get(this)}get objType(){return O}get jsonObject(){return{name:this.name,address:this.address,lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),objId:x.get(this),objType:O.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+O.name);if(O.validate(e.objType),O.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.address=e.name,e.name="";case"1.12.0":case"1.13.0":case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+O.name)}let t=Object.getOwnPropertyNames(e);return["address","name","lat","lng","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+O.name)}),e}(e);this.address=t.address||"",this.name=t.name||"",this.lat=t.lat||a.defaultValue,this.lng=t.lng||a.defaultValue,x.set(this,b()),this.validateData()}validateData(){"string"==typeof this.address?this.address=g.sanitizeToJsString(this.address):this.address="","string"==typeof this.name?this.name=g.sanitizeToJsString(this.name):this.name="","number"!=typeof this.lat&&(this.lat=a.defaultValue),"number"!=typeof this.lng&&(this.lng=a.defaultValue)}}function I(){return Object.seal(new P)}const M=w("ItineraryPoint"),A=new WeakMap;class S{constructor(){this.lat=a.defaultValue,this.lng=a.defaultValue,this.distance=e.defaultValue,this.elev=o.defaultValue,A.set(this,b())}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objType(){return M}get objId(){return A.get(this)}get jsonObject(){return{lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),distance:parseFloat(this.distance.toFixed(e.fixed)),elev:parseFloat(this.elev.toFixed(o.fixed)),objId:A.get(this),objType:M.jsonObject}}set jsonObject(t){let n=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+M.name);if(M.validate(e.objType),M.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.elev=o.defaultValue;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+M.name)}let t=Object.getOwnPropertyNames(e);return["lat","lng","distance","elev","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+M.name)}),e}(t);this.lat=n.lat||a.defaultValue,this.lng=n.lng||a.defaultValue,this.distance=n.distance||e.defaultValue,this.elev=n.elev||o.defaultValue,A.set(this,b()),this.validateData()}validateData(){"number"!=typeof this.lat&&(this.lat=a.defaultValue),"number"!=typeof this.lng&&(this.lng=a.defaultValue),"number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.elev&&(this.elev=o.defaultValue)}}function E(){return Object.seal(new S)}const C=w("Maneuver"),H=new WeakMap;class D{constructor(){this.iconName="",this.instruction="",this.itineraryPointObjId=-1,this.distance=e.defaultValue,this.duration=e.defaultValue,H.set(this,b())}get objType(){return C}get objId(){return H.get(this)}get jsonObject(){return{iconName:this.iconName,instruction:this.instruction,distance:parseFloat(this.distance.toFixed(e.fixed)),duration:this.duration,itineraryPointObjId:this.itineraryPointObjId,objId:H.get(this),objType:C.jsonObject}}set jsonObject(t){let o=function(t){if(!Object.getOwnPropertyNames(t).includes("objType"))throw new Error("No objType for "+C.name);if(C.validate(t.objType),C.version!==t.objType.version)switch(t.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":"kArriveDefault"===t.iconName&&(t.distance=e.defaultValue);case"1.12.0":case"1.13.0":case"2.0.0":t.objType.version="2.1.0";break;default:throw new Error("invalid version for "+C.name)}let o=Object.getOwnPropertyNames(t);return["iconName","instruction","distance","duration","itineraryPointObjId","objId"].forEach(e=>{if(!o.includes(e))throw new Error("No "+e+" for "+C.name)}),t}(t);this.iconName=o.iconName||"",this.instruction=o.instruction||"",this.distance=o.distance||e.defaultValue,this.duration=o.duration||e.defaultValue,this.itineraryPointObjId=o.itineraryPointObjId||-1,H.set(this,b()),this.validateData()}validateData(){"string"==typeof this.iconName?this.iconName=g.sanitizeToJsString(this.iconName):this.iconName="","string"==typeof this.instruction?this.instruction=g.sanitizeToJsString(this.instruction):this.instruction="","number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.duration&&(this.duration=e.defaultValue),"number"!=typeof this.itineraryPointObjId&&(this.itineraryPointObjId=-1)}}function R(){return Object.seal(new D)}const z=w("Itinerary"),V=new WeakMap;class F{constructor(){this.hasProfile=!1,this.ascent=0,this.descent=0,this.provider="",this.transitMode="",this.itineraryPoints=j(E),this.maneuvers=j(R),V.set(this,b())}get objType(){return z}get objId(){return V.get(this)}get jsonObject(){return{hasProfile:this.hasProfile,ascent:this.ascent,descent:this.descent,itineraryPoints:this.itineraryPoints.jsonObject,maneuvers:this.maneuvers.jsonObject,provider:this.provider,transitMode:this.transitMode,objId:V.get(this),objType:z.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+z.name);if(z.validate(e.objType),z.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.hasProfile=!1,e.ascent=0,e.descent=0;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+z.name)}let t=Object.getOwnPropertyNames(e);return["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+z.name)}),e}(e);this.hasProfile=t.hasProfile||!1,this.ascent=t.ascent||0,this.descent=t.descent||0,this.itineraryPoints.jsonObject=t.itineraryPoints||[],this.maneuvers.jsonObject=t.maneuvers||[],this.provider=t.provider||"",this.transitMode=t.transitMode||"",V.set(this,b());let o=new Map,a=0,n=this.itineraryPoints.iterator;for(;!n.done;)o.set(t.itineraryPoints[a].objId,n.value.objId),a++;let i=this.maneuvers.iterator;for(;!i.done;)i.value.itineraryPointObjId=o.get(i.value.itineraryPointObjId);this.validateData()}validateData(){"boolean"!=typeof this.hasProfile&&(this.hasProfile=!1),"number"!=typeof this.ascent&&(this.ascent=0),"number"!=typeof this.descent&&(this.descent=0),"string"==typeof this.provider?this.provider=g.sanitizeToJsString(this.provider):this.provider="","string"==typeof this.transitMode?this.transitMode=g.sanitizeToJsString(this.transitMode):this.transitMode=""}}function k(){return Object.seal(new F)}const U=w("Note"),W=new WeakMap;function B(e){return e.replaceAll(/style='color:white;background-color:red'/g,"class='TravelNotes-Note-WhiteRed'").replaceAll(/style='color:white;background-color:green'/g,"class='TravelNotes-Note-WhiteGreen'").replaceAll(/style='color:white;background-color:blue'/g,"class='TravelNotes-Note-WhiteBlue'").replaceAll(/style='color:white;background-color:brown'/g,"class='TravelNotes-Note-WhiteBrown'").replaceAll(/style='color:white;background-color:black'/g,"class='TravelNotes-Note-WhiteBlack'").replaceAll(/style='border:solid 0.1em'/g,"class='TravelNotes-Note-BlackWhite'").replaceAll(/style='background-color:white;'/g,"class='TravelNotes-Note-Knooppunt'").replaceAll(/style='fill:green;font:bold 120px sans-serif;'/g,"").replaceAll(/style='fill:none;stroke:green;stroke-width:10;'/g,"")}class q{constructor(){this.iconHeight=0,this.iconWidth=0,this.iconContent="",this.popupContent="",this.tooltipContent="",this.phone="",this.url="",this.address="",this.iconLat=a.defaultValue,this.iconLng=a.defaultValue,this.lat=a.defaultValue,this.lng=a.defaultValue,this.distance=e.invalid,this.chainedDistance=e.defaultValue,W.set(this,b())}get isRouteNote(){return this.distance!==e.invalid}get iconLatLng(){return[this.iconLat,this.iconLng]}set iconLatLng(e){this.iconLat=e[0],this.iconLng=e[1]}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objType(){return U}get objId(){return W.get(this)}get jsonObject(){return{iconHeight:this.iconHeight,iconWidth:this.iconWidth,iconContent:this.iconContent,popupContent:this.popupContent,tooltipContent:this.tooltipContent,phone:this.phone,url:this.url,address:this.address,iconLat:parseFloat(this.iconLat.toFixed(a.fixed)),iconLng:parseFloat(this.iconLng.toFixed(a.fixed)),lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),distance:parseFloat(this.distance.toFixed(e.fixed)),chainedDistance:parseFloat(this.chainedDistance.toFixed(e.fixed)),objId:W.get(this),objType:U.jsonObject}}set jsonObject(t){let o=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+U.name);if(U.validate(e.objType),U.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":"string"==typeof e.iconHeight&&(e.iconHeight=Number.parseInt(e.iconHeight)),"string"==typeof e.iconWidth&&(e.iconWidth=Number.parseInt(e.iconWidth)),e.iconContent=B(e.iconContent),e.popupContent=B(e.popupContent),e.tooltipContent=B(e.tooltipContent),e.phone=B(e.phone),e.address=B(e.address);case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+U.name)}let t=Object.getOwnPropertyNames(e);return["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+U.name)}),e}(t);this.iconHeight=o.iconHeight||0,this.iconWidth=o.iconWidth||0,this.iconContent=o.iconContent||"",this.popupContent=o.popupContent||"",this.tooltipContent=o.tooltipContent||"",this.phone=o.phone||"",this.url=o.url||"",this.address=o.address||"",this.iconLat=o.iconLat||a.defaultValue,this.iconLng=o.iconLng||a.defaultValue,this.lat=o.lat||a.defaultValue,this.lng=o.lng||a.defaultValue,this.distance=o.distance||e.invalid,this.chainedDistance=o.chainedDistance||e.defaultValue,W.set(this,b()),this.validateData(!0)}validateData(t){if("number"!=typeof this.iconHeight&&(this.iconHeight=0),"number"!=typeof this.iconWidth&&(this.iconWidth=0),"string"==typeof this.iconContent){let e=g.sanitizeToHtmlString(this.iconContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.iconContent+")"),this.iconContent=e.htmlString}else this.iconContent="";if("string"==typeof this.popupContent){let e=g.sanitizeToHtmlString(this.popupContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.popupContent+")"),this.popupContent=e.htmlString}else this.popupContent="";if("string"==typeof this.tooltipContent){let e=g.sanitizeToHtmlString(this.tooltipContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.tooltipContent+")"),this.tooltipContent=e.htmlString}else this.tooltipContent="";if("string"==typeof this.phone){let e=g.sanitizeToHtmlString(this.phone);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.phone+")"),this.phone=e.htmlString}else this.phone="";if("string"==typeof this.url&&""!==this.url){let e=g.sanitizeToUrl(this.url);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.url+")"),this.url=encodeURI(e.url)}else this.url="";"string"==typeof this.address?this.address=g.sanitizeToHtmlString(this.address).htmlString:this.address="","number"!=typeof this.iconLat&&(this.iconLat=a.defaultValue),"number"!=typeof this.iconLng&&(this.iconLng=a.defaultValue),"number"!=typeof this.lat&&(this.lat=a.defaultValue),"number"!=typeof this.lng&&(this.lng=a.defaultValue),"number"!=typeof this.distance&&(this.distance=e.invalid),"number"!=typeof this.chainedDistance&&(this.chainedDistance=e.defaultValue)}}function Z(){return Object.seal(new q)}const _=w("Route"),J=new WeakMap;class X{constructor(){this.name="",this.wayPoints=j(I),this.wayPoints.add(I()),this.wayPoints.add(I()),this.notes=j(Z),this.itinerary=k(),this.width=m.route.width,this.color=m.route.color,this.dashArray=m.route.dashArray,this.chain=!1,this.chainedDistance=e.defaultValue,this.distance=e.defaultValue,this.duration=e.defaultValue,this.editionStatus=n.notEdited,this.hidden=!1,J.set(this,b())}get computedName(){let e=this.name;return""===e&&(e=(""===this.wayPoints.first.fullName?"???":this.wayPoints.first.fullName)+" ⮞ "+(""===this.wayPoints.last.fullName?"???":this.wayPoints.last.fullName)),e}get objId(){return J.get(this)}get objType(){return _}get jsonObject(){return{name:this.name,wayPoints:this.wayPoints.jsonObject,notes:this.notes.jsonObject,itinerary:this.itinerary.jsonObject,width:this.width,color:this.color,dashArray:this.dashArray,chain:this.chain,distance:parseFloat(this.distance.toFixed(e.fixed)),duration:this.duration,editionStatus:this.editionStatus,hidden:this.hidden,chainedDistance:parseFloat(this.chainedDistance.toFixed(e.fixed)),objId:J.get(this),objType:_.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+_.name);if(_.validate(e.objType),_.version!==e.objType.version)switch(e.objType.version){case"1.0.0":e.dashArray=0,e.hidden=!1;case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.edited=n.notEdited;case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.editionStatus=e.edited;case"1.12.0":case"1.13.0":case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+_.name)}let t=Object.getOwnPropertyNames(e);return["name","wayPoints","notes","itinerary","width","color","dashArray","chain","distance","duration","editionStatus","hidden","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+_.name)}),e}(e);this.name=t.name||"",this.wayPoints.jsonObject=t.wayPoints||[],this.notes.jsonObject=t.notes||[],this.itinerary.jsonObject=t.itinerary||k().jsonObject,this.width=t.width||m.route.width,this.color=t.color||"#000000",this.dashArray=t.dashArray||0,this.chain=t.chain||!1,this.distance=t.distance,this.duration=t.duration,this.editionStatus=t.editionStatus||n.notEdited,this.hidden=t.hidden||!1,this.chainedDistance=t.chainedDistance,J.set(this,b()),this.validateData()}validateData(){"string"==typeof this.name?this.name=g.sanitizeToJsString(this.name):this.name="","number"!=typeof this.width&&(this.width=m.route.width),"string"==typeof this.color?this.color=g.sanitizeToColor(this.color)||m.route.color:this.color=m.route.color,"number"!=typeof this.dashArray&&(this.dashArray=0),this.dashArray>=m.route.dashChoices.length&&(this.dashArray=0),"boolean"!=typeof this.chain&&(this.chain=!1),"number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.duration&&(this.duration=e.defaultValue),"number"!=typeof this.editionStatus&&(this.editionStatus=n.notEdited),"boolean"!=typeof this.hidden&&(this.hidden=!1),"number"!=typeof this.chainedDistance&&(this.chainedDistance=e.defaultValue)}}function G(){return Object.seal(new X)}const K=w("Travel"),$=new WeakMap;class Q{constructor(){this.editedRoute=G(),this.routes=j(G),this.notes=j(Z),this.layerName="OSM - Color",this.name="",this.readOnly=!1,$.set(this,b())}get objId(){return $.get(this)}get objType(){return K}get jsonObject(){return{editedRoute:this.editedRoute.jsonObject,layerName:this.layerName,name:this.name,routes:this.routes.jsonObject,notes:this.notes.jsonObject,readOnly:this.readOnly,objId:$.get(this),objType:K.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+K.name);if(K.validate(e.objType),K.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.editedRoute=G();case"1.5.0":if(e.userData.layerId){let t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"Lantmäteriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find(t=>t.layerId===e.userData.layerId);e.layerName=t?t.layerName:"OSM - Color"}else e.layerName="OSM - Color";case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+K.name)}let t=Object.getOwnPropertyNames(e);return["name","editedRoute","routes","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+K.name)}),e}(e);this.editedRoute.jsonObject=t.editedRoute,this.layerName=e.layerName||"OSM - Color",this.name=t.name||"",this.readOnly=t.readOnly||!1,this.routes.jsonObject=t.routes||[],this.notes.jsonObject=t.notes||[],$.set(this,b()),this.validateData()}validateData(){"string"==typeof this.layerName?this.layerName=g.sanitizeToJsString(this.layerName):this.layerName="OSM - Color","string"==typeof this.name?this.name=g.sanitizeToJsString(this.name):this.name="TravelNotes","boolean"!=typeof this.readOnly&&(this.readOnly=!0)}}function Y(){return Object.seal(new Q)}let ee=new Map,te=new Map,oe=Object.seal({provider:"",transitMode:""}),ae=L.UUID;const ne=Object.seal(new class{constructor(){this.map=null,this.travel=Y(),this.editedRouteObjId=-1,this.searchData=[]}get providers(){return ee}get mapObjects(){return te}get routing(){return oe}get UUID(){return ae}});const ie=Object.seal(new class{getRoute(e){let t=null;return t=ne.travel.routes.getAt(e),t||e===ne.travel.editedRoute.objId&&(t=ne.travel.editedRoute),t}getNoteAndRoute(e){let t=null,o=null;if(t=ne.travel.notes.getAt(e),!t){let a=ne.travel.routes.iterator;for(;!a.done&&!t;)t=a.value.notes.getAt(e),t&&(o=a.value);t||(t=ne.travel.editedRoute.notes.getAt(e),t&&(o=ne.travel.editedRoute))}return Object.freeze({note:t,route:o})}getWayPoint(e){let t=ne.travel.editedRoute.wayPoints.getAt(e);if(!t){let o=ne.travel.routes.iterator;for(;!o.done&&!t;)t=o.value.wayPoints.getAt(e)}return t}}),re=Math.PI/180;const se=Object.freeze(new class{getLatLngElevAtDist(e,t){if(e.distance<=t||0>=t)return null;let o=0,a=e.itinerary.itineraryPoints.iterator;for(;o<t&&!a.done;)o+=a.value.distance;let n=a.value;a.done;let i=(n.distance-o+t)/n.distance;return Object.freeze({latLng:[n.lat+(a.value.lat-n.lat)*i,n.lng+(a.value.lng-n.lng)*i],elev:n.elev+(a.value.elev-n.elev)*i,ascent:100*(a.value.elev-n.elev)/n.distance,routeDistance:t})}getClosestLatLngDistance(t,o){if(0===t.itinerary.itineraryPoints.length)return null;let a=t.itinerary.itineraryPoints.iterator;a.done;let n=Number.MAX_VALUE,i=window.L.Projection.SphericalMercator.project(window.L.latLng(o[0],o[1])),r=window.L.Projection.SphericalMercator.project(window.L.latLng(a.value.lat,a.value.lng)),s=null,l=e.defaultValue,c=a.value.distance;for(;!a.done;){let e=window.L.Projection.SphericalMercator.project(window.L.latLng(a.value.lat,a.value.lng)),t=window.L.LineUtil.pointToSegmentDistance(i,r,e);t<n&&(n=t,s=window.L.Projection.SphericalMercator.unproject(window.L.LineUtil.closestPointOnSegment(i,r,e)),l=c-s.distanceTo(window.L.latLng(a.value.lat,a.value.lng))),c+=a.value.distance,r=e}return Object.freeze({latLng:[s.lat,s.lng],distance:l})}getLatLngBounds(e){let t=window.L.latLng([90,180]),o=window.L.latLng([-90,-180]);return e.forEach(e=>{t.lat=Math.min(t.lat,e[0]),t.lng=Math.min(t.lng,e[1]),o.lat=Math.max(o.lat,e[0]),o.lng=Math.max(o.lng,e[1])}),window.L.latLngBounds(t,o)}getSquareBoundingBox(e,t){let o=t/6371e3/re,a=e[0]*re,n=Math.acos((Math.cos(t/6371e3)-Math.sin(a)**2)/Math.cos(a)**2)/re;return window.L.latLngBounds(window.L.latLng([e[0]-o,e[1]-n]),window.L.latLng([e[0]+o,e[1]+n]))}project(e,t){let o=ne.map.project(window.L.latLng(e),t);return[o.x,o.y]}screenCoordToLatLng(e,t){let o=ne.map.containerPointToLatLng(window.L.point(e,t));return[o.lat,o.lng]}addPoints(e,t){return[e[0]+t[0],e[1]+t[1]]}subtrackPoints(e,t){return[e[0]-t[0],e[1]-t[1]]}});function le(){let e=null,t=1,o=1,a=Number.MAX_VALUE,n=0,r=0,l=null,c=0,d=m.route.elev.smoothCoefficient,u=m.route.elev.smoothPoints;function h(){let e=function(){let e=0,t=0,o=[],a=l.itinerary.itineraryPoints.iterator,n=0,i=a.done;for(o.push({distance:e,elev:a.value.elev}),n+=a.value.distance,i=a.done;!i;){for(e+=c;e>=n&&!i;)n+=a.value.distance,i=a.done;if(!i){let i=(a.value.elev-a.previous.elev)/a.previous.distance;t=a.value.elev-(n-e)*i,o.push({distance:e,elev:t})}}return o.push({distance:n,elev:l.itinerary.itineraryPoints.last.elev}),o}(),t=new Map,o=(e[u].elev-e[0].elev)/u,a=0;for(a=0;a<u;a++)t.set(a*c,{distance:a*c,elev:e[0].elev+o*a});for(a=u;a<e.length-u;a++){let o=0;for(let t=a-u;a+u>=t;t++)o+=e[t].elev;t.set(e[a].distance,{distance:e[a].distance,elev:o/(2*u+1)})}return a--,o=c*(e[e.length-1].elev-e[e.length-1-u].elev)/(e[e.length-1].distance-e[e.length-1-u].distance),t.set(e[a].distance+c,{distance:e[a].distance+c,elev:e[a].elev+o}),t.set(e[a].distance+2*c,{distance:e[a].distance+2*c,elev:e[a].elev+2*o}),t}function g(c){return l=c,a=Number.MAX_VALUE,n=0,l.itinerary.itineraryPoints.forEach(e=>{n=Math.max(n,e.elev),a=Math.min(a,e.elev)}),r=n-a,t=i.height/r,o=i.width/l.distance,e=document.createElementNS(s,"svg"),e.setAttributeNS(null,"viewBox","0 0 "+(i.width+2*i.margin)+" "+(i.height+2*i.margin)),e.setAttributeNS(null,"class","TravelNotes-SvgProfile"),function(){let a="",r=0,c=0,d=0;l.itinerary.itineraryPoints.forEach(e=>{c=(i.margin+o*r).toFixed(0),d=(i.margin+t*(n-e.elev)).toFixed(0),a+=c+","+d+" ",r+=e.distance});let u=document.createElementNS(s,"polyline");u.setAttributeNS(null,"points",a),u.setAttributeNS(null,"class","TravelNotes-SvgProfile-profilePolyline"),e.appendChild(u)}(),function(){const t=i.margin.toFixed(0),o=(i.margin+i.height).toFixed(0),a=(i.margin+i.width).toFixed(0),n=i.margin.toFixed(0);let r=t+","+n+" "+t+","+o+" "+a+","+o+" "+a+","+n,l=document.createElementNS(s,"polyline");l.setAttributeNS(null,"points",r),l.setAttributeNS(null,"class","TravelNotes-SvgProfile-framePolyline"),e.appendChild(l)}(),function(){let o=Number.MAX_VALUE,l=0;i.vScales.forEach(e=>{let t=Math.abs(r/4-e);t<o&&(o=t,l=e)});let c=Math.ceil(a/l)*l;const d=(i.margin+i.width+i.xDeltaText).toFixed(0),u=(i.margin-i.xDeltaText).toFixed(0);for(;c<n;){let o=i.margin+(n-c)*t,a=document.createElementNS(s,"text");a.appendChild(document.createTextNode(c.toFixed(0))),a.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),a.setAttributeNS(null,"x",d),a.setAttributeNS(null,"y",o),a.setAttributeNS(null,"text-anchor","start"),e.appendChild(a);let r=document.createElementNS(s,"text");r.appendChild(document.createTextNode(c.toFixed(0))),r.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),r.setAttributeNS(null,"x",u),r.setAttributeNS(null,"y",o),r.setAttributeNS(null,"text-anchor","end"),e.appendChild(r),c+=l}}(),function(){const t=i.margin+i.height+i.margin/2;let a=Number.MAX_VALUE,n=0;i.hScales.forEach(e=>{let t=Math.abs(l.distance/8-e);t<a&&(a=t,n=e)});let r=Math.ceil(l.chainedDistance/n)*n;for(;r<l.distance+l.chainedDistance;){let a=document.createElementNS(s,"text");a.appendChild(document.createTextNode(1e3<n||0<l.chainedDistance?r/1e3+" km":r+" m ")),a.setAttributeNS(null,"class","TravelNotes-SvgProfile-distLegend"),a.setAttributeNS(null,"x",i.margin+(r-l.chainedDistance)*o),a.setAttributeNS(null,"y",t),a.setAttributeNS(null,"text-anchor","start"),e.appendChild(a),r+=n}}(),e}return Object.seal(new class{smooth(e){!function(e){l=e;let t=l.itinerary.itineraryPoints.iterator,o=0,a=0;for(;!t.done;)o+=t.value.distance,a+=t.next?Math.abs(t.value.elev-t.next.elev):0;if(c=10*Math.floor(d/(a/o)),o<=2*u*c)return;let n=h();t=l.itinerary.itineraryPoints.iterator,t.done;let i=t.value.distance;for(;!t.done;){let e=n.get(Math.floor(i/c)*c),o=n.get(Math.ceil(i/c)*c);if(e&&o){let a=i-e.distance,n=(o.elev-e.elev)/(o.distance-e.distance);t.value.elev=e.elev+a*n}i+=t.value.distance}}(e)}createSvg(e){return g(e)}})}function ce(e,t){let o=t.note,a=f.create("div");if(0!==o.tooltipContent.length&&g.sanitizeToHtmlElement(o.tooltipContent,f.create("div",{className:e+"NoteHtml-TooltipContent"},a)),0!==o.popupContent.length&&g.sanitizeToHtmlElement(o.popupContent,f.create("div",{className:e+"NoteHtml-PopupContent"},a)),0!==o.address.length&&g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Address")+"</span> : "+o.address,f.create("div",{className:e+"NoteHtml-Address"},a)),0!==o.url.length&&g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Link")+"<a href="+o.url+' target="_blank" >'+o.url.substr(0,40)+"...</a>",f.create("div",{className:e+"NoteHtml-Url"},a)),0!==o.phone.length){let t=o.phone;if(o.phone.match(/^\+[0-9, ,*,#]*$/)){let e=o.phone.replaceAll(/\u0020/g,""),a=o.phone.replaceAll(/\u0020/g," ");t=N.getText("HTMLViewsFactory - Phone")+" : "+N.getText("HTMLViewsFactory - call")+'<a target="_blank" href="tel:'+e+'" >'+a+"</a>"+N.getText("HTMLViewsFactory - Send a sms to")+'<a target="_blank" href="sms:'+e+'" >'+a+"</a>"}else t=N.getText("HTMLViewsFactory - Phone")+" : "+o.phone;g.sanitizeToHtmlElement(t,f.create("div",{className:e+"NoteHtml-Phone"},a))}if(g.sanitizeToHtmlElement(L.formatLatLng(o.latLng),f.create("div",{className:e+"NoteHtml-LatLng"},a)),t.route){t.route.chain&&g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of travel")+"</span> : "+L.formatDistance(o.chainedDistance+o.distance),f.create("div",{className:e+"NoteHtml-Distance"},a)),g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of route")+"</span> : "+L.formatDistance(o.distance),f.create("div",{className:e+"NoteHtml-Distance"},a));let n=t.route.notes.next(o.objId);if(n){let t=n.distance-o.distance;9<t&&g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Next note after")+"</span> : "+L.formatDistance(t),f.create("div",{className:e+"NoteHtml-NextDistance"},a))}}return a}function de(e,t){let o=f.create("div"),a=f.create("div",{className:e+"Travel-Notes-IconCell"},o);g.sanitizeToHtmlElement(t.note.iconContent,a),a.style.width=String(t.note.iconWidth)+"px",a.style.height=String(t.note.iconHeight)+"px","TravelNotes-Roadbook-"===e&&a.firstChild&&("svg"===a.firstChild.tagName?(a.firstChild.setAttributeNS(null,"viewBox","0 0 "+r.svgViewboxDim+" "+r.svgViewboxDim),a.style.width=String(t.note.iconWidth*m.note.svgRoadbookDimCoef)+"px",a.style.height=String(t.note.iconWidth*m.note.svgRoadbookDimCoef)+"px"):a.firstChild.classList.contains("TravelNotes-MapNoteCategory-0073")&&(a.style.width=String(t.note.iconWidth*m.note.svgRoadbookDimCoef)+"px",a.style.height=String(t.note.iconWidth*m.note.svgRoadbookDimCoef)+"px"));let n=ce(e,t);return n.className=e+"Travel-Notes-Cell",o.appendChild(n),o.noteObjId=t.note.objId,o}function ue(e){let t=f.create("div",{className:e+"Travel-Notes"}),o=ne.travel.notes.iterator;for(;!o.done;){let a=de(e,{note:o.value,route:null});a.className=e+"Travel-Notes-Row",t.appendChild(a)}return t}function he(e,t){let o=f.create("div",{className:e+"Route-Header",id:"route"+t.objId});return g.sanitizeToHtmlElement(t.computedName,f.create("div",{className:e+"Route-Header-Name"},o)),0!==t.distance&&g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Route distance",{distance:L.formatDistance(t.distance)}),f.create("div",{className:e+"Route-Header-Distance"},o)),ne.travel.readOnly||"bike"===t.itinerary.transitMode||g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Duration",{duration:L.formatTime(t.duration)}),f.create("div",{className:e+"Route-Header-Duration"},o)),t.itinerary.hasProfile&&(g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Ascent",{ascent:t.itinerary.ascent.toFixed(0)}),f.create("div",{className:e+"Route-Header-Ascent"},o)),g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Descent",{descent:t.itinerary.descent.toFixed(0)}),f.create("div",{className:e+"Route-Header-Descent"},o))),o}function ge(t,o){let a=f.create("div");f.create("div",{className:t+"Route-ManeuversAndNotes-IconCell TravelNotes-ManeuverNote-"+o.maneuver.iconName},a);let n=f.create("div",{className:t+"Route-ManeuversAndNotes-Cell"},a);return g.sanitizeToHtmlElement(o.maneuver.instruction,f.create("div",null,n)),o.route.chain&&g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of travel")+"</span> : "+L.formatDistance(o.route.chainedDistance+o.maneuverDistance),f.create("div",null,n)),g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of route")+"</span> : "+L.formatDistance(o.maneuverDistance),f.create("div",null,n)),e.defaultValue<o.maneuver.distance&&g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Next maneuver after")+"</span> : "+L.formatDistance(o.maneuver.distance),f.create("div",null,n)),a}function pe(e,t){let o=[],a=t.notes.iterator;for(;!a.done;){let n=de(e,{note:a.value,route:t});n.className=e+"Route-Notes-Row",n.objId=b(),n.latLng=a.value.latLng,n.noteObjId=a.value.objId,n.distance=a.value.distance,o.push(n)}let n=t.itinerary.maneuvers.iterator,i=0;for(;!n.done;){let a=ge(e,{route:t,maneuver:n.value,maneuverDistance:i});a.className=e+"Route-Maneuvers-Row",a.objId=b(),a.latLng=t.itinerary.itineraryPoints.getAt(n.value.itineraryPointObjId).latLng,a.maneuverObjId=n.value.objId,a.distance=i,o.push(a),i+=n.value.distance}o.sort((e,t)=>e.distance-t.distance);let r=f.create("div",{className:e+"Route-ManeuversAndNotes"});return o.forEach(e=>r.appendChild(e)),r}function me(e,t){let o="";""!==t.itinerary.provider&&""!==t.itinerary.transitMode&&(o=N.getText("HTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:t.itinerary.provider,transitMode:N.getText("HTMLViewsFactory - TransitMode "+t.itinerary.transitMode)}));let a=f.create("div",{className:e+"RouteFooter"});return g.sanitizeToHtmlElement(o,a),a}function fe(e,t){let o=f.create("div",{className:e+"RouteProfile"});return g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Profile"),o),o.appendChild(le().createSvg(t)),o}function ve(t){let o=f.create("div",{className:t+"Travel"});o.appendChild(function(t){let o=f.create("div",{className:t+"Travel-Header"});g.sanitizeToHtmlElement(ne.travel.name,f.create("div",{className:t+"Travel-Header-Name"},o));let a=e.defaultValue,n=0,i=0,r=ne.travel.routes.iterator;for(;!r.done;){let e=r.value.objId===ne.editedRouteObjId&&m.routeEditor.displayEditionInHTMLPage?ne.travel.editedRoute:r.value;g.sanitizeToHtmlElement('<a href="#route'+e.objId+'" >'+e.computedName+"</a> : "+L.formatDistance(e.distance)+".",f.create("div",{className:t+"Travel-Header-RouteName"},o)),e.chain&&(a+=e.distance,n+=e.itinerary.ascent,i+=e.itinerary.descent)}return g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Travel distance",{distance:L.formatDistance(a)}),f.create("div",{className:t+"Travel-Header-TravelDistance"},o)),0!==n&&g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Travel ascent",{ascent:n.toFixed(0)}),f.create("div",{className:t+"Travel-Header-TravelAscent"},o)),0!==i&&g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Travel descent",{descent:i.toFixed(0)}),f.create("div",{className:t+"Travel-Header-TravelDescent"},o)),o}(t)),o.appendChild(ue(t));let a=ne.travel.routes.iterator;for(;!a.done;){let e=m.routeEditor.displayEditionInHTMLPage&&a.value.objId===ne.editedRouteObjId?ne.travel.editedRoute:a.value;o.appendChild(he(t,e)),e.itinerary.hasProfile&&o.appendChild(fe(t,e)),o.appendChild(pe(t,e)),o.appendChild(me(t,e))}return o.appendChild(function(e){let t=N.getText("HTMLViewsFactory - Travel footer")+'<a href="https://github.com/wwwouaiebe/leaflet.TravelNotes" target="_blank" title="https://github.com/wwwouaiebe/leaflet.TravelNotes" >Travel & Notes</a>, © <a href="https://www.ouaie.be/" target="_blank" title="https://www.ouaie.be/" >wwwouaiebe 2017 2021</a> © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="https://www.openstreetmap.org/copyright">'+N.getText("HTMLViewsFactory - OpenStreetMap contributors")+"</a>",o=f.create("div",{className:e+"TravelFooter"});return g.sanitizeToHtmlElement(t,o),o}(t)),o}const ye=Object.freeze(new class{getTravelHTML(e){return ve(e)}getNoteTextAndIconHTML(e,t){return de(e,t)}getNoteTextHTML(e,t){return ce(e,t)}getEditedRouteManeuversAndNotesHTML(e){return pe(e,ne.travel.editedRoute)}getTravelNotesHTML(e){return ue(e)}getRouteHeaderHTML(e,t){return he(e,t)}});let be=null,we=null;function je(e){let t=ie.getRoute(e.target.objId),o=se.getClosestLatLngDistance(t,[e.latlng.lat,e.latlng.lng]).distance;o+=t.chainedDistance,o=L.formatDistance(o);let a=ne.mapObjects.get(e.target.objId);a.closeTooltip();let n=t.computedName;ne.travel.readOnly||(n+=0===n.length?"":" - ",n+=o),a.setTooltipContent(n),a.openTooltip(e.latlng)}function Te(e,t){t.objId=e,t.addTo(ne.map),ne.mapObjects.set(e,t)}function Ne(e){let t=ie.getNoteAndRoute(e).note,o=window.L.marker(t.latLng,{icon:window.L.divIcon({iconSize:[m.note.grip.size,m.note.grip.size],iconAnchor:[m.note.grip.size/2,m.note.grip.size/2],html:"<div></div>",className:"TravelNotes-Note-Bullet"}),opacity:m.note.grip.opacity,draggable:!ne.travel.readOnly});o.objId=t.objId;let a=window.L.divIcon({iconSize:[t.iconWidth,t.iconHeight],iconAnchor:[t.iconWidth/2,t.iconHeight/2],popupAnchor:[0,-t.iconHeight/2],html:t.iconContent,className:"TravelNotes-AllNotes "});let n=window.L.marker(t.iconLatLng,{zIndexOffset:100,icon:a,draggable:!ne.travel.readOnly});n.objId=t.objId,n.bindPopup(e=>ye.getNoteTextHTML("TravelNotes-",ie.getNoteAndRoute(e.objId))),0!==t.tooltipContent.length&&(n.bindTooltip(e=>ie.getNoteAndRoute(e.objId).note.tooltipContent),n.getTooltip().options.offset[0]=t.iconWidth/2);let i=window.L.polyline([t.latLng,t.iconLatLng],m.note.polyline);i.objId=t.objId;let r=window.L.layerGroup([n,i,o]);return r.markerId=window.L.Util.stamp(n),r.polylineId=window.L.Util.stamp(i),r.bulletId=window.L.Util.stamp(o),Te(t.objId,r),m.note.haveBackground&&document.querySelectorAll(".TravelNotes-MapNote,.TravelNotes-SvgIcon").forEach(e=>e.classList.add("TravelNotes-MapNote-Background")),Object.freeze({marker:n,polyline:i,bullet:o})}function Le(e){e.dashArray>=m.route.dashChoices.length&&(e.dashArray=0);let t=m.route.dashChoices[e.dashArray].iDashArray;if(t){let o="",a=0;for(a=0;a<t.length-1;a++)o+=t[a]*e.width+",";return o+=t[a]*e.width,o}return null}const Oe=Object.seal(new class{addRoute(e){let t=ie.getRoute(e),o=[],a=t.itinerary.itineraryPoints.iterator;for(;!a.done;)o.push(a.value.latLng);let i=window.L.polyline(o,{color:t.color,weight:t.width,dashArray:Le(t)});Te(t.objId,i),n.notEdited===t.editionStatus&&(i.bindTooltip(t.computedName,{sticky:!0,direction:"right"}),i.on("mouseover",je),i.on("mousemove",je)),i.bindPopup(e=>{let t=ie.getRoute(e.objId);return ye.getRouteHeaderHTML("TravelNotes-UI-",t)}),window.L.DomEvent.on(i,"click",e=>e.target.openPopup(e.latlng));let r=t.notes.iterator;for(;!r.done;)Ne(r.value.objId);return t}addNote(e){return Ne(e)}getDashArray(e){return Le(e)}zoomTo(e,t){if(t){let e=[];t.forEach(t=>e=e.concat(t)),ne.map.fitBounds(se.getLatLngBounds(e))}else ne.map.setView(e,m.itineraryPointZoom)}setLayer(e,t){let o=null;o="wmts"===e.service.toLowerCase()?window.L.tileLayer(t):window.L.tileLayer.wms(t,e.wmsOptions),be&&ne.map.removeLayer(be),ne.map.addLayer(o),be=o,ne.travel.readOnly||(ne.map.getZoom()<(e.minZoom||0)&&ne.map.setZoom(e.minZoom||0),ne.map.setMinZoom(e.minZoom||0),ne.map.getZoom()>(e.maxZoom||18)&&ne.map.setZoom(e.maxZoom||18),ne.map.setMaxZoom(e.maxZoom||18),e.bounds?(ne.map.getBounds().intersects(e.bounds)&&!ne.map.getBounds().contains(e.bounds)||(ne.map.setMaxBounds(null),ne.map.fitBounds(e.bounds),ne.map.setZoom(e.minZoom||0)),ne.map.setMaxBounds(e.bounds)):ne.map.setMaxBounds(null)),ne.map.fire("baselayerchange",o)}onGeolocationStatusChanged(e){t.active!==e&&we&&(ne.map.removeLayer(we),we=null)}onGeolocationPositionChanged(e){let t=m.geoLocation.zoomToPosition;we&&(ne.map.removeLayer(we),t=!1),we=window.L.circleMarker(window.L.latLng(e.coords.latitude,e.coords.longitude),{radius:m.geoLocation.radius,color:m.geoLocation.color}).bindTooltip(L.formatLatLng([e.coords.latitude,e.coords.longitude])).addTo(ne.map),t&&ne.map.setView(window.L.latLng(e.coords.latitude,e.coords.longitude),m.geoLocation.zoomFactor)}});const xe=Object.freeze(new class{dispatch(e,t){let o=function(e){return-1<["showitinerary","updateitinerary","showtravelnotes","updatetravelnotes","showsearch","updatesearch","setrouteslist","setprovider","providersadded","travelnameupdated","settransitmode"].indexOf(e)?document.getElementById("TravelNotes-UI-MainDiv"):-1<["removeobject","removeallobjects","zoomto","additinerarypointmarker","addsearchpointmarker","addrectangle","addwaypoint","layerchange","geolocationstatuschanged","geolocationpositionchanged","routeupdated","routepropertiesupdated","noteupdated","roadbookupdate","profileclosed"].indexOf(e)?document:null}(e);if(o){let a=new Event(e);t&&(a.data=t),o.dispatchEvent(a)}}});function Pe(e){return Math.floor(Math.abs(e)+.5)*(0<=e?1:-1)}const Ie=Object.freeze(new class{encode(e,t){if(!e.length)return"";let o=t.length,a=Array.from(t,e=>Math.pow(10,e));function n(e,t,o){let a=Pe(e*o),n=Pe(t*o),i=a-n;i<<=1,0>a-n&&(i=~i);let r="";for(;32<=i;)r+=String.fromCharCode(63+(32|31&i)),i>>=5;return r+=String.fromCharCode(i+63),r}let i="";for(let t=0;t<o;t++)i+=n(e[0][t],0,a[t]);for(let t=1;t<e.length;t++){let r=e[t],s=e[t-1];for(let e=0;e<o;e++)i+=n(r[e],s[e],a[e])}return i}decode(e,t){let o=t.length;if(!e||0===e.length)return[];let a=0,n=[],i=Array.from(t,e=>Math.pow(10,e)),r=new Array(o).fill(0);function s(){let t=null,o=0,n=0;do{t=e.charCodeAt(a++)-63,n|=(31&t)<<o,o+=5}while(32<=t);return 1&n?~(n>>1):n>>1}for(;a<e.length;){let e=new Array(o).fill(0);for(let t=0;t<o;t++)r[t]+=s(),e[t]=r[t]/i[t];n.push(e)}return n}});function Me(){let e=[];function t(t){e.push(t.latLng),e.push(t.iconLatLng)}function o(o){o.itinerary.itineraryPoints.forEach(t=>e.push(t.latLng)),o.notes.forEach(e=>t(e))}return Object.seal(new class{zoomToLatLng(e){xe.dispatch("zoomto",{latLng:e})}zoomToManeuver(e){let t=ne.travel.editedRoute.itinerary.maneuvers.getAt(e).itineraryPointObjId,o=ne.travel.editedRoute.itinerary.itineraryPoints.getAt(t).latLng;xe.dispatch("zoomto",{latLng:o})}zoomToNote(o){e=[],t(ie.getNoteAndRoute(o).note),xe.dispatch("zoomto",{geometry:[e]})}zoomToRoute(t){e=[],o(ie.getRoute(t)),xe.dispatch("zoomto",{geometry:[e]})}zoomToTravel(){e=[],ne.travel.routes.forEach(e=>o(e)),-1!==ne.travel.editedRouteObjId&&o(ne.travel.editedRoute),ne.travel.notes.forEach(e=>t(e)),xe.dispatch("zoomto",{geometry:[e]})}zoomToPoi(e){xe.dispatch("zoomto",e)}})}function Ae(){return Object.seal(new class{openDistantFile(t){(function(){function t(e){let t={};0!==e.itinerary.itineraryPoints.length&&(t=e.itinerary.itineraryPoints[0].objType);let o={values:"",objType:t},n=[];e.itinerary.itineraryPoints.forEach(e=>{n.push([e.lat,e.lng,e.distance,e.elev,e.objId])}),o.values=Ie.encode(n,[a.fixed,a.fixed,2,2,0]),e.itinerary.itineraryPoints=o}function i(t){let n=[];if(t.itinerary.itineraryPoints.values)Ie.decode(t.itinerary.itineraryPoints.values,[a.fixed,a.fixed,2,2,0]).forEach(i=>{let r={lat:a.defaultValue,lng:a.defaultValue,distance:e.defaultValue,elev:o.defaultValue,objId:-1};[r.lat,r.lng,r.distance,r.elev,r.objId]=i,r.objType=t.itinerary.itineraryPoints.objType,n.push(r)});else{t.itinerary.itineraryPoints.latLngs=Ie.decode(t.itinerary.itineraryPoints.latLngs,[a.fixed,a.fixed]);let e=0;t.itinerary.itineraryPoints.latLngs.forEach(a=>{let i={};i.lat=a[0],i.lng=a[1],i.distance=t.itinerary.itineraryPoints.distances[e],t.itinerary.itineraryPoints.elevs?i.elev=t.itinerary.itineraryPoints.elevs[e]:i.elev=o.defaultValue,i.objId=t.itinerary.itineraryPoints.objIds[e],i.objType=t.itinerary.itineraryPoints.objType,n.push(i),e++})}t.itinerary.itineraryPoints=n}function r(e){e.routes.forEach(i),e.editedRoute&&i(e.editedRoute)}return Object.seal(new class{decompress(e){r(e),ne.travel.jsonObject=e,ne.editedRouteObjId=-1,ne.travel.routes.forEach(e=>{n.notEdited!==e.editionStatus&&(ne.editedRouteObjId=e.objId)})}decompressMerge(e){r(e);let t=Y();t.jsonObject=e;let o=t.routes.iterator;for(;!o.done;)ne.travel.routes.add(o.value);let a=t.notes.iterator;for(;!a.done;)ne.travel.notes.add(a.value)}compress(){let e=ne.travel.jsonObject;return e.routes.forEach(t),t(e.editedRoute),e}})})().decompress(t),ne.travel.readOnly=!0,this.display()}display(){document.title="Travel & Notes"+(""===ne.travel.name?"":" - "+ne.travel.name);let e=ne.travel.routes.iterator;for(;!e.done;)n.notEdited===e.value.editionStatus&&xe.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:e.value.objId});-1!==ne.editedRouteObjId&&xe.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:ne.travel.editedRoute.objId});let t=ne.travel.notes.iterator;for(;!t.done;)xe.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:t.value.objId});Me().zoomToTravel()}})}const Se=Object.seal(new class{createUI(){f.create("div",{id:"TravelNotes-AttributionsUI"},document.querySelector("body")),this.attributions=""}set attributions(e){let t='© <a href="https://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> | © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+e+'| © <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a>',o=document.getElementById("TravelNotes-AttributionsUI");for(;o.firstChild;)o.removeChild(o.firstChild);g.sanitizeToHtmlElement(t,o)}});let Ee="geolocation"in navigator?t.inactive:t.disabled,Ce=null;function He(e){xe.dispatch("geolocationpositionchanged",{position:e})}function De(){t.active===Ee&&(Ee=t.inactive),xe.dispatch("geolocationstatuschanged",{status:Ee}),navigator.geolocation.clearWatch(Ce),Ce=null}function Re(e){1===e.code&&(Ee=t.refusedByUser),De()}const ze=Object.seal(new class{get status(){return Ee}switch(){switch(Ee){case t.inactive:Ee=t.active,xe.dispatch("geolocationstatuschanged",{status:Ee}),navigator.geolocation.getCurrentPosition(He,Re,m.geoLocation.options),Ce=navigator.geolocation.watchPosition(He,Re,m.geoLocation.options);break;case t.active:De()}return Ee}});let Ve=null,Fe=[{service:"wmts",url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"red",backgroundColor:"white"},providerName:"OSM",providerKeyNeeded:!1,attribution:""}];function ke(e){e.stopPropagation(),xe.dispatch("layerchange",{layer:e.target.layer}),Se.attributions=e.target.layer.attribution}function Ue(e){e.stopPropagation(),ze.switch()}function We(e){e.stopPropagation(),Me().zoomToTravel()}function Be(e){f.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:e.name,layer:e,textContent:e.toolbar.text,style:"color:"+e.toolbar.color+";background-color:"+e.toolbar.backgroundColor},Ve).addEventListener("click",ke,!1)}const qe=Object.seal(new class{createUI(){Ve=f.create("div",{id:"TravelNotes-ViewerLayersToolbarUI"},document.querySelector("body")),f.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"My position",textContent:"🌐",style:"color:black;background-color:white"},Ve).addEventListener("click",Ue,!1),f.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"Zoom on the travel",textContent:"🔍",style:"color:black;background-color:white"},Ve).addEventListener("click",We,!1),Fe.forEach(Be)}setLayer(e){let t=Fe.find(t=>t.name===e)||Fe[0];xe.dispatch("layerchange",{layer:t}),Se.attributions=t.attribution}addLayers(e){e.forEach(e=>{e.providerKeyNeeded||Fe.push(e)})}});let Ze=!1;const _e=Object.seal(new class{addReadOnlyMap(e,t){Ze||(Ze=!0,document.addEventListener("routeupdated",e=>{e.data&&Oe.addRoute(e.data.addedRouteObjId)},!1),document.addEventListener("noteupdated",e=>{e.data&&Oe.addNote(e.data.addedNoteObjId)},!1),document.addEventListener("zoomto",e=>{e.data&&Oe.zoomTo(e.data.latLng,e.data.geometry)},!1),document.addEventListener("layerchange",e=>{e.data&&Oe.setLayer(e.data.layer,e.data.layer.url)}),document.addEventListener("geolocationpositionchanged",e=>{e.data&&Oe.onGeolocationPositionChanged(e.data.position)},!1),document.addEventListener("geolocationstatuschanged",e=>{e.data&&Oe.onGeolocationStatusChanged(e.data.status)},!1),Se.createUI(),t&&qe.createUI(),qe.setLayer("OSM - Color"),e&&v.getJsonPromise(e).then(e=>{Ae().openDistantFile(e)}).catch(e=>{console.log(e||"Not possible to load the .trv file"),ne.map.setView([a.defaultValue,a.defaultValue],2)}))}});(function(){let e=null,t=null,o=!1;return Object.freeze(new class{start(){!function(){let a=new URL(window.location),n=a.searchParams.get("fil");if(n&&0!==n.length)try{if(n=atob(n),n.match(/[^\w-%:./]/))throw new Error("invalid char in the url encoded in the fil parameter");let e=new URL(n);a.protocol&&e.protocol&&a.protocol===e.protocol&&a.hostname&&e.hostname&&a.hostname===e.hostname?t=encodeURI(e.href):console.log("The distant file is not on the same site than the app")}catch(e){console.log(e.message)}let i=a.searchParams.get("lng");i&&(i.match(/^[A-Z,a-z]{2}$/)?e=i.toLowerCase():console.log("invalid lng parameter")),""===a.searchParams.get("lay")&&(o=!0)}(),e=e||m.language;let n=window.location.origin+window.location.pathname+"TravelNotes";v.getJsonPromise(n+"Config.json").then(t=>(t.language=e,"wwwouaiebe.github.io"===window.location.hostname&&(t.note.haveBackground=!0),m.overload(t),v.getJsonPromise(n+e.toUpperCase()+".json"))).then(e=>(N.setTranslations(e),v.getJsonPromise(n+"Layers.json"))).then(e=>{qe.addLayers(e),function(){{f.create("div",{id:"Map"},document.querySelector("body"));let e=window.L.map("Map",{attributionControl:!1,zoomControl:!1}).setView([a.defaultValue,a.defaultValue],2);ne.map=e,_e.addReadOnlyMap(t,o)}}()}).catch(()=>{document.body.textContent="An error occurs when loading the configuration "})}})})().start()}();