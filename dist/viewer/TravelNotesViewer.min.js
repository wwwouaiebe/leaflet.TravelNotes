/**
 * 
 * @source: https://github.com/wwwouaiebe/leaflet.TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * leaflet.travelnotes - version 2.3.0
 * Build 00134 - 2021-07-08T14:37:01+0200 
 * Copyright 2017 2021 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Constants.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/Object.freeze({notSaved:"ðŸ”´",modified:"ðŸŸ¡",saved:"ðŸŸ¢"});const e=Object.freeze({fixed:2,invalid:-1,defaultValue:0,metersInKm:1e3}),t=Object.freeze({refusedByUser:-1,disabled:0,inactive:1,active:2}),o=(Object.freeze({invalidPane:"43a6a53e-008a-4910-80a6-7a87d301ea15",itineraryPane:"8fbf0da7-4e6f-4bc7-8e20-1388461ccde7",travelNotesPane:"dffe782b-07df-4b81-a318-f287c0cf5ec6",searchPane:"228f00d7-43a8-4c13-897d-70400cb6dd58"}),Object.freeze({fixed:2,defaultValue:0})),a=Object.freeze({defaultValue:0,fixed:6,maxLat:90,minLat:-90,maxLng:180,minLng:-180}),n=Object.freeze({notEdited:0,editedNoChange:1,editedChanged:2}),r=Object.freeze({margin:100,height:500,width:1e3,yDeltaText:30,xDeltaText:10,vScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],hScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}),i=Object.freeze({width:40,height:40,svgViewboxDim:200}),s=Object.freeze({d0:0,d90:90,d180:180,d270:270,d360:360,d540:540,toRadians:Math.PI/180,fromRadians:180/Math.PI}),l="http://www.w3.org/2000/svg",c=window.location.protocol,d=new DOMParser;let u=new Map;function h(e){return e.replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;").replaceAll(/"/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}function g(e,t="href"){let o=d.parseFromString("<div>"+e+"</div>","text/html");if(!o||"#document"!==o.nodeName)return{url:"",errorsString:"Parsing error"};let a=o.body.firstChild,n="";for(let e=0;e<a.childNodes.length;e++){if("#text"!==a.childNodes[e].nodeName)return{url:"",errorsString:"Invalid characters found in the url"};n+=a.childNodes[e].nodeValue}if(n=n.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),n!==e)return{url:"",errorsString:"Invalid characters found in the url"};let r=["https:"];if("http:"!==c&&"href"!==t||r.push("http:"),"href"===t){r.push("mailto:"),r.push("sms:"),r.push("tel:");let e=n.match(/^#\w*/);if(e&&n===e[0])return{url:n,errorsString:""}}"src"===t&&r.push("data:");let i=null;try{i=new URL(n)}catch(e){return{url:"",errorsString:"Invalid url string"}}if(-1===r.indexOf(i.protocol))return{url:"",errorsString:"Invalid protocol "+i.protocol};if(-1!==["sms:","tel:"].indexOf(i.protocol)&&i.pathname.match(/^\+[0-9,*,#]*$/))return{url:n,errorsString:""};try{encodeURIComponent(i.href)}catch(e){return{url:"",errorsString:"Invalid character in url"}}return{url:n,errorsString:""}}u.set("a",["href","target"]),u.set("div",[]),u.set("del",[]),u.set("em",[]),u.set("figcaption",[]),u.set("figure",[]),u.set("h1",[]),u.set("h2",[]),u.set("h3",[]),u.set("h4",[]),u.set("h5",[]),u.set("h6",[]),u.set("hr",[]),u.set("img",["src","alt","width","height"]),u.set("ins",[]),u.set("li",[]),u.set("mark",[]),u.set("ol",[]),u.set("p",[]),u.set("s",[]),u.set("small",[]),u.set("strong",[]),u.set("span",[]),u.set("sub",[]),u.set("sup",[]),u.set("ul",[]),u.set("svg",["xmlns","viewBox","class"]),u.set("text",["x","y","text-anchor"]),u.set("polyline",["points","class","transform"]);const p=Object.freeze(new class{sanitizeToColor(e){let t=e.match(/^#[0-9,A-F,a-f]{6}$/);return t?t[0]:null}sanitizeToUrl(e,t){return g(e,t)}sanitizeToJsString(e){return function(e){let t=d.parseFromString("<div>"+e+"</div>","text/html");if(!t||"#document"!==t.nodeName)return"";let o=t.body.firstChild,a="";for(let e=0;e<o.childNodes.length;e++){if("#text"!==o.childNodes[e].nodeName)return"";a+=o.childNodes[e].nodeValue}return a=a.replaceAll(/</g,"â‰º").replaceAll(/>/g,"â‰»").replaceAll(/"/g,"â€³").replaceAll(/\u0027/g,"â€²"),a}(e)}sanitizeToHtmlElement(e,t){!function(e,t){let o=d.parseFromString("<div>"+e+"</div>","text/html");o&&"#document"===o.nodeName?function e(t,o){let a=t.childNodes;for(let n=0;n<a.length;n++){let a=t.childNodes[n],r=a.nodeName.toLowerCase(),i=u.get(r);if(i){i=i.concat(["id","class","dir","title","tanwidth","tanheight"]);let t="svg"===r||"text"===r||"polyline"===r,n=t?document.createElementNS(l,r):document.createElement(r);if(i.forEach(e=>{if(t)a.hasAttributeNS(null,e)&&(n.setAttributeNS(null,e,a.getAttribute(e)),a.removeAttributeNS(null,e));else if(a.hasAttribute(e))if("href"===e||"src"===e){let t=g(a.getAttribute(e),e).url;""!==t&&n.setAttribute(e,t)}else n.setAttribute(e,a.getAttribute(e))}),a.hasAttribute("style")){a.getAttribute("style").split(";").forEach(e=>{let t=e.split(":");2!==t.length||"width"!==t[0].trim()&&"height"!==t[0].trim()||(n.style[t[0].trim()]=t[1].trim())})}a.hasAttribute("target")&&n.setAttribute("rel","noopener noreferrer"),o.appendChild(n),e(a,n)}else"#text"===r&&o.appendChild(document.createTextNode(a.nodeValue))}}(o.body.firstChild,t):t.textContent=""}(e,t)}sanitizeToHtmlString(e){return function(e){let t="",o="",a=d.parseFromString("<div>"+e.replace("&nbsp;","à¨€")+"</div>","text/html");return a&&"#document"===a.nodeName?(function e(a){let n=a.childNodes;for(let r=0;r<n.length;r++){let n=a.childNodes[r],i=n.nodeName.toLowerCase(),s=u.get(i);if(s){s=s.concat(["id","class","dir","title","tanwidth","tanheight"]);let a="svg"===i||"text"===i||"polyline"===i;t+="<"+i,n.hasAttribute("target")&&(t+=' rel="noopener noreferrer"'),s.forEach(e=>{if(a)n.hasAttributeNS(null,e)&&(t+=" "+e+'="'+h(n.getAttribute(e))+'"',n.removeAttribute(e));else if(n.hasAttribute(e))if("href"===e||"src"===e){let a=g(n.getAttribute(e),e).url;""===a?o+="\nAn invalid url ("+n.getAttribute(e)+") was removed from a "+e+" attribute":t+=" "+e+'="'+a+'"',n.removeAttribute(e)}else t+=" "+e+'="'+h(n.getAttribute(e))+'"',n.removeAttribute(e)}),t+=">",e(n),t+="</"+i+">"}else"#text"===i?t+=h(n.nodeValue):o+="\nAn invalid tag "+i+" was removed";if(n.hasAttributes)for(let e=0;e<n.attributes.length;e++)o+="\nAn unsecure attribute "+n.attributes[e].name+'="'+n.attributes[e].value+'" was removed.'}}(a.body.firstChild),{htmlString:t,errorsString:o}):{htmlString:"",errorsString:"Parsing error"}}(e)}});let m={APIKeys:{saveToSessionStorage:!0},APIKeysDialog:{haveUnsecureButtons:!0,showAPIKeys:!0,showButton:!0},colorDialog:{haveSlider:!0,initialRed:0},contextMenu:{timeout:1500},errorsUI:{helpTimeOut:3e4,showError:!0,showHelp:!0,showInfo:!0,showWarning:!0,timeOut:1e4},geoCoder:{distances:{city:1200,hamlet:200,town:1500,village:400},osmCityAdminLevel:{DEFAULT:"8",GB:"10"}},geoLocation:{marker:{color:"#ff0000",radius:11},options:{enableHighAccuracy:!1,maximumAge:0,timeout:1/0},zoomFactor:17,zoomToPosition:!0},itineraryPaneUI:{showManeuvers:!1,showNotes:!0},itineraryPoint:{marker:{color:"#ff0000",fill:!1,radius:7,weight:2},zoomFactor:17},layersToolbarUI:{haveLayersToolbarUI:!0,toolbarTimeOut:1500,theDevil:{addButton:!1}},map:{center:{lat:50.50923,lng:5.49542},zoom:12},mouseUI:{haveMouseUI:!0},nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},note:{grip:{size:10,opacity:0,moveOpacity:1},haveBackground:!1,maxManeuversNotes:100,polyline:{color:"#808080",weight:1},reverseGeocoding:!1,svgIcon:{angleDistance:10,angleDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},rcnRefDistance:20,roadbookFactor:1,zoom:17}},noteDialog:{areaHeight:{icon:2,popupContent:8},mask:{iconsDimension:!0,iconTextArea:!1,tooltip:!1,popupContent:!1,address:!1,link:!1,phone:!0},theDevil:{addButton:!1,zoomFactor:17}},osmSearch:{nextSearchLimit:{color:"#ff0000",fill:!1,weight:1},previousSearchLimit:{color:"#006400",fill:!1,weight:1},searchPointMarker:{color:"#006400",fill:!1,radius:20,weight:4},searchPointPolyline:{color:"#006400",fill:!1,weight:4},showSearchNoteDialog:!1},overpassApi:{timeOut:40,url:"https://lz4.overpass-api.de/api/interpreter"},printRouteMap:{isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,pageBreak:!1,printNotes:!0,borderWidth:30,zoomFactor:15,entryPointMarker:{color:"#00ff00",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"#ff0000",weight:4,radius:10,fill:!0,fillOpacity:1}},route:{color:"#ff0000",dashArray:0,dashChoices:[{text:"â€”â€”â€”â€”â€”â€”",iDashArray:[0]},{text:"â€” â€” â€” â€” â€”",iDashArray:[4,2]},{text:"â€”â€§â€”â€§â€”â€§â€”â€§â€”",iDashArray:[4,2,0,2]},{text:"Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:.25,smoothPoints:3},showDragTooltip:3,width:3},routeEditor:{showEditedRouteInRoadbook:!0},travelEditor:{startMinimized:!0,startupRouteEdition:!0,timeout:1e3},travelNotes:{autoLoad:!0,haveBeforeUnloadWarning:!0,language:"fr"},travelNotesToolbarUI:{contactMail:{url:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues"}},wayPoint:{reverseGeocoding:!1,geocodingIncludeName:!1}};let f=new class{get APIKeys(){return m.APIKeys}get APIKeysDialog(){return m.APIKeysDialog}get colorDialog(){return m.colorDialog}get contextMenu(){return m.contextMenu}get errorsUI(){return m.errorsUI}get geoCoder(){return m.geoCoder}get geoLocation(){return m.geoLocation}get itineraryPaneUI(){return m.itineraryPaneUI}get itineraryPoint(){return m.itineraryPoint}get layersToolbarUI(){return m.layersToolbarUI}get map(){return m.map}get mouseUI(){return m.mouseUI}get nominatim(){return m.nominatim}get note(){return m.note}get noteDialog(){return m.noteDialog}get osmSearch(){return m.osmSearch}get overpassApi(){return m.overpassApi}get printRouteMap(){return m.printRouteMap}get route(){return m.route}get routeEditor(){return m.routeEditor}get travelEditor(){return m.travelEditor}get travelNotes(){return m.travelNotes}get travelNotesToolbarUI(){return m.travelNotesToolbarUI}get wayPoint(){return m.wayPoint}overload(e){!function e(t,o){if("object"==typeof t&&"object"==typeof o)try{for(let a in o)"object"==typeof o[a]?e(t[a],o[a]):typeof t[a]==typeof o[a]&&("string"==typeof o[a]?o[a]="color"===a?p.sanitizeToColor(t[a])||o[a]:"url"===a?p.sanitizeToUrl(t[a]).url:p.sanitizeToJsString(t[a]):o[a]=t[a]||o[a]);for(let a in t)"object"==typeof t[a]?("[object Array]"===Object.prototype.toString.call(t[a])?o[a]=o[a]||[]:o[a]=o[a]||{},e(t[a],o[a])):"string"==typeof o.property?o[a]=p.sanitizeToHtmlString(t[a],[]).htmlString:o[a]=t[a]}catch(e){e instanceof Error&&console.error(e)}}(e,m),m=function e(t){for(let o in t)"object"==typeof t[o]&&(t[o]=e(t[o]));return Object.freeze(t)}(m)}};
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file HTMLElementsFactory.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/const v=new class{constructor(){Object.freeze(this)}create(e,t,o){let a=null;return"text"===e.toLowerCase()?a=document.createTextNode(t.value||""):(a=document.createElement(e),t&&function(e,t){for(let o in t)try{e[o]=t[o]}catch(e){e instanceof Error&&console.error(e)}e.target&&(e.rel="noopener noreferrer")}(a,t)),o&&o.appendChild(a),a}};let y=0;function b(){return++y,y}
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Version.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/function w(e){const t=e;return new class{constructor(){Object.freeze(this)}get name(){return t}get version(){return"2.3.0"}get jsonObject(){return{name:t,version:"2.3.0"}}validate(e){if(!Object.getOwnPropertyNames(e).includes("name"))throw new Error("No name for "+t);if(t!==e.name)throw new Error("Invalid name for "+t);if(!Object.getOwnPropertyNames(e).includes("version"))throw new Error("No version for "+t)}}}function j(e){const t=e;let o=[];const a=function(){let e=t();if(!e.objType||!e.objType.name)throw new Error("invalid object name for collection");return e.objType.name}();function n(e){if(!e.objType||!e.objType.name||e.objType.name!==a)throw new Error("invalid object name for add function");o.push(e)}function r(){let e=-1;return Object.freeze({get value(){return e<o.length?o[e]:null},get previous(){return 0>=e?null:o[e-1]},get next(){return e<o.length-1?o[e+1]:null},get done(){return++e>=o.length},get first(){return 0===e},get last(){return e>=o.length-1},get index(){return e}})}function i(e){return o.findIndex(t=>t.objId===e)}function s(e,t,a){let n=i(e);if(-1===n)throw new Error("invalid objId for next or previous function");if(1!==a&&-1!==a)throw new Error("invalid direction");let r=t;for(r||(r=()=>!0),n+=a;-1<n&&n<o.length&&!r(o[n]);)n+=a;return-1===n||o.length===n?null:o[n]}return new class{constructor(){Object.freeze(this)}add(e){n(e)}forEach(e){let t=null,o=r();for(;!o.done;)t=e(o.value,t);return t}getAt(e){let t=i(e);return-1===t?null:o[t]}moveTo(e,t,a){let n=i(e),r=i(t);if(-1===n||-1===r)throw new Error("invalid objId for function  myMoveTo");a||r++,o.splice(r,0,o[n]),r<n&&n++,o.splice(n,1)}next(e,t){return s(e,t,1)}previous(e,t){return s(e,t,-1)}remove(e){if(-1===i(e))throw new Error("invalid objId for remove function");o.splice(i(e),1)}removeAll(e){e?o.splice(1,o.length-2):o.length=0}replace(e,t){let n=i(e);if(-1===n)throw new Error("invalid objId for replace function");if(!t.objType||!t.objType.name||t.objType.name!==a)throw new Error("invalid object name for replace function");o[n]=t}reverse(){o.reverse()}sort(e){o.sort(e)}swap(e,t){let a=i(e);if(-1===a||0===a&&t||o.length-1===a&&!t)throw new Error("invalid objId for swap function");let n=o[a];o[a]=o[a+(t?-1:1)],o[a+(t?-1:1)]=n}get first(){return o[0]}get iterator(){return r()}get last(){return o[o.length-1]}get length(){return o.length}get jsonObject(){let e=[],t=r();for(;!t.done;)e.push(t.value.jsonObject);return e}set jsonObject(e){o.length=0;let a=null;e.forEach(e=>{a=t(),a.jsonObject=e,n(a)})}}}let T=new Map;const N=new class{constructor(){Object.freeze(this)}setTranslations(e){e.forEach(e=>T.set(e.msgid,p.sanitizeToJsString(e.msgstr)))}getText(e,t){let o=T.get(e);return t&&o&&Object.getOwnPropertyNames(t).forEach(e=>o=o.replace("{"+e+"}",t[e])),o||e}};const L=new class{constructor(){Object.freeze(this)}get UUID(){let e=new Uint16Array(8);const t=["","-","-","-","-","","",""];window.crypto.getRandomValues(e);let o="";for(let a=0;a<8;a++)o+=e[a].toString(16).padStart(4,"0")+t[a];return o}storageAvailable(e){try{let t=window[e],o="__storage_test__";return t.setItem(o,o),t.removeItem(o),!0}catch(e){return!1}}saveFile(e,t,o){try{let a=window.URL.createObjectURL(new File([t],e,{type:o||"text/plain"})),n=document.createElement("a");n.setAttribute("href",a),n.setAttribute("download",e),n.click(),window.URL.revokeObjectURL(a)}catch(e){e instanceof Error&&console.error(e)}}formatTime(e){let t=Math.floor(e);if(0===t)return"";let o=Math.floor(t/86400),a=Math.floor(t%86400/3600),n=Math.floor(t%3600/60),r=Math.floor(t%60);return 0<o?o+"Â "+N.getText("Utilities - Day")+"Â "+a+"Â "+N.getText("Utilities - Hour"):0<a?a+"Â "+N.getText("Utilities - Hour")+"Â "+n+"Â "+N.getText("Utilities - Minute"):0<n?n+"Â "+N.getText("Utilities - Minute"):r+"Â "+N.getText("Utilities - Second")}formatDistance(t){let o=Math.floor(t);return 0>=o?"0Â km":Math.floor(o/e.metersInKm)+","+Math.floor(o%e.metersInKm/10).toFixed(0).padStart(2,"0").padEnd(3,"0")+"Â km"}formatLat(e){return e>0?e.toFixed(a.fixed)+"Â N":(-e).toFixed(a.fixed)+"Â S"}formatLng(e){return e>0?e.toFixed(a.fixed)+"Â E":(-e).toFixed(a.fixed)+"Â W"}formatLatLng(e){return 0===e[0]&&0===e[1]?"":this.formatLat(e[0])+"Â -Â "+this.formatLng(e[1])}},O=w("WayPoint"),x=new WeakMap;function I(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+O.name);O.validate(e.objType),O.version!==e.objType.version&&function(e){switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.address=e.name,e.name="";case"1.12.0":case"1.13.0":case"2.0.0":case"2.1.0":case"2.2.0":e.objType.version="2.3.0";break;default:throw new Error("invalid version for "+O.name)}}(e);let t=Object.getOwnPropertyNames(e);return["address","name","lat","lng","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+O.name)}),e}class A{constructor(){this.name="",this.address="",this.lat=a.defaultValue,this.lng=a.defaultValue,x.set(this,b()),Object.seal(this)}get fullName(){let e=""===this.name?this.address:this.name+", "+this.address;return""===e&&(e=L.formatLatLng([this.lat,this.lng])),e}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objId(){return x.get(this)}get objType(){return O}get jsonObject(){return{name:this.name,address:this.address,lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),objId:x.get(this),objType:O.jsonObject}}set jsonObject(e){let t=I(e);this.address=t.address||"",this.name=t.name||"",this.lat=t.lat||a.defaultValue,this.lng=t.lng||a.defaultValue,x.set(this,b()),this.validateData()}validateData(){"string"==typeof this.address?this.address=p.sanitizeToJsString(this.address):this.address="","string"==typeof this.name?this.name=p.sanitizeToJsString(this.name):this.name="","number"!=typeof this.lat&&(this.lat=a.defaultValue),"number"!=typeof this.lng&&(this.lng=a.defaultValue)}}function M(){return new A}const P=w("ItineraryPoint"),S=new WeakMap;function E(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+P.name);P.validate(e.objType),P.version!==e.objType.version&&function(e){switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.elev=o.defaultValue;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":case"2.0.0":case"2.1.0":case"2.2.0":e.objType.version="2.3.0";break;default:throw new Error("invalid version for "+P.name)}}(e);let t=Object.getOwnPropertyNames(e);return["lat","lng","distance","elev","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+P.name)}),e}class C{constructor(){this.lat=a.defaultValue,this.lng=a.defaultValue,this.distance=e.defaultValue,this.elev=o.defaultValue,S.set(this,b()),Object.seal(this)}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objType(){return P}get objId(){return S.get(this)}get jsonObject(){return{lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),distance:parseFloat(this.distance.toFixed(e.fixed)),elev:parseFloat(this.elev.toFixed(o.fixed)),objId:S.get(this),objType:P.jsonObject}}set jsonObject(t){let n=E(t);this.lat=n.lat||a.defaultValue,this.lng=n.lng||a.defaultValue,this.distance=n.distance||e.defaultValue,this.elev=n.elev||o.defaultValue,S.set(this,b()),this.validateData()}validateData(){"number"!=typeof this.lat&&(this.lat=a.defaultValue),"number"!=typeof this.lng&&(this.lng=a.defaultValue),"number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.elev&&(this.elev=o.defaultValue)}}function z(){return new C}const D=w("Maneuver"),R=new WeakMap;function H(t){if(!Object.getOwnPropertyNames(t).includes("objType"))throw new Error("No objType for "+D.name);D.validate(t.objType),D.version!==t.objType.version&&function(t){switch(t.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":"kArriveDefault"===t.iconName&&(t.distance=e.defaultValue);case"1.12.0":case"1.13.0":case"2.0.0":case"2.1.0":case"2.2.0":t.objType.version="2.3.0";break;default:throw new Error("invalid version for "+D.name)}}(t);let o=Object.getOwnPropertyNames(t);return["iconName","instruction","distance","duration","itineraryPointObjId","objId"].forEach(e=>{if(!o.includes(e))throw new Error("No "+e+" for "+D.name)}),t}class V{constructor(){this.iconName="",this.instruction="",this.itineraryPointObjId=-1,this.distance=e.defaultValue,this.duration=e.defaultValue,R.set(this,b()),Object.seal(this)}get objType(){return D}get objId(){return R.get(this)}get jsonObject(){return{iconName:this.iconName,instruction:this.instruction,distance:parseFloat(this.distance.toFixed(e.fixed)),duration:this.duration,itineraryPointObjId:this.itineraryPointObjId,objId:R.get(this),objType:D.jsonObject}}set jsonObject(t){let o=H(t);this.iconName=o.iconName||"",this.instruction=o.instruction||"",this.distance=o.distance||e.defaultValue,this.duration=o.duration||e.defaultValue,this.itineraryPointObjId=o.itineraryPointObjId||-1,R.set(this,b()),this.validateData()}validateData(){"string"==typeof this.iconName?this.iconName=p.sanitizeToJsString(this.iconName):this.iconName="","string"==typeof this.instruction?this.instruction=p.sanitizeToJsString(this.instruction):this.instruction="","number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.duration&&(this.duration=e.defaultValue),"number"!=typeof this.itineraryPointObjId&&(this.itineraryPointObjId=-1)}}function k(){return new V}const F=w("Itinerary"),U=new WeakMap;function B(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+F.name);F.validate(e.objType),F.version!==e.objType.version&&function(e){switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.hasProfile=!1,e.ascent=0,e.descent=0;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":case"2.0.0":case"2.1.0":case"2.2.0":e.objType.version="2.3.0";break;default:throw new Error("invalid version for "+F.name)}}(e);let t=Object.getOwnPropertyNames(e);return["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+F.name)}),e}class W{constructor(){this.hasProfile=!1,this.ascent=0,this.descent=0,this.provider="",this.transitMode="",this.itineraryPoints=j(z),this.maneuvers=j(k),U.set(this,b()),Object.seal(this)}get objType(){return F}get objId(){return U.get(this)}get jsonObject(){return{hasProfile:this.hasProfile,ascent:this.ascent,descent:this.descent,itineraryPoints:this.itineraryPoints.jsonObject,maneuvers:this.maneuvers.jsonObject,provider:this.provider,transitMode:this.transitMode,objId:U.get(this),objType:F.jsonObject}}set jsonObject(e){let t=B(e);this.hasProfile=t.hasProfile||!1,this.ascent=t.ascent||0,this.descent=t.descent||0,this.itineraryPoints.jsonObject=t.itineraryPoints||[],this.maneuvers.jsonObject=t.maneuvers||[],this.provider=t.provider||"",this.transitMode=t.transitMode||"",U.set(this,b());let o=new Map,a=0,n=this.itineraryPoints.iterator;for(;!n.done;)o.set(t.itineraryPoints[a].objId,n.value.objId),a++;let r=this.maneuvers.iterator;for(;!r.done;)r.value.itineraryPointObjId=o.get(r.value.itineraryPointObjId);this.validateData()}validateData(){"boolean"!=typeof this.hasProfile&&(this.hasProfile=!1),"number"!=typeof this.ascent&&(this.ascent=0),"number"!=typeof this.descent&&(this.descent=0),"string"==typeof this.provider?this.provider=p.sanitizeToJsString(this.provider):this.provider="","string"==typeof this.transitMode?this.transitMode=p.sanitizeToJsString(this.transitMode):this.transitMode=""}}function _(){return new W}const Z=w("Note"),K=new WeakMap;function G(e){return e.replaceAll(/style='color:white;background-color:red'/g,"class='TravelNotes-Note-WhiteRed'").replaceAll(/style='color:white;background-color:green'/g,"class='TravelNotes-Note-WhiteGreen'").replaceAll(/style='color:white;background-color:blue'/g,"class='TravelNotes-Note-WhiteBlue'").replaceAll(/style='color:white;background-color:brown'/g,"class='TravelNotes-Note-WhiteBrown'").replaceAll(/style='color:white;background-color:black'/g,"class='TravelNotes-Note-WhiteBlack'").replaceAll(/style='border:solid 0.1em'/g,"class='TravelNotes-Note-BlackWhite'").replaceAll(/style='background-color:white;'/g,"class='TravelNotes-Note-Knooppunt'").replaceAll(/style='fill:green;font:bold 120px sans-serif;'/g,"").replaceAll(/style='fill:none;stroke:green;stroke-width:10;'/g,"")}function J(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+Z.name);Z.validate(e.objType),Z.version!==e.objType.version&&function(e){switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":"string"==typeof e.iconHeight&&(e.iconHeight=Number.parseInt(e.iconHeight)),"string"==typeof e.iconWidth&&(e.iconWidth=Number.parseInt(e.iconWidth)),e.iconContent=G(e.iconContent),e.popupContent=G(e.popupContent),e.tooltipContent=G(e.tooltipContent),e.phone=G(e.phone),e.address=G(e.address);case"2.0.0":case"2.1.0":case"2.2.0":e.objType.version="2.3.0";break;default:throw new Error("invalid version for "+Z.name)}}(e);let t=Object.getOwnPropertyNames(e);return["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+Z.name)}),e}class q{constructor(){this.iconHeight=0,this.iconWidth=0,this.iconContent="",this.popupContent="",this.tooltipContent="",this.phone="",this.url="",this.address="",this.iconLat=a.defaultValue,this.iconLng=a.defaultValue,this.lat=a.defaultValue,this.lng=a.defaultValue,this.distance=e.invalid,this.chainedDistance=e.defaultValue,K.set(this,b()),Object.seal(this)}get isRouteNote(){return this.distance!==e.invalid}get iconLatLng(){return[this.iconLat,this.iconLng]}set iconLatLng(e){this.iconLat=e[0],this.iconLng=e[1]}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objType(){return Z}get objId(){return K.get(this)}get jsonObject(){return{iconHeight:this.iconHeight,iconWidth:this.iconWidth,iconContent:this.iconContent,popupContent:this.popupContent,tooltipContent:this.tooltipContent,phone:this.phone,url:this.url,address:this.address,iconLat:parseFloat(this.iconLat.toFixed(a.fixed)),iconLng:parseFloat(this.iconLng.toFixed(a.fixed)),lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),distance:parseFloat(this.distance.toFixed(e.fixed)),chainedDistance:parseFloat(this.chainedDistance.toFixed(e.fixed)),objId:K.get(this),objType:Z.jsonObject}}set jsonObject(t){let o=J(t);this.iconHeight=o.iconHeight||0,this.iconWidth=o.iconWidth||0,this.iconContent=o.iconContent||"",this.popupContent=o.popupContent||"",this.tooltipContent=o.tooltipContent||"",this.phone=o.phone||"",this.url=o.url||"",this.address=o.address||"",this.iconLat=o.iconLat||a.defaultValue,this.iconLng=o.iconLng||a.defaultValue,this.lat=o.lat||a.defaultValue,this.lng=o.lng||a.defaultValue,this.distance=o.distance||e.invalid,this.chainedDistance=o.chainedDistance||e.defaultValue,K.set(this,b()),this.validateData(!0)}validateData(t){if("number"!=typeof this.iconHeight&&(this.iconHeight=0),"number"!=typeof this.iconWidth&&(this.iconWidth=0),"string"==typeof this.iconContent){let e=p.sanitizeToHtmlString(this.iconContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.iconContent+")"),this.iconContent=e.htmlString}else this.iconContent="";if("string"==typeof this.popupContent){let e=p.sanitizeToHtmlString(this.popupContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.popupContent+")"),this.popupContent=e.htmlString}else this.popupContent="";if("string"==typeof this.tooltipContent){let e=p.sanitizeToHtmlString(this.tooltipContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.tooltipContent+")"),this.tooltipContent=e.htmlString}else this.tooltipContent="";if("string"==typeof this.phone){let e=p.sanitizeToHtmlString(this.phone);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.phone+")"),this.phone=e.htmlString}else this.phone="";if("string"==typeof this.url&&""!==this.url){let e=p.sanitizeToUrl(this.url);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.url+")"),this.url=encodeURI(e.url)}else this.url="";"string"==typeof this.address?this.address=p.sanitizeToHtmlString(this.address).htmlString:this.address="","number"!=typeof this.iconLat&&(this.iconLat=a.defaultValue),"number"!=typeof this.iconLng&&(this.iconLng=a.defaultValue),"number"!=typeof this.lat&&(this.lat=a.defaultValue),"number"!=typeof this.lng&&(this.lng=a.defaultValue),"number"!=typeof this.distance&&(this.distance=e.invalid),"number"!=typeof this.chainedDistance&&(this.chainedDistance=e.defaultValue)}}function X(){return new q}const $=w("Route"),Q=new WeakMap;function Y(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+$.name);$.validate(e.objType),$.version!==e.objType.version&&function(e){switch(e.objType.version){case"1.0.0":e.dashArray=0,e.hidden=!1;case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.edited=n.notEdited;case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.editionStatus=e.edited;case"1.12.0":case"1.13.0":case"2.0.0":case"2.1.0":case"2.2.0":e.objType.version="2.3.0";break;default:throw new Error("invalid version for "+$.name)}}(e);let t=Object.getOwnPropertyNames(e);return["name","wayPoints","notes","itinerary","width","color","dashArray","chain","distance","duration","editionStatus","hidden","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+$.name)}),e}class ee{constructor(){this.name="",this.wayPoints=j(M),this.wayPoints.add(M()),this.wayPoints.add(M()),this.notes=j(X),this.itinerary=_(),this.width=f.route.width,this.color=f.route.color,this.dashArray=f.route.dashArray,this.chain=!0,this.chainedDistance=e.defaultValue,this.distance=e.defaultValue,this.duration=e.defaultValue,this.editionStatus=n.notEdited,this.hidden=!1,Q.set(this,b()),Object.seal(this)}get computedName(){let e=this.name;return""===e&&(e=(""===this.wayPoints.first.fullName?"???":this.wayPoints.first.fullName)+" â®ž "+(""===this.wayPoints.last.fullName?"???":this.wayPoints.last.fullName)),e}get objId(){return Q.get(this)}get objType(){return $}get jsonObject(){return{name:this.name,wayPoints:this.wayPoints.jsonObject,notes:this.notes.jsonObject,itinerary:this.itinerary.jsonObject,width:this.width,color:this.color,dashArray:this.dashArray,chain:this.chain,distance:parseFloat(this.distance.toFixed(e.fixed)),duration:this.duration,editionStatus:this.editionStatus,hidden:this.hidden,chainedDistance:parseFloat(this.chainedDistance.toFixed(e.fixed)),objId:Q.get(this),objType:$.jsonObject}}set jsonObject(e){let t=Y(e);this.name=t.name||"",this.wayPoints.jsonObject=t.wayPoints||[],this.notes.jsonObject=t.notes||[],this.itinerary.jsonObject=t.itinerary||_().jsonObject,this.width=t.width||f.route.width,this.color=t.color||"#000000",this.dashArray=t.dashArray||0,this.chain=t.chain||!1,this.distance=t.distance,this.duration=t.duration,this.editionStatus=t.editionStatus||n.notEdited,this.hidden=t.hidden||!1,this.chainedDistance=t.chainedDistance,Q.set(this,b()),this.validateData()}validateData(){"string"==typeof this.name?this.name=p.sanitizeToJsString(this.name):this.name="","number"!=typeof this.width&&(this.width=f.route.width),"string"==typeof this.color?this.color=p.sanitizeToColor(this.color)||f.route.color:this.color=f.route.color,"number"!=typeof this.dashArray&&(this.dashArray=0),this.dashArray>=f.route.dashChoices.length&&(this.dashArray=0),"boolean"!=typeof this.chain&&(this.chain=!1),"number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.duration&&(this.duration=e.defaultValue),"number"!=typeof this.editionStatus&&(this.editionStatus=n.notEdited),"boolean"!=typeof this.hidden&&(this.hidden=!1),"number"!=typeof this.chainedDistance&&(this.chainedDistance=e.defaultValue)}}function te(){return new ee}const oe=w("Travel"),ae=new WeakMap;function ne(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+oe.name);oe.validate(e.objType),oe.version!==e.objType.version&&function(e){switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.editedRoute=te();case"1.5.0":if(e.userData.layerId){let t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"LantmÃ¤teriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find(t=>t.layerId===e.userData.layerId);e.layerName=t?t.layerName:"OSM - Color"}else e.layerName="OSM - Color";case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":case"2.0.0":case"2.1.0":case"2.2.0":e.objType.version="2.3.0";break;default:throw new Error("invalid version for "+oe.name)}}(e);let t=Object.getOwnPropertyNames(e);return["name","editedRoute","routes","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+oe.name)}),e}class re{constructor(){this.editedRoute=te(),this.routes=j(te),this.notes=j(X),this.layerName="OSM - Color",this.name="",this.readOnly=!1,ae.set(this,b()),Object.seal(this)}get objId(){return ae.get(this)}get objType(){return oe}get jsonObject(){return{editedRoute:this.editedRoute.jsonObject,layerName:this.layerName,name:this.name,routes:this.routes.jsonObject,notes:this.notes.jsonObject,readOnly:this.readOnly,objId:ae.get(this),objType:oe.jsonObject}}set jsonObject(e){let t=ne(e);this.editedRoute.jsonObject=t.editedRoute,this.layerName=e.layerName||"OSM - Color",this.name=t.name||"",this.readOnly=t.readOnly||!1,this.routes.jsonObject=t.routes||[],this.notes.jsonObject=t.notes||[],ae.set(this,b()),this.validateData()}validateData(){"string"==typeof this.layerName?this.layerName=p.sanitizeToJsString(this.layerName):this.layerName="OSM - Color","string"==typeof this.name?this.name=p.sanitizeToJsString(this.name):this.name="TravelNotes","boolean"!=typeof this.readOnly&&(this.readOnly=!0)}}function ie(){return new re}let se=new Map,le=new Map,ce=Object.seal({provider:"",transitMode:""}),de=L.UUID;const ue=new class{constructor(){this.map=null,this.travel=ie(),this.editedRouteObjId=-1,this.searchData=[],Object.seal(this)}get providers(){return se}get mapObjects(){return le}get routing(){return ce}get UUID(){return de}};const he=new class{constructor(){Object.freeze(this)}getRoute(e){let t=null;return t=ue.travel.routes.getAt(e),t||e===ue.travel.editedRoute.objId&&(t=ue.travel.editedRoute),t}getNoteAndRoute(e){let t=null,o=null;if(t=ue.travel.notes.getAt(e),!t){let a=ue.travel.routes.iterator;for(;!a.done&&!t;)t=a.value.notes.getAt(e),t&&(o=a.value);t||(t=ue.travel.editedRoute.notes.getAt(e),t&&(o=ue.travel.editedRoute))}return Object.freeze({note:t,route:o})}getWayPoint(e){let t=ue.travel.editedRoute.wayPoints.getAt(e);if(!t){let o=ue.travel.routes.iterator;for(;!o.done&&!t;)t=o.value.wayPoints.getAt(e)}return t}};const ge=new class{constructor(){Object.freeze(this)}getLatLngElevAtDist(e,t){if(e.distance<=t||0>=t)return null;let o=0,a=e.itinerary.itineraryPoints.iterator;for(;o<t&&!a.done;)o+=a.value.distance;let n=a.value;a.done;let r=(n.distance-o+t)/n.distance;return Object.freeze({latLng:[n.lat+(a.value.lat-n.lat)*r,n.lng+(a.value.lng-n.lng)*r],elev:n.elev+(a.value.elev-n.elev)*r,ascent:100*(a.value.elev-n.elev)/n.distance,routeDistance:t})}getClosestLatLngDistance(t,o){if(0===t.itinerary.itineraryPoints.length)return null;let a=t.itinerary.itineraryPoints.iterator;a.done;let n=Number.MAX_VALUE,r=window.L.Projection.SphericalMercator.project(window.L.latLng(o[0],o[1])),i=window.L.Projection.SphericalMercator.project(window.L.latLng(a.value.lat,a.value.lng)),s=null,l=e.defaultValue,c=a.value.distance;for(;!a.done;){let e=window.L.Projection.SphericalMercator.project(window.L.latLng(a.value.lat,a.value.lng)),t=window.L.LineUtil.pointToSegmentDistance(r,i,e);t<n&&(n=t,s=window.L.Projection.SphericalMercator.unproject(window.L.LineUtil.closestPointOnSegment(r,i,e)),l=c-s.distanceTo(window.L.latLng(a.value.lat,a.value.lng))),c+=a.value.distance,i=e}return Object.freeze({latLng:[s.lat,s.lng],distance:l})}getLatLngBounds(e){let t=window.L.latLng([a.maxLat,a.maxLng]),o=window.L.latLng([a.minLat,a.minLng]);return e.forEach(e=>{t.lat=Math.min(t.lat,e[0]),t.lng=Math.min(t.lng,e[1]),o.lat=Math.max(o.lat,e[0]),o.lng=Math.max(o.lng,e[1])}),window.L.latLngBounds(t,o)}getSquareBoundingBox(e,t){let o=t/6371e3*s.fromRadians,a=e[0]*s.toRadians,n=Math.acos((Math.cos(t/6371e3)-Math.sin(a)**2)/Math.cos(a)**2)*s.fromRadians;return window.L.latLngBounds(window.L.latLng([e[0]-o,e[1]-n]),window.L.latLng([e[0]+o,e[1]+n]))}project(e,t){let o=ue.map.project(window.L.latLng(e),t);return[o.x,o.y]}screenCoordToLatLng(e,t){let o=ue.map.containerPointToLatLng(window.L.point(e,t));return[o.lat,o.lng]}addPoints(e,t){return[e[0]+t[0],e[1]+t[1]]}subtrackPoints(e,t){return[e[0]-t[0],e[1]-t[1]]}},pe=r.margin.toFixed(0),me=(r.margin+r.height).toFixed(0),fe=(r.margin+r.width).toFixed(0),ve=r.margin.toFixed(0),ye=(r.margin+r.width+r.xDeltaText).toFixed(0),be=(r.margin-r.xDeltaText).toFixed(0),we=r.margin+r.height+r.margin/2;function je(){let t=null,o=1,a=1,n=Number.MAX_VALUE,i=0,s=0,c=null,d=0,u=f.route.elev.smoothCoefficient,h=f.route.elev.smoothPoints;function g(){let e=function(){let e=0,t=0,o=[],a=c.itinerary.itineraryPoints.iterator,n=0,r=a.done;for(o.push({distance:e,elev:a.value.elev}),n+=a.value.distance,r=a.done;!r;){for(e+=d;e>=n&&!r;)n+=a.value.distance,r=a.done;if(!r){let r=(a.value.elev-a.previous.elev)/a.previous.distance;t=a.value.elev-(n-e)*r,o.push({distance:e,elev:t})}}return o.push({distance:n,elev:c.itinerary.itineraryPoints.last.elev}),o}(),t=new Map,o=(e[h].elev-e[0].elev)/h,a=0;for(a=0;a<h;a++)t.set(a*d,{distance:a*d,elev:e[0].elev+o*a});for(a=h;a<e.length-h;a++){let o=0;for(let t=a-h;a+h>=t;t++)o+=e[t].elev;t.set(e[a].distance,{distance:e[a].distance,elev:o/(2*h+1)})}return a--,o=d*(e[e.length-1].elev-e[e.length-1-h].elev)/(e[e.length-1].distance-e[e.length-1-h].distance),t.set(e[a].distance+d,{distance:e[a].distance+d,elev:e[a].elev+o}),t.set(e[a].distance+2*d,{distance:e[a].distance+2*d,elev:e[a].elev+2*o}),t}function p(d){return c=d,n=Number.MAX_VALUE,i=0,c.itinerary.itineraryPoints.forEach(e=>{i=Math.max(i,e.elev),n=Math.min(n,e.elev)}),s=i-n,o=r.height/s,a=r.width/c.distance,t=document.createElementNS(l,"svg"),t.setAttributeNS(null,"viewBox","0 0 "+(r.width+2*r.margin)+" "+(r.height+2*r.margin)),t.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile"),function(){let e="",n=0,s=0,d=0;c.itinerary.itineraryPoints.forEach(t=>{s=(r.margin+a*n).toFixed(0),d=(r.margin+o*(i-t.elev)).toFixed(0),e+=s+","+d+" ",n+=t.distance});let u=document.createElementNS(l,"polyline");u.setAttributeNS(null,"points",e),u.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-profilePolyline"),t.appendChild(u)}(),function(){let e=pe+","+ve+" "+pe+","+me+" "+fe+","+me+" "+fe+","+ve,o=document.createElementNS(l,"polyline");o.setAttributeNS(null,"points",e),o.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-framePolyline"),t.appendChild(o)}(),function(){let e=Number.MAX_VALUE,a=0;r.vScales.forEach(t=>{let o=Math.abs(s/4-t);o<e&&(e=o,a=t)});let c=Math.ceil(n/a)*a;for(;c<i;){let e=r.margin+(i-c)*o,n=document.createElementNS(l,"text");n.appendChild(document.createTextNode(c.toFixed(0))),n.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-elevLegend"),n.setAttributeNS(null,"x",ye),n.setAttributeNS(null,"y",e),n.setAttributeNS(null,"text-anchor","start"),t.appendChild(n);let s=document.createElementNS(l,"text");s.appendChild(document.createTextNode(c.toFixed(0))),s.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-elevLegend"),s.setAttributeNS(null,"x",be),s.setAttributeNS(null,"y",e),s.setAttributeNS(null,"text-anchor","end"),t.appendChild(s),c+=a}}(),function(){let o=Number.MAX_VALUE,n=0;r.hScales.forEach(e=>{let t=Math.abs(c.distance/8-e);t<o&&(o=t,n=e)});let i=Math.ceil(c.chainedDistance/n)*n;for(;i<c.distance+c.chainedDistance;){let o=document.createElementNS(l,"text");o.appendChild(document.createTextNode(e.metersInKm<n||0<c.chainedDistance?i/e.metersInKm+" km":i+" m ")),o.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-distLegend"),o.setAttributeNS(null,"x",r.margin+(i-c.chainedDistance)*a),o.setAttributeNS(null,"y",we),o.setAttributeNS(null,"text-anchor","start"),t.appendChild(o),i+=n}}(),t}return new class{constructor(){Object.freeze(this)}smooth(e){!function(e){c=e;let t=c.itinerary.itineraryPoints.iterator,o=0,a=0;for(;!t.done;)o+=t.value.distance,a+=t.next?Math.abs(t.value.elev-t.next.elev):0;if(d=10*Math.floor(u/(a/o)),o<=2*h*d)return;let n=g();t=c.itinerary.itineraryPoints.iterator,t.done;let r=t.value.distance;for(;!t.done;){let e=n.get(Math.floor(r/d)*d),o=n.get(Math.ceil(r/d)*d);if(e&&o){let a=r-e.distance,n=(o.elev-e.elev)/(o.distance-e.distance);t.value.elev=e.elev+a*n}r+=t.value.distance}}(e)}createSvg(e){return p(e)}}}function Te(e,t){let o=t.note,a=v.create("div");if(0!==o.tooltipContent.length&&p.sanitizeToHtmlElement(o.tooltipContent,v.create("div",{className:e+"NoteHtml-TooltipContent"},a)),0!==o.popupContent.length&&p.sanitizeToHtmlElement(o.popupContent,v.create("div",{className:e+"NoteHtml-PopupContent"},a)),0!==o.address.length&&p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Address")+"</span>Â :Â "+o.address,v.create("div",{className:e+"NoteHtml-Address"},a)),0!==o.url.length&&p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Link")+"</span><a href="+o.url+' target="_blank" >'+o.url.substr(0,40)+"...</a>",v.create("div",{className:e+"NoteHtml-Url"},a)),0!==o.phone.length){let t=o.phone;if(o.phone.match(/^\+[0-9, ,*,#]*$/)){let e=o.phone.replaceAll(/\u0020/g,""),a=o.phone.replaceAll(/\u0020/g,"Â ");t=N.getText("HTMLViewsFactory - Phone")+"Â :Â "+N.getText("HTMLViewsFactory - call")+'<a target="_blank" href="tel:'+e+'" >'+a+"</a>"+N.getText("HTMLViewsFactory - Send a sms to")+'<a target="_blank" href="sms:'+e+'" >'+a+"</a>"}else t=N.getText("HTMLViewsFactory - Phone")+"Â :Â "+o.phone;p.sanitizeToHtmlElement(t,v.create("div",{className:e+"NoteHtml-Phone"},a))}if(p.sanitizeToHtmlElement(L.formatLatLng(o.latLng),v.create("div",{className:e+"NoteHtml-LatLng"},a)),t.route){t.route.chain&&p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of travel")+"</span>Â :Â "+L.formatDistance(o.chainedDistance+o.distance),v.create("div",{className:e+"NoteHtml-Distance"},a)),p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of route")+"</span>Â :Â "+L.formatDistance(o.distance),v.create("div",{className:e+"NoteHtml-Distance"},a));let n=t.route.notes.next(o.objId);if(n){let t=n.distance-o.distance;9<t&&p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Next note after")+"</span>Â :Â "+L.formatDistance(t),v.create("div",{className:e+"NoteHtml-NextDistance"},a))}}return a}function Ne(e,t){let o=v.create("div"),a=v.create("div",{className:e+(t.route?"Route-ManeuversAndNotes-IconCell":"Travel-Notes-IconCell")},o),n=1;p.sanitizeToHtmlElement(t.note.iconContent,a),"TravelNotes-Roadbook-"===e&&a.firstChild?("svg"===a.firstChild.tagName?(a.firstChild.setAttributeNS(null,"viewBox","0 0 "+i.svgViewboxDim+" "+i.svgViewboxDim),n=f.note.svgIcon.roadbookFactor):a.firstChild.classList.contains("TravelNotes-MapNoteCategory-0073")&&(n=f.note.svgIcon.roadbookFactor),a.setAttribute("tanwidth",String(t.note.iconWidth*n)+"px"),a.setAttribute("tanheight",String(t.note.iconWidth*n)+"px")):(a.style.width=String(t.note.iconWidth)+"px",a.style.height=String(t.note.iconHeight)+"px");let r=Te(e,t);return r.className=e+(t.route?"Route-ManeuversAndNotes-Cell":"Travel-Notes-Cell"),o.appendChild(r),o.noteObjId=t.note.objId,o}function Le(e){let t=v.create("div",{className:e+"Travel-Notes"}),o=ue.travel.notes.iterator;for(;!o.done;){let a=Ne(e,{note:o.value,route:null});a.className=e+"Travel-Notes-Row",t.appendChild(a)}return t}function Oe(e,t){let o=v.create("div",{className:e+"Route-Header",id:"route"+t.objId});return p.sanitizeToHtmlElement(t.computedName,v.create("div",{className:e+"Route-Header-Name"},o)),0!==t.distance&&p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Route distance")+"</span>Â :Â "+L.formatDistance(t.distance),v.create("div",{className:e+"Route-Header-Distance"},o)),ue.travel.readOnly||"bike"===t.itinerary.transitMode||p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Duration")+"</span>Â :Â "+L.formatTime(t.duration),v.create("div",{className:e+"Route-Header-Duration"},o)),t.itinerary.hasProfile&&(p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Ascent")+"</span>Â :Â "+String(t.itinerary.ascent.toFixed(0))+" m.",v.create("div",{className:e+"Route-Header-Ascent"},o)),p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Descent")+"</span>Â :Â "+String(t.itinerary.descent.toFixed(0))+" m.",v.create("div",{className:e+"Route-Header-Descent"},o))),o}function xe(t,o){let a=v.create("div");v.create("div",{className:t+"Route-ManeuversAndNotes-IconCell TravelNotes-ManeuverNote-"+o.maneuver.iconName},a);let n=v.create("div",{className:t+"Route-ManeuversAndNotes-Cell"},a);return p.sanitizeToHtmlElement(o.maneuver.instruction,v.create("div",null,n)),o.route.chain&&p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of travel")+"</span>Â :Â "+L.formatDistance(o.route.chainedDistance+o.maneuverDistance),v.create("div",{className:t+"Route-Maneuver-Distance"},n)),p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of route")+"</span>Â :Â "+L.formatDistance(o.maneuverDistance),v.create("div",{className:t+"Route-Maneuver-Distance"},n)),e.defaultValue<o.maneuver.distance&&p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Next maneuver after")+"</span>Â :Â "+L.formatDistance(o.maneuver.distance),v.create("div",{className:t+"Route-Maneuver-Distance"},n)),a}function Ie(e,t){let o=[],a=t.notes.iterator;for(;!a.done;){let n=Ne(e,{note:a.value,route:t});n.className=e+"Route-Notes-Row",n.objId=b(),n.latLng=a.value.latLng,n.noteObjId=a.value.objId,n.distance=a.value.distance,o.push(n)}let n=t.itinerary.maneuvers.iterator,r=0;for(;!n.done;){let a=xe(e,{route:t,maneuver:n.value,maneuverDistance:r});a.className=e+"Route-Maneuvers-Row",a.objId=b(),a.latLng=t.itinerary.itineraryPoints.getAt(n.value.itineraryPointObjId).latLng,a.maneuverObjId=n.value.objId,a.distance=r,o.push(a),r+=n.value.distance}o.sort((e,t)=>e.distance-t.distance);let i=v.create("div",{className:e+"Route-ManeuversAndNotes"});return o.forEach(e=>i.appendChild(e)),i}function Ae(e,t){let o="";""!==t.itinerary.provider&&""!==t.itinerary.transitMode&&(o=N.getText("HTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:t.itinerary.provider,transitMode:N.getText("HTMLViewsFactory - TransitMode "+t.itinerary.transitMode)}));let a=v.create("div",{className:e+"RouteFooter"});return p.sanitizeToHtmlElement(o,a),a}function Me(e,t){let o=v.create("div",{className:e+"RouteProfile"});return p.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Profile"),o),o.appendChild(je().createSvg(t)),o}function Pe(t){let o=v.create("div",{className:t+"Travel"});o.appendChild(function(t){let o=v.create("div",{className:t+"Travel-Header"});p.sanitizeToHtmlElement(ue.travel.name,v.create("div",{className:t+"Travel-Header-Name"},o));let a=e.defaultValue,n=0,r=0,i=ue.travel.routes.iterator;for(;!i.done;){let e=i.value.objId===ue.editedRouteObjId&&f.routeEditor.showEditedRouteInRoadbook?ue.travel.editedRoute:i.value;p.sanitizeToHtmlElement('<a href="#route'+e.objId+'" >'+e.computedName+"</a>Â :Â "+L.formatDistance(e.distance)+".",v.create("div",{className:t+"Travel-Header-RouteName"},o)),e.chain&&(a+=e.distance,n+=e.itinerary.ascent,r+=e.itinerary.descent)}return p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Travel distance")+"</span>Â :Â "+L.formatDistance(a),v.create("div",{className:t+"Travel-Header-TravelDistance"},o)),0!==n&&p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Travel ascent")+"</span>Â :Â "+String(n.toFixed(0))+" m.",v.create("div",{className:t+"Travel-Header-TravelAscent"},o)),0!==r&&p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Travel descent")+"</span>Â :Â "+String(r.toFixed(0))+" m.",v.create("div",{className:t+"Travel-Header-TravelDescent"},o)),o}(t)),o.appendChild(Le(t));let a=ue.travel.routes.iterator;for(;!a.done;){let e=f.routeEditor.showEditedRouteInRoadbook&&a.value.objId===ue.editedRouteObjId?ue.travel.editedRoute:a.value;o.appendChild(Oe(t,e)),e.itinerary.hasProfile&&o.appendChild(Me(t,e)),o.appendChild(Ie(t,e)),o.appendChild(Ae(t,e))}return o.appendChild(function(e){let t=N.getText("HTMLViewsFactory - Travel footer")+'<a href="https://github.com/wwwouaiebe/leaflet.TravelNotes" target="_blank" title="https://github.com/wwwouaiebe/leaflet.TravelNotes" >Travel & Notes</a>, Â© <a href="https://www.ouaie.be/" target="_blank" title="https://www.ouaie.be/" >wwwouaiebe 2017 2021</a> Â© <a href="https://www.openstreetmap.org/copyright" target="_blank" title="https://www.openstreetmap.org/copyright">'+N.getText("HTMLViewsFactory - OpenStreetMap contributors")+"</a>",o=v.create("div",{className:e+"TravelFooter"});return p.sanitizeToHtmlElement(t,o),o}(t)),o}const Se=new class{constructor(){Object.freeze(this)}getTravelHTML(e){return Pe(e)}getNoteTextAndIconHTML(e,t){return Ne(e,t)}getNoteTextHTML(e,t){return Te(e,t)}getEditedRouteManeuversAndNotesHTML(e){return Ie(e,ue.travel.editedRoute)}getTravelNotesHTML(e){return Le(e)}getRouteHeaderHTML(e,t){return Oe(e,t)}};let Ee=null,Ce=null;function ze(e){let t=he.getRoute(e.target.objId),o=ge.getClosestLatLngDistance(t,[e.latlng.lat,e.latlng.lng]).distance;o+=t.chainedDistance,o=L.formatDistance(o);let a=ue.mapObjects.get(e.target.objId);a.closeTooltip();let n=t.computedName;ue.travel.readOnly||(n+=0===n.length?"":" - ",n+=o),a.setTooltipContent(n),a.openTooltip(e.latlng)}function De(e,t){t.objId=e,t.addTo(ue.map),ue.mapObjects.set(e,t)}function Re(e){let t=he.getNoteAndRoute(e).note,o=window.L.marker(t.latLng,{icon:window.L.divIcon({iconSize:[f.note.grip.size,f.note.grip.size],iconAnchor:[f.note.grip.size/2,f.note.grip.size/2],html:"<div></div>",className:"TravelNotes-Map-Note-Bullet"}),opacity:f.note.grip.opacity,draggable:!ue.travel.readOnly});o.objId=t.objId;let a=window.L.divIcon({iconSize:[t.iconWidth,t.iconHeight],iconAnchor:[t.iconWidth/2,t.iconHeight/2],popupAnchor:[0,-t.iconHeight/2],html:t.iconContent,className:"TravelNotes-Map-AllNotes "}),n=window.L.marker(t.iconLatLng,{zIndexOffset:100,icon:a,draggable:!ue.travel.readOnly});n.objId=t.objId,n.bindPopup(e=>Se.getNoteTextHTML("TravelNotes-Map-",he.getNoteAndRoute(e.objId))),0!==t.tooltipContent.length&&(n.bindTooltip(e=>he.getNoteAndRoute(e.objId).note.tooltipContent),n.getTooltip().options.offset[0]=t.iconWidth/2);let r=window.L.polyline([t.latLng,t.iconLatLng],f.note.polyline);r.objId=t.objId;let i=window.L.layerGroup([n,r,o]);return i.markerId=window.L.Util.stamp(n),i.polylineId=window.L.Util.stamp(r),i.bulletId=window.L.Util.stamp(o),De(t.objId,i),f.note.haveBackground&&document.querySelectorAll(".TravelNotes-MapNote,.TravelNotes-SvgIcon").forEach(e=>e.classList.add("TravelNotes-Map-Note-Background")),Object.freeze({marker:n,polyline:r,bullet:o})}function He(e){e.dashArray>=f.route.dashChoices.length&&(e.dashArray=0);let t=f.route.dashChoices[e.dashArray].iDashArray;if(t){let o="",a=0;for(a=0;a<t.length-1;a++)o+=t[a]*e.width+",";return o+=t[a]*e.width,o}return null}const Ve=new class{constructor(){Object.freeze(this)}addRoute(e){let t=he.getRoute(e),o=[],a=t.itinerary.itineraryPoints.iterator;for(;!a.done;)o.push(a.value.latLng);let r=window.L.polyline(o,{color:t.color,weight:t.width,dashArray:He(t)});De(t.objId,r),n.notEdited===t.editionStatus&&(r.bindTooltip(t.computedName,{sticky:!0,direction:"right"}),r.on("mouseover",ze),r.on("mousemove",ze)),r.bindPopup(e=>{let t=he.getRoute(e.objId);return Se.getRouteHeaderHTML("TravelNotes-Map-",t)}),window.L.DomEvent.on(r,"click",e=>e.target.openPopup(e.latlng));let i=t.notes.iterator;for(;!i.done;)Re(i.value.objId);return t}addNote(e){return Re(e)}getDashArray(e){return He(e)}zoomTo(e,t){if(t){let e=[];t.forEach(t=>e=e.concat(t)),ue.map.fitBounds(ge.getLatLngBounds(e))}else ue.map.setView(e,f.itineraryPoint.zoomFactor)}setLayer(e,t){let o=null;o="wmts"===e.service.toLowerCase()?window.L.tileLayer(t):window.L.tileLayer.wms(t,e.wmsOptions),Ee&&ue.map.removeLayer(Ee),ue.map.addLayer(o),Ee=o,ue.travel.readOnly||(ue.map.getZoom()<(e.minZoom||0)&&ue.map.setZoom(e.minZoom||0),ue.map.setMinZoom(e.minZoom||0),ue.map.getZoom()>(e.maxZoom||18)&&ue.map.setZoom(e.maxZoom||18),ue.map.setMaxZoom(e.maxZoom||18),e.bounds?(ue.map.getBounds().intersects(e.bounds)&&!ue.map.getBounds().contains(e.bounds)||(ue.map.setMaxBounds(null),ue.map.fitBounds(e.bounds),ue.map.setZoom(e.minZoom||0)),ue.map.setMaxBounds(e.bounds)):ue.map.setMaxBounds(null)),ue.map.fire("baselayerchange",o)}onGeolocationStatusChanged(e){t.active!==e&&Ce&&(ue.map.removeLayer(Ce),Ce=null)}onGeolocationPositionChanged(e){let t=f.geoLocation.zoomToPosition;Ce&&(ue.map.removeLayer(Ce),t=!1),Ce=window.L.circleMarker(window.L.latLng(e.coords.latitude,e.coords.longitude),f.geoLocation.marker).bindTooltip(L.formatLatLng([e.coords.latitude,e.coords.longitude])).addTo(ue.map),t&&ue.map.setView(window.L.latLng(e.coords.latitude,e.coords.longitude),f.geoLocation.zoomFactor)}};const ke=new class{constructor(){Object.freeze(this)}dispatch(e,t){let o=function(e){return-1<["showitinerary","updateitinerary","showtravelnotes","updatetravelnotes","showsearch","updatesearch","setrouteslist","setprovider","providersadded","travelnameupdated","settransitmode"].indexOf(e)?document.querySelector("#TravelNotes-UI-MainDiv"):-1<["removeobject","removeallobjects","zoomto","additinerarypointmarker","addsearchpointmarker","addrectangle","addwaypoint","layerchange","geolocationstatuschanged","geolocationpositionchanged","routeupdated","routepropertiesupdated","noteupdated","roadbookupdate","profileclosed"].indexOf(e)?document:null}(e);if(o){let a=new Event(e);t&&(a.data=t),o.dispatchEvent(a)}}};function Fe(e){return Math.floor(Math.abs(e)+.5)*(0<=e?1:-1)}const Ue=new class{constructor(){Object.freeze(this)}encode(e,t){if(!e.length)return"";let o=t.length,a=Array.from(t,e=>Math.pow(10,e));function n(e,t,o){let a=Fe(e*o),n=Fe(t*o),r=a-n;r<<=1,0>a-n&&(r=~r);let i="";for(;32<=r;)i+=String.fromCharCode(63+(32|31&r)),r>>=5;return i+=String.fromCharCode(r+63),i}let r="";for(let t=0;t<o;t++)r+=n(e[0][t],0,a[t]);for(let t=1;t<e.length;t++){let i=e[t],s=e[t-1];for(let e=0;e<o;e++)r+=n(i[e],s[e],a[e])}return r}decode(e,t){let o=t.length;if(!e||0===e.length)return[];let a=0,n=[],r=Array.from(t,e=>Math.pow(10,e)),i=new Array(o).fill(0);function s(){let t=null,o=0,n=0;do{t=e.charCodeAt(a++)-63,n|=(31&t)<<o,o+=5}while(32<=t);return 1&n?~(n>>1):n>>1}for(;a<e.length;){let e=new Array(o).fill(0);for(let t=0;t<o;t++)i[t]+=s(),e[t]=i[t]/r[t];n.push(e)}return n}};function Be(){let e=[];function t(t){e.push(t.latLng),e.push(t.iconLatLng)}function o(o){o.itinerary.itineraryPoints.forEach(t=>e.push(t.latLng)),o.notes.forEach(e=>t(e))}return new class{constructor(){Object.freeze(this)}zoomToLatLng(e){ke.dispatch("zoomto",{latLng:e})}zoomToManeuver(e){let t=ue.travel.editedRoute.itinerary.maneuvers.getAt(e).itineraryPointObjId,o=ue.travel.editedRoute.itinerary.itineraryPoints.getAt(t).latLng;ke.dispatch("zoomto",{latLng:o})}zoomToNote(o){e=[],t(he.getNoteAndRoute(o).note),ke.dispatch("zoomto",{geometry:[e]})}zoomToRoute(t){e=[],o(he.getRoute(t)),ke.dispatch("zoomto",{geometry:[e]})}zoomToTravel(){e=[],ue.travel.routes.forEach(e=>o(e)),-1!==ue.travel.editedRouteObjId&&o(ue.travel.editedRoute),ue.travel.notes.forEach(e=>t(e)),ke.dispatch("zoomto",{geometry:[e]})}zoomToPoi(e){ke.dispatch("zoomto",e)}}}function We(){return new class{constructor(){Object.freeze(this)}openDistantFile(t){(function(){function t(e){let t={};0!==e.itinerary.itineraryPoints.length&&(t=e.itinerary.itineraryPoints[0].objType);let o={values:"",objType:t},n=[];e.itinerary.itineraryPoints.forEach(e=>{n.push([e.lat,e.lng,e.distance,e.elev,e.objId])}),o.values=Ue.encode(n,[a.fixed,a.fixed,2,2,0]),e.itinerary.itineraryPoints=o}function r(t){let n=[];if(t.itinerary.itineraryPoints.values)Ue.decode(t.itinerary.itineraryPoints.values,[a.fixed,a.fixed,2,2,0]).forEach(r=>{let i={lat:a.defaultValue,lng:a.defaultValue,distance:e.defaultValue,elev:o.defaultValue,objId:-1};[i.lat,i.lng,i.distance,i.elev,i.objId]=r,i.objType=t.itinerary.itineraryPoints.objType,n.push(i)});else{t.itinerary.itineraryPoints.latLngs=Ue.decode(t.itinerary.itineraryPoints.latLngs,[a.fixed,a.fixed]);let e=0;t.itinerary.itineraryPoints.latLngs.forEach(a=>{let r={};r.lat=a[0],r.lng=a[1],r.distance=t.itinerary.itineraryPoints.distances[e],t.itinerary.itineraryPoints.elevs?r.elev=t.itinerary.itineraryPoints.elevs[e]:r.elev=o.defaultValue,r.objId=t.itinerary.itineraryPoints.objIds[e],r.objType=t.itinerary.itineraryPoints.objType,n.push(r),e++})}t.itinerary.itineraryPoints=n}function i(e){e.routes.forEach(r),e.editedRoute&&r(e.editedRoute)}return new class{constructor(){Object.freeze(this)}decompress(e){i(e),ue.travel.jsonObject=e,ue.editedRouteObjId=-1,ue.travel.routes.forEach(e=>{n.notEdited!==e.editionStatus&&(ue.editedRouteObjId=e.objId)})}decompressMerge(e){i(e);let t=ie();t.jsonObject=e;let o=t.routes.iterator;for(;!o.done;)ue.travel.routes.add(o.value);let a=t.notes.iterator;for(;!a.done;)ue.travel.notes.add(a.value)}compress(e){let o=e.jsonObject;return o.routes.forEach(t),t(o.editedRoute),o}}})().decompress(t),ue.travel.readOnly=!0,this.display()}display(){document.title="Travel & Notes"+(""===ue.travel.name?"":" - "+ue.travel.name);let e=ue.travel.routes.iterator;for(;!e.done;)n.notEdited===e.value.editionStatus&&ke.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:e.value.objId});-1!==ue.editedRouteObjId&&ke.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:ue.travel.editedRoute.objId});let t=ue.travel.notes.iterator;for(;!t.done;)ke.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:t.value.objId});Be().zoomToTravel()}}}let _e=null;const Ze=new class{constructor(){Object.freeze(this)}createUI(){_e=v.create("div",{id:"TravelNotes-AttributionsUI"},document.body),this.attributions=""}set attributions(e){let t='Â© <a href="https://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> | Â© <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+e+'| Â© <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a>';for(;_e.firstChild;)_e.removeChild(_e.firstChild);p.sanitizeToHtmlElement(t,_e)}};let Ke="geolocation"in navigator?t.inactive:t.disabled,Ge=null;function Je(e){ke.dispatch("geolocationpositionchanged",{position:e})}function qe(){t.active===Ke&&(Ke=t.inactive),ke.dispatch("geolocationstatuschanged",{status:Ke}),navigator.geolocation.clearWatch(Ge),Ge=null}function Xe(e){1===e.code&&(Ke=t.refusedByUser),qe()}const $e=new class{constructor(){Object.freeze(this)}get status(){return Ke}switch(){switch(Ke){case t.inactive:Ke=t.active,ke.dispatch("geolocationstatuschanged",{status:Ke}),navigator.geolocation.getCurrentPosition(Je,Xe,f.geoLocation.options),Ge=navigator.geolocation.watchPosition(Je,Xe,f.geoLocation.options);break;case t.active:qe()}return Ke}};let Qe=null,Ye=[{service:"wmts",url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"red",backgroundColor:"white"},providerName:"OSM",providerKeyNeeded:!1,attribution:""}];function et(e){e.stopPropagation(),ke.dispatch("layerchange",{layer:e.target.layer}),Ze.attributions=e.target.layer.attribution}function tt(e){e.stopPropagation(),$e.switch()}function ot(e){e.stopPropagation(),Be().zoomToTravel()}function at(e){v.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:e.name,layer:e,textContent:e.toolbar.text,style:"color:"+e.toolbar.color+";background-color:"+e.toolbar.backgroundColor},Qe).addEventListener("click",et,!1)}const nt=new class{constructor(){Object.freeze(this)}createUI(){Qe=v.create("div",{id:"TravelNotes-ViewerLayersToolbarUI"},document.body),v.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"My position",textContent:"ðŸŒ",style:"color:black;background-color:white"},Qe).addEventListener("click",tt,!1),v.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"Zoom on the travel",textContent:"ðŸ”",style:"color:black;background-color:white"},Qe).addEventListener("click",ot,!1),Ye.forEach(at)}setLayer(e){let t=e.match(/^[0-9]$/)?Ye[Number.parseInt(e)]||Ye[0]:Ye.find(t=>t.name===e)||Ye[0];ke.dispatch("layerchange",{layer:t}),Ze.attributions=t.attribution}addLayers(e){e.forEach(e=>{e.providerKeyNeeded||Ye.push(e)})}};let rt=!1;function it(e){if("Z"===e.key||"z"===e.key)Be().zoomToTravel();else if("G"===e.key||"g"===e.key)$e.switch();else{let t=e.key.charCodeAt(0);47<t&&58>t&&nt.setLayer(e.key)}}const st=new class{constructor(){Object.freeze(this)}addReadOnlyMap(e,t){rt||(rt=!0,document.addEventListener("keydown",it,!0),document.addEventListener("routeupdated",e=>{e.data&&Ve.addRoute(e.data.addedRouteObjId)},!1),document.addEventListener("noteupdated",e=>{e.data&&Ve.addNote(e.data.addedNoteObjId)},!1),document.addEventListener("zoomto",e=>{e.data&&Ve.zoomTo(e.data.latLng,e.data.geometry)},!1),document.addEventListener("layerchange",e=>{e.data&&Ve.setLayer(e.data.layer,e.data.layer.url)}),document.addEventListener("geolocationpositionchanged",e=>{e.data&&Ve.onGeolocationPositionChanged(e.data.position)},!1),document.addEventListener("geolocationstatuschanged",e=>{e.data&&Ve.onGeolocationStatusChanged(e.data.status)},!1),Ze.createUI(),t&&nt.createUI(),nt.setLayer("OSM - Color"),e&&async function(e){let t=await fetch(e);if(200===t.status&&t.ok){let e=await t.json();We().openDistantFile(e)}else ue.map.setView([a.defaultValue,a.defaultValue],2),document.title="Travel & Notes"}(e))}};!function(){let e=null,t=null,o=!1,n=window.location.href.substr(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes";!async function(){!function(){let a=new URL(window.location),n=a.searchParams.get("fil");if(n&&0!==n.length)try{if(n=atob(n),n.match(/[^\w-%:./]/))throw new Error("invalid char in the url encoded in the fil parameter");let e=new URL(n);if(!(a.protocol&&e.protocol&&a.protocol===e.protocol&&a.hostname&&e.hostname&&a.hostname===e.hostname))throw new Error("The distant file is not on the same site than the app");t=encodeURI(e.href)}catch(e){e instanceof Error&&console.error(e)}let r=a.searchParams.get("lng");r&&r.match(/^[A-Z,a-z]{2}$/)&&(e=r.toLowerCase()),""===a.searchParams.get("lay")&&(o=!0)}(),await async function(){let t=await fetch(n+"Config.json");if(200===t.status&&t.ok){let o=await t.json();return o.travelNotes.language=e||o.travelNotes.language,"wwwouaiebe.github.io"===window.location.hostname&&(o.note.haveBackground=!0),f.overload(o),!0}return!1}()?(e=e||f.travelNotes.language,await async function(){let t=await fetch(n+e.toUpperCase()+".json");return!(200!==t.status||!t.ok)&&(N.setTranslations(await t.json()),!0)}()?await async function(){let e=await fetch(n+"Layers.json");return!(200!==e.status||!e.ok)&&(nt.addLayers(await e.json()),!0)}()?function(){v.create("div",{id:"TravelNotes-Map"},document.body);let e=window.L.map("TravelNotes-Map",{attributionControl:!1,zoomControl:!1}).setView([a.defaultValue,a.defaultValue],2);ue.map=e,st.addReadOnlyMap(t,o)}():document.body.textContent="Not possible to load the TravelNotesLayers.json file. ":document.body.textContent="Not possible to load the TravelNotesConfig"+e.toUpperCase()+".json file. "):document.body.textContent="Not possible to load the TravelNotesConfig.json file. "}()}()}();