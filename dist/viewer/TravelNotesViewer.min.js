/**
 * 
 * @source: https://github.com/wwwouaiebe/leaflet.TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * leaflet.travelnotes - version 2.0.0
 * Build 00923 - 2021-01-13T08:35:39+0100 
 * Copyright 2017 2021 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Constants.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/const e=Object.freeze({fixed:2,invalid:-1,defaultValue:0}),t=Object.freeze({refusedByUser:-1,disabled:0,inactive:1,active:2}),o=(Object.freeze({invalidPane:"43a6a53e-008a-4910-80a6-7a87d301ea15",itineraryPane:"8fbf0da7-4e6f-4bc7-8e20-1388461ccde7",travelNotesPane:"dffe782b-07df-4b81-a318-f287c0cf5ec6",searchPane:"228f00d7-43a8-4c13-897d-70400cb6dd58"}),Object.freeze({fixed:2,defaultValue:0})),a=Object.freeze({defaultValue:0,fixed:6}),n=Object.freeze({notEdited:0,editedNoChange:1,editedChanged:2}),r=Object.freeze({margin:100,height:500,width:1e3,yDeltaText:30,xDeltaText:10,vScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],hScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}),i=Object.freeze({width:40,height:40,svgViewboxDim:200}),s="http://www.w3.org/2000/svg";let l=new Map;l.set("a",["href","target"]),l.set("br",[]),l.set("div",[]),l.set("del",[]),l.set("em",[]),l.set("figcaption",[]),l.set("figure",[]),l.set("h1",[]),l.set("h2",[]),l.set("h3",[]),l.set("h4",[]),l.set("h5",[]),l.set("h6",[]),l.set("hr",[]),l.set("img",["src","alt","width","height"]),l.set("ins",[]),l.set("li",[]),l.set("mark",[]),l.set("ol",[]),l.set("p",[]),l.set("s",[]),l.set("small",[]),l.set("strong",[]),l.set("span",[]),l.set("sub",[]),l.set("sup",[]),l.set("ul",[]),l.set("svg",["xmlns","viewBox","class"]),l.set("text",["x","y","text-anchor"]),l.set("polyline",["points","class","transform"]);const c=window.location.protocol,d=new DOMParser;function u(e){return e.replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;").replaceAll(/"/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}function h(e,t="href"){let o=d.parseFromString("<div>"+e+"</div>","text/html");if(!o||"#document"!==o.nodeName)return{url:"",errorsString:"Parsing error"};let a=o.querySelector("body").firstChild,n="";for(let e=0;e<a.childNodes.length;e++){if("#text"!==a.childNodes[e].nodeName)return{url:"",errorsString:"Invalid characters found in the url"};n+=a.childNodes[e].nodeValue}if(n=n.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),n!==e)return{url:"",errorsString:"Invalid characters found in the url"};let r=["https:"];if("http:"!==c&&"href"!==t||r.push("http:"),"href"===t){r.push("mailto:"),r.push("sms:"),r.push("tel:");let e=n.match(/^#\w*/);if(e&&n===e[0])return{url:n,errorsString:""}}"src"===t&&r.push("data:");let i=null;try{i=new URL(n)}catch(e){return{url:"",errorsString:"Invalid url string"}}if(-1===r.indexOf(i.protocol))return{url:"",errorsString:"Invalid protocol "+i.protocol};if(-1!==["sms:","tel:"].indexOf(i.protocol)&&i.pathname.match(/^\+[0-9,*,#]*$/))return{url:n,errorsString:""};try{encodeURIComponent(i.href)}catch(e){return{url:"",errorsString:"Invalid character in url"}}return{url:n,errorsString:""}}const g=Object.freeze(new class{sanitizeToColor(e){let t=e.match(/^#[0-9,A-F,a-f]{6}$/);return t?t[0]:null}sanitizeToUrl(e,t){return h(e,t)}sanitizeToJsString(e){return function(e){let t=d.parseFromString("<div>"+e+"</div>","text/html");if(!t||"#document"!==t.nodeName)return"";let o=t.querySelector("body").firstChild,a="";for(let e=0;e<o.childNodes.length;e++){if("#text"!==o.childNodes[e].nodeName)return"";a+=o.childNodes[e].nodeValue}return a=a.replaceAll(/</g,"≺").replaceAll(/>/g,"≻").replaceAll(/"/g,"″").replaceAll(/\u0027/g,"′"),a}(e)}sanitizeToHtmlElement(e,t){!function(e,t){let o=d.parseFromString("<div>"+e+"</div>","text/html");o&&"#document"===o.nodeName?function e(t,o){let a=t.childNodes;for(let n=0;n<a.length;n++){let a=t.childNodes[n],r=a.nodeName.toLowerCase(),i=l.get(r);if(i){i=i.concat(["id","class","dir","title"]);let t="svg"===r||"text"===r||"polyline"===r,n=t?document.createElementNS(s,r):document.createElement(r);if(i.forEach(e=>{if(t)a.hasAttributeNS(null,e)&&(n.setAttributeNS(null,e,a.getAttribute(e)),a.removeAttributeNS(null,e));else if(a.hasAttribute(e))if("href"===e||"src"===e){let t=h(a.getAttribute(e),e).url;""!==t&&n.setAttribute(e,t)}else n.setAttribute(e,a.getAttribute(e))}),a.hasAttribute("style")){a.getAttribute("style").split(";").forEach(e=>{let t=e.split(":");2!==t.length||"width"!==t[0].trim()&&"height"!==t[0].trim()||(n.style[t[0].trim()]=t[1].trim())})}o.appendChild(n),e(a,n)}else"#text"===r&&o.appendChild(document.createTextNode(a.nodeValue))}}(o.querySelector("body").firstChild,t):t.textContent=""}(e,t)}sanitizeToHtmlString(e){return function(e){let t="",o="",a=d.parseFromString("<div>"+e.replace("&nbsp;","਀")+"</div>","text/html");return a&&"#document"===a.nodeName?(function e(a){let n=a.childNodes;for(let r=0;r<n.length;r++){let n=a.childNodes[r],i=n.nodeName.toLowerCase(),s=l.get(i);if(s){s=s.concat(["id","class","dir","title"]);let a="svg"===i||"text"===i||"polyline"===i;t+="<"+i,s.forEach(e=>{if(a)n.hasAttributeNS(null,e)&&(t+=" "+e+'="'+u(n.getAttribute(e))+'"',n.removeAttribute(e));else if(n.hasAttribute(e))if("href"===e||"src"===e){let a=h(n.getAttribute(e),e).url;""===a?o+="\nAn invalid url ("+n.getAttribute(e)+") was removed from a "+e+" attribute":t+=" "+e+'="'+a+'"',n.removeAttribute(e)}else t+=" "+e+'="'+u(n.getAttribute(e))+'"',n.removeAttribute(e)}),t+=">",e(n),t+="</"+i+">"}else"#text"===i?t+=u(n.nodeValue):o+="\nAn invalid tag "+i+" was removed";if(n.hasAttributes)for(let e=0;e<n.attributes.length;e++)o+="\nAn unsecure attribute "+n.attributes[e].name+'="'+n.attributes[e].value+'" was removed.'}}(a.querySelector("body").firstChild),{htmlString:t,errorsString:o}):{htmlString:"",errorsString:"Parsing error"}}(e)}});let p={autoLoad:!1,map:{center:{lat:50.50923,lng:5.49542},zoom:12},travelNotesToolbarUI:{contactMail:{url:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues"}},layersToolbarUI:{haveLayersToolbarUI:!0,toolbarTimeOut:1500,theDevil:{addButton:!1}},mouseUI:{haveMouseUI:!0},errorUI:{timeOut:1e4,helpTimeOut:3e4,showError:!0,showWarning:!0,showInfo:!0,showHelp:!0},geoLocation:{color:"#ff0000",radius:11,zoomToPosition:!0,zoomFactor:17,options:{enableHighAccuracy:!1,maximumAge:0,timeout:1/0}},APIKeys:{showDialogButton:!0,saveToSessionStorage:!0,showAPIKeysInDialog:!0,dialogHaveUnsecureButtons:!0},contextMenu:{timeout:1500},routing:{auto:!0},language:"fr",itineraryPointMarker:{color:"#ff0000",weight:2,radius:7,fill:!1},searchPointMarker:{color:"#006400",weight:4,radius:20,fill:!1},searchPointPolyline:{color:"#006400",weight:4,radius:20,fill:!1},previousSearchLimit:{color:"#006400",fill:!1,weight:1},nextSearchLimit:{color:"#ff0000",fill:!1,weight:1},wayPoint:{reverseGeocoding:!1},route:{color:"#ff0000",width:3,dashArray:0,dashChoices:[{text:"——————",iDashArray:null},{text:"— — — — —",iDashArray:[4,2]},{text:"—‧—‧—‧—‧—",iDashArray:[4,2,0,2]},{text:"················",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:.25,smoothPoints:3},showDragTooltip:3},note:{osmSearchNoteDialog:!1,reverseGeocoding:!1,grip:{size:10,opacity:0,moveOpacity:1},polyline:{color:"#808080",weight:1},haveBackground:!1,svgRoadbookDimCoef:2,svgAnleMaxDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},svgZoom:17,svgAngleDistance:10,svgHamletDistance:200,svgVillageDistance:400,svgCityDistance:1200,svgTownDistance:1500,svgTimeOut:40,maxManeuversNotes:100},noteDialog:{toggleIconDimension:!0,toggleIconTextArea:!1,toggleTooltip:!1,togglePopupContent:!1,toggleAddress:!1,toggleLink:!1,togglePhone:!0,iconAreaHeight:2,popupAreaHeigth:8},itineraryPointZoom:17,routeEditor:{displayEditionInHTMLPage:!0},travelEditor:{clearAfterSave:!0,startMinimized:!0,timeout:1e3,startupRouteEdition:!0},haveBeforeUnloadWarning:!0,overpassApi:{url:"https://lz4.overpass-api.de/api/interpreter"},nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},printRouteMap:{isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,pageBreak:!1,printNotes:!0,borderWidth:30,zoomFactor:15,entryPointMarker:{color:"#00ff00",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"#ff0000",weight:4,radius:10,fill:!0,fillOpacity:1}},haveCrypto:!1,itineraryPane:{showNotes:!0,showManeuvers:!1},colorDialog:{haveSlider:!0,initialRed:0}};let m=new class{get autoLoad(){return p.autoLoad}get map(){return p.map}get travelNotesToolbarUI(){return p.travelNotesToolbarUI}get layersToolbarUI(){return p.layersToolbarUI}get mouseUI(){return p.mouseUI}get errorUI(){return p.errorUI}get APIKeys(){return p.APIKeys}get contextMenu(){return p.contextMenu}get routing(){return p.routing}get language(){return p.language}get itineraryPointMarker(){return p.itineraryPointMarker}get searchPointMarker(){return p.searchPointMarker}get searchPointPolyline(){return p.searchPointPolyline}get previousSearchLimit(){return p.previousSearchLimit}get nextSearchLimit(){return p.nextSearchLimit}get wayPoint(){return p.wayPoint}get route(){return p.route}get note(){return p.note}get noteDialog(){return p.noteDialog}get itineraryPointZoom(){return p.itineraryPointZoom}get routeEditor(){return p.routeEditor}get travelEditor(){return p.travelEditor}get haveBeforeUnloadWarning(){return p.haveBeforeUnloadWarning}get overpassApi(){return p.overpassApi}get nominatim(){return p.nominatim}get geoLocation(){return p.geoLocation}get printRouteMap(){return p.printRouteMap}get haveCrypto(){return p.haveCrypto}get itineraryPane(){return p.itineraryPane}get colorDialog(){return p.colorDialog}overload(e){!function e(t,o){if("object"==typeof t&&"object"==typeof o)try{for(let a in o)"object"==typeof o[a]?e(t[a],o[a]):typeof t[a]==typeof o[a]&&("string"==typeof o[a]?o[a]="color"===a?g.sanitizeToColor(t[a])||o[a]:"url"===a?g.sanitizeToUrl(t[a]).url:g.sanitizeToJsString(t[a]):o[a]=t[a]||o[a]);for(let a in t)"object"==typeof t[a]?("[object Array]"===Object.prototype.toString.call(t[a])?o[a]=o[a]||[]:o[a]=o[a]||{},e(t[a],o[a])):"string"==typeof o.property?o[a]=g.sanitizeToHtmlString(t[a],[]).htmlString:o[a]=t[a]}catch(e){console.log(e||"Not possible to overload Config")}}(e,p),p=function e(t){for(let o in t)"object"==typeof t[o]&&(t[o]=e(t[o]));return Object.freeze(t)}(p)}};
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file HTMLElementsFactory.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/const f=Object.freeze(new class{create(e,t,o){let a=null;return"text"===e.toLowerCase()?a=document.createTextNode(t.value||""):(a=document.createElement(e),t&&function(e,t){for(let o in t)try{e[o]=t[o]}catch(e){console.log("Invalid property : "+o)}}(a,t)),o&&o.appendChild(a),a}});const v=Object.freeze(new
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file HttpRequestBuilder.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/
class{getTextPromise(e,t){return new Promise((function(o,a){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){a("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onreadystatechange=function(){4===n.readyState&&(200===n.status?o(n.responseText):a("Error XMLHttpRequest - File : "+n.responseURL))},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.overrideMimeType("text/plain"),n.send(null)}))}getJsonPromise(e,t){return new Promise((function(o,a){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){a("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){let e=null;try{e=JSON.parse(n.responseText)}catch(e){a(e.message+" File: "+n.responseURL)}o(e)}else a("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.overrideMimeType("application/json"),n.send(null)}))}getBinaryPromise(e,t){return new Promise((function(o,a){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){a("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onload=function(){if(200===n.status){let e=n.response;e?o(e):a("Error XMLHttpRequest - File : "+n.responseURL)}else a("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.responseType="arraybuffer",n.send(null)}))}});let y=0;function b(){return++y,y}
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Version.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/function w(e){const t=e;return Object.seal(new class{get name(){return t}get version(){return"2.0.0"}get jsonObject(){return{name:t,version:"2.0.0"}}validate(e){if(!Object.getOwnPropertyNames(e).includes("name"))throw new Error("No name for "+t);if(t!==e.name)throw new Error("Invalid name for "+t);if(!Object.getOwnPropertyNames(e).includes("version"))throw new Error("No version for "+t)}})}function j(e){const t=e;let o=[];const a=function(){let e=t();if(!e.objType||!e.objType.name)throw new Error("invalid object name for collection");return e.objType.name}();function n(e){if(!e.objType||!e.objType.name||e.objType.name!==a)throw new Error("invalid object name for add function");o.push(e)}function r(){let e=-1;return Object.seal({get value(){return e<o.length?o[e]:null},get previous(){return 0>=e?null:o[e-1]},get next(){return e<o.length-1?o[e+1]:null},get done(){return++e>=o.length},get first(){return 0===e},get last(){return e>=o.length-1},get index(){return e}})}function i(e){return o.findIndex(t=>t.objId===e)}function s(e,t,a){let n=i(e);if(-1===n)throw new Error("invalid objId for next or previous function");if(1!==a&&-1!==a)throw new Error("invalid direction");let r=t;for(r||(r=()=>!0),n+=a;-1<n&&n<o.length&&!r(o[n]);)n+=a;return-1===n||o.length===n?null:o[n]}return Object.seal(new class{add(e){n(e)}forEach(e){let t=null,o=r();for(;!o.done;)t=e(o.value,t);return t}getAt(e){let t=i(e);return-1===t?null:o[t]}moveTo(e,t,a){let n=i(e),r=i(t);if(-1===n||-1===r)throw new Error("invalid objId for function  myMoveTo");a||r++,o.splice(r,0,o[n]),r<n&&n++,o.splice(n,1)}next(e,t){return s(e,t,1)}previous(e,t){return s(e,t,-1)}remove(e){if(-1===i(e))throw new Error("invalid objId for remove function");o.splice(i(e),1)}removeAll(e){e?o.splice(1,o.length-2):o.length=0}replace(e,t){let n=i(e);if(-1===n)throw new Error("invalid objId for replace function");if(!t.objType||!t.objType.name||t.objType.name!==a)throw new Error("invalid object name for replace function");o[n]=t}reverse(){o.reverse()}sort(e){o.sort(e)}swap(e,t){let a=i(e);if(-1===a||0===a&&t||o.length-1===a&&!t)throw new Error("invalid objId for swap function");let n=o[a];o[a]=o[a+(t?-1:1)],o[a+(t?-1:1)]=n}get first(){return o[0]}get iterator(){return r()}get last(){return o[o.length-1]}get length(){return o.length}get jsonObject(){let e=[],t=r();for(;!t.done;)e.push(t.value.jsonObject);return e}set jsonObject(e){o.length=0;let a=null;e.forEach(e=>{a=t(),a.jsonObject=e,n(a)})}})}let T=new Map;const N=Object.freeze(new class{setTranslations(e){e.forEach(e=>T.set(e.msgid,g.sanitizeToJsString(e.msgstr)))}getText(e,t){let o=T.get(e);return t&&o&&Object.getOwnPropertyNames(t).forEach(e=>o=o.replace("{"+e+"}",t[e])),o||e}});const O=Object.freeze(new class{get UUID(){let e=new Uint16Array(8);const t=["","-","-","-","-","","",""];window.crypto.getRandomValues(e);let o="";for(let a=0;a<8;a++)o+=e[a].toString(16).padStart(4,"0")+t[a];return o}storageAvailable(e){try{let t=window[e],o="__storage_test__";return t.setItem(o,o),t.removeItem(o),!0}catch(e){return!1}}saveFile(e,t,o){try{let a=window.URL.createObjectURL(new File([t],e,{type:o||"text/plain"})),n=document.createElement("a");n.setAttribute("href",a),n.setAttribute("download",e),n.click(),window.URL.revokeObjectURL(a)}catch(e){console.log(e||"An error occurs when saving file")}}formatTime(e){let t=Math.floor(e);if(0===t)return"";let o=Math.floor(t/86400),a=Math.floor(t%86400/3600),n=Math.floor(t%3600/60),r=Math.floor(t%60);return 0<o?o+" "+N.getText("Utilities - Day")+" "+a+" "+N.getText("Utilities - Hour"):0<a?a+" "+N.getText("Utilities - Hour")+" "+n+" "+N.getText("Utilities - Minute"):0<n?n+" "+N.getText("Utilities - Minute"):r+" "+N.getText("Utilities - Second")}formatDistance(e){let t=Math.floor(e);return 0>=t?"0 km":Math.floor(t/1e3)+","+Math.floor(t%1e3/10).toFixed(0).padStart(2,"0").padEnd(3,"0")+" km"}formatLat(e){return e>0?e.toFixed(a.fixed)+" N":(-e).toFixed(a.fixed)+" S"}formatLng(e){return e>0?e.toFixed(a.fixed)+" E":(-e).toFixed(a.fixed)+" W"}formatLatLng(e){return 0===e[0]&&0===e[1]?"":this.formatLat(e[0])+" - "+this.formatLng(e[1])}}),x=w("WayPoint"),M=new WeakMap;class I{constructor(){this.name="",this.address="",this.lat=a.defaultValue,this.lng=a.defaultValue,M.set(this,b())}get fullName(){let e=""===this.name?this.address:this.name+", "+this.address;return""===e&&(e=O.formatLatLng([this.lat,this.lng])),e}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objId(){return M.get(this)}get objType(){return x}get jsonObject(){return{name:this.name,address:this.address,lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),objId:M.get(this),objType:x.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+x.name);if(x.validate(e.objType),x.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.address=e.name,e.name="";case"1.12.0":case"1.13.0":e.objType.version="2.0.0";break;default:throw new Error("invalid version for "+x.name)}let t=Object.getOwnPropertyNames(e);return["address","name","lat","lng","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+x.name)}),e}(e);this.address=t.address||"",this.name=t.name||"",this.lat=t.lat||a.defaultValue,this.lng=t.lng||a.defaultValue,M.set(this,b()),this.validateData()}validateData(){"string"==typeof this.address?this.address=g.sanitizeToJsString(this.address):this.address="","string"==typeof this.name?this.name=g.sanitizeToJsString(this.name):this.name="","number"!=typeof this.lat&&(this.lat=a.defaultValue),"number"!=typeof this.lng&&(this.lng=a.defaultValue)}}function P(){return Object.seal(new I)}const S=w("ItineraryPoint"),A=new WeakMap;class E{constructor(){this.lat=a.defaultValue,this.lng=a.defaultValue,this.distance=e.defaultValue,this.elev=o.defaultValue,A.set(this,b())}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objType(){return S}get objId(){return A.get(this)}get jsonObject(){return{lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),distance:parseFloat(this.distance.toFixed(e.fixed)),elev:parseFloat(this.elev.toFixed(o.fixed)),objId:A.get(this),objType:S.jsonObject}}set jsonObject(t){let n=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+S.name);if(S.validate(e.objType),S.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.elev=o.defaultValue;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":e.objType.version="2.0.0";break;default:throw new Error("invalid version for "+S.name)}let t=Object.getOwnPropertyNames(e);return["lat","lng","distance","elev","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+S.name)}),e}(t);this.lat=n.lat||a.defaultValue,this.lng=n.lng||a.defaultValue,this.distance=n.distance||e.defaultValue,this.elev=n.elev||o.defaultValue,A.set(this,b()),this.validateData()}validateData(){"number"!=typeof this.lat&&(this.lat=a.defaultValue),"number"!=typeof this.lng&&(this.lng=a.defaultValue),"number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.elev&&(this.elev=o.defaultValue)}}function C(){return Object.seal(new E)}const H=w("Maneuver"),D=new WeakMap;class R{constructor(){this.iconName="",this.instruction="",this.itineraryPointObjId=-1,this.distance=e.defaultValue,this.duration=e.defaultValue,D.set(this,b())}get objType(){return H}get objId(){return D.get(this)}get jsonObject(){return{iconName:this.iconName,instruction:this.instruction,distance:parseFloat(this.distance.toFixed(e.fixed)),duration:this.duration,itineraryPointObjId:this.itineraryPointObjId,objId:D.get(this),objType:H.jsonObject}}set jsonObject(t){let o=function(t){if(!Object.getOwnPropertyNames(t).includes("objType"))throw new Error("No objType for "+H.name);if(H.validate(t.objType),H.version!==t.objType.version)switch(t.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":"kArriveDefault"===t.iconName&&(t.distance=e.defaultValue);case"1.12.0":case"1.13.0":t.objType.version="2.0.0";break;default:throw new Error("invalid version for "+H.name)}let o=Object.getOwnPropertyNames(t);return["iconName","instruction","distance","duration","itineraryPointObjId","objId"].forEach(e=>{if(!o.includes(e))throw new Error("No "+e+" for "+H.name)}),t}(t);this.iconName=o.iconName||"",this.instruction=o.instruction||"",this.distance=o.distance||e.defaultValue,this.duration=o.duration||e.defaultValue,this.itineraryPointObjId=o.itineraryPointObjId||-1,D.set(this,b()),this.validateData()}validateData(){"string"==typeof this.iconName?this.iconName=g.sanitizeToJsString(this.iconName):this.iconName="","string"==typeof this.instruction?this.instruction=g.sanitizeToJsString(this.instruction):this.instruction="","number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.duration&&(this.duration=e.defaultValue),"number"!=typeof this.itineraryPointObjId&&(this.itineraryPointObjId=-1)}}function z(){return Object.seal(new R)}const V=w("Itinerary"),F=new WeakMap;class k{constructor(){this.hasProfile=!1,this.ascent=0,this.descent=0,this.provider="",this.transitMode="",this.itineraryPoints=j(C),this.maneuvers=j(z),F.set(this,b())}get objType(){return V}get objId(){return F.get(this)}get jsonObject(){return{hasProfile:this.hasProfile,ascent:this.ascent,descent:this.descent,itineraryPoints:this.itineraryPoints.jsonObject,maneuvers:this.maneuvers.jsonObject,provider:this.provider,transitMode:this.transitMode,objId:F.get(this),objType:V.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+V.name);if(V.validate(e.objType),V.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.hasProfile=!1,e.ascent=0,e.descent=0;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":e.objType.version="2.0.0";break;default:throw new Error("invalid version for "+V.name)}let t=Object.getOwnPropertyNames(e);return["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+V.name)}),e}(e);this.hasProfile=t.hasProfile||!1,this.ascent=t.ascent||0,this.descent=t.descent||0,this.itineraryPoints.jsonObject=t.itineraryPoints||[],this.maneuvers.jsonObject=t.maneuvers||[],this.provider=t.provider||"",this.transitMode=t.transitMode||"",F.set(this,b());let o=new Map,a=0,n=this.itineraryPoints.iterator;for(;!n.done;)o.set(t.itineraryPoints[a].objId,n.value.objId),a++;let r=this.maneuvers.iterator;for(;!r.done;)r.value.itineraryPointObjId=o.get(r.value.itineraryPointObjId);this.validateData()}validateData(){"boolean"!=typeof this.hasProfile&&(this.hasProfile=!1),"number"!=typeof this.ascent&&(this.ascent=0),"number"!=typeof this.descent&&(this.descent=0),"string"==typeof this.provider?this.provider=g.sanitizeToJsString(this.provider):this.provider="","string"==typeof this.transitMode?this.transitMode=g.sanitizeToJsString(this.transitMode):this.transitMode=""}}function U(){return Object.seal(new k)}const W=w("Note"),B=new WeakMap;function q(e){return e.replaceAll(/style='color:white;background-color:red'/g,"class='TravelNotes-Note-WhiteRed'").replaceAll(/style='color:white;background-color:green'/g,"class='TravelNotes-Note-WhiteGreen'").replaceAll(/style='color:white;background-color:blue'/g,"class='TravelNotes-Note-WhiteBlue'").replaceAll(/style='color:white;background-color:brown'/g,"class='TravelNotes-Note-WhiteBrown'").replaceAll(/style='color:white;background-color:black'/g,"class='TravelNotes-Note-WhiteBlack'").replaceAll(/style='border:solid 0.1em'/g,"class='TravelNotes-Note-BlackWhite'").replaceAll(/style='background-color:white;'/g,"class='TravelNotes-Note-Knooppunt'").replaceAll(/style='fill:green;font:bold 120px sans-serif;'/g,"").replaceAll(/style='fill:none;stroke:green;stroke-width:10;'/g,"")}class J{constructor(){this.iconHeight=0,this.iconWidth=0,this.iconContent="",this.popupContent="",this.tooltipContent="",this.phone="",this.url="",this.address="",this.iconLat=a.defaultValue,this.iconLng=a.defaultValue,this.lat=a.defaultValue,this.lng=a.defaultValue,this.distance=e.invalid,this.chainedDistance=e.defaultValue,B.set(this,b())}get isRouteNote(){return this.distance!==e.invalid}get iconLatLng(){return[this.iconLat,this.iconLng]}set iconLatLng(e){this.iconLat=e[0],this.iconLng=e[1]}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objType(){return W}get objId(){return B.get(this)}get jsonObject(){return{iconHeight:this.iconHeight,iconWidth:this.iconWidth,iconContent:this.iconContent,popupContent:this.popupContent,tooltipContent:this.tooltipContent,phone:this.phone,url:this.url,address:this.address,iconLat:parseFloat(this.iconLat.toFixed(a.fixed)),iconLng:parseFloat(this.iconLng.toFixed(a.fixed)),lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),distance:parseFloat(this.distance.toFixed(e.fixed)),chainedDistance:parseFloat(this.chainedDistance.toFixed(e.fixed)),objId:B.get(this),objType:W.jsonObject}}set jsonObject(t){let o=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+W.name);if(W.validate(e.objType),W.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":"string"==typeof e.iconHeight&&(e.iconHeight=Number.parseInt(e.iconHeight)),"string"==typeof e.iconWidth&&(e.iconWidth=Number.parseInt(e.iconWidth)),e.iconContent=q(e.iconContent),e.popupContent=q(e.popupContent),e.tooltipContent=q(e.tooltipContent),e.phone=q(e.phone),e.address=q(e.address),e.objType.version="2.0.0";break;default:throw new Error("invalid version for "+W.name)}let t=Object.getOwnPropertyNames(e);return["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+W.name)}),e}(t);this.iconHeight=o.iconHeight||0,this.iconWidth=o.iconWidth||0,this.iconContent=o.iconContent||"",this.popupContent=o.popupContent||"",this.tooltipContent=o.tooltipContent||"",this.phone=o.phone||"",this.url=o.url||"",this.address=o.address||"",this.iconLat=o.iconLat||a.defaultValue,this.iconLng=o.iconLng||a.defaultValue,this.lat=o.lat||a.defaultValue,this.lng=o.lng||a.defaultValue,this.distance=o.distance||e.invalid,this.chainedDistance=o.chainedDistance||e.defaultValue,B.set(this,b()),this.validateData(!0)}validateData(t){if("number"!=typeof this.iconHeight&&(this.iconHeight=0),"number"!=typeof this.iconWidth&&(this.iconWidth=0),"string"==typeof this.iconContent){let e=g.sanitizeToHtmlString(this.iconContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.iconContent+")"),this.iconContent=e.htmlString}else this.iconContent="";if("string"==typeof this.popupContent){let e=g.sanitizeToHtmlString(this.popupContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.popupContent+")"),this.popupContent=e.htmlString}else this.popupContent="";if("string"==typeof this.tooltipContent){let e=g.sanitizeToHtmlString(this.tooltipContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.tooltipContent+")"),this.tooltipContent=e.htmlString}else this.tooltipContent="";if("string"==typeof this.phone){let e=g.sanitizeToHtmlString(this.phone);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.phone+")"),this.phone=e.htmlString}else this.phone="";if("string"==typeof this.url&&""!==this.url){let e=g.sanitizeToUrl(this.url);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.url+")"),this.url=encodeURI(e.url)}else this.url="";"string"==typeof this.address?this.address=g.sanitizeToHtmlString(this.address).htmlString:this.address="","number"!=typeof this.iconLat&&(this.iconLat=a.defaultValue),"number"!=typeof this.iconLng&&(this.iconLng=a.defaultValue),"number"!=typeof this.lat&&(this.lat=a.defaultValue),"number"!=typeof this.lng&&(this.lng=a.defaultValue),"number"!=typeof this.distance&&(this.distance=e.invalid),"number"!=typeof this.chainedDistance&&(this.chainedDistance=e.defaultValue)}}function Z(){return Object.seal(new J)}const _=w("Route"),G=new WeakMap;class X{constructor(){this.name="",this.wayPoints=j(P),this.wayPoints.add(P()),this.wayPoints.add(P()),this.notes=j(Z),this.itinerary=U(),this.width=m.route.width,this.color=m.route.color,this.dashArray=m.route.dashArray,this.chain=!1,this.chainedDistance=e.defaultValue,this.distance=e.defaultValue,this.duration=e.defaultValue,this.editionStatus=n.notEdited,this.hidden=!1,G.set(this,b())}get computedName(){let e=this.name;return""===e&&(e=(""===this.wayPoints.first.fullName?"???":this.wayPoints.first.fullName)+" ⮞ "+(""===this.wayPoints.last.fullName?"???":this.wayPoints.last.fullName)),e}get objId(){return G.get(this)}get objType(){return _}get jsonObject(){return{name:this.name,wayPoints:this.wayPoints.jsonObject,notes:this.notes.jsonObject,itinerary:this.itinerary.jsonObject,width:this.width,color:this.color,dashArray:this.dashArray,chain:this.chain,distance:parseFloat(this.distance.toFixed(e.fixed)),duration:this.duration,editionStatus:this.editionStatus,hidden:this.hidden,chainedDistance:parseFloat(this.chainedDistance.toFixed(e.fixed)),objId:G.get(this),objType:_.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+_.name);if(_.validate(e.objType),_.version!==e.objType.version)switch(e.objType.version){case"1.0.0":e.dashArray=0,e.hidden=!1;case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.edited=n.notEdited;case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.editionStatus=e.edited;case"1.12.0":case"1.13.0":e.objType.version="2.0.0";break;default:throw new Error("invalid version for "+_.name)}let t=Object.getOwnPropertyNames(e);return["name","wayPoints","notes","itinerary","width","color","dashArray","chain","distance","duration","editionStatus","hidden","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+_.name)}),e}(e);this.name=t.name||"",this.wayPoints.jsonObject=t.wayPoints||[],this.notes.jsonObject=t.notes||[],this.itinerary.jsonObject=t.itinerary||U().jsonObject,this.width=t.width||m.route.width,this.color=t.color||"#000000",this.dashArray=t.dashArray||0,this.chain=t.chain||!1,this.distance=t.distance,this.duration=t.duration,this.editionStatus=t.editionStatus||n.notEdited,this.hidden=t.hidden||!1,this.chainedDistance=t.chainedDistance,G.set(this,b()),this.validateData()}validateData(){"string"==typeof this.name?this.name=g.sanitizeToJsString(this.name):this.name="","number"!=typeof this.width&&(this.width=m.route.width),"string"==typeof this.color?this.color=g.sanitizeToColor(this.color)||m.route.color:this.color=m.route.color,"number"!=typeof this.dashArray&&(this.dashArray=0),this.dashArray>=m.route.dashChoices.length&&(this.dashArray=0),"boolean"!=typeof this.chain&&(this.chain=!1),"number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.duration&&(this.duration=e.defaultValue),"number"!=typeof this.editionStatus&&(this.editionStatus=n.notEdited),"boolean"!=typeof this.hidden&&(this.hidden=!1),"number"!=typeof this.chainedDistance&&(this.chainedDistance=e.defaultValue)}}function K(){return Object.seal(new X)}const $=w("Travel"),Q=new WeakMap;class Y{constructor(){this.editedRoute=K(),this.routes=j(K),this.notes=j(Z),this.layerName="OSM - Color",this.name="",this.readOnly=!1,Q.set(this,b())}get objId(){return Q.get(this)}get objType(){return $}get jsonObject(){return{editedRoute:this.editedRoute.jsonObject,layerName:this.layerName,name:this.name,routes:this.routes.jsonObject,notes:this.notes.jsonObject,readOnly:this.readOnly,objId:Q.get(this),objType:$.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+$.name);if($.validate(e.objType),$.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.editedRoute=K();case"1.5.0":if(e.userData.layerId){let t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"Lantmäteriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find(t=>t.layerId===e.userData.layerId);e.layerName=t?t.layerName:"OSM - Color"}else e.layerName="OSM - Color";case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":e.objType.version="2.0.0";break;default:throw new Error("invalid version for "+$.name)}let t=Object.getOwnPropertyNames(e);return["name","editedRoute","routes","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+$.name)}),e}(e);this.editedRoute.jsonObject=t.editedRoute,this.layerName=e.layerName||"OSM - Color",this.name=t.name||"",this.readOnly=t.readOnly||!1,this.routes.jsonObject=t.routes||[],this.notes.jsonObject=t.notes||[],Q.set(this,b()),this.validateData()}validateData(){"string"==typeof this.layerName?this.layerName=g.sanitizeToJsString(this.layerName):this.layerName="OSM - Color","string"==typeof this.name?this.name=g.sanitizeToJsString(this.name):this.name="TravelNotes","boolean"!=typeof this.readOnly&&(this.readOnly=!0)}}function ee(){return Object.seal(new Y)}let te=new Map,oe=new Map,ae=Object.seal({provider:"",transitMode:""}),ne=O.UUID;const re=Object.seal(new class{constructor(){this.map=null,this.travel=ee(),this.editedRouteObjId=-1,this.searchData=[]}get providers(){return te}get mapObjects(){return oe}get routing(){return ae}get UUID(){return ne}});const ie=Object.seal(new class{getRoute(e){let t=null;return t=re.travel.routes.getAt(e),t||e===re.travel.editedRoute.objId&&(t=re.travel.editedRoute),t}getNoteAndRoute(e){let t=null,o=null;if(t=re.travel.notes.getAt(e),!t){let a=re.travel.routes.iterator;for(;!a.done&&!t;)t=a.value.notes.getAt(e),t&&(o=a.value);t||(t=re.travel.editedRoute.notes.getAt(e),t&&(o=re.travel.editedRoute))}return Object.freeze({note:t,route:o})}getWayPoint(e){let t=re.travel.editedRoute.wayPoints.getAt(e);if(!t){let o=re.travel.routes.iterator;for(;!o.done&&!t;)t=o.value.wayPoints.getAt(e)}return t}}),se=Math.PI/180;function le(e){return(e+540)%360-180}const ce=Object.freeze(new class{getLatLngElevAtDist(e,t){if(e.distance<=t||0>=t)return null;let o=0,a=e.itinerary.itineraryPoints.iterator;for(;o<t&&!a.done;)o+=a.value.distance;let n=a.value;a.done;let r=(n.distance-o+t)/n.distance;return Object.freeze({latLng:[n.lat+(a.value.lat-n.lat)*r,n.lng+(a.value.lng-n.lng)*r],elev:n.elev+(a.value.elev-n.elev)*r,ascent:100*(a.value.elev-n.elev)/n.distance,routeDistance:t})}getClosestLatLngDistance(t,o){if(0===t.itinerary.itineraryPoints.length)return null;let a=t.itinerary.itineraryPoints.iterator;a.done;let n=Number.MAX_VALUE,r=L.Projection.SphericalMercator.project(L.latLng(o[0],o[1])),i=L.Projection.SphericalMercator.project(L.latLng(a.value.lat,a.value.lng)),s=null,l=e.defaultValue,c=a.value.distance;for(;!a.done;){let e=L.Projection.SphericalMercator.project(L.latLng(a.value.lat,a.value.lng)),t=L.LineUtil.pointToSegmentDistance(r,i,e);t<n&&(n=t,s=L.Projection.SphericalMercator.unproject(L.LineUtil.closestPointOnSegment(r,i,e)),l=c-s.distanceTo(L.latLng(a.value.lat,a.value.lng))),c+=a.value.distance,i=e}return Object.freeze({latLng:[s.lat,s.lng],distance:l})}getLatLngBounds(e){let t=L.latLng([90,180]),o=L.latLng([-90,-180]);return e.forEach(e=>{t.lat=Math.min(t.lat,e[0]),t.lng=Math.min(t.lng,e[1]),o.lat=Math.max(o.lat,e[0]),o.lng=Math.max(o.lng,e[1])}),L.latLngBounds(t,o)}pointsDistance(e,t){if(e[0]===t[0]&&e[1]===t[1])return 0;let o=e[0]*se,a=t[0]*se,n=(le(t[1])-le(e[1]))*se;return 6371e3*Math.acos(Math.sin(o)*Math.sin(a)+Math.cos(o)*Math.cos(a)*Math.cos(n))}getSquareBoundingBox(e,t){let o=t/6371e3/se,a=e[0]*se,n=Math.acos((Math.cos(t/6371e3)-Math.sin(a)**2)/Math.cos(a)**2)/se;return L.latLngBounds(L.latLng([e[0]-o,e[1]-n]),L.latLng([e[0]+o,e[1]+n]))}project(e,t){let o=re.map.project(L.latLng(e),t);return[o.x,o.y]}screenCoordToLatLng(e,t){let o=re.map.containerPointToLatLng(L.point(e,t));return[o.lat,o.lng]}addPoints(e,t){return[e[0]+t[0],e[1]+t[1]]}subtrackPoints(e,t){return[e[0]-t[0],e[1]-t[1]]}});function de(){let e=null,t=1,o=1,a=Number.MAX_VALUE,n=0,i=0,l=null,c=0,d=m.route.elev.smoothCoefficient,u=m.route.elev.smoothPoints;function h(){let e=function(){let e=0,t=0,o=[],a=l.itinerary.itineraryPoints.iterator,n=0,r=a.done;for(o.push({distance:e,elev:a.value.elev}),n+=a.value.distance,r=a.done;!r;){for(e+=c;e>=n&&!r;)n+=a.value.distance,r=a.done;if(!r){let r=(a.value.elev-a.previous.elev)/a.previous.distance;t=a.value.elev-(n-e)*r,o.push({distance:e,elev:t})}}return o.push({distance:n,elev:l.itinerary.itineraryPoints.last.elev}),o}(),t=new Map,o=(e[u].elev-e[0].elev)/u,a=0;for(a=0;a<u;a++)t.set(a*c,{distance:a*c,elev:e[0].elev+o*a});for(a=u;a<e.length-u;a++){let o=0;for(let t=a-u;a+u>=t;t++)o+=e[t].elev;t.set(e[a].distance,{distance:e[a].distance,elev:o/(2*u+1)})}return a--,o=c*(e[e.length-1].elev-e[e.length-1-u].elev)/(e[e.length-1].distance-e[e.length-1-u].distance),t.set(e[a].distance+c,{distance:e[a].distance+c,elev:e[a].elev+o}),t.set(e[a].distance+2*c,{distance:e[a].distance+2*c,elev:e[a].elev+2*o}),t}function g(c){return l=c,a=Number.MAX_VALUE,n=0,l.itinerary.itineraryPoints.forEach(e=>{n=Math.max(n,e.elev),a=Math.min(a,e.elev)}),i=n-a,t=r.height/i,o=r.width/l.distance,e=document.createElementNS(s,"svg"),e.setAttributeNS(null,"viewBox","0 0 "+(r.width+2*r.margin)+" "+(r.height+2*r.margin)),e.setAttributeNS(null,"class","TravelNotes-SvgProfile"),function(){let a="",i=0,c=0,d=0;l.itinerary.itineraryPoints.forEach(e=>{c=(r.margin+o*i).toFixed(0),d=(r.margin+t*(n-e.elev)).toFixed(0),a+=c+","+d+" ",i+=e.distance});let u=document.createElementNS(s,"polyline");u.setAttributeNS(null,"points",a),u.setAttributeNS(null,"class","TravelNotes-SvgProfile-profilePolyline"),e.appendChild(u)}(),function(){const t=r.margin.toFixed(0),o=(r.margin+r.height).toFixed(0),a=(r.margin+r.width).toFixed(0),n=r.margin.toFixed(0);let i=t+","+n+" "+t+","+o+" "+a+","+o+" "+a+","+n,l=document.createElementNS(s,"polyline");l.setAttributeNS(null,"points",i),l.setAttributeNS(null,"class","TravelNotes-SvgProfile-framePolyline"),e.appendChild(l)}(),function(){let o=Number.MAX_VALUE,l=0;r.vScales.forEach(e=>{let t=Math.abs(i/4-e);t<o&&(o=t,l=e)});let c=Math.ceil(a/l)*l;const d=(r.margin+r.width+r.xDeltaText).toFixed(0),u=(r.margin-r.xDeltaText).toFixed(0);for(;c<n;){let o=r.margin+(n-c)*t,a=document.createElementNS(s,"text");a.appendChild(document.createTextNode(c.toFixed(0))),a.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),a.setAttributeNS(null,"x",d),a.setAttributeNS(null,"y",o),a.setAttributeNS(null,"text-anchor","start"),e.appendChild(a);let i=document.createElementNS(s,"text");i.appendChild(document.createTextNode(c.toFixed(0))),i.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),i.setAttributeNS(null,"x",u),i.setAttributeNS(null,"y",o),i.setAttributeNS(null,"text-anchor","end"),e.appendChild(i),c+=l}}(),function(){const t=r.margin+r.height+r.margin/2;let a=Number.MAX_VALUE,n=0;r.hScales.forEach(e=>{let t=Math.abs(l.distance/8-e);t<a&&(a=t,n=e)});let i=Math.ceil(l.chainedDistance/n)*n;for(;i<l.distance+l.chainedDistance;){let a=document.createElementNS(s,"text");a.appendChild(document.createTextNode(1e3<n||0<l.chainedDistance?i/1e3+" km":i+" m ")),a.setAttributeNS(null,"class","TravelNotes-SvgProfile-distLegend"),a.setAttributeNS(null,"x",r.margin+(i-l.chainedDistance)*o),a.setAttributeNS(null,"y",t),a.setAttributeNS(null,"text-anchor","start"),e.appendChild(a),i+=n}}(),e}return Object.seal(new class{smooth(e){!function(e){l=e;let t=l.itinerary.itineraryPoints.iterator,o=0,a=0;for(;!t.done;)o+=t.value.distance,a+=t.next?Math.abs(t.value.elev-t.next.elev):0;if(c=10*Math.floor(d/(a/o)),o<=2*u*c)return;let n=h();t=l.itinerary.itineraryPoints.iterator,t.done;let r=t.value.distance;for(;!t.done;){let e=n.get(Math.floor(r/c)*c),o=n.get(Math.ceil(r/c)*c);if(e&&o){let a=r-e.distance,n=(o.elev-e.elev)/(o.distance-e.distance);t.value.elev=e.elev+a*n}r+=t.value.distance}}(e)}createSvg(e){return g(e)}})}function ue(e,t){let o=t.note,a=f.create("div");if(0!==o.tooltipContent.length&&g.sanitizeToHtmlElement(o.tooltipContent,f.create("div",{className:e+"NoteHtml-TooltipContent"},a)),0!==o.popupContent.length&&g.sanitizeToHtmlElement(o.popupContent,f.create("div",{className:e+"NoteHtml-PopupContent"},a)),0!==o.address.length&&g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Address")+"</span> : "+o.address,f.create("div",{className:e+"NoteHtml-Address"},a)),0!==o.url.length&&g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Link")+"<a href="+o.url+' target="_blank" >'+o.url.substr(0,40)+"...</a>",f.create("div",{className:e+"NoteHtml-Url"},a)),0!==o.phone.length){let t=o.phone;if(o.phone.match(/^\+[0-9, ,*,#]*$/)){let e=o.phone.replaceAll(/\u0020/g,""),a=o.phone.replaceAll(/\u0020/g," ");t=N.getText("HTMLViewsFactory - Phone")+" : "+N.getText("HTMLViewsFactory - call")+'<a target="_blank" href="tel:'+e+'" >'+a+"</a>"+N.getText("HTMLViewsFactory - Send a sms to")+'<a target="_blank" href="sms:'+e+'" >'+a+"</a>"}else t=N.getText("HTMLViewsFactory - Phone")+" : "+o.phone;g.sanitizeToHtmlElement(t,f.create("div",{className:e+"NoteHtml-Phone"},a))}if(g.sanitizeToHtmlElement(O.formatLatLng(o.latLng),f.create("div",{className:e+"NoteHtml-LatLng"},a)),t.route){t.route.chain&&g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of travel")+"</span> : "+O.formatDistance(o.chainedDistance+o.distance),f.create("div",{className:e+"NoteHtml-Distance"},a)),g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of route")+"</span> : "+O.formatDistance(o.distance),f.create("div",{className:e+"NoteHtml-Distance"},a));let n=t.route.notes.next(o.objId);if(n){let t=n.distance-o.distance;9<t&&g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Next note after")+"</span> : "+O.formatDistance(t),f.create("div",{className:e+"NoteHtml-NextDistance"},a))}}return a}function he(e,t){let o=f.create("div"),a=f.create("div",{className:e+"Travel-Notes-IconCell"},o);g.sanitizeToHtmlElement(t.note.iconContent,a),a.style.width=String(t.note.iconWidth)+"px",a.style.height=String(t.note.iconHeight)+"px","TravelNotes-Roadbook-"===e&&a.firstChild&&("svg"===a.firstChild.tagName?(a.firstChild.setAttributeNS(null,"viewBox","0 0 "+i.svgViewboxDim+" "+i.svgViewboxDim),a.style.width=String(t.note.iconWidth*m.note.svgRoadbookDimCoef)+"px",a.style.height=String(t.note.iconWidth*m.note.svgRoadbookDimCoef)+"px"):a.firstChild.classList.contains("TravelNotes-MapNoteCategory-0073")&&(a.style.width=String(t.note.iconWidth*m.note.svgRoadbookDimCoef)+"px",a.style.height=String(t.note.iconWidth*m.note.svgRoadbookDimCoef)+"px"));let n=ue(e,t);return n.className=e+"Travel-Notes-Cell",o.appendChild(n),o.noteObjId=t.note.objId,o}function ge(e){let t=f.create("div",{className:e+"Travel-Notes"}),o=re.travel.notes.iterator;for(;!o.done;){let a=he(e,{note:o.value,route:null});a.className=e+"Travel-Notes-Row",t.appendChild(a)}return t}function pe(e,t){let o=f.create("div",{className:e+"Route-Header",id:"route"+t.objId});return g.sanitizeToHtmlElement(t.computedName,f.create("div",{className:e+"Route-Header-Name"},o)),0!==t.distance&&g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Route distance",{distance:O.formatDistance(t.distance)}),f.create("div",{className:e+"Route-Header-Distance"},o)),re.travel.readOnly||"bike"===t.itinerary.transitMode||g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Duration",{duration:O.formatTime(t.duration)}),f.create("div",{className:e+"Route-Header-Duration"},o)),t.itinerary.hasProfile&&(g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Ascent",{ascent:t.itinerary.ascent.toFixed(0)}),f.create("div",{className:e+"Route-Header-Ascent"},o)),g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Descent",{descent:t.itinerary.descent.toFixed(0)}),f.create("div",{className:e+"Route-Header-Descent"},o))),o}function me(t,o){let a=f.create("div");f.create("div",{className:t+"Route-ManeuversAndNotes-IconCell TravelNotes-ManeuverNote-"+o.maneuver.iconName},a);let n=f.create("div",{className:t+"Route-ManeuversAndNotes-Cell"},a);return g.sanitizeToHtmlElement(o.maneuver.instruction,f.create("div",null,n)),o.route.chain&&g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of travel")+"</span> : "+O.formatDistance(o.route.chainedDistance+o.maneuverDistance),f.create("div",null,n)),g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of route")+"</span> : "+O.formatDistance(o.maneuverDistance),f.create("div",null,n)),e.defaultValue<o.maneuver.distance&&g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Next maneuver after")+"</span> : "+O.formatDistance(o.maneuver.distance),f.create("div",null,n)),a}function fe(e,t){let o=[],a=t.notes.iterator;for(;!a.done;){let n=he(e,{note:a.value,route:t});n.className=e+"Route-Notes-Row",n.objId=b(),n.latLng=a.value.latLng,n.noteObjId=a.value.objId,n.distance=a.value.distance,o.push(n)}let n=t.itinerary.maneuvers.iterator,r=0;for(;!n.done;){let a=me(e,{route:t,maneuver:n.value,maneuverDistance:r});a.className=e+"Route-Maneuvers-Row",a.objId=b(),a.latLng=t.itinerary.itineraryPoints.getAt(n.value.itineraryPointObjId).latLng,a.maneuverObjId=n.value.objId,a.distance=r,o.push(a),r+=n.value.distance}o.sort((e,t)=>e.distance-t.distance);let i=f.create("div",{className:e+"Route-ManeuversAndNotes"});return o.forEach(e=>i.appendChild(e)),i}function ve(e,t){let o="";""!==t.itinerary.provider&&""!==t.itinerary.transitMode&&(o=N.getText("HTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:t.itinerary.provider,transitMode:N.getText("HTMLViewsFactory - TransitMode "+t.itinerary.transitMode)}));let a=f.create("div",{className:e+"RouteFooter"});return g.sanitizeToHtmlElement(o,a),a}function ye(e,t){let o=f.create("div",{className:e+"RouteProfile"});return g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Profile"),o),o.appendChild(de().createSvg(t)),o}function be(t){let o=f.create("div",{className:t+"Travel"});o.appendChild(function(t){let o=f.create("div",{className:t+"Travel-Header"});g.sanitizeToHtmlElement(re.travel.name,f.create("div",{className:t+"Travel-Header-Name"},o));let a=e.defaultValue,n=0,r=0,i=re.travel.routes.iterator;for(;!i.done;){let e=i.value.objId===re.editedRouteObjId&&m.routeEditor.displayEditionInHTMLPage?re.travel.editedRoute:i.value;g.sanitizeToHtmlElement('<a href="#route'+e.objId+'" >'+e.computedName+"</a> : "+O.formatDistance(e.distance)+".",f.create("div",{className:t+"Travel-Header-RouteName"},o)),e.chain&&(a+=e.distance,n+=e.itinerary.ascent,r+=e.itinerary.descent)}return g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Travel distance",{distance:O.formatDistance(a)}),f.create("div",{className:t+"Travel-Header-TravelDistance"},o)),0!==n&&g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Travel ascent",{ascent:n.toFixed(0)}),f.create("div",{className:t+"Travel-Header-TravelAscent"},o)),0!==r&&g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Travel descent",{descent:r.toFixed(0)}),f.create("div",{className:t+"Travel-Header-TravelDescent"},o)),o}(t)),o.appendChild(ge(t));let a=re.travel.routes.iterator;for(;!a.done;){let e=m.routeEditor.displayEditionInHTMLPage&&a.value.objId===re.editedRouteObjId?re.travel.editedRoute:a.value;o.appendChild(pe(t,e)),e.itinerary.hasProfile&&o.appendChild(ye(t,e)),o.appendChild(fe(t,e)),o.appendChild(ve(t,e))}return o.appendChild(function(e){let t=N.getText("HTMLViewsFactory - Travel footer")+'<a href="https://github.com/wwwouaiebe/leaflet.TravelNotes" target="_blank" title="https://github.com/wwwouaiebe/leaflet.TravelNotes" >Travel & Notes</a>, © <a href="https://www.ouaie.be/" target="_blank" title="https://www.ouaie.be/" >wwwouaiebe 2017 2021</a> © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="https://www.openstreetmap.org/copyright">'+N.getText("HTMLViewsFactory - OpenStreetMap contributors")+"</a>",o=f.create("div",{className:e+"TravelFooter"});return g.sanitizeToHtmlElement(t,o),o}(t)),o}const we=Object.freeze(new class{getTravelHTML(e){return be(e)}getNoteTextAndIconHTML(e,t){return he(e,t)}getNoteTextHTML(e,t){return ue(e,t)}getEditedRouteManeuversAndNotesHTML(e){return fe(e,re.travel.editedRoute)}getTravelNotesHTML(e){return ge(e)}getRouteHeaderHTML(e,t){return pe(e,t)}});let je=null,Te=null;function Ne(e){let t=ie.getRoute(e.target.objId),o=ce.getClosestLatLngDistance(t,[e.latlng.lat,e.latlng.lng]).distance;o+=t.chainedDistance,o=O.formatDistance(o);let a=re.mapObjects.get(e.target.objId);a.closeTooltip();let n=t.computedName;re.travel.readOnly||(n+=0===n.length?"":" - ",n+=o),a.setTooltipContent(n),a.openTooltip(e.latlng)}function Le(e,t){t.objId=e,t.addTo(re.map),re.mapObjects.set(e,t)}function Oe(e){let t=ie.getNoteAndRoute(e).note,o=L.marker(t.latLng,{icon:L.divIcon({iconSize:[m.note.grip.size,m.note.grip.size],iconAnchor:[m.note.grip.size/2,m.note.grip.size/2],html:"<div></div>",className:"TravelNotes-Note-Bullet"}),opacity:m.note.grip.opacity,draggable:!re.travel.readOnly});o.objId=t.objId;let a=L.divIcon({iconSize:[t.iconWidth,t.iconHeight],iconAnchor:[t.iconWidth/2,t.iconHeight/2],popupAnchor:[0,-t.iconHeight/2],html:t.iconContent,className:"TravelNotes-AllNotes "});let n=L.marker(t.iconLatLng,{zIndexOffset:100,icon:a,draggable:!re.travel.readOnly});n.objId=t.objId,n.bindPopup(e=>we.getNoteTextHTML("TravelNotes-",ie.getNoteAndRoute(e.objId))),0!==t.tooltipContent.length&&(n.bindTooltip(e=>ie.getNoteAndRoute(e.objId).note.tooltipContent),n.getTooltip().options.offset[0]=t.iconWidth/2);let r=L.polyline([t.latLng,t.iconLatLng],m.note.polyline);r.objId=t.objId;let i=L.layerGroup([n,r,o]);return i.markerId=L.Util.stamp(n),i.polylineId=L.Util.stamp(r),i.bulletId=L.Util.stamp(o),Le(t.objId,i),m.note.haveBackground&&document.querySelectorAll(".TravelNotes-MapNote,.TravelNotes-SvgIcon").forEach(e=>e.classList.add("TravelNotes-MapNote-Background")),Object.freeze({marker:n,polyline:r,bullet:o})}function xe(e){e.dashArray>=m.route.dashChoices.length&&(e.dashArray=0);let t=m.route.dashChoices[e.dashArray].iDashArray;if(t){let o="",a=0;for(a=0;a<t.length-1;a++)o+=t[a]*e.width+",";return o+=t[a]*e.width,o}return null}const Me=Object.seal(new class{addRoute(e){let t=ie.getRoute(e),o=[],a=t.itinerary.itineraryPoints.iterator;for(;!a.done;)o.push(a.value.latLng);let r=L.polyline(o,{color:t.color,weight:t.width,dashArray:xe(t)});Le(t.objId,r),n.notEdited===t.editionStatus&&(r.bindTooltip(t.computedName,{sticky:!0,direction:"right"}),r.on("mouseover",Ne),r.on("mousemove",Ne)),r.bindPopup(e=>{let t=ie.getRoute(e.objId);return we.getRouteHeaderHTML("TravelNotes-UI-",t)}),L.DomEvent.on(r,"click",e=>e.target.openPopup(e.latlng));let i=t.notes.iterator;for(;!i.done;)Oe(i.value.objId);return t}addNote(e){return Oe(e)}getDashArray(e){return xe(e)}zoomTo(e,t){if(t){let e=[];t.forEach(t=>e=e.concat(t)),re.map.fitBounds(ce.getLatLngBounds(e))}else re.map.setView(e,m.itineraryPointZoom)}setLayer(e,t){let o=null;o="wmts"===e.service.toLowerCase()?L.tileLayer(t):L.tileLayer.wms(t,e.wmsOptions),je&&re.map.removeLayer(je),re.map.addLayer(o),je=o,re.travel.readOnly||(re.map.getZoom()<(e.minZoom||0)&&re.map.setZoom(e.minZoom||0),re.map.setMinZoom(e.minZoom||0),re.map.getZoom()>(e.maxZoom||18)&&re.map.setZoom(e.maxZoom||18),re.map.setMaxZoom(e.maxZoom||18),e.bounds?(re.map.getBounds().intersects(e.bounds)&&!re.map.getBounds().contains(e.bounds)||(re.map.setMaxBounds(null),re.map.fitBounds(e.bounds),re.map.setZoom(e.minZoom||0)),re.map.setMaxBounds(e.bounds)):re.map.setMaxBounds(null)),re.map.fire("baselayerchange",o)}onGeolocationStatusChanged(e){t.active!==e&&Te&&(re.map.removeLayer(Te),Te=null)}onGeolocationPositionChanged(e){let t=m.geoLocation.zoomToPosition;Te&&(re.map.removeLayer(Te),t=!1),Te=L.circleMarker(L.latLng(e.coords.latitude,e.coords.longitude),{radius:m.geoLocation.radius,color:m.geoLocation.color}).bindTooltip(O.formatLatLng([e.coords.latitude,e.coords.longitude])).addTo(re.map),t&&re.map.setView(L.latLng(e.coords.latitude,e.coords.longitude),m.geoLocation.zoomFactor)}});const Ie=Object.freeze(new class{dispatch(e,t){let o=function(e){return-1<["showitinerary","updateitinerary","showtravelnotes","updatetravelnotes","showsearch","updatesearch","setrouteslist","setprovider","providersadded","travelnameupdated","settransitmode"].indexOf(e)?document.getElementById("TravelNotes-UI-MainDiv"):-1<["removeobject","removeallobjects","zoomto","additinerarypointmarker","addsearchpointmarker","addrectangle","addwaypoint","layerchange","geolocationstatuschanged","geolocationpositionchanged","routeupdated","routepropertiesupdated","noteupdated","roadbookupdate","profileclosed"].indexOf(e)?document:null}(e);if(o){let a=new Event(e);t&&(a.data=t),o.dispatchEvent(a)}}});var Pe={};function Se(e){return Math.floor(Math.abs(e)+.5)*(e>=0?1:-1)}function Ae(e,t,o){var a=(e=Se(e*o))-(t=Se(t*o));a<<=1,e-t<0&&(a=~a);for(var n="";a>=32;)n+=String.fromCharCode(63+(32|31&a)),a>>=5;return n+=String.fromCharCode(a+63)}function Ee(e){for(var t=[],o=0;o<e.length;o++){var a=e[o].slice();t.push([a[1],a[0]])}return t}function Ce(){let e=[];function t(t){e.push(t.latLng),e.push(t.iconLatLng)}function o(o){o.itinerary.itineraryPoints.forEach(t=>e.push(t.latLng)),o.notes.forEach(e=>t(e))}return Object.seal(new class{zoomToLatLng(e){Ie.dispatch("zoomto",{latLng:e})}zoomToManeuver(e){let t=re.travel.editedRoute.itinerary.maneuvers.getAt(e).itineraryPointObjId,o=re.travel.editedRoute.itinerary.itineraryPoints.getAt(t).latLng;Ie.dispatch("zoomto",{latLng:o})}zoomToNote(o){e=[],t(ie.getNoteAndRoute(o).note),Ie.dispatch("zoomto",{geometry:[e]})}zoomToRoute(t){e=[],o(ie.getRoute(t)),Ie.dispatch("zoomto",{geometry:[e]})}zoomToTravel(){e=[],re.travel.routes.forEach(e=>o(e)),-1!==re.travel.editedRouteObjId&&o(re.travel.editedRoute),re.travel.notes.forEach(e=>t(e)),Ie.dispatch("zoomto",{geometry:[e]})}zoomToPoi(e){Ie.dispatch("zoomto",e)}})}function He(){return Object.seal(new class{openDistantFile(e){(function(){function e(e){let t={};0!==e.itinerary.itineraryPoints.length&&(t=e.itinerary.itineraryPoints[0].objType);let o={latLngs:[],distances:[],elevs:[],objIds:[],objType:t};e.itinerary.itineraryPoints.forEach(e=>{o.latLngs.push([e.lat,e.lng]),o.distances.push(e.distance),o.elevs.push(e.elev),o.objIds.push(e.objId)}),o.latLngs=Pe.encode(o.latLngs,6),e.itinerary.itineraryPoints=o}function t(e){e.itinerary.itineraryPoints.latLngs=Pe.decode(e.itinerary.itineraryPoints.latLngs,6);let t=[],a=0;e.itinerary.itineraryPoints.latLngs.forEach(n=>{let r={};r.lat=n[0],r.lng=n[1],r.distance=e.itinerary.itineraryPoints.distances[a],e.itinerary.itineraryPoints.elevs?r.elev=e.itinerary.itineraryPoints.elevs[a]:r.elev=o.defaultValue,r.objId=e.itinerary.itineraryPoints.objIds[a],r.objType=e.itinerary.itineraryPoints.objType,t.push(r),a++}),e.itinerary.itineraryPoints=t}function a(e){e.routes.forEach(t),e.editedRoute&&t(e.editedRoute)}return Object.seal(new class{decompress(e){a(e),re.travel.jsonObject=e,re.editedRouteObjId=-1,re.travel.routes.forEach(e=>{n.notEdited!==e.editionStatus&&(re.editedRouteObjId=e.objId)})}decompressMerge(e){a(e);let t=ee();t.jsonObject=e;let o=t.routes.iterator;for(;!o.done;)re.travel.routes.add(o.value);let n=t.notes.iterator;for(;!n.done;)re.travel.notes.add(n.value)}compress(){let t=re.travel.jsonObject;return t.routes.forEach(e),e(t.editedRoute),t}})})().decompress(e),re.travel.readOnly=!0,this.display()}display(){document.title="Travel & Notes"+(""===re.travel.name?"":" - "+re.travel.name);let e=re.travel.routes.iterator;for(;!e.done;)n.notEdited===e.value.editionStatus&&Ie.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:e.value.objId});-1!==re.editedRouteObjId&&Ie.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:re.travel.editedRoute.objId});let t=re.travel.notes.iterator;for(;!t.done;)Ie.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:t.value.objId});Ce().zoomToTravel()}})}Pe.decode=function(e,t){for(var o,a=0,n=0,r=0,i=[],s=0,l=0,c=null,d=Math.pow(10,Number.isInteger(t)?t:5);a<e.length;){c=null,s=0,l=0;do{l|=(31&(c=e.charCodeAt(a++)-63))<<s,s+=5}while(c>=32);o=1&l?~(l>>1):l>>1,s=l=0;do{l|=(31&(c=e.charCodeAt(a++)-63))<<s,s+=5}while(c>=32);n+=o,r+=1&l?~(l>>1):l>>1,i.push([n/d,r/d])}return i},Pe.encode=function(e,t){if(!e.length)return"";for(var o=Math.pow(10,Number.isInteger(t)?t:5),a=Ae(e[0][0],0,o)+Ae(e[0][1],0,o),n=1;n<e.length;n++){var r=e[n],i=e[n-1];a+=Ae(r[0],i[0],o),a+=Ae(r[1],i[1],o)}return a},Pe.fromGeoJSON=function(e,t){if(e&&"Feature"===e.type&&(e=e.geometry),!e||"LineString"!==e.type)throw new Error("Input must be a GeoJSON LineString");return Pe.encode(Ee(e.coordinates),t)},Pe.toGeoJSON=function(e,t){return{type:"LineString",coordinates:Ee(Pe.decode(e,t))}},"object"==typeof module&&module.exports&&(module.exports=Pe);const De=Object.seal(new class{createUI(){f.create("div",{id:"TravelNotes-AttributionsUI"},document.querySelector("body")),this.attributions=""}set attributions(e){let t='© <a href="https://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> | © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+e+'| © <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a>',o=document.getElementById("TravelNotes-AttributionsUI");for(;o.firstChild;)o.removeChild(o.firstChild);g.sanitizeToHtmlElement(t,o)}});let Re="geolocation"in navigator?t.inactive:t.disabled,ze=null;function Ve(e){Ie.dispatch("geolocationpositionchanged",{position:e})}function Fe(){t.active===Re&&(Re=t.inactive),Ie.dispatch("geolocationstatuschanged",{status:Re}),navigator.geolocation.clearWatch(ze),ze=null}function ke(e){1===e.code&&(Re=t.refusedByUser),Fe()}const Ue=Object.seal(new class{get status(){return Re}switch(){switch(Re){case t.inactive:Re=t.active,Ie.dispatch("geolocationstatuschanged",{status:Re}),navigator.geolocation.getCurrentPosition(Ve,ke,m.geoLocation.options),ze=navigator.geolocation.watchPosition(Ve,ke,m.geoLocation.options);break;case t.active:Fe()}return Re}});let We=null,Be=[{service:"wmts",url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"red",backgroundColor:"white"},providerName:"OSM",providerKeyNeeded:!1,attribution:""}];function qe(e){e.stopPropagation(),Ie.dispatch("layerchange",{layer:e.target.layer}),De.attributions=e.target.layer.attribution}function Je(e){e.stopPropagation(),Ue.switch()}function Ze(e){e.stopPropagation(),Ce().zoomToTravel()}function _e(e){f.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:e.name,layer:e,textContent:e.toolbar.text,style:"color:"+e.toolbar.color+";background-color:"+e.toolbar.backgroundColor},We).addEventListener("click",qe,!1)}const Ge=Object.seal(new class{createUI(){We=f.create("div",{id:"TravelNotes-ViewerLayersToolbarUI"},document.querySelector("body")),f.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"My position",textContent:"🌐",style:"color:black;background-color:white"},We).addEventListener("click",Je,!1),f.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"Zoom on the travel",textContent:"🔍",style:"color:black;background-color:white"},We).addEventListener("click",Ze,!1),Be.forEach(_e)}setLayer(e){let t=Be.find(t=>t.name===e)||Be[0];Ie.dispatch("layerchange",{layer:t}),De.attributions=t.attribution}addLayers(e){e.forEach(e=>{e.providerKeyNeeded||Be.push(e)})}});let Xe=!1;const Ke=Object.seal(new class{addReadOnlyMap(e,t){Xe||(Xe=!0,document.addEventListener("routeupdated",e=>{e.data&&Me.addRoute(e.data.addedRouteObjId)},!1),document.addEventListener("noteupdated",e=>{e.data&&Me.addNote(e.data.addedNoteObjId)},!1),document.addEventListener("zoomto",e=>{e.data&&Me.zoomTo(e.data.latLng,e.data.geometry)},!1),document.addEventListener("layerchange",e=>{e.data&&Me.setLayer(e.data.layer,e.data.layer.url)}),document.addEventListener("geolocationpositionchanged",e=>{e.data&&Me.onGeolocationPositionChanged(e.data.position)},!1),document.addEventListener("geolocationstatuschanged",e=>{e.data&&Me.onGeolocationStatusChanged(e.data.status)},!1),De.createUI(),t&&Ge.createUI(),Ge.setLayer("OSM - Color"),e&&v.getJsonPromise(e).then(e=>{He().openDistantFile(e)}).catch(e=>{console.log(e||"Not possible to load the .trv file"),re.map.setView([a.defaultValue,a.defaultValue],2)}))}});(function(){let e=null,t=null,o=!1,n="";function r(t){var o,a,r,i;(o=t[0],n="fulfilled"===o.status?(o.value.language=e,"wwwouaiebe.github.io"===window.location.hostname&&(o.value.note.haveBackground=!0),m.overload(o.value),""):"Not possible to load the TravelNotesConfig.json file. ",n)?console.log(n):(a=t[1],r=t[3],n="fulfilled"===a.status?(N.setTranslations(a.value),""):"fulfilled"===r.status?(N.setTranslations(r.value),"Not possible to load the TravelNotes"+e.toUpperCase()+".json file. English will be used. "):"Not possible to load the translations. ",n+="fulfilled"===(i=t[2]).status?(Ge.addLayers(i.value),""):"Not possible to load the TravelNotesLayers.json file. Only the OpenStreetMap background will be available. ",""!==n&&(console.log(n),n=""))}return Object.freeze(new class{start(){window.L.travelNotes=Ke,function(){let a=new URL(window.location),n=a.searchParams.get("fil");if(n&&0!==n.length)try{if(n=atob(n),n.match(/[^\w-%:./]/))throw new Error("invalid char in the url encoded in the fil parameter");let e=new URL(n);a.protocol&&e.protocol&&a.protocol===e.protocol&&a.hostname&&e.hostname&&a.hostname===e.hostname?t=encodeURI(e.href):console.log("The distant file is not on the same site than the app")}catch(e){console.log(e.message)}let r=a.searchParams.get("lng");r&&(r.match(/^[A-Z,a-z]{2}$/)?e=r.toLowerCase():console.log("invalid lng parameter")),""===a.searchParams.get("lay")&&(o=!0)}(),e=e||m.language,Promise.allSettled(function(){let t=window.location.origin+window.location.pathname+"TravelNotes";return[v.getJsonPromise(t+"Config.json"),v.getJsonPromise(t+e.toUpperCase()+".json"),v.getJsonPromise(t+"Layers.json"),v.getJsonPromise(t+"EN.json")]}()).then(e=>{r(e),function(){if(m.autoLoad&&""===n){f.create("div",{id:"Map"},document.querySelector("body"));let e=window.L.map("Map",{attributionControl:!1,zoomControl:!1}).setView([a.defaultValue,a.defaultValue],0);re.map=e,Ke.addReadOnlyMap(t,o)}}()})}})})().start()}();